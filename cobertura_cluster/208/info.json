{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "40d64f4f1e463bdc00c23d7f080b2e6b", "detectedBy": ["AST_HIERARCHICAL"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "580f6d723f8d884bf1e9da2f825b9ccc", "repository": "https://github.com/cobertura/cobertura.git", "fileName": "cobertura/src/net/sourceforge/cobertura/coveragedata/ProjectData.java", "commitBeforeChange": "8d76b07e3d230fcd0d3b233e7ffc80df6ca3ec82", "commitAfterChange": "c7179e693f89a314eb6898100456db755030dd92", "methodNumberBeforeChange": 0, "methodNumberAfterChange": 5, "signatureBeforeChange": "  \tpublic ProjectData()", "signatureAfterChange": "  \tpublic int getNumberOfSourceFiles()", "diff": ["-\tpublic ProjectData()", "-\t{", "-\t}", "+\tpublic int getNumberOfSourceFiles()", "+\t{", "+\t\treturn this.sourceFiles.size();", "+\t}"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "f6d88126db7821e4dfbbe7b23fe873d6", "repository": "https://github.com/cobertura/cobertura.git", "fileName": "cobertura/src/net/sourceforge/cobertura/coveragedata/ProjectData.java", "commitBeforeChange": "d60722f0c5b36ff4b20dbf6bd4dfc6603aa104af", "commitAfterChange": "518c187f06f8c93e5dd5f7fc9752f5520ae1b5e3", "methodNumberBeforeChange": 12, "methodNumberAfterChange": 12, "signatureBeforeChange": "  \tpublic static void saveGlobalProjectData()", "signatureAfterChange": "  \tpublic static void saveGlobalProjectData()", "diff": ["-\t\tFileLocker fileLocker = new FileLocker(dataFile);", "-\t\ttry", "-\t\t{", "-\t\t\t// Read the old data, merge our current data into it, then", "-\t\t\t// write a new ser file.", "-\t\t\tif (fileLocker.lock())", "+\t\t/*", "+\t\t * A note about the next synchronized block:  Cobertura uses static fields to", "+\t\t * hold the data.   When there are multiple classloaders, each classloader", "+\t\t * will keep track of the line counts for the classes that it loads.  ", "+\t\t * ", "+\t\t * The static initializers for the Cobertura classes are also called for", "+\t\t * each classloader.   So, there is one shutdown hook for each classloader.", "+\t\t * So, when the JVM exits, each shutdown hook will try to write the", "+\t\t * data it has kept to the datafile.   They will do this at the same", "+\t\t * time.   Before Java 6, this seemed to work fine, but with Java 6, there", "+\t\t * seems to have been a change with how file locks are implemented.   So,", "+\t\t * care has to be taken to make sure only one thread locks a file at a time.", "+\t\t * ", "+\t\t * So, we will synchronize on the string that represents the path to the", "+\t\t * dataFile.  Apparently, there will be only one of these in the JVM", "+\t\t * even if there are multiple classloaders.  I assume that is because", "+\t\t * the String class is loaded by the JVM's root classloader. ", "+\t\t */", "+\t\tsynchronized (dataFile.getPath().intern() ) {", "+\t\t\tFileLocker fileLocker = new FileLocker(dataFile);", "+\t\t\t", "+\t\t\ttry", "-\t\t\t\tProjectData datafileProjectData = loadCoverageDataFromDatafile(dataFile);", "-\t\t\t\tif (datafileProjectData == null)", "+\t\t\t\t// Read the old data, merge our current data into it, then", "+\t\t\t\t// write a new ser file.", "+\t\t\t\tif (fileLocker.lock())", "-\t\t\t\t\tdatafileProjectData = projectDataToSave;", "+\t\t\t\t\tProjectData datafileProjectData = loadCoverageDataFromDatafile(dataFile);", "+\t\t\t\t\tif (datafileProjectData == null)", "+\t\t\t\t\t{", "+\t\t\t\t\t\tdatafileProjectData = projectDataToSave;", "+\t\t\t\t\t}", "+\t\t\t\t\telse", "+\t\t\t\t\t{", "+\t\t\t\t\t\tdatafileProjectData.merge(projectDataToSave);", "+\t\t\t\t\t}", "+\t\t\t\t\tCoverageDataFileHandler.saveCoverageData(datafileProjectData, dataFile);", "-\t\t\t\telse", "-\t\t\t\t{", "-\t\t\t\t\tdatafileProjectData.merge(projectDataToSave);", "-\t\t\t\t}", "-\t\t\t\tCoverageDataFileHandler.saveCoverageData(datafileProjectData, dataFile);", "-\t\t}", "-\t\tfinally", "-\t\t{", "-\t\t\t// Release the file lock", "-\t\t\tfileLocker.release();", "+\t\t\tfinally", "+\t\t\t{", "+\t\t\t\t// Release the file lock", "+\t\t\t\tfileLocker.release();", "+\t\t\t}"]}]}