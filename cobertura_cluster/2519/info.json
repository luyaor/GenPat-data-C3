{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "109d584b3285909b717af3ea8666c52d", "detectedBy": ["AST_HIERARCHICAL"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "4f284b31735a957cb96c12d88aa8fecc", "repository": "https://github.com/cobertura/cobertura.git", "fileName": "cobertura/src/test/java/net/sourceforge/cobertura/webapp/test/WebAppFunctionalTest.java", "commitBeforeChange": "c375766d9094530d2f833df204ec339bfbb1b3b9", "commitAfterChange": "eca94255cccacd9f5e33441462a1b8a3ddc4d322", "methodNumberBeforeChange": 5, "methodNumberAfterChange": 4, "signatureBeforeChange": "  \t@Test \tpublic void flushCoberturaData() throws Exception", "signatureAfterChange": "  \t@Test \tpublic void flushCoberturaData() throws Exception", "diff": ["-\t\tLogger.getRootLogger().setLevel(Level.ALL);", "-\t\tFile tempDir = TestUtils.getTempDir();", "-\t\tFile webappServerDir = new File(tempDir, \"webserver\");", "-\t\tfinal File srcDir = new File(tempDir, SRC_DIR);", "-\t\tnew File(webappServerDir, \"logs\").mkdirs();", "-", "-\t\tWebappServer.writeSimpleServletSource(srcDir);", "-", "-\t\tfinal String appName = \"simple\";", "-", "-\t\twebappServer.deployApp(new HashMap() {", "-\t\t\t{", "-\t\t\t\tput(\"webInfText\", WebappServer.SIMPLE_SERVLET_WEB_XML_TEXT);", "-\t\t\t\tput(\"srcDir\", srcDir);", "-\t\t\t\tput(\"appName\", appName);", "-\t\t\t\tput(\"instrumentCobertura\", true);", "-\t\t\t\tput(\"deployCoberturaFlush\", true);", "-\t\t\t\tput(\"modifyMainCoberturaDataFile\", true);", "-\t\t\t}", "-\t\t});", "+\t\twebappServer.deployApp(srcDir, true, true, true);", "-\t\tMap data = webappServer.withRunningServer(new Closure(null) {", "-\t\t\tpublic void doCall(HashMap values) {", "-\t\t\t}", "-\t\t});", "+\t\twebappServer.withRunningServer();", "-\t\t/*", "-\t\t * do a HTTP get of the simple webapp - this is just to get somewhat close to a ", "-\t\t * real world scenario", "-\t\t */", "-\t\tString webappResponse = IOUtils", "-\t\t\t\t.toString(new java.net.URL(\"http://\" + data.get(\"hostname\")", "-\t\t\t\t\t\t+ \":\" + data.get(\"webappPort\") + \"/\" + appName", "-\t\t\t\t\t\t+ \"/SimpleServlet\").openConnection().getInputStream());", "-\t\tassertEquals(\"Webapp response was incorrect\", \"Hi\", webappResponse", "-\t\t\t\t.trim());", "+\t\twebappServer.pingServer();", "+\t\t", "+\t\tFile xmlReport = webappServer.getXmlReport();", "-\t\t//Do a coverage report of the main cobertura.ser file at the root of the project", "-\t\tReportTask reportTask = new ReportTask();", "-\t\treportTask.setProject(TestUtils.project);", "-\t\treportTask.setDataFile(((File) data.get(\"datafile\")).getAbsolutePath());", "-\t\treportTask.setFormat(\"xml\");", "-\t\treportTask.setDestDir(new File(((File) data.get(\"xmlReport\"))", "-\t\t\t\t.getParent()));", "-\t\treportTask.execute();", "+\t\tgenerateReportFile(xmlReport);", "-\t\tNode dom = TestUtils.getXMLReportDOM(((File) data.get(\"xmlReport\"))", "-\t\t\t\t.getAbsolutePath());", "+\t\tNode dom = TestUtils.getXMLReportDOM(xmlReport);", "-\t\t//flush the cobertura data by doing an HTTP get", "-", "-\t\tString flushing = IOUtils.toString(new java.net.URL(\"http://\"", "-\t\t\t\t+ data.get(\"hostname\") + \":\" + data.get(\"webappPort\")", "-\t\t\t\t+ \"/coberturaFlush/flushCobertura\").openConnection()", "-\t\t\t\t.getInputStream());", "-", "-\t\tassertEquals(\"\", flushing);", "+\t\twebappServer.pingCoberturaServer();", "-\t\t//run the report again", "+\t\tgenerateReportFile(xmlReport);", "-\t\treportTask = new ReportTask();", "-\t\treportTask.setProject(TestUtils.project);", "-\t\treportTask.setDataFile(((File) data.get(\"datafile\")).getAbsolutePath());", "-\t\treportTask.setFormat(\"xml\");", "-\t\treportTask.setDestDir(new File(((File) data.get(\"xmlReport\"))", "-\t\t\t\t.getParent()));", "-\t\treportTask.execute();", "-", "-\t\tdom = TestUtils.getXMLReportDOM(((File) data.get(\"xmlReport\"))", "-\t\t\t\t.getAbsolutePath());", "+\t\tdom = TestUtils.getXMLReportDOM(xmlReport);"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "7d543a2b5c63f8d8fbd344b2e006e53d", "repository": "https://github.com/cobertura/cobertura.git", "fileName": "cobertura/src/test/java/net/sourceforge/cobertura/webapp/test/WebAppFunctionalTest.java", "commitBeforeChange": "c375766d9094530d2f833df204ec339bfbb1b3b9", "commitAfterChange": "eca94255cccacd9f5e33441462a1b8a3ddc4d322", "methodNumberBeforeChange": 3, "methodNumberAfterChange": 3, "signatureBeforeChange": "  \tpublic void basicStartAndStopOfWebApp(boolean tomcat) throws Exception", "signatureAfterChange": "  \tpublic void basicStartAndStopOfWebApp(boolean tomcat) throws Exception", "diff": ["-\t\tFile tempDir = TestUtils.getTempDir();", "-\t\tFile webappServerDir = new File(tempDir, \"webserver\");", "-", "-\t\tfinal File srcDir = new File(tempDir, SRC_DIR);", "-\t\tnew File(webappServerDir, \"logs\").mkdirs();", "-\t\tWebappServer.writeSimpleServletSource(srcDir);", "-", "-\t\tfinal String appName = \"simple\";", "-", "-\t\twebappServer.deployApp(new HashMap() {", "-\t\t\t{", "-\t\t\t\tput(\"webInfText\", WebappServer.SIMPLE_SERVLET_WEB_XML_TEXT);", "-\t\t\t\tput(\"srcDir\", srcDir);", "-\t\t\t\tput(\"appName\", appName);", "-\t\t\t\tput(\"instrumentRegEx\", \"com.acme.*\");", "-\t\t\t}", "-\t\t});", "+\t\twebappServer.deployApp(srcDir, \"com.acme.*\");", "-\t\tMap data = webappServer.withRunningServer(new Closure(null) {", "-\t\t\tpublic void doCall(HashMap values) {", "-\t\t\t}", "-\t\t});", "+\t\twebappServer.withRunningServer();", "-\t\t//do a HTTP get so the doGet method will be hit", "-\t\tString webappResponse = IOUtils", "-\t\t\t\t.toString(new URL(\"http://\" + data.get(\"hostname\") + \":\"", "-\t\t\t\t\t\t+ data.get(\"webappPort\") + \"/\" + appName", "-\t\t\t\t\t\t+ \"/SimpleServlet\").openConnection().getInputStream());", "+\t\twebappServer.pingServer();", "+\t\t", "+\t\tFile xmlReport = webappServer.getXmlReport();", "-\t\tassertEquals(\"Webapp response was incorrect\", \"Hi\", webappResponse", "-\t\t\t\t.trim());", "+\t\tgenerateReportFile(xmlReport);", "-\t\tReportTask reportTask = new ReportTask();", "-\t\treportTask.setProject(TestUtils.project);", "-\t\treportTask.setDataFile(((File) data.get(\"datafile\")).getAbsolutePath());", "-\t\treportTask.setFormat(\"xml\");", "-\t\treportTask.setDestDir(new File(((File) data.get(\"xmlReport\"))", "-\t\t\t\t.getParent()));", "-\t\treportTask.execute();", "+\t\tNode dom = TestUtils.getXMLReportDOM(xmlReport);", "-\t\tNode dom = TestUtils.getXMLReportDOM(((File) data.get(\"xmlReport\"))", "-\t\t\t\t.getAbsolutePath());", "-", "-\t\t//make sure the report shows the doGet method has not been hit yet - the data is not flushed until the server stops", "-\t\treportTask = new ReportTask();", "-\t\treportTask.setProject(TestUtils.project);", "-\t\treportTask.setDataFile(((File) data.get(\"datafile\")).getAbsolutePath());", "-\t\treportTask.setFormat(\"xml\");", "-\t\treportTask.setDestDir(new File(((File) data.get(\"xmlReport\"))", "-\t\t\t\t.getParent()));", "-\t\treportTask.execute();", "+\t\tgenerateReportFile(xmlReport);", "-\t\tdom = TestUtils.getXMLReportDOM(((File) data.get(\"xmlReport\"))", "-\t\t\t\t.getAbsolutePath());", "+\t\tdom = TestUtils.getXMLReportDOM(xmlReport);", "-\t\t//now that the server has stopped, make sure the report shows it has been hit"]}]}