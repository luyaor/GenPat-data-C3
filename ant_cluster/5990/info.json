{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "d5d492b6367884e92849671ef977a549", "detectedBy": ["DIFF_HIERARCHICAL"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "4d8e3788d9e8bf64eec9ad4b9f24f16d", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/optional/starteam/TreeBasedTask.java", "commitBeforeChange": "837f7ef785e24137608ba41f850d605b23bccff4", "commitAfterChange": "23e61358c8ed2aa3fe63c1f67082150047f1df9e", "methodNumberBeforeChange": 19, "methodNumberAfterChange": 32, "signatureBeforeChange": "     protected static Hashtable listLocalFiles(java.io.File localFolder)", "signatureAfterChange": "         UnmatchedFileMap init(java.io.File localFolder, Folder remoteFolder)", "diff": ["-    protected static Hashtable listLocalFiles(java.io.File localFolder) {", "-        Hashtable localFileList = new Hashtable();", "-        // we can't use java 2 collections so we will use an identity", "-        // Hashtable to  hold the file names.  We only care about the keys,", "-        // not the values (which will all be \"\").", "+         */", "+        UnmatchedFileMap init(java.io.File localFolder, Folder remoteFolder) {", "+            if (!localFolder.exists()) {", "+                return this;", "+            }", "-        if (localFolder.exists()) {", "-            for (int i = 0; i < localFiles.length; i++) {", "-                localFileList.put(localFolder.toString() +", "-                        java.io.File.separatorChar + localFiles[i], \"\");", "+    ", "+            for (int i=0; i < localFiles.length; i++) {", "+                String fn = localFiles[i];", "+                java.io.File localFile = ", "+                    new java.io.File(localFolder, localFiles[i]).getAbsoluteFile();", "+                ", "+                log(\"adding \" + localFile + \" to UnmatchedFileMap\",", "+                    Project.MSG_DEBUG);", "+    ", "+                if (localFile.isDirectory()) {", "+                    this.put(localFile, new Folder( remoteFolder, fn, fn));", "+                } ", "+                else {", "+                    com.starbase.starteam.File remoteFile = ", "+                        new com.starbase.starteam.File(remoteFolder);", "+                    remoteFile.setName(fn);", "+                    this.put(localFile, remoteFile);", "+                }", "+            }", "+            return this;", "+        }", "-        return localFileList;"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "637b36888ae81d50cab395fa1d703faf", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/optional/starteam/StarTeamList.java", "commitBeforeChange": "837f7ef785e24137608ba41f850d605b23bccff4", "commitAfterChange": "23e61358c8ed2aa3fe63c1f67082150047f1df9e", "methodNumberBeforeChange": 3, "methodNumberAfterChange": 4, "signatureBeforeChange": "     protected void visit(Folder starteamFolder, java.io.File targetFolder)             throws BuildException", "signatureAfterChange": "     protected void visit(Folder starteamFolder, java.io.File targetFolder)             throws BuildException", "diff": ["-            if (null == getRootLocalFolder()) {", "-                log(\"Folder: \" + starteamFolder.getName() + \" (Default folder: \" + targetFolder + \")\");", "-            } else {", "-                log(\"Folder: \" + starteamFolder.getName() + \" (Local folder: \" + targetFolder + \")\");", "+            if (null != getRootLocalFolder()) {", "+                starteamFolder.setAlternatePathFragment(", "+                    targetFolder.getAbsolutePath());", "+", "-            Hashtable localFiles = listLocalFiles(targetFolder);", "+            Folder[] subFolders = starteamFolder.getSubFolders();", "+            Item[] files = starteamFolder.getItems(getTypeNames().FILE);", "+            ", "+            UnmatchedFileMap ufm = ", "+                new UnmatchedListingMap().init(", "+                    targetFolder.getAbsoluteFile(), starteamFolder);", "+", "+            log(\"\");", "+            log(\"Listing StarTeam folder \" + ", "+                starteamFolder.getFolderHierarchy()); ", "+            log(\" against local folder \" + ", "+                targetFolder.getAbsolutePath());", "+", "-            Item[] files = starteamFolder.getItems(\"File\");", "-                delistLocalFile(localFiles, localFile);", "-", "-", "+                ufm.removeControlledItem(localFile);", "-            Folder[] subFolders = starteamFolder.getSubFolders();", "-                delistLocalFile(localFiles, targetSubfolder);", "+                ufm.removeControlledItem(targetSubfolder);", "+            }", "+            if (this.listUncontrolled) {", "+                ufm.processUncontrolledItems();"]}]}