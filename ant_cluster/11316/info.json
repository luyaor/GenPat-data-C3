{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "dae96d754ff8404536e8cdd3b7995dd1", "detectedBy": ["AST_HIERARCHICAL"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "17d131f3b0aa381121d99f7f0e7e2303", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/Rmic.java", "commitBeforeChange": "d5313cd9aeb9e62923cf784c46598937160aba2e", "commitAfterChange": "38c2a2a22283450dab6afcf3d3ec094c67dc1e4e", "methodNumberBeforeChange": 7, "methodNumberAfterChange": 8, "signatureBeforeChange": "      public void execute() throws BuildException", "signatureAfterChange": "      public void execute() throws BuildException", "diff": ["+", "-        File baseFile = project.resolveFile(base);", "+        File baseDir = project.resolveFile(base);", "+        if (baseDir == null) {", "+            throw new BuildException(\"base attribute must be set!\", location);", "+        }", "+        if (!baseDir.exists()) {", "+            throw new BuildException(\"base does not exist!\", location);", "+        }", "+", "+        if (verify) {", "+            project.log(\"Verify has been turned on.\", Project.MSG_INFO);", "+        }", "-        if (null != sourceBase)", "+        if (null != sourceBase) {", "-        String classpath = getCompileClasspath(baseFile);", "+        }", "+        String classpath = getCompileClasspath(baseDir);", "+", "+        // scan base dirs to build up compile lists", "+", "+        DirectoryScanner ds = this.getDirectoryScanner(baseDir);", "+", "+        String[] files = ds.getIncludedFiles();", "+", "+        scanDir(baseDir, files, verify);", "+", "-            int argCount = 5;", "+        int argCount = 5;", "+        if (compileList.size() > 0) argCount += compileList.size() - 1;", "-        args[i++] = baseFile.getAbsolutePath();", "+        args[i++] = baseDir.getAbsolutePath();", "-        args[i++] = classname;", "-        compiler.compile(args);", "+        if (classname != null) {", "+            if (shouldCompile(new File(baseDir, classname.replace('.', File.separatorChar)))) {", "+                args[i++] = classname;", "+                compiler.compile(args);", "+            }", "+        } else {", "+            if (compileList.size() > 0) {", "+                project.log(\"RMI Compiling \" + compileList.size() +", "+                            \" classes to \" + baseDir, Project.MSG_INFO);", "+", "+                for (int j = 0; j < compileList.size(); j++) {", "+                    args[i++] = (String) compileList.elementAt(j);", "+                }", "+                compiler.compile(args);", "+            }", "+        }", "-                String stubFileName = classname.replace('.', '/') + \"_Stub.java\";", "-            File oldStubFile = new File(baseFile, stubFileName);", "-            File newStubFile = new File(sourceBaseFile, stubFileName);", "-            try {", "-                project.copyFile(oldStubFile, newStubFile, filtering);", "-                oldStubFile.delete();", "-            } catch (IOException ioe) {", "-                String msg = \"Failed to copy \" + oldStubFile + \" to \" +", "-                             newStubFile + \" due to \" + ioe.getMessage();", "-                throw new BuildException(msg);", "-            }", "-            if (!\"1.2\".equals(stubVersion)) {", "-                String skelFileName = classname.replace('.', '/') + \"_Skel.java\";", "-                File oldSkelFile = new File(baseFile, skelFileName);", "-                File newSkelFile = new File(sourceBaseFile, skelFileName);", "-                try {", "-                    project.copyFile(oldSkelFile, newSkelFile, filtering);", "-                    oldSkelFile.delete();", "-                } catch (IOException ioe) {", "-                    String msg = \"Failed to copy \" + oldSkelFile + \" to \" +", "-                                  newSkelFile + \" due to \" + ioe.getMessage();", "-                    throw new BuildException(msg);", "+            if (classname != null) {", "+                moveGeneratedFile(baseDir, sourceBaseFile, classname);", "+            } else {", "+                for (int j = 0; j < compileList.size(); j++) {", "+                    moveGeneratedFile(baseDir, sourceBaseFile, (String) compileList.elementAt(j));", "+    }"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "2f84cb412a70ae90bd841c62db392f81", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/launch/Launcher.java", "commitBeforeChange": "6867c1dd7e1ff94b1ab8f87a314a528eb847c69a", "commitAfterChange": "c12912c52bda86fe28ed7476165b6cc49ce8c0ee", "methodNumberBeforeChange": 1, "methodNumberAfterChange": 1, "signatureBeforeChange": "     private void run(String[] args) throws MalformedURLException", "signatureAfterChange": "     private void run(String[] args) throws MalformedURLException", "diff": ["-        String libPath = \"\";", "-        String[] newargs = null;", "-        int argcount = -1;", "-        for (argcount = 0; argcount < args.length -1; argcount++) {", "-            if (args[argcount].equals(\"-lib\")) {", "-                libPath = args[argcount + 1];", "-                break;", "+", "+        List libPaths = new ArrayList();", "+        List argList = new ArrayList();", "+        String[] newArgs;", "+", "+        for (int i = 0; i < args.length; ++i) {", "+            if (args[i].equals(\"-lib\")) {", "+                if (i == args.length - 1) {", "+                    throw new IllegalStateException(\"The -lib argument must \"", "+                        + \"be followed by a library location\");", "+                }", "+                libPaths.add(args[++i]);", "+            } else {", "+                argList.add(args[i]);", "-        }", "-        if (args.length > 0 && args[args.length -1].equals(\"-lib\")) {", "-            // if the last argument is -lib", "-            // remove it from the arguments passed to Launcher", "-            //", "-            newargs = new String[args.length - 1];", "-            System.arraycopy(args, 0, newargs, 0, args.length -1);", "-        } else if (libPath.equals(\"\")) {", "-           newargs = new String[args.length];", "-           System.arraycopy(args, 0, newargs, 0, args.length);", "-        }  else {", "-            newargs = new String[args.length - 2];", "-            // copy the beginning of the args array", "-            if (argcount > 0 ) {", "-                System.arraycopy(args, 0, newargs, 0 ,argcount);", "-            }", "-            // copy the end of the args array", "-            if ((argcount + 2 < args.length) && argcount > 0) {", "-                System.arraycopy(args, argcount + 2, newargs, argcount, args.length - (argcount + 2));", "-            }", "-        }", "-        StringTokenizer myTokenizer = new StringTokenizer(libPath, System.getProperty(\"path.separator\"));", "-        URL[] classPathJars = new URL[myTokenizer.countTokens()];", "-        int classPathJarCount = 0;", "-        while (myTokenizer.hasMoreElements()) {", "-            String token = myTokenizer.nextToken();", "-            classPathJars[classPathJarCount++] = new File(token).toURL();", "+        if (libPaths.size() == 0) {", "+            newArgs = args;", "+        } else {", "+            newArgs = (String[]) argList.toArray(new String[0]);", "+        }", "+", "+        List libPathURLs = new ArrayList();", "+        for (Iterator i = libPaths.iterator(); i.hasNext();) {", "+            String libPath = (String) i.next();", "+            StringTokenizer myTokenizer", "+                = new StringTokenizer(libPath, System.getProperty(\"path.separator\"));", "+            while (myTokenizer.hasMoreElements()) {", "+                File element = new File(myTokenizer.nextToken());", "+                if (element.isDirectory()) {", "+                    // add any jars in the directory", "+                    URL[] dirURLs = Locator.getLocationURLs(element);", "+                    for (int j = 0; j < dirURLs.length; ++j) {", "+                        libPathURLs.add(dirURLs[j]);", "+                    }", "+                }", "+                libPathURLs.add(element.toURL());", "+            }", "+        }", "+", "+        URL[] libJars = (URL[])libPathURLs.toArray(new URL[0]);", "-        int numJars = classPathJars.length + userJars.length + systemJars.length;", "+        int numJars = libJars.length + userJars.length + systemJars.length;", "-        System.arraycopy(classPathJars, 0, jars, 0, classPathJars.length);", "-        System.arraycopy(userJars, 0, jars, classPathJars.length, userJars.length);", "-        System.arraycopy(systemJars, 0, jars, userJars.length + classPathJars.length,", "+        System.arraycopy(libJars, 0, jars, 0, libJars.length);", "+        System.arraycopy(userJars, 0, jars, libJars.length, userJars.length);", "+        System.arraycopy(systemJars, 0, jars, userJars.length + libJars.length,", "+        if (baseClassPath.charAt(baseClassPath.length() - 1)", "+                == File.pathSeparatorChar) {", "+            baseClassPath.setLength(baseClassPath.length() - 1);", "+        }", "-            main.startAnt(newargs, null, null);", "+            main.startAnt(newArgs, null, null);"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "870e930c05cdf4689786351605ca1f3b", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/Concat.java", "commitBeforeChange": "ec980be7345681968c93f0609e9a3fecb39b9753", "commitAfterChange": "fbb9886634198d8377104bef9ec697fadeb134df", "methodNumberBeforeChange": 16, "methodNumberAfterChange": 19, "signatureBeforeChange": "     private void checkAndExecute()", "signatureAfterChange": "     private ResourceCollection validate()", "diff": ["-    private void checkAndExecute() {", "+    private ResourceCollection validate() {", "-                    \"DestFile attribute is required for binary concatenation\");", "+                    \"destfile attribute is required for binary concatenation\");", "-", "-", "-", "-        if (sources.size() == 0 && textBuffer == null) {", "+        if (rc == null && textBuffer == null) {", "-                \"At least one file must be provided, or some text.\");", "+                \"At least one resource must be provided, or some text.\");", "-", "-        // If using filesets, disallow inline text. This is similar to", "-        // using GNU 'cat' with file arguments -- stdin is simply", "-        // ignored.", "-        if (sources.size() > 0 && textBuffer != null) {", "-            throw new BuildException(", "-                \"Cannot include inline text when using filesets.\");", "-        }", "-", "-        // Iterate thru the sources - paths, filesets and filelists", "-        for (Enumeration e = sources.elements(); e.hasMoreElements();) {", "-            Object o = e.nextElement();", "-            if (o instanceof Path) {", "-                Path path = (Path) o;", "-                checkAddFiles(null, path.list());", "-", "-            } else if (o instanceof FileSet) {", "-                FileSet fileSet = (FileSet) o;", "-                DirectoryScanner scanner =", "-                    fileSet.getDirectoryScanner(getProject());", "-                checkAddFiles(fileSet.getDir(getProject()),", "-                              scanner.getIncludedFiles());", "-", "-            } else if (o instanceof FileList) {", "-                FileList fileList = (FileList) o;", "-                checkAddFiles(fileList.getDir(getProject()),", "-                              fileList.getFiles(getProject()));", "+        if (rc != null) {", "+            // If using resources, disallow inline text. This is similar to", "+            // using GNU 'cat' with file arguments -- stdin is simply", "+            // ignored.", "+            if (textBuffer != null) {", "+                throw new BuildException(", "+                    \"Cannot include inline text when using resources.\");", "-        }", "-", "-        // check if the files are outofdate", "-        if (destinationFile != null && !forceOverwrite", "-            && (sourceFiles.size() > 0) && destinationFile.exists()) {", "-            boolean outofdate = false;", "-            for (int i = 0; i < sourceFiles.size(); ++i) {", "-                File file = (File) sourceFiles.elementAt(i);", "-                if (file.lastModified() > destinationFile.lastModified()) {", "-                    outofdate = true;", "-                    break;", "+            Restrict noexistRc = new Restrict();", "+            noexistRc.add(NOT_EXISTS);", "+            noexistRc.add(rc);", "+            for (Iterator i = noexistRc.iterator(); i.hasNext();) {", "+                log(i.next() + \" does not exist.\", Project.MSG_ERR);", "+            }", "+            if (destinationFile != null) {", "+                for (Iterator i = rc.iterator(); i.hasNext();) {", "+                    Object o = i.next();", "+                    if (o instanceof FileResource) {", "+                        File f = ((FileResource) o).getFile();", "+                        if (FILE_UTILS.fileNameEquals(f, destinationFile)) {", "+                            throw new BuildException(\"Input file \\\"\"", "+                                + f + \"\\\" is the same as the output file.\");", "+                        }", "+                    }", "+                }", "+            }", "+            Restrict existRc = new Restrict();", "+            existRc.add(EXISTS);", "+            existRc.add(rc);", "+            boolean outofdate = destinationFile == null || forceOverwrite;", "+            if (!outofdate) {", "+                for (Iterator i = existRc.iterator(); !outofdate && i.hasNext();) {", "+                    Resource r = (Resource) i.next();", "-                return; // no need to do anything", "+                return null; // no need to do anything", "+            return existRc;", "+        } else {", "+            StringResource s = new StringResource();", "+            s.setProject(getProject());", "+            s.setValue(textBuffer.toString());", "+            return s;", "+    }", "-        // Do nothing if all the sources are not present", "-        // And textBuffer is null", "-        if (textBuffer == null && sourceFiles.size() == 0", "-            && header == null && footer == null) {", "-            log(\"No existing files and no nested text, doing nothing\",", "-", "-            binaryCat();", "-            cat();", "-        }", "-    }"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "caf24dd808d201d010220002b72acdd7", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "proposal/myrmidon/src/java/org/apache/ant/Main.java", "commitBeforeChange": "58f8db35ee5db94294191fc2599cb02a8086b881", "commitAfterChange": "8c97911720b40557d78672245bc2e7f724917297", "methodNumberBeforeChange": 2, "methodNumberAfterChange": 2, "signatureBeforeChange": "     protected void execute( final List clOptions )         throws Exception", "signatureAfterChange": "     protected void execute( final List clOptions )         throws Exception", "diff": ["-        String builderName = null;", "-        String binDir = null;", "-        String libDir = null;", "-            case BIN_DIR_OPT: binDir = option.getArgument(); break;", "-            case LIB_DIR_OPT: libDir = option.getArgument(); break;", "-        if( null == logLevel ) logLevel = getDefaultLogLevel();", "-        if( null == listenerName ) listenerName = getDefaultListener();", "-        if( null == filename ) filename = getDefaultFilename();", "-        if( null == libDir ) libDir = getDefaultLibDir();", "-        if( null == taskLibDir ) taskLibDir = getDefaultTaskLibDir();", "-        if( null == builderName ) builderName = getBuilderNameFor( filename );", "+        if( null == logLevel ) logLevel = DEFAULT_LOGLEVEL;", "+        if( null == listenerName ) listenerName = DEFAULT_LISTENER;", "+        if( null == filename ) filename = DEFAULT_FILENAME;", "-        setupLogger( logLevel ); //handle logging...", "-        setupListener( listenerName ); //handle listener..", "-        setupDefaultAntDirs();        ", "+        //handle logging...", "+        setLogger( createLogger( logLevel ) );", "-        //try to auto-discover the location of ant so that ", "-        //can populate classpath with libs/tasks and gain access", "-        //to antRun", "-        if( null == binDir && null == homeDir ) ", "+        //if ant home not set then use system property ant.home ", "+        //that was set up by launcher.", "+        if( null == homeDir ) homeDir = System.getProperty( \"ant.home\" );", "+", "+        final Properties properties = new Properties();", "+        properties.setProperty( \"ant.home\", homeDir );", "+", "+        if( null != taskLibDir ) properties.setProperty( \"ant.path.task-lib\", taskLibDir );", "+", "+        m_homeDir = (new File( homeDir )).getAbsoluteFile();", "+        if( !m_homeDir.isDirectory() )", "-            m_homeDir = getDefaultHomeDir();", "-            m_binDir = m_homeDir.getParentFile();", "-        }", "-        else if( null == binDir ) // && null != homeDir", "-        {", "-            m_homeDir = getHomeDir( homeDir );", "-            m_binDir = new File( m_homeDir, \"bin\" );", "-        }", "-        else", "-        {", "-            m_binDir = getBinDir( binDir );", "-            m_homeDir = m_binDir.getParentFile();", "+            throw new AntException( \"ant-home (\" + m_homeDir + \") is not a directory\" );", "-        m_libDir = getLibDir( m_homeDir, libDir );", "-        m_taskLibDir = getTaskLibDir( m_homeDir, taskLibDir );", "-        m_buildFile = getFile( filename );", "+        final File libDir = new File( m_homeDir, \"lib\" );", "-        m_logger.warn( \"Ant Build File: \" + m_buildFile );", "-        m_logger.info( \"Ant Home Directory: \" + m_homeDir );", "-        m_logger.info( \"Ant Bin Directory: \" + m_binDir );", "-        m_logger.debug( \"Ant Lib Directory: \" + m_libDir );", "-        m_logger.debug( \"Ant Task Lib Directory: \" + m_taskLibDir );", "-", "+        final File buildFile = (new File( filename )).getCanonicalFile();", "+        if( !buildFile.isFile() )", "+        {", "+            throw new AntException( \"File \" + buildFile + \" is not a file or doesn't exist\" );", "+        }", "+        ", "-        setupContextClassLoader( m_libDir );", "+        final ClassLoader classLoader = createClassLoader( libDir );", "+        Thread.currentThread().setContextClassLoader( classLoader );", "-        final Project project = getProject( builderName, m_buildFile );", "+        //handle listener.. ", "+        final ProjectListener listener = createListener( listenerName ); ", "+", "+        getLogger().warn( \"Ant Build File: \" + buildFile );", "+        getLogger().info( \"Ant Home Directory: \" + m_homeDir );", "+        //getLogger().info( \"Ant Bin Directory: \" + m_binDir );", "+        //getLogger().debug( \"Ant Lib Directory: \" + m_libDir );", "+        //getLogger().debug( \"Ant Task Lib Directory: \" + m_taskLibDir );", "+", "+        final AntEngine antEngine = new DefaultAntEngine();", "+        setupLogger( antEngine );", "+        antEngine.setProperties( properties );", "+        antEngine.init();", "+", "+        final ProjectBuilder builder = antEngine.getProjectBuilder();", "+", "+        //create the project", "+        final Project project = builder.build( buildFile );", "-        final ProjectEngine engine = getProjectEngine();", "-", "-        //make sure Engine is sweet...", "-        if( engine instanceof Initializable )", "-        {", "-            ((Initializable)engine).init();", "-        }", "-", "-        engine.addProjectListener( m_listener );", "-", "-        deployDefaultTaskLibs( engine, m_taskLibDir );", "+        final ProjectEngine engine = antEngine.getProjectEngine();", "+        engine.addProjectListener( listener );", "-        //shutdown engine gracefully if needed", "-        if( engine instanceof Disposable )", "-        {", "-            ((Disposable)engine).dispose();", "-        }", "-    }", "+        antEngine.dispose();"]}]}