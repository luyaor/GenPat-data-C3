{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "bce35e02eb0530b55a5e85538ed143c8", "detectedBy": ["DIFF_HIERARCHICAL", "DIFF_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "b0b07f4dd6bf5f7422bcdec174e2322f", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/Zip.java", "commitBeforeChange": "fffe72edb5a6a6deb6222d79841a42c1663ccd36", "commitAfterChange": "b74b9067510ce1fd1ce68b465f74c38c81fb7d01", "methodNumberBeforeChange": 10, "methodNumberAfterChange": 10, "signatureBeforeChange": "      public void execute() throws BuildException", "signatureAfterChange": "      public void execute() throws BuildException", "diff": ["-        File renamedFile=null;", "+        File renamedFile = null;", "-        boolean reallyDoUpdate=false;", "+        ", "+        addingNewFiles = true;", "+        boolean reallyDoUpdate = false;", "-            reallyDoUpdate=true;", "+            reallyDoUpdate = true;", "-                renamedFile = new File (zipFile.getParent(), \"tmp.\"+i);", "+                renamedFile = new File(zipFile.getParent(), \"tmp.\"+i);", "-                if (!renamedFile.exists())", "+                if (!renamedFile.exists()) {", "+                }", "-            if (i==1000)", "-                throw new BuildException ", "-                (\"Can't find temporary filename to rename old file to.\");", "+            if (i == 1000) {", "+                throw new BuildException(\"Can't find available temporary filename to which to rename old file.\");", "+            }", "+            ", "-                if (!zipFile.renameTo (renamedFile))", "-                    throw new BuildException ", "-                    (\"Unable to rename old file to temporary file\");", "+                if (!zipFile.renameTo(renamedFile)) {", "+                    throw new BuildException(\"Unable to rename old file to temporary file\");", "+                }", "-                throw new BuildException ", "-                    (\"Not allowed to rename old file to temporary file\");", "+                throw new BuildException(\"Not allowed to rename old file to temporary file\");", "-        if (baseDir != null)", "+        if (baseDir != null) {", "+        }", "-        if (isUpToDate(scanners, zipFile)) return;", "+        if (isUpToDate(scanners, zipFile)) {", "+            return;", "+        }", "-        String action=reallyDoUpdate ? \"Updating \" : \"Building \";", "+        String action = reallyDoUpdate ? \"Updating \" : \"Building \";", "-                if (baseDir != null)", "+                if (baseDir != null) {", "+                }", "-                if (reallyDoUpdate)", "-                {", "-                    ZipFileSet oldFiles = new ZipFileSet ();", "-                    oldFiles.setSrc (renamedFile);", "+                if (reallyDoUpdate) {", "+                    addingNewFiles = false;", "+                    ZipFileSet oldFiles = new ZipFileSet();", "+                    oldFiles.setSrc(renamedFile);", "-                    StringBuffer exclusionPattern=new StringBuffer();", "+                    StringBuffer exclusionPattern = new StringBuffer();", "-                        if (i != 0)", "-                            exclusionPattern.append (\",\");", "-                        exclusionPattern.append ", "-                            ((String) addedFiles.elementAt(i));", "+                        if (i != 0) {", "+                            exclusionPattern.append(\",\");", "+                        }", "+                        exclusionPattern.append((String)addedFiles.elementAt(i));", "-                    oldFiles.setExcludes (exclusionPattern.toString());", "+                    oldFiles.setExcludes(exclusionPattern.toString());", "-                    tmp.addElement (oldFiles);", "-                    addFiles (tmp, zOut);", "+                    tmp.addElement(oldFiles);", "+                    addFiles(tmp, zOut);", "+                finalizeZipOutputStream(zOut);"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "c2d8b3b8191738853c84decb552172ab", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/Zip.java", "commitBeforeChange": "e5fcb123200cbdf1faccaf2a57fdf8c1e272d8bb", "commitAfterChange": "ec2d68aa71e1dfc8503b4a74f04d8ebd9bc02561", "methodNumberBeforeChange": 9, "methodNumberAfterChange": 10, "signatureBeforeChange": "      public void execute() throws BuildException", "signatureAfterChange": "      public void execute() throws BuildException", "diff": ["+        // Renamed version of original file, if it exists", "+        File renamedFile=null;", "+        // Whether or not an actual update is required -", "+        // we don't need to update if the original file doesn't exist", "+        boolean reallyDoUpdate=false;", "+        if (doUpdate && zipFile.exists())", "+        {", "+            reallyDoUpdate=true;", "+            ", "+            int i;", "+            for (i=0; i < 1000; i++)", "+            {", "+                renamedFile = new File (zipFile.getParent(), \"tmp.\"+i);", "+                ", "+                if (!renamedFile.exists())", "+                    break;", "+            }", "+            if (i==1000)", "+                throw new BuildException ", "+                (\"Can't find temporary filename to rename old file to.\");", "+            try", "+            {", "+                if (!zipFile.renameTo (renamedFile))", "+                    throw new BuildException ", "+                    (\"Unable to rename old file to temporary file\");", "+            }", "+            catch (SecurityException e)", "+            {", "+                throw new BuildException ", "+                    (\"Not allowed to rename old file to temporary file\");", "+            }", "+        }", "+        ", "-        log(\"Building \"+ archiveType +\": \"+ zipFile.getAbsolutePath());", "+        String action=reallyDoUpdate ? \"Updating \" : \"Building \";", "+        ", "+        log(action + archiveType +\": \"+ zipFile.getAbsolutePath());", "+        boolean success = false;", "-            boolean success = false;", "+                if (reallyDoUpdate)", "+                {", "+                    ZipFileSet oldFiles = new ZipFileSet ();", "+                    oldFiles.setSrc (renamedFile);", "+                    ", "+                    StringBuffer exclusionPattern=new StringBuffer();", "+                    for (int i=0; i < addedFiles.size(); i++)", "+                    {", "+                        if (i != 0)", "+                            exclusionPattern.append (\",\");", "+                        exclusionPattern.append ", "+                            ((String) addedFiles.elementAt(i));", "+                    }", "+                    oldFiles.setExcludes (exclusionPattern.toString());", "+                    Vector tmp = new Vector();", "+                    tmp.addElement (oldFiles);", "+                    addFiles (tmp, zOut);", "+                }", "+            if (reallyDoUpdate) {", "+                if (!renamedFile.renameTo (zipFile)) {", "+                    msg+=\" (and I couldn't rename the temporary file \"+", "+                        renamedFile.getName()+\" back)\";", "+                }", "+            }", "+            ", "+        // If we've been successful on an update, delete the temporary file", "+        if (success && reallyDoUpdate)", "+            if (!renamedFile.delete())", "+                log (\"Warning: unable to delete temporary file \"+", "+                     renamedFile.getName(), Project.MSG_WARN);"]}]}