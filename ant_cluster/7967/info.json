{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "260f8c7553fdb20191bd7f4969f18c1a", "detectedBy": ["DIFF_HIERARCHICAL"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "bbd7080aeb48a0b41ebe40083009a5fe", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/optional/ejb/WeblogicDeploymentTool.java", "commitBeforeChange": "d60b6ca1eea0a3372c99965f3c15466328659908", "commitAfterChange": "c6c232893c39257745a8f7a618bcdb5c59791cae", "methodNumberBeforeChange": 26, "methodNumberAfterChange": 26, "signatureBeforeChange": "     protected boolean isRebuildRequired(File genericJarFile, File weblogicJarFile)", "signatureAfterChange": "     protected boolean isRebuildRequired(File genericJarFile, File weblogicJarFile)", "diff": ["-    protected boolean isRebuildRequired(File genericJarFile, File weblogicJarFile)", "-    {", "+    protected boolean isRebuildRequired(File genericJarFile, File weblogicJarFile) {", "-        try", "-        {", "+        try {", "-                && weblogicJarFile.exists() && weblogicJarFile.isFile())", "-            {", "+                 && weblogicJarFile.exists() && weblogicJarFile.isFile()) {", "-                for (Enumeration e = genericJar.entries(); e.hasMoreElements();)", "-                {", "-                    JarEntry je = (JarEntry)e.nextElement();", "+                for (Enumeration e = genericJar.entries(); e.hasMoreElements();) {", "+                    JarEntry je = (JarEntry) e.nextElement();", "+", "-                for (Enumeration e = wlJar.entries() ; e.hasMoreElements();)", "-                {", "-                    JarEntry je = (JarEntry)e.nextElement();", "+                for (Enumeration e = wlJar.entries(); e.hasMoreElements();) {", "+                    JarEntry je = (JarEntry) e.nextElement();", "+", "-                for (Enumeration e = genericEntries.keys(); e.hasMoreElements();)", "-                {", "-                    String filepath = (String)e.nextElement();", "-                    if (wlEntries.containsKey(filepath))    // File name/path match", "-                    {", "+", "+                for (Enumeration e = genericEntries.keys(); e.hasMoreElements();) {", "+                    String filepath = (String) e.nextElement();", "+", "+                    if (wlEntries.containsKey(filepath)) {// File name/path match", "+", "-                        JarEntry genericEntry = (JarEntry)genericEntries.get(filepath);", "-                        JarEntry wlEntry = (JarEntry)wlEntries.get(filepath);", "-                        if ((genericEntry.getCrc() !=  wlEntry.getCrc())  || // Crc's Match", "-                            (genericEntry.getSize() != wlEntry.getSize()) ) // Size Match", "-                        {", "-                            if (genericEntry.getName().endsWith(\".class\"))", "-                            {", "+                        JarEntry genericEntry = (JarEntry) genericEntries.get(filepath);", "+                        JarEntry wlEntry = (JarEntry) wlEntries.get(filepath);", "+", "+                        if ((genericEntry.getCrc() != wlEntry.getCrc()) || // Crc's Match", "+                        (genericEntry.getSize() != wlEntry.getSize())) {// Size Match", "+", "+                            if (genericEntry.getName().endsWith(\".class\")) {", "-                                String classname = genericEntry.getName().replace(File.separatorChar,'.');", "-                                classname = classname.substring(0,classname.lastIndexOf(\".class\"));", "+                                String classname = genericEntry.getName().replace(File.separatorChar, '.');", "+", "+                                classname = classname.substring(0, classname.lastIndexOf(\".class\"));", "+", "-                                if (genclass.isInterface())", "-                                {", "+", "+                                if (genclass.isInterface()) {", "-                                    log(\"Interface \" + genclass.getName() + \" has changed\",Project.MSG_VERBOSE);", "+                                    log(\"Interface \" + genclass.getName() + \" has changed\", Project.MSG_VERBOSE);", "-                                }", "-                                else", "-                                {", "+                                } else {", "-                            }", "-                            else", "-                            {", "+                            } else {", "-                                    log(\"Non class file \" + genericEntry.getName() + \" has changed\",Project.MSG_VERBOSE);", "+                                    log(\"Non class file \" + genericEntry.getName() + \" has changed\", Project.MSG_VERBOSE);", "-                    }", "-                    else // a file doesnt exist rebuild", "-                    {", "-                        log(\"File \" + filepath + \" not present in weblogic jar\",Project.MSG_VERBOSE);", "-                        rebuild =  true;", "+                    } else {// a file doesnt exist rebuild", "+", "+                        log(\"File \" + filepath + \" not present in weblogic jar\", Project.MSG_VERBOSE);", "+                        rebuild = true;", "-                if (!rebuild)", "-                {", "-                    log(\"No rebuild needed - updating jar\",Project.MSG_VERBOSE);", "+                if (!rebuild) {", "+                    log(\"No rebuild needed - updating jar\", Project.MSG_VERBOSE);", "-                    for (Enumeration e = wlEntries.elements() ; e.hasMoreElements();)", "-                    {", "+                    for (Enumeration e = wlEntries.elements(); e.hasMoreElements();) {", "-                        JarEntry je = (JarEntry)e.nextElement();", "+                        JarEntry je = (JarEntry) e.nextElement();", "+", "-                                je.getCompressedSize() == je.getSize()) {", "+                            je.getCompressedSize() == je.getSize()) {", "-                        }", "-                        else {", "+                        } else {", "-                        if (replaceEntries.containsKey(je.getName()))", "-                        {", "-                            log(\"Updating Bean class from generic Jar \" + je.getName(),Project.MSG_VERBOSE);", "+                        if (replaceEntries.containsKey(je.getName())) {", "+                            log(\"Updating Bean class from generic Jar \" + je.getName(), Project.MSG_VERBOSE);", "-                            je = (JarEntry)replaceEntries.get(je.getName());", "+                            je = (JarEntry) replaceEntries.get(je.getName());", "-                        }", "-                        else  //use fle from original weblogic jar", "-                        {", "+                        } else {//use fle from original weblogic jar", "+", "-                        while ((bytesRead = is.read(buffer)) != -1)", "-                        {", "-                            newJarStream.write(buffer,0,bytesRead);", "+                        while ((bytesRead = is.read(buffer)) != -1) {", "+                            newJarStream.write(buffer, 0, bytesRead);", "+                } else {", "+                    log(\"Weblogic Jar rebuild needed due to changed \"", "+                         + \"interface or XML\", Project.MSG_VERBOSE);", "-                else", "-                {", "-                    log(\"Weblogic Jar rebuild needed due to changed interface or XML\",Project.MSG_VERBOSE);", "-                }", "-            }", "-            else", "-            {", "+            } else {", "-        }", "-        catch(ClassNotFoundException cnfe)", "-        {", "+        } catch (ClassNotFoundException cnfe) {", "-                + \". Details: \"", "-                + cnfe.getMessage();", "+                 + \". Details: \"", "+                 + cnfe.getMessage();", "+", "-        }", "-        catch(IOException ioe) {", "+        } catch (IOException ioe) {", "-                + \". Details: \"", "-                + ioe.getMessage();", "+                 + \". Details: \"", "+                 + ioe.getMessage();", "+", "-        }", "-        finally {", "+        } finally {", "+                } catch (IOException closeException) {", "-                catch (IOException closeException) {}", "+                } catch (IOException closeException) {", "-                catch (IOException closeException) {}", "+                } catch (IOException closeException) {", "-                catch (IOException closeException) {}"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "c352bed73a7e5ea10cb068dfb2d7f6ab", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/FixCRLF.java", "commitBeforeChange": "0777fa853af3a619d777adaead96e9c0d1aff291", "commitAfterChange": "5061e731c3919a7236bdcdd2ad9965d384313e26", "methodNumberBeforeChange": 15, "methodNumberAfterChange": 15, "signatureBeforeChange": "       private void processFile(String file) throws BuildException", "signatureAfterChange": "      private void processFile(String file) throws BuildException", "diff": ["-", "-        File tmpFile = null;", "-        BufferedWriter outWriter;", "-        OneLiner.BufferLine line;", "-        // read the contents of the file", "-        OneLiner lines = new OneLiner(srcFile);", "+        FilterChain fc = new FilterChain();", "+        fc.add(filter);", "+        Vector fcv = new Vector(1);", "+        fcv.add(fc);", "+        File tmpFile = FILE_UTILS.createTempFile(\"fixcrlf\", \"\", null);", "+        tmpFile.deleteOnExit();", "-            // Set up the output Writer", "-            try {", "-                tmpFile = FILE_UTILS.createTempFile(\"fixcrlf\", \"\", null);", "-                tmpFile.deleteOnExit();", "-                Writer writer = (encoding == null) ? new FileWriter(tmpFile)", "-                    : new OutputStreamWriter(new FileOutputStream(tmpFile),", "-                                             encoding);", "-                outWriter = new BufferedWriter(writer);", "-            } catch (IOException e) {", "-                throw new BuildException(e);", "-            }", "-", "-            while (lines.hasMoreElements()) {", "-                // In-line states", "-                int endComment;", "-", "-                try {", "-                    line = (OneLiner.BufferLine) lines.nextElement();", "-                } catch (NoSuchElementException e) {", "-                    throw new BuildException(e);", "-                }", "-", "-                String lineString = line.getLineString();", "-                int linelen = line.length();", "-", "-                // Note - all of the following processing NOT done for", "-                // tabs ASIS", "-", "-                if (tabs == ASIS) {", "-                    // Just copy the body of the line across", "-                    try {", "-                        outWriter.write(lineString);", "-                    } catch (IOException e) {", "-                        throw new BuildException(e);", "-                    } // end of try-catch", "-", "-                } else { // (tabs != ASIS)", "-", "-                    while (line.getNext() < linelen) {", "-", "-                        switch (lines.getState()) {", "-", "-                        case NOTJAVA:", "-                            notInConstant(line, line.length(), outWriter);", "-                            break;", "-", "-                        case IN_MULTI_COMMENT:", "-                            endComment", "-                                = lineString.indexOf(\"*/\", line.getNext());", "-                            if (endComment >= 0) {", "-                                // End of multiLineComment on this line", "-                                endComment += 2;  // Include the end token", "-                                lines.setState(LOOKING);", "-                            } else {", "-                                endComment = linelen;", "-                            }", "-", "-                            notInConstant(line, endComment, outWriter);", "-                            break;", "-", "-                        case IN_SINGLE_COMMENT:", "-                            notInConstant(line, line.length(), outWriter);", "-                            lines.setState(LOOKING);", "-                            break;", "-", "-                        case IN_CHAR_CONST:", "-                        case IN_STR_CONST:", "-                            // Got here from LOOKING by finding an", "-                            // opening \"\\'\" next points to that quote", "-                            // character.", "-                            // Find the end of the constant.  Watch", "-                            // out for backslashes.  Literal tabs are", "-                            // left unchanged, and the column is", "-                            // adjusted accordingly.", "-", "-                            int begin = line.getNext();", "-                            char terminator = (lines.getState() == IN_STR_CONST", "-                                               ? '\\\"'", "-                                               : '\\'');", "-                            endOfCharConst(line, terminator);", "-                            while (line.getNext() < line.getLookahead()) {", "-                                if (line.getNextCharInc() == '\\t') {", "-                                    line.setColumn(line.getColumn()", "-                                        + tablength", "-                                        - (line.getColumn() % tablength));", "-                                } else {", "-                                    line.incColumn();", "-                                }", "-                            }", "-", "-                            // Now output the substring", "-                            try {", "-                                outWriter.write(line.substring(begin,", "-                                                               line.getNext()));", "-                            } catch (IOException e) {", "-                                throw new BuildException(e);", "-                            }", "-", "-                            lines.setState(LOOKING);", "-", "-                            break;", "-", "-", "-                        case LOOKING:", "-                            nextStateChange(line);", "-                            notInConstant(line, line.getLookahead(), outWriter);", "-                            break;", "-", "-                        } // end of switch (state)", "-", "-                    } // end of while (line.getNext() < linelen)", "-", "-                } // end of else (tabs != ASIS)", "-", "-                if (!(\"\".equals(line.getEol())) || fixlast) {", "-                    try {", "-                        outWriter.write(eolstr);", "-                    } catch (IOException e) {", "-                        throw new BuildException(e);", "-                    } // end of try-catch", "-                } //end if non-blank original eol or fixlast", "-", "-            } // end of while (lines.hasNext())", "-", "-            try {", "-                // Handle CTRLZ", "-                if (ctrlz == ASIS) {", "-                    outWriter.write(lines.getEofStr());", "-                } else if (ctrlz == ADD) {", "-                    outWriter.write(CTRLZ);", "-                }", "-            } catch (IOException e) {", "-                throw new BuildException(e);", "-            } finally {", "-                try {", "-                    outWriter.close();", "-                } catch (IOException e) {", "-                    throw new BuildException(e);", "-                }", "-            }", "-", "-", "-            try {", "-                lines.close();", "-                lines = null;", "-            } catch (IOException e) {", "-                throw new BuildException(\"Unable to close source file \"", "-                                         + srcFile);", "-            }", "+            FILE_UTILS.copyFile(srcFile, tmpFile, null, fcv, false, ", "+                                false, encoding, getProject());", "-                if (!FILE_UTILS.contentEquals(destFile, tmpFile)) {", "-                    log(destFile + \" is being written\", Project.MSG_DEBUG);", "-                } else {", "-                    log(destFile + \" is not written, as the contents \"", "-                        + \"are identical\", Project.MSG_DEBUG);", "-                    destIsWrong = false;", "-                }", "+                destIsWrong = !FILE_UTILS.contentEquals(destFile, tmpFile);", "+                log(destFile + (destIsWrong ? \" is being written\"", "+                    : \" is not written, as the contents are identical\"),", "+                    Project.MSG_DEBUG);", "-", "-", "-        } finally {", "-            try {", "-                if (lines != null) {", "-                    lines.close();", "-                }", "-            } catch (IOException io) {", "-                log(\"Error closing \" + srcFile, Project.MSG_ERR);", "-            } // end of catch", "-", "-            if (tmpFile != null) {", "-                tmpFile.delete();", "-            }", "-        } // end of finally", "+        }"]}]}