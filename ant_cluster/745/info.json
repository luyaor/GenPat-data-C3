{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "119f6e7cac8cd4870ae3e5a6f1f8f11b", "detectedBy": ["DIFF_HIERARCHICAL", "DIFF_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "312be39defb234cdbfca6681a687cdd9", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/tar/TarInputStream.java", "commitBeforeChange": "171220cb337ad731d3e79f0db9e45381b615fbb2", "commitAfterChange": "1fe6b17d5fbbf0f70c13def785498d87e7d3c685", "methodNumberBeforeChange": 14, "methodNumberAfterChange": 14, "signatureBeforeChange": "     public TarEntry getNextEntry() throws IOException", "signatureAfterChange": "     public TarEntry getNextEntry() throws IOException", "diff": ["-            StringBuffer longName = new StringBuffer();", "+            ByteArrayOutputStream longName = new ByteArrayOutputStream();", "-                longName.append(new String(buf, 0, length)); // TODO default charset?", "+                longName.write(buf, 0, length);", "-            // remove trailing null terminator", "-            if (longName.length() > 0", "-                && longName.charAt(longName.length() - 1) == 0) {", "-                longName.deleteCharAt(longName.length() - 1);", "+            byte[] longNameData = longName.toByteArray();", "+            // remove trailing null terminator(s)", "+            length = longNameData.length;", "+            while (length > 0 && longNameData[length - 1] == 0) {", "+                --length;", "-            currEntry.setName(longName.toString());", "+            if (length != longNameData.length) {", "+                byte[] l = new byte[length];", "+                System.arraycopy(longNameData, 0, l, 0, length);", "+                longNameData = l;", "+            }", "+            ", "+            currEntry.setName(encoding.decode(longNameData));"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "e74b1cec9cbdd76f5f1813dafa89ef7e", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/tar/TarInputStream.java", "commitBeforeChange": "3fb018053018728cd4a6d4d873607092012fd54e", "commitAfterChange": "1a22123f5c7a236164cadc975673d2b3bcc4033f", "methodNumberBeforeChange": 14, "methodNumberAfterChange": 14, "signatureBeforeChange": "     public TarEntry getNextEntry() throws IOException", "signatureAfterChange": "     public TarEntry getNextEntry() throws IOException", "diff": ["-        if (currEntry.isGNULongNameEntry()) {", "-            // read in the name", "-            ByteArrayOutputStream longName = new ByteArrayOutputStream();", "-            int length = 0;", "-            while ((length = read(SMALL_BUF)) >= 0) {", "-                longName.write(SMALL_BUF, 0, length);", "-            }", "-            getNextEntry();", "-            if (currEntry == null) {", "+        if (currEntry.isGNULongLinkEntry()) {", "+            byte[] longLinkData = getLongNameData();", "+            if (longLinkData == null) {", "-                // Malformed tar file - long entry name not followed by entry", "+                // Malformed tar file - long link entry name not followed by", "+                // entry", "-            byte[] longNameData = longName.toByteArray();", "-            // remove trailing null terminator(s)", "-            length = longNameData.length;", "-            while (length > 0 && longNameData[length - 1] == 0) {", "-                --length;", "+            currEntry.setLinkName(encoding.decode(longLinkData));", "+        }", "+", "+        if (currEntry.isGNULongNameEntry()) {", "+            byte[] longNameData = getLongNameData();", "+            if (longNameData == null) {", "+                // Bugzilla: 40334", "+                // Malformed tar file - long entry name not followed by", "+                // entry", "+                return null;", "-            if (length != longNameData.length) {", "-                byte[] l = new byte[length];", "-                System.arraycopy(longNameData, 0, l, 0, length);", "-                longNameData = l;", "-            }", "-            "]}]}