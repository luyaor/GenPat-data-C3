{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "505291bd297a58c896b5706cf51b61df", "detectedBy": ["AST_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "babc081b5ad8e677f160294373f8bc41", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/Redirector.java", "commitBeforeChange": "e1dba00d6fba1e923723c523e5aed501dc5ab84b", "commitAfterChange": "3ade0b6e769ba60594a31515f5ba7e3e0054810a", "methodNumberBeforeChange": 20, "methodNumberAfterChange": 20, "signatureBeforeChange": "     public synchronized void setAlwaysLog(boolean alwaysLog)", "signatureAfterChange": "     public void setAlwaysLog(boolean alwaysLog)", "diff": ["-    public synchronized void setAlwaysLog(boolean alwaysLog) {", "-        this.alwaysLog = alwaysLog;", "+    public void setAlwaysLog(boolean alwaysLog) {", "+        synchronized (outMutex) {", "+            alwaysLogOut = alwaysLog;", "+        }", "+        synchronized (errMutex) {", "+            alwaysLogErr = alwaysLog;", "+        }"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "cd154ec67472068569e3e18b33a8fdbe", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/Redirector.java", "commitBeforeChange": "e1dba00d6fba1e923723c523e5aed501dc5ab84b", "commitAfterChange": "3ade0b6e769ba60594a31515f5ba7e3e0054810a", "methodNumberBeforeChange": 27, "methodNumberAfterChange": 27, "signatureBeforeChange": "     public synchronized void createStreams()", "signatureAfterChange": "     public void createStreams()", "diff": ["-    public synchronized void createStreams() {", "-        outStreams();", "-        errorStreams();", "-        if (alwaysLog || outputStream == null) {", "-            OutputStream outputLog", "-                = new LogOutputStream(managingTask, Project.MSG_INFO);", "-            outputStream = (outputStream == null)", "-                ? outputLog : new TeeOutputStream(outputLog, outputStream);", "-        }", "-        if (alwaysLog || errorStream == null) {", "-            OutputStream errorLog", "-                = new LogOutputStream(managingTask, Project.MSG_WARN);", "-            errorStream = (errorStream == null)", "-                ? errorLog : new TeeOutputStream(errorLog, errorStream);", "-        }", "-        if ((outputFilterChains != null && outputFilterChains.size() > 0)", "-            || !(outputEncoding.equalsIgnoreCase(inputEncoding))) {", "-            try {", "-                LeadPipeInputStream snk = new LeadPipeInputStream();", "-                snk.setManagingComponent(managingTask);", "+    public void createStreams() {", "-                InputStream outPumpIn = snk;", "+        synchronized (outMutex) {", "+            outStreams();", "+            if (alwaysLogOut || outputStream == null) {", "+                OutputStream outputLog = new LogOutputStream(managingTask,", "+                        Project.MSG_INFO);", "+                outputStream = (outputStream == null) ? outputLog", "+                        : new TeeOutputStream(outputLog, outputStream);", "+            }", "-                Reader reader = new InputStreamReader(outPumpIn, inputEncoding);", "+            if ((outputFilterChains != null && outputFilterChains.size() > 0)", "+                    || !(outputEncoding.equalsIgnoreCase(inputEncoding))) {", "+                try {", "+                    LeadPipeInputStream snk = new LeadPipeInputStream();", "+                    snk.setManagingComponent(managingTask);", "-                if (outputFilterChains != null && outputFilterChains.size() > 0) {", "-                    ChainReaderHelper helper = new ChainReaderHelper();", "-                    helper.setProject(managingTask.getProject());", "-                    helper.setPrimaryReader(reader);", "-                    helper.setFilterChains(outputFilterChains);", "-                    reader = helper.getAssembledReader();", "+                    InputStream outPumpIn = snk;", "+", "+                    Reader reader = new InputStreamReader(outPumpIn,", "+                            inputEncoding);", "+", "+                    if (outputFilterChains != null", "+                            && outputFilterChains.size() > 0) {", "+                        ChainReaderHelper helper = new ChainReaderHelper();", "+                        helper.setProject(managingTask.getProject());", "+                        helper.setPrimaryReader(reader);", "+                        helper.setFilterChains(outputFilterChains);", "+                        reader = helper.getAssembledReader();", "+                    }", "+                    outPumpIn = new ReaderInputStream(reader, outputEncoding);", "+", "+                    Thread t = new Thread(threadGroup, new StreamPumper(", "+                            outPumpIn, outputStream, true), \"output pumper\");", "+                    t.setPriority(Thread.MAX_PRIORITY);", "+                    outputStream = new PipedOutputStream(snk);", "+                    t.start();", "+                } catch (IOException eyeOhEx) {", "+                    throw new BuildException(\"error setting up output stream\",", "+                            eyeOhEx);", "-                outPumpIn = new ReaderInputStream(reader, outputEncoding);", "-", "-                Thread t = new Thread(threadGroup, new StreamPumper(", "-                    outPumpIn, outputStream, true), \"output pumper\");", "-                t.setPriority(Thread.MAX_PRIORITY);", "-                outputStream = new PipedOutputStream(snk);", "-                t.start();", "-            } catch (IOException eyeOhEx) {", "-                throw new BuildException(", "-                    \"error setting up output stream\", eyeOhEx);", "-        if ((errorFilterChains != null && errorFilterChains.size() > 0)", "-            || !(errorEncoding.equalsIgnoreCase(inputEncoding))) {", "-            try {", "-                LeadPipeInputStream snk = new LeadPipeInputStream();", "-                snk.setManagingComponent(managingTask);", "+        synchronized (errMutex) {", "+            errorStreams();", "+            if (alwaysLogErr || errorStream == null) {", "+                OutputStream errorLog = new LogOutputStream(managingTask,", "+                        Project.MSG_WARN);", "+                errorStream = (errorStream == null) ? errorLog", "+                        : new TeeOutputStream(errorLog, errorStream);", "+            }", "-                InputStream errPumpIn = snk;", "+            if ((errorFilterChains != null && errorFilterChains.size() > 0)", "+                    || !(errorEncoding.equalsIgnoreCase(inputEncoding))) {", "+                try {", "+                    LeadPipeInputStream snk = new LeadPipeInputStream();", "+                    snk.setManagingComponent(managingTask);", "-                Reader reader = new InputStreamReader(errPumpIn, inputEncoding);", "+                    InputStream errPumpIn = snk;", "-                if (errorFilterChains != null && errorFilterChains.size() > 0) {", "-                    ChainReaderHelper helper = new ChainReaderHelper();", "-                    helper.setProject(managingTask.getProject());", "-                    helper.setPrimaryReader(reader);", "-                    helper.setFilterChains(errorFilterChains);", "-                    reader = helper.getAssembledReader();", "+                    Reader reader = new InputStreamReader(errPumpIn,", "+                            inputEncoding);", "+", "+                    if (errorFilterChains != null", "+                            && errorFilterChains.size() > 0) {", "+                        ChainReaderHelper helper = new ChainReaderHelper();", "+                        helper.setProject(managingTask.getProject());", "+                        helper.setPrimaryReader(reader);", "+                        helper.setFilterChains(errorFilterChains);", "+                        reader = helper.getAssembledReader();", "+                    }", "+                    errPumpIn = new ReaderInputStream(reader, errorEncoding);", "+", "+                    Thread t = new Thread(threadGroup, new StreamPumper(", "+                            errPumpIn, errorStream, true), \"error pumper\");", "+                    t.setPriority(Thread.MAX_PRIORITY);", "+                    errorStream = new PipedOutputStream(snk);", "+                    t.start();", "+                } catch (IOException eyeOhEx) {", "+                    throw new BuildException(\"error setting up error stream\",", "+                            eyeOhEx);", "-                errPumpIn = new ReaderInputStream(reader, errorEncoding);", "-", "-                Thread t = new Thread(threadGroup, new StreamPumper(", "-                    errPumpIn, errorStream, true), \"error pumper\");", "-                t.setPriority(Thread.MAX_PRIORITY);", "-                errorStream = new PipedOutputStream(snk);", "-                t.start();", "-            } catch (IOException eyeOhEx) {", "-                throw new BuildException(", "-                    \"error setting up error stream\", eyeOhEx);", "-        // if input files are specified, inputString and inputStream are ignored;", "-        // classes that work with redirector attributes can enforce", "-        // whatever warnings are needed", "-        if (input != null && input.length > 0) {", "-            managingTask.log(\"Redirecting input from file\"", "-                + ((input.length == 1) ? \"\" : \"s\"), Project.MSG_VERBOSE);", "-            try {", "-                inputStream = new ConcatFileInputStream(input);", "-            } catch (IOException eyeOhEx) {", "-                throw new BuildException(eyeOhEx);", "+        synchronized (inMutex) {", "+            // if input files are specified, inputString and inputStream are", "+            // ignored;", "+            // classes that work with redirector attributes can enforce", "+            // whatever warnings are needed", "+            if (input != null && input.length > 0) {", "+                managingTask", "+                        .log(\"Redirecting input from file\"", "+                                + ((input.length == 1) ? \"\" : \"s\"),", "+                                Project.MSG_VERBOSE);", "+                try {", "+                    inputStream = new ConcatFileInputStream(input);", "+                } catch (IOException eyeOhEx) {", "+                    throw new BuildException(eyeOhEx);", "+                }", "+                ((ConcatFileInputStream) inputStream)", "+                        .setManagingComponent(managingTask);", "+            } else if (inputString != null) {", "+                StringBuffer buf = new StringBuffer(\"Using input \");", "+                if (logInputString) {", "+                    buf.append('\"').append(inputString).append('\"');", "+                } else {", "+                    buf.append(\"string\");", "+                }", "+                managingTask.log(buf.toString(), Project.MSG_VERBOSE);", "+                inputStream = new ByteArrayInputStream(inputString.getBytes());", "-            ((ConcatFileInputStream) inputStream).setManagingComponent(managingTask);", "-        } else if (inputString != null) {", "-            StringBuffer buf = new StringBuffer(\"Using input \");", "-            if (logInputString) {", "-                buf.append('\"').append(inputString).append('\"');", "-            } else {", "-                buf.append(\"string\");", "-            }", "-            managingTask.log(buf.toString(), Project.MSG_VERBOSE);", "-            inputStream = new ByteArrayInputStream(inputString.getBytes());", "-        }", "-        if (inputStream != null", "-            && inputFilterChains != null && inputFilterChains.size() > 0) {", "-            ChainReaderHelper helper = new ChainReaderHelper();", "-            helper.setProject(managingTask.getProject());", "-            try {", "-                helper.setPrimaryReader(", "-                    new InputStreamReader(inputStream, inputEncoding));", "-            } catch (IOException eyeOhEx) {", "-                throw new BuildException(", "-                    \"error setting up input stream\", eyeOhEx);", "+            if (inputStream != null && inputFilterChains != null", "+                    && inputFilterChains.size() > 0) {", "+                ChainReaderHelper helper = new ChainReaderHelper();", "+                helper.setProject(managingTask.getProject());", "+                try {", "+                    helper.setPrimaryReader(new InputStreamReader(inputStream,", "+                            inputEncoding));", "+                } catch (IOException eyeOhEx) {", "+                    throw new BuildException(\"error setting up input stream\",", "+                            eyeOhEx);", "+                }", "+                helper.setFilterChains(inputFilterChains);", "+                inputStream = new ReaderInputStream(", "+                        helper.getAssembledReader(), inputEncoding);", "-            helper.setFilterChains(inputFilterChains);", "-            inputStream = new ReaderInputStream(", "-                helper.getAssembledReader(), inputEncoding);"]}]}