{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "1a641c3a6a763dd33184cadb1e33e6bb", "detectedBy": ["DIFF_HIERARCHICAL"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "3070cfad485d02df15a41c371a6217d5", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/Expand.java", "commitBeforeChange": "dc00bd536bd6a1cd2bae07cecc352c085a8a0f9d", "commitAfterChange": "80d371a3b4e1ba3f845e1b9a8f831fd6a11fafd5", "methodNumberBeforeChange": 1, "methodNumberAfterChange": 1, "signatureBeforeChange": "      private void expandFile(Touch touch, File srcF, File dir)", "signatureAfterChange": "     protected void expandFile(Touch touch, File srcF, File dir)", "diff": ["-    private void expandFile(Touch touch, File srcF, File dir) {", "+     */", "+    protected void expandFile(Touch touch, File srcF, File dir) {", "-            log(\"Expanding: \" + srcF + \" into \" + dir, Project.MSG_INFO);", "-                File f = new File(dir, project.translatePath(ze.getName()));", "-                try {", "-                    if (!overwrite && f.exists() ", "-                        && f.lastModified() >= ze.getTime()) {", "-                        log(\"Skipping \" + f + \" as it is up-to-date\",", "-                            Project.MSG_DEBUG);", "-                        continue;", "-                    }", "-                    ", "-                    log(\"expanding \" + ze.getName() + \" to \"+ f, ", "-                        Project.MSG_VERBOSE);", "-                    // create intermediary directories - sometimes zip don't add them", "-                    File dirF=new File(f.getParent());", "-                    dirF.mkdirs();", "-                    ", "-                    if (ze.isDirectory()) {", "-                        f.mkdirs(); ", "-                    } else {", "-                        byte[] buffer = new byte[1024];", "-                        int length = 0;", "-                        FileOutputStream fos = new FileOutputStream(f);", "-                        ", "-                        while ((length = zis.read(buffer)) >= 0) {", "-                            fos.write(buffer, 0, length);", "-                        }", "-                        ", "-                        fos.close();", "-                    }", "-                    ", "-                    if (project.getJavaVersion() != Project.JAVA_1_1) {", "-                        touch.setFile(f);", "-                        touch.setMillis(ze.getTime());", "-                        touch.touch();", "-                    }", "-                    ", "-                } catch( FileNotFoundException ex ) {", "-                    log(\"Unable to expand to file \" + f.getPath(), Project.MSG_WARN);", "-                }", "+                extractFile(touch, srcF, dir, zis,", "+                            ze.getName(), ze.getSize(),", "+                            new Date(ze.getTime()),", "+                            ze.isDirectory());", "-            log(\"expand complete\", Project.MSG_VERBOSE );", "+", "+            if (dest != null) {", "+                log(\"expand complete\", Project.MSG_VERBOSE );", "+            }", "+"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "606ffbd96f55b5474802842283d0ab61", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/Expand.java", "commitBeforeChange": "e22d7c50937ee1d155f91bfd635673bd41017e76", "commitAfterChange": "95fa304e14c4cc49d84e089ea13107a35b68f8d5", "methodNumberBeforeChange": 2, "methodNumberAfterChange": 2, "signatureBeforeChange": "      protected void extractFile(FileUtils fileUtils, File srcF, File dir,                                InputStream compressedInputStream,                                String entryName, long entrySize,                                Date entryDate, boolean isDirectory)                                throws IOException", "signatureAfterChange": "      protected void extractFile(FileUtils fileUtils, File srcF, File dir,                                InputStream compressedInputStream,                                String entryName,                                Date entryDate, boolean isDirectory)                                throws IOException", "diff": ["-                               String entryName, long entrySize,", "+                               String entryName,", "-                               throws IOException {", "-        extractFile(fileUtils, srcF, dir, compressedInputStream,", "-                    entryName, entrySize, entryDate, isDirectory,", "-                    null, null);", "-", "-    }", "+        log(\"Expanding: \" + srcF + \" into \" + dir, Project.MSG_INFO);", "+        File f = fileUtils.resolveFile(dir, entryName);", "+        try {", "+            if (!overwrite && f.exists()", "+                && f.lastModified() >= entryDate.getTime()) {", "+                log(\"Skipping \" + f + \" as it is up-to-date\",", "+                    Project.MSG_DEBUG);", "+                return;", "+            log(\"expanding \" + entryName + \" to \"+ f,", "+                Project.MSG_VERBOSE);", "+            // create intermediary directories - sometimes zip don't add them", "+            File dirF= fileUtils.getParentFile(f);", "+            dirF.mkdirs();", "+            if (isDirectory) {", "+                f.mkdirs();", "+            } else {", "+                byte[] buffer = new byte[1024];", "+                int length = 0;", "+                FileOutputStream fos = null;", "+                try {", "+                    fos = new FileOutputStream(f);", "+", "+                    while ((length =", "+                            compressedInputStream.read(buffer)) >= 0) {", "+                        fos.write(buffer, 0, length);", "+                    }", "+", "+                    fos.close();", "+                    fos = null;", "+                } finally {", "+                    if (fos != null) {", "+                        try {", "+                            fos.close();", "+                        } catch (IOException e) {}", "+", "+            fileUtils.setFileLastModified(f, entryDate.getTime());", "+        } catch( FileNotFoundException ex ) {", "+            log(\"Unable to expand to file \" + f.getPath(), Project.MSG_WARN);"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "fef40ba098eec3c339116f1e496e65cb", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/Untar.java", "commitBeforeChange": "dc00bd536bd6a1cd2bae07cecc352c085a8a0f9d", "commitAfterChange": "80d371a3b4e1ba3f845e1b9a8f831fd6a11fafd5", "methodNumberBeforeChange": 0, "methodNumberAfterChange": 0, "signatureBeforeChange": "     public void execute() throws BuildException", "signatureAfterChange": "      protected void expandFile(Touch touch, File srcF, File dir)", "diff": ["-     */", "-    public void execute() throws BuildException {", "-", "-        Touch touch = (Touch) project.createTask(\"touch\");", "-        touch.setOwningTarget(target);", "-        touch.setTaskName(getTaskName());", "-        touch.setLocation(getLocation());", "-                    ", "-        File srcF = source;", "-", "+    protected void expandFile(Touch touch, File srcF, File dir) {", "-            if (source == null) {", "-                throw new BuildException(\"No source specified\", location);", "-            }", "-            if (!srcF.exists()) {", "-                throw new BuildException(\"source \"+srcF+\" doesn't exist\",", "-                                         location);", "+            if (dest != null) {", "+                log(\"Expanding: \" + srcF + \" into \" + dir, Project.MSG_INFO);", "-            if (dest == null) {", "-                throw new BuildException(\"No destination specified\", location);", "-            }", "-            File dir = dest;", "-", "-            log(\"Expanding: \" + srcF + \" into \" + dir, Project.MSG_INFO);", "-                try {", "-                    File f = new File(dir, project.translatePath(te.getName()));", "-                    if (!overwrite && f.exists() ", "-                        && f.lastModified() >= te.getModTime().getTime()) {", "-                        log(\"Skipping \" + f + \" as it is up-to-date\",", "-                            Project.MSG_DEBUG);", "-                        continue;", "-                    }", "-                    ", "-                    log(\"expanding \" + te.getName() + \" to \"+ f, ", "-                        Project.MSG_VERBOSE);", "-                    File dirF=new File(f.getParent());", "-                    dirF.mkdirs();", "-", "-                    if (te.isDirectory()) {", "-                        f.mkdirs();", "-                    } else {", "-                        byte[] buffer = new byte[1024];", "-                        int length = 0;", "-                        FileOutputStream fos = new FileOutputStream(f);", "-", "-                        while ((length = tis.read(buffer)) >= 0) {", "-                            fos.write(buffer, 0, length);", "-                        }", "-", "-                        fos.close();", "-                    }", "-", "-                    if (project.getJavaVersion() != Project.JAVA_1_1) {", "-                        touch.setFile(f);", "-                        touch.setMillis(te.getModTime().getTime());", "-                        touch.touch();", "-                    }", "-", "-                } catch(FileNotFoundException ex) {", "-                    log(\"FileNotFoundException: \" + te.getName(),", "-                        Project.MSG_WARN);", "-                }", "+                extractFile(touch, srcF, dir, tis,", "+                            te.getName(), te.getSize(),", "+                            te.getModTime(), te.isDirectory(),", "+                            mode2str(te.getMode()),", "+                            te.getUserId() + \"/\" + te.getGroupId());", "+            if (dest != null) {", "+                log(\"expand complete\", Project.MSG_VERBOSE );", "+            }", "+", "-\t} finally {", "-\t    if (tis != null) {", "-\t        try {", "-\t            tis.close();", "-\t        }", "-\t        catch (IOException e) {}", "-\t    }", "-\t}", "+        } finally {", "+            if (tis != null) {", "+                try {", "+                    tis.close();", "+                }", "+                catch (IOException e) {}", "+            }", "+        }"]}]}