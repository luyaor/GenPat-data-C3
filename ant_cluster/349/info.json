{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "85d59738f0a30aab489e8bcab9b6be19", "detectedBy": ["DIFF_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "8f3237afa92f21bfd511ee4cfed1c338", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/helper/ProjectHelper2.java", "commitBeforeChange": "b8c35567eee957064ae29052eae63ee1b4f9c7aa", "commitAfterChange": "d377aa50f3aef9a5dbb9974d1e5818489ab2db99", "methodNumberBeforeChange": 3, "methodNumberAfterChange": 3, "signatureBeforeChange": "     public void parse(Project project, Object source) throws BuildException", "signatureAfterChange": "     public void parse(Project project, Object source) throws BuildException", "diff": ["-            for (String[] extensionInfo : getExtensionStack()) {", "-                String tgName = extensionInfo[0];", "-                String name = extensionInfo[1];", "-                OnMissingExtensionPoint missingBehaviour = OnMissingExtensionPoint", "-                        .valueOf(extensionInfo[2]);", "-                Hashtable projectTargets = project.getTargets();", "-                if (!projectTargets.containsKey(tgName)) {", "-                    String message = \"can't add target \" + name", "-                        + \" to extension-point \" + tgName", "-                        + \" because the extension-point is unknown.\";", "-                    if (missingBehaviour == OnMissingExtensionPoint.FAIL) {", "-                        throw new BuildException(message);", "-                    } else if (missingBehaviour == OnMissingExtensionPoint.WARN) {", "-                        Target target = (Target) projectTargets.get(name);", "-                        context.getProject().log(target,", "-                                                 \"Warning: \" + message,", "-                                                 Project.MSG_WARN);", "-                    }", "-                } else {", "-                    Target t = (Target) projectTargets.get(tgName);", "-                    if (!(t instanceof ExtensionPoint)) {", "-                        throw new BuildException(\"referenced target \"", "-                                                 + tgName", "-                                                 + \" is not an extension-point\");", "-                    }", "-                    t.addDependency(name);", "-                }", "-            }", "+            resolveExtensionOfAttributes(project);"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "c31951acd1ea13f015c760155386ad77", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/ProjectHelper.java", "commitBeforeChange": "d377aa50f3aef9a5dbb9974d1e5818489ab2db99", "commitAfterChange": "944210b384ccb4e335ce5a5c3ded7f784fd3e581", "methodNumberBeforeChange": 35, "methodNumberAfterChange": 35, "signatureBeforeChange": "     public void resolveExtensionOfAttributes(Project project)             throws BuildException", "signatureAfterChange": "     public void resolveExtensionOfAttributes(Project project)             throws BuildException", "diff": ["-            String tgName = extensionInfo[0];", "-            String name = extensionInfo[1];", "+            String extPointName = extensionInfo[0];", "+            String targetName = extensionInfo[1];", "+            // if the file has been included or imported, it may have a prefix", "+            // we should consider when trying to resolve the target it is", "+            // extending", "+            String prefixAndSep = extensionInfo.length > 3 ? extensionInfo[3] : null;", "+", "+            // find the target we're extending", "-            if (!projectTargets.containsKey(tgName)) {", "-                String message = \"can't add target \" + name", "-                        + \" to extension-point \" + tgName", "+            Target extPoint = null;", "+            if (prefixAndSep == null) {", "+                // no prefix - not from an imported/included build file", "+                extPoint = (Target) projectTargets.get(extPointName);", "+            } else {", "+                // we have a prefix, which means we came from an include/import", "+", "+                // FIXME: here we handle no particular level of include. We try", "+                // the fully prefixed name, and then the non-prefixed name. But", "+                // there might be intermediate project in the import stack,", "+                // which prefix should be tested before testing the non-prefix", "+                // root name.", "+", "+                extPoint = (Target) projectTargets.get(prefixAndSep + extPointName);", "+                if (extPoint == null) {", "+                    extPoint = (Target) projectTargets.get(extPointName);", "+                }", "+            }", "+", "+            // make sure we found a point to extend on", "+            if (extPoint == null) {", "+                String message = \"can't add target \" + targetName", "+                        + \" to extension-point \" + extPointName", "-                    Target target = (Target) projectTargets.get(name);", "-                    project.log(target, \"Warning: \" + message, Project.MSG_WARN);", "+                    Target t = (Target) projectTargets.get(targetName);", "+                    project.log(t, \"Warning: \" + message, Project.MSG_WARN);", "-                Target t = (Target) projectTargets.get(tgName);", "-                if (!(t instanceof ExtensionPoint)) {", "-                    throw new BuildException(\"referenced target \" + tgName", "+                if (!(extPoint instanceof ExtensionPoint)) {", "+                    throw new BuildException(\"referenced target \" + extPointName", "-                t.addDependency(name);", "+                extPoint.addDependency(targetName);"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "ed897432288f413c697c229abe2bee7a", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/helper/ProjectHelper2.java", "commitBeforeChange": "047941f0312007c9145af76a61f428ad68da7583", "commitAfterChange": "bd52e7b9b16b87287bed0c011c4fc1794543e9fb", "methodNumberBeforeChange": 3, "methodNumberAfterChange": 3, "signatureBeforeChange": "     public void parse(Project project, Object source) throws BuildException", "signatureAfterChange": "     public void parse(Project project, Object source) throws BuildException", "diff": ["+                String missingBehaviour = extensionInfo[2];", "-                    throw new BuildException(\"can't add target \"", "-                                             + name + \" to extension-point \"", "-                                             + tgName", "-                                             + \" because the extension-point\"", "-                                             + \" is unknown.\");", "+                    String message = \"can't add target \" + name", "+                        + \" to extension-point \" + tgName", "+                        + \" because the extension-point is unknown.\";", "+                    if (missingBehaviour.equals(MISSING_EP_FAIL)) {", "+                        throw new BuildException(message);", "+                    } else if (missingBehaviour.equals(MISSING_EP_WARN)) {", "+                        Target target = (Target) projectTargets.get(name);", "+                        context.getProject().log(target,", "+                                                 \"Warning: \" + message,", "+                                                 Project.MSG_WARN);", "+                    }", "+                } else {", "+                    Target t = (Target) projectTargets.get(tgName);", "+                    if (!(t instanceof ExtensionPoint)) {", "+                        throw new BuildException(\"referenced target \"", "+                                                 + tgName", "+                                                 + \" is not an extension-point\");", "+                    }", "+                    t.addDependency(name);", "-                Target t = (Target) projectTargets.get(tgName);", "-                if (!(t instanceof ExtensionPoint)) {", "-                    throw new BuildException(\"referenced target \"", "-                                             + tgName", "-                                             + \" is not an extension-point\");", "-                }", "-                t.addDependency(name);"]}]}