{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "17f5e560014cdbdc4aa7400852dfd8aa", "detectedBy": ["DIFF_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "000c56e225cfa6311e225baf6c355514", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/optional/unix/Symlink.java", "commitBeforeChange": "1225a5a849faa66e73a1262180dd002332b162b0", "commitAfterChange": "90a6d8155086ee0d0a1911584a56eb7b33fb3d0f", "methodNumberBeforeChange": 16, "methodNumberAfterChange": 20, "signatureBeforeChange": "     private Properties loadLinks(Vector fileSets)", "signatureAfterChange": "     private Properties loadLinks(Vector v)", "diff": ["-    private Properties loadLinks(Vector fileSets) {", "+    private Properties loadLinks(Vector v) {", "-        Enumeration keys;", "-        String key, value;", "-        String[] includedFiles;", "-", "-        FSLoop: for (int i = 0; i < fileSets.size(); i++) {", "-            String workingDir;", "-            FileSet fsTemp = (FileSet) fileSets.elementAt(i);", "-", "-            DirectoryScanner ds;", "-", "-            try {", "-                File linelength = fsTemp.getDir(this.getProject());", "-                workingDir = linelength.getCanonicalPath();", "-            } catch (IOException ioe) {", "-                handleError(\"Exception caught getting \"", "-                            + \"canonical path of working dir \"", "-                            + \"of a FileSet passed to symlink \"", "-                            + \"task. FileSet skipped.\");", "-                continue FSLoop;", "-            }", "-            ds = fsTemp.getDirectoryScanner(this.getProject());", "+        for (int i = 0; i < v.size(); i++) {", "+            FileSet fs = (FileSet) v.elementAt(i);", "+            DirectoryScanner ds = fs.getDirectoryScanner(this.getProject());", "-            includedFiles = ds.getIncludedFiles();", "+            String[] incs = ds.getIncludedFiles();", "+            File dir = fs.getDir(getProject());", "-            // loop through the files identified by each file set", "-            // and load their contents.", "-            for (int j = 0; j < includedFiles.length; j++) {", "-                File inc = new File(workingDir + File.separator", "-                                    + includedFiles[j]);", "-                String inDir;", "-                Properties propTemp = new Properties();", "-", "+            // load included files as properties files:", "+            for (int j = 0; j < incs.length; j++) {", "+                File inc = new File(dir, incs[j]);", "+                File pf = inc.getParentFile();", "+                Properties lnks = new Properties();", "-                    propTemp.load(new FileInputStream(inc));", "-                    inDir = inc.getParent();", "-                    inDir = (new File(inDir)).getCanonicalPath();", "+                    lnks.load(new BufferedInputStream(new FileInputStream(inc)));", "+                    pf = pf.getCanonicalFile();", "-                    handleError(\"Unable to find \" + includedFiles[j]", "-                                + \"FileSet skipped.\");", "-                    continue FSLoop;", "+                    handleError(\"Unable to find \" + incs[j] + \"; skipping it.\");", "+                    continue;", "-                    handleError(\"Unable to open \" + includedFiles[j]", "-                                + \" or its parent dir\"", "-                                + \"FileSet skipped.\");", "-                    continue FSLoop;", "+                    handleError(\"Unable to open \" + incs[j]", "+                                + \" or its parent dir; skipping it.\");", "+                    continue;", "-                keys = propTemp.keys();", "-                propTemp.list(System.out);", "+                lnks.list(new PrintStream(", "+                    new LogOutputStream(this, Project.MSG_INFO)));", "-                // working directory", "-                while (keys.hasMoreElements()) {", "-                    key = (String) keys.nextElement();", "-                    value = propTemp.getProperty(key);", "-                    finalList.put(inDir + File.separator + key, value);", "+                // working directory:", "+                for (Iterator kitr = lnks.keySet().iterator(); kitr.hasNext();) {", "+                    String key = (String) kitr.next();", "+                    finalList.put(new File(pf, key).getAbsolutePath(),", "+                        lnks.getProperty(key));"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "7bb011a1fb11800e3d2a502bb5431840", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/Definer.java", "commitBeforeChange": "26f6bfe2be0861267eca5624537b48daa7574dd6", "commitAfterChange": "8701272b2418d74536d09b289f118d1833d42217", "methodNumberBeforeChange": 12, "methodNumberAfterChange": 18, "signatureBeforeChange": "       public void execute() throws BuildException", "signatureAfterChange": "       public void execute() throws BuildException", "diff": ["-        if (file == null && resource == null) {", "-", "-            // simple case - one definition", "-            if (name == null || value == null) {", "-                String msg = \"name or classname attributes of \"", "-                    + getTaskName() + \" element \"", "-                    + \"are undefined\";", "-                throw new BuildException(msg);", "+        if (!definerSet) {", "+            throw new BuildException(", "+                \"name, file or resource attribute of \"", "+                + getTaskName() + \" is undefined\", getLocation());", "+        }", "+        ", "+        if (name != null) {", "+            if (classname == null) {", "+                throw new BuildException(", "+                    \"classname attribute of \" + getTaskName() + \" element \"", "+                    + \"is undefined\", getLocation());", "-            addDefinition(al, name, value);", "-", "+            addDefinition(al, name, classname);", "+            if (classname != null) {", "+                String msg = \"You must not specify classname \"", "+                    + \"together with file or resource.\";", "+                throw new BuildException(msg, getLocation());", "+            }", "+            URL url = null;", "+            if (file != null) {", "+                url = fileToURL();", "+            }", "+            if (resource != null) {", "+                url = resourceToURL(al);", "+            }", "-            InputStream is = null;", "-            try {", "-                if (name != null || value != null) {", "-                    String msg = \"You must not specify name or value \"", "-                        + \"together with file or resource.\";", "-                    throw new BuildException(msg, getLocation());", "-                }", "+            if (url == null) {", "+                return;", "+            }", "-                if (file != null && resource != null) {", "-                    String msg = \"You must not specify both, file and \"", "-                        + \"resource.\";", "-                    throw new BuildException(msg, getLocation());", "-                }", "+            loadProperties(al, url);", "+        }", "+    }", "-                Properties props = new Properties();", "-                if (file != null) {", "-                    log(\"Loading definitions from file \" + file,", "-                        Project.MSG_VERBOSE);", "-                    is = new FileInputStream(file);", "-                    if (is == null) {", "-                        log(\"Could not load definitions from file \" + file", "-                            + \". It doesn\\'t exist.\", Project.MSG_WARN);", "-                    }", "-                }", "-                if (resource != null) {", "-                    log(\"Loading definitions from resource \" + resource,", "-                        Project.MSG_VERBOSE);", "-                    is = al.getResourceAsStream(resource);", "-                    if (is == null) {", "-                        log(\"Could not load definitions from resource \"", "-                            + resource + \". It could not be found.\",", "-                            Project.MSG_WARN);", "-                    }", "-                }", "-", "-                if (is != null) {", "-                    props.load(is);", "-                    Enumeration keys = props.keys();", "-                    while (keys.hasMoreElements()) {", "-                        String n = (String) keys.nextElement();", "-                        String v = props.getProperty(n);", "-                        addDefinition(al, n, v);", "-                    }", "-                }", "-            } catch (IOException ex) {", "-                throw new BuildException(ex, getLocation());", "-            } finally {", "-                if (is != null) {", "-                    try {", "-                        is.close();", "-                    } catch (IOException e) {}", "-                }"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "e156dcaf366b107c2f81a9895df4f4d6", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/Definer.java", "commitBeforeChange": "8d496e5daaebec48cea6b123ca56351d9fd95245", "commitAfterChange": "2ecc6fa52abb223a67f8b81db23427f103c49b8b", "methodNumberBeforeChange": 3, "methodNumberAfterChange": 3, "signatureBeforeChange": "      public void execute() throws BuildException", "signatureAfterChange": "      public void execute() throws BuildException", "diff": ["-        if (name==null || value==null ) {", "-            String msg = \"name or classname attributes of \"", "-                + getTaskName() + \" element \"", "-                + \"are undefined\";", "-            throw new BuildException(msg);", "-        }", "-        try {", "-            AntClassLoader al = null;", "-            if (classpath != null) {", "-                al = new AntClassLoader(project, classpath);", "-            } else {", "-                al = new AntClassLoader(project, Path.systemClasspath);", "-            }", "-            // need to load Task via system classloader or the new", "-            // task we want to define will never be a Task but always", "-            // be wrapped into a TaskAdapter.", "-            al.addSystemPackageRoot(\"org.apache.tools.ant\");", "+        AntClassLoader al=createLoader();", "+        if (file==null && resource==null ) {", "+", "+            // simple case - one definition", "+            if ( name==null || value==null  ) {", "+                String msg = \"name or classname attributes of \"", "+                    + getTaskName() + \" element \"", "+                    + \"are undefined\";", "+                throw new BuildException(msg);", "+            }", "+            addDefinition( al, name, value );", "+", "+        } else {", "+", "+            try {", "+                if (name != null || value != null) {", "+                    String msg = \"You must not specify name or value \"", "+                        + \"together with file or resource.\";", "+                    throw new BuildException(msg, location);", "+                }", "+            ", "+                if (file != null && resource != null) {", "+                    String msg = \"You must not specify both, file and resource.\";", "+                    throw new BuildException(msg, location);", "+                }", "+            ", "+", "+                Properties props=new Properties();", "+                InputStream is=null;", "+                if( file != null ) {", "+                    log(\"Loading definitions from file \" + file, ", "+                        Project.MSG_VERBOSE);", "+                    is=new FileInputStream( file );", "+                    if (is == null) {", "+                        log(\"Could not load definitions from file \" + file", "+                            + \". It doesn\\'t exist.\", Project.MSG_WARN);", "+                    }", "+                }    ", "+                if( resource!=null ) {", "+                    log(\"Loading definitions from resource \" + resource, ", "+                        Project.MSG_VERBOSE);", "+                    is=al.getResourceAsStream( resource );", "+                    if (is == null) {", "+                        log(\"Could not load definitions from resource \" ", "+                            + resource + \". It could not be found.\", ", "+                            Project.MSG_WARN);", "+                    }", "+                }", "+", "+                if( is!=null ) {", "+                    props.load( is );", "+                    Enumeration keys=props.keys();", "+                    while( keys.hasMoreElements() ) {", "+                        String n=(String)keys.nextElement();", "+                        String v=props.getProperty( n );", "+                        addDefinition( al, n, v );", "+                    }", "+                }", "+            } catch( IOException ex ) {", "+                throw new BuildException(ex, location);", "+            }", "+        }", "+    }"]}]}