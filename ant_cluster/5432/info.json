{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "428d0dbd157ef2351e38a5a6387a3734", "detectedBy": ["DIFF_HIERARCHICAL"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "be48926ea7146f5669af5ecf51b8b1fd", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/Zip.java", "commitBeforeChange": "a9aa3e7efe1a4e4437f575079a89f915936b95dd", "commitAfterChange": "c341e8606d84afbac9fbe08b9814bbb0bf826e3b", "methodNumberBeforeChange": 43, "methodNumberAfterChange": 43, "signatureBeforeChange": "     protected final void addResources(FileSet fileset, Resource[] resources,                                       ZipOutputStream zOut)         throws IOException", "signatureAfterChange": "     protected final void addResources(FileSet fileset, Resource[] resources,                                       ZipOutputStream zOut)         throws IOException", "diff": ["-                if (resources[i].isDirectory() && !name.endsWith(\"/\")) {", "-                    name = name + \"/\";", "-                }", "-                if (!doFilesonly && !dealingWithFiles", "-                    && resources[i].isDirectory()", "-                    && !zfs.hasDirModeBeenSet()) {", "-                    int nextToLastSlash = name.lastIndexOf(\"/\",", "-                                                           name.length() - 2);", "-                    if (nextToLastSlash != -1) {", "-                        addParentDirs(base, name.substring(0,", "-                                                           nextToLastSlash + 1),", "-                                      zOut, prefix, dirMode);", "+                if (resources[i].isDirectory()) {", "+                    if (doFilesonly) {", "+                        continue;", "-                    if (zf != null) {", "-                        ZipEntry ze = zf.getEntry(resources[i].getName());", "-                        int unixMode = ze.getUnixMode();", "-                        if ((unixMode == 0 || unixMode == UnixStat.DIR_FLAG)", "-                            && !preserve0Permissions) {", "-                            unixMode = dirMode;", "-                        }", "-                        addParentDirs(base, name, zOut, prefix,", "-                                      unixMode);", "-                    } else {", "-                        ArchiveResource tr = (ArchiveResource) resources[i];", "-                        addParentDirs(base, name, zOut, prefix,", "-                                      tr.getMode());", "-                    }", "+                    int thisDirMode = zfs != null && zfs.hasDirModeBeenSet()", "+                        ? dirMode : getUnixMode(resources[i], zf, dirMode);", "+                    addDirectoryResource(resources[i], name, prefix,", "+                                         base, zOut,", "+                                         dirMode, thisDirMode);", "-                } else {", "+                } else { // !isDirectory", "+", "-                }", "-                if (!resources[i].isDirectory() && dealingWithFiles) {", "-                    File f = FILE_UTILS.resolveFile(base,", "-                                                   resources[i].getName());", "-                    zipFile(f, zOut, prefix + name, fileMode);", "-                } else if (!resources[i].isDirectory()) {", "-                    if (zf != null) {", "-                    ZipEntry ze = zf.getEntry(resources[i].getName());", "-", "-                    if (ze != null) {", "-                        boolean oldCompress = doCompress;", "-                        if (keepCompression) {", "-                            doCompress = (ze.getMethod() == ZipEntry.DEFLATED);", "-                        }", "-                        InputStream is = null;", "-                        try {", "-                            is = zf.getInputStream(ze);", "-                            int unixMode = ze.getUnixMode();", "-                            if (zfs.hasFileModeBeenSet()", "-                                || ((unixMode == 0", "-                                     || unixMode == UnixStat.FILE_FLAG)", "-                                    && !preserve0Permissions)) {", "-                                unixMode = fileMode;", "-                            }", "-                            zipFile(is, zOut, prefix + name,", "-                                    ze.getTime(), zfs.getSrc(getProject()),", "-                                    unixMode);", "-                        } finally {", "-                            doCompress = oldCompress;", "-                            FileUtils.close(is);", "-                        }", "-                    }", "+                    if (dealingWithFiles) {", "+                        File f = FILE_UTILS.resolveFile(base,", "+                                                        resources[i].getName());", "+                        zipFile(f, zOut, prefix + name, fileMode);", "-                        ArchiveResource tr = (ArchiveResource) resources[i];", "-                        InputStream is = null;", "-                        try {", "-                            is = tr.getInputStream();", "-                            zipFile(is, zOut, prefix + name,", "-                                    resources[i].getLastModified(),", "-                                    zfs.getSrc(getProject()),", "-                                    zfs.hasFileModeBeenSet() ? fileMode", "-                                    : tr.getMode());", "-                        } finally {", "-                            FileUtils.close(is);", "-                        }", "+                        int thisFileMode =", "+                            zfs != null && zfs.hasFileModeBeenSet()", "+                            ? fileMode : getUnixMode(resources[i], zf,", "+                                                     fileMode);", "+                        addResource(resources[i], name, prefix,", "+                                    zOut, thisFileMode,", "+                                    zf, zfs.getSrc(getProject()));", "+            }", "+        }", "+    }"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "cbfb4801cd56022a02e610a202f91eb0", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/util/FileUtils.java", "commitBeforeChange": "cdb548b3b4d78f378f11293a270aa5a8bb4a913a", "commitAfterChange": "5e01ac3c135e9e7f675ca6dcc66abe9e0d0d6005", "methodNumberBeforeChange": 14, "methodNumberAfterChange": 14, "signatureBeforeChange": "     public void copyFile(File sourceFile, File destFile,                          FilterSetCollection filters, Vector filterChains,                          boolean overwrite, boolean preserveLastModified,                          String encoding, Project project)         throws IOException", "signatureAfterChange": "     public void copyFile(File sourceFile, File destFile,                          FilterSetCollection filters, Vector filterChains,                          boolean overwrite, boolean preserveLastModified,                          String encoding, Project project)         throws IOException", "diff": ["-                if (encoding == null) {", "-                    in = new BufferedReader(new FileReader(sourceFile));", "-                    out = new BufferedWriter(new FileWriter(destFile));", "-                } else {", "-                    in = new BufferedReader(new InputStreamReader(", "-                            new FileInputStream(sourceFile), encoding));", "-                    out = new BufferedWriter(new OutputStreamWriter(", "-                            new FileOutputStream(destFile), encoding));", "-                }", "-", "-                if (filterChainsAvailable) {", "-                    ChainReaderHelper crh = new ChainReaderHelper();", "-                    crh.setBufferSize(8192);", "-                    crh.setPrimaryReader(in);", "-                    crh.setFilterChains(filterChains);", "-                    crh.setProject(project);", "-                    Reader rdr = crh.getAssembledReader();", "-                    in = new BufferedReader(rdr);", "-                }", "-", "-                int length;", "-                String newline = null;", "-                String line = in.readLine();", "-                while (line != null) {", "-                    if (line.length() == 0) {", "-                        out.newLine();", "+                try {", "+                    if (encoding == null) {", "+                        in = new BufferedReader(new FileReader(sourceFile));", "+                        out = new BufferedWriter(new FileWriter(destFile));", "-                        if (filterSetsAvailable) {", "-                            newline = filters.replaceTokens(line);", "-                        } else {", "-                            newline = line;", "-                        }", "-                        out.write(newline);", "-                        out.newLine();", "+                        in = ", "+                            new BufferedReader(new InputStreamReader(", "+                                                 new FileInputStream(sourceFile), ", "+                                                 encoding));", "+                        out = ", "+                            new BufferedWriter(new OutputStreamWriter(", "+                                                 new FileOutputStream(destFile), ", "+                                                 encoding));", "-                    line = in.readLine();", "+", "+                    if (filterChainsAvailable) {", "+                        ChainReaderHelper crh = new ChainReaderHelper();", "+                        crh.setBufferSize(8192);", "+                        crh.setPrimaryReader(in);", "+                        crh.setFilterChains(filterChains);", "+                        crh.setProject(project);", "+                        Reader rdr = crh.getAssembledReader();", "+                        in = new BufferedReader(rdr);", "+                    }", "+                    ", "+                    int length;", "+                    String newline = null;", "+                    String line = in.readLine();", "+                    while (line != null) {", "+                        if (line.length() == 0) {", "+                            out.newLine();", "+                        } else {", "+                            if (filterSetsAvailable) {", "+                                newline = filters.replaceTokens(line);", "+                            } else {", "+                                newline = line;", "+                            }", "+                            out.write(newline);", "+                            out.newLine();", "+                        }", "+                        line = in.readLine();", "+                    }", "+                } finally {", "+                    if (out != null) {", "+                        out.close();", "+                    }", "+                    if (in != null) {", "+                        in.close();", "+                    }", "-", "-                out.close();", "-                in.close();", "-                FileInputStream in = new FileInputStream(sourceFile);", "-                FileOutputStream out = new FileOutputStream(destFile);", "+                FileInputStream in = null;", "+                FileOutputStream out = null;", "+                try {", "+                    in = new FileInputStream(sourceFile);", "+                    out = new FileOutputStream(destFile);", "-                byte[] buffer = new byte[8 * 1024];", "-                int count = 0;", "-                do {", "-                    out.write(buffer, 0, count);", "-                    count = in.read(buffer, 0, buffer.length);", "-                } while (count != -1);", "-", "-                in.close();", "-                out.close();", "+                    byte[] buffer = new byte[8 * 1024];", "+                    int count = 0;", "+                    do {", "+                        out.write(buffer, 0, count);", "+                        count = in.read(buffer, 0, buffer.length);", "+                    } while (count != -1);", "+                } finally {", "+                    if (out != null) {", "+                        out.close();", "+                    }", "+                    if (in != null) {", "+                        in.close();", "+                    }", "+                }"]}]}