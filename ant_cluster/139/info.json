{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "9841897ab7d88835e61f1b97ad683cba", "detectedBy": ["DIFF_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "219a1ef08ca0874f20378c69a887277d", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/optional/net/FTP.java", "commitBeforeChange": "33d19ef67e2eb18cdf696c337f158ae725f92f21", "commitAfterChange": "b14e61f604f088f5522e8caa9c396da71e7b775e", "methodNumberBeforeChange": 57, "methodNumberAfterChange": 57, "signatureBeforeChange": "     protected int transferFiles(FTPClient ftp, FileSet fs)          throws IOException, BuildException", "signatureAfterChange": "     protected int transferFiles(FTPClient ftp, FileSet fs)          throws IOException, BuildException", "diff": ["-", "-            for (int i = 0; i < dsfiles.length; i++) {", "-                switch (action) {", "-                    case SEND_FILES:", "-                        sendFile(ftp, dir, dsfiles[i]);", "-                        break;", "-                    case GET_FILES:", "-                        getFile(ftp, dir, dsfiles[i]);", "-                        break;", "-                    case DEL_FILES:", "-                        delFile(ftp, dsfiles[i]);", "-                        break;", "-                    case LIST_FILES:", "-                        listFile(ftp, bw, dsfiles[i]);", "-                        break;", "-                    case CHMOD:", "-                        doSiteCommand(ftp, \"chmod \" + chmod + \" \" + resolveFile(dsfiles[i]));", "-                        transferred++;", "-                        break;", "-                    case RM_DIR:", "-                        rmDir(ftp, dsfiles[i]);", "-                        break;", "-                    default:", "-                        throw new BuildException(\"unknown ftp action \" + action);", "+            if (action == RM_DIR) {", "+                // to remove directories, start by the end of the list", "+                // the trunk does not let itself be removed before the leaves", "+                for (int i = dsfiles.length - 1; i >= 0; i--) {", "+                    rmDir(ftp, dsfiles[i]);", "+                }", "+            }   else {", "+                for (int i = 0; i < dsfiles.length; i++) {", "+                    switch (action) {", "+                        case SEND_FILES:", "+                            sendFile(ftp, dir, dsfiles[i]);", "+                            break;", "+                        case GET_FILES:", "+                            getFile(ftp, dir, dsfiles[i]);", "+                            break;", "+                        case DEL_FILES:", "+                            delFile(ftp, dsfiles[i]);", "+                            break;", "+                        case LIST_FILES:", "+                            listFile(ftp, bw, dsfiles[i]);", "+                            break;", "+                        case CHMOD:", "+                            doSiteCommand(ftp, \"chmod \" + chmod + \" \" + resolveFile(dsfiles[i]));", "+                            transferred++;", "+                            break;", "+                        default:", "+                            throw new BuildException(\"unknown ftp action \" + action);", "+                    }"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "c9764c1e50bb261ac098b0d63ae0ea75", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/optional/net/FTP.java", "commitBeforeChange": "12df7ec426adb3e47cfb0d268d9b646769e38ac7", "commitAfterChange": "152be14c152edab99f90e8c71f589a6bf8087bbe", "methodNumberBeforeChange": 23, "methodNumberAfterChange": 23, "signatureBeforeChange": "     protected int transferFiles(FTPClient ftp, FileSet fs)         throws IOException, BuildException", "signatureAfterChange": "     protected int transferFiles(FTPClient ftp, FileSet fs)         throws IOException, BuildException", "diff": ["-        if ((ds.getBasedir() == null) && ((action == SEND_FILES) || (action == GET_FILES))) {", "-            throw new BuildException( \"the dir attribute must be set for send and get actions\" );", "+        if ((ds.getBasedir() == null) ", "+            && ((action == SEND_FILES) || (action == GET_FILES))) {", "+            throw new BuildException(\"the dir attribute must be set for send \"", "+                                     + \"and get actions\" );", "-        if (action == LIST_FILES) {", "-            File pd = new File(listing.getParent());", "-            if (!pd.exists()) {", "-                pd.mkdirs();", "-            }", "-            bw = new BufferedWriter(new FileWriter(listing));", "-        }", "-", "-        for (int i = 0; i < dsfiles.length; i++)", "-        {", "-            switch (action) {", "-            case SEND_FILES: {", "-                sendFile(ftp, dir, dsfiles[i]);", "-                break;", "+        try {", "+            if (action == LIST_FILES) {", "+                File pd = fileUtils.getParentFile(listing);", "+                if (!pd.exists()) {", "+                    pd.mkdirs();", "+                }", "+                bw = new BufferedWriter(new FileWriter(listing));", "-            case GET_FILES: {", "-                getFile(ftp, dir, dsfiles[i]);", "-                break;", "-            }", "+            for (int i = 0; i < dsfiles.length; i++) {", "+                switch (action) {", "+                case SEND_FILES: {", "+                    sendFile(ftp, dir, dsfiles[i]);", "+                    break;", "+                }", "-            case DEL_FILES: {", "-                delFile(ftp, dsfiles[i]);", "-                break;", "-            }", "+                case GET_FILES: {", "+                    getFile(ftp, dir, dsfiles[i]);", "+                    break;", "+                }", "-            case LIST_FILES: {", "-                listFile(ftp, bw, dsfiles[i]);", "-                break;", "-            }", "+                case DEL_FILES: {", "+                    delFile(ftp, dsfiles[i]);", "+                    break;", "+                }", "+                    ", "+                case LIST_FILES: {", "+                    listFile(ftp, bw, dsfiles[i]);", "+                    break;", "+                }", "+                    ", "+                case CHMOD: {", "+                    doSiteCommand(ftp, \"chmod \" + chmod + \" \" + dsfiles[i]);", "+                    transferred++;", "+                    break;", "+                }", "-            case CHMOD: {", "-                 doSiteCommand(ftp,\"chmod \" + chmod + \" \" + dsfiles[i]);", "-                 transferred++;", "-                 break;", "+                default: {", "+                    throw new BuildException(\"unknown ftp action \" + action );", "+                }", "+                }", "-", "-            default: {", "-                throw new BuildException(\"unknown ftp action \" + action );", "+        } finally {", "+            if (bw != null) {", "+                bw.close();", "-            }", "-        }", "-", "-        if (action == LIST_FILES) {", "-            bw.close();"]}]}