{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "6cb2c10eed39b7c2e2a8cf9a9764ce94", "detectedBy": ["AST_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "9e5ac01ae0bc20bddaee612a3ecee0d1", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/taskdefs/Replace.java", "commitBeforeChange": "79ab8ae1d59ed007337a3657ac5c6c78107cc0d8", "commitAfterChange": "c8c751af8ea4cb0607690327d79a0b56d6054925", "methodNumberBeforeChange": 14, "methodNumberAfterChange": 14, "signatureBeforeChange": "     private void processFile(File src) throws BuildException", "signatureAfterChange": "     private void processFile(File src) throws BuildException", "diff": ["-        File temp = fileUtils.createTempFile(\"rep\", \".tmp\",", "-                                             fileUtils.getParentFile(src));", "-        temp.deleteOnExit();", "-", "+        File temp = null;", "-            writer = encoding == null ? new FileWriter(temp)", "-                : new OutputStreamWriter(new FileOutputStream(temp), encoding);", "-            BufferedWriter bw = new BufferedWriter(writer);", "+            br.close();", "+            reader = null;", "+", "-            //Preserve original string (buf) so we can compare the result", "-            String newString = new String(buf);", "+            StringBuffer buffer = new StringBuffer(buf);", "+            buf = null;", "-            if (token != null) {", "-                // line separators in values and tokens are \"\\n\"", "-                // in order to compare with the file contents, replace them", "-                // as needed", "-                String val = stringReplace(value.getText(), \"\\r\\n\",", "-                                           \"\\n\", false);", "-                val = stringReplace(val, \"\\n\",", "-                                           StringUtils.LINE_SEP, false);", "-                String tok = stringReplace(token.getText(), \"\\r\\n\",", "-                                            \"\\n\", false);", "-                tok = stringReplace(tok, \"\\n\",", "-                                           StringUtils.LINE_SEP, false);", "+            int repCountStart = replaceCount;", "-                // for each found token, replace with value", "-                log(\"Replacing in \" + src.getPath() + \": \" + token.getText()", "-                    + \" --> \" + value.getText(), Project.MSG_VERBOSE);", "-                newString = stringReplace(newString, tok, val, true);", "-            }", "+            processReplacefilters(buffer, src.getPath());", "-            if (replacefilters.size() > 0) {", "-                newString = processReplacefilters(newString, src.getPath());", "-            }", "-", "-            boolean changes = !newString.equals(buf);", "+            boolean changes = (replaceCount != repCountStart);", "-                bw.write(newString, 0, newString.length());", "+                String out = buffer.toString();", "+                temp = fileUtils.createTempFile(\"rep\", \".tmp\",", "+                        src.getParentFile());", "+                temp.deleteOnExit();", "+                writer = encoding == null ? new FileWriter(temp)", "+                        : new OutputStreamWriter(new FileOutputStream(temp), encoding);", "+                BufferedWriter bw = new BufferedWriter(writer);", "+                bw.write(out, 0, out.length());", "-            }", "-", "-            // cleanup", "-            bw.close();", "-            writer = null;", "-            br.close();", "-            reader = null;", "-", "-            // If there were changes, move the new one to the old one;", "-            // otherwise, delete the new one", "-            if (changes) {", "+                bw.close();", "+                writer = null;"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "f6d520f32d36b9339b92515f84d169dd", "repository": "https://git-wip-us.apache.org/repos/asf/ant.git", "fileName": "src/main/org/apache/tools/ant/Diagnostics.java", "commitBeforeChange": "04a541221cbc527ac88a716e624b093cb92a04cd", "commitAfterChange": "bec41871b591248271815886afd1c0a318ee025e", "methodNumberBeforeChange": 12, "methodNumberAfterChange": 12, "signatureBeforeChange": "     public static void doReport(PrintStream out)", "signatureAfterChange": "     public static void doReport(PrintStream out)", "diff": ["-        out.println();", "-        out.println(\"-------------------------------------------\");", "-        out.println(\" Implementation Version \");", "-        out.println(\"-------------------------------------------\");", "+        header(out, \"Implementation Version\");", "+", "-        out.println();", "-        out.println(\"-------------------------------------------\");", "-        out.println(\" ANT_HOME/lib jar listing\");", "-        out.println(\"-------------------------------------------\");", "+        header(out, \"ANT_HOME/lib jar listing\");", "-        out.println();", "-        out.println(\"-------------------------------------------\");", "-        out.println(\" USER_HOME/.ant/lib jar listing\");", "-        out.println(\"-------------------------------------------\");", "+        header(out, \"USER_HOME/.ant/lib jar listing\");", "-        out.println();", "-        out.println(\"-------------------------------------------\");", "-        out.println(\" Tasks availability\");", "-        out.println(\"-------------------------------------------\");", "+        header(out, \"Tasks availability\");", "-        out.println();", "-        out.println(\"-------------------------------------------\");", "-        out.println(\" org.apache.env.Which diagnostics\");", "-        out.println(\"-------------------------------------------\");", "+        header(out, \"org.apache.env.Which diagnostics\");", "-", "-        out.println();", "-        out.println(\"-------------------------------------------\");", "-        out.println(\" XML Parser information\");", "-        out.println(\"-------------------------------------------\");", "+        header(out, \"XML Parser information\");", "-        out.println();", "-        out.println(\"-------------------------------------------\");", "-        out.println(\" System properties\");", "-        out.println(\"-------------------------------------------\");", "+        header(out, \"System properties\");", "+        header(out, \"Temp dir\");", "+        doReportTempDir(out);", "+    }"]}]}