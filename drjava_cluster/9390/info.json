{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "2fdc25194418b1f8ec831122f74a9f78", "detectedBy": ["DIFF_HIERARCHICAL"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "4dc985b2c16656c5c8ac299dfad77532", "repository": "http://git.code.sf.net/p/drjava/git_repo", "fileName": "drjava/src/edu/rice/cs/drjava/model/debug/DebugManager.java", "commitBeforeChange": "90f3515e98e577591a6618f1cf8f59bee5e6c509", "commitAfterChange": "1acb7e79f21833d9f8611e81be6afdbc403d9516", "methodNumberBeforeChange": 35, "methodNumberAfterChange": 35, "signatureBeforeChange": "    private void _updateWatches()", "signatureAfterChange": "    private void _updateWatches()", "diff": ["-    int stackIndex = 0;", "-    StackFrame currFrame = null;", "-    List frames = null;", "+      int stackIndex = 0;", "+      StackFrame currFrame = null;", "+      List frames = null;", "-    }", "-    catch (IncompatibleThreadStateException itse) {", "-      return;", "-    }", "-    currFrame = (StackFrame) frames.get(stackIndex);", "-    stackIndex++;", "-    Location location = currFrame.location();", "-    ReferenceType rt = location.declaringType();", "-    for (int i = 0; i < _watches.size(); i++) {", "-      WatchData currWatch = _watches.elementAt(i);", "-      String currName = currWatch.getName();", "-      String currValue = currWatch.getValue();", "-      // check for \"this\"", "-      if (currName.equals(\"this\")) {", "-        ObjectReference obj = currFrame.thisObject();", "-        if (obj != null) {", "-          currWatch.setValue(obj);", "-          currWatch.setType(obj.type());", "+      currFrame = (StackFrame) frames.get(stackIndex);", "+      stackIndex++;", "+      Location location = currFrame.location();", "+      ReferenceType rt = location.declaringType();", "+      for (int i = 0; i < _watches.size(); i++) {", "+        WatchData currWatch = _watches.elementAt(i);", "+        String currName = currWatch.getName();", "+        String currValue = currWatch.getValue();", "+        // check for \"this\"", "+        if (currName.equals(\"this\")) {", "+          ObjectReference obj = currFrame.thisObject();", "+          if (obj != null) {", "+            currWatch.setValue(_getValue(obj));", "+            currWatch.setType(obj.type());", "+          }", "+          else {", "+            currWatch.setValue(WatchUndefinedValue.Singleton);", "+            currWatch.setType(null);", "+          }", "+          continue;", "+        } ", "+        //List frames = null;", "+        LocalVariable localVar = null;", "+        try {", "+          localVar = currFrame.visibleVariableByName(currName);", "-        else {", "-          currWatch.setValue(WatchUndefinedValue.Singleton);", "-          currWatch.setType(null);", "+        catch (AbsentInformationException aie) {", "-        continue;", "-      } ", "-      //List frames = null;", "-      LocalVariable localVar = null;", "-      try {", "-        localVar = currFrame.visibleVariableByName(currName);", "-      }", "-      catch (AbsentInformationException aie) {", "-      }", "-      ", "-      ReferenceType outerRt = rt;", "-      // if the variable being watched is not a local variable, check if it's a field", "-      if (localVar == null) {", "-        Field field = outerRt.fieldByName(currName);", "-        // if the variable is not a field either, it's not defined in this ", "-        // ReferenceType's scope, keep going further out in scope.", "-        String className = outerRt.name();", "-        while (field == null) {", "+        ReferenceType outerRt = rt;", "+        // if the variable being watched is not a local variable, check if it's a field", "+        if (localVar == null) {", "+          Field field = outerRt.fieldByName(currName);", "-          // crop off the $ if there is one and anything after it", "-          int indexOfDollar = className.lastIndexOf('$');    ", "-          if (indexOfDollar > -1) {", "-            className = className.substring(0, indexOfDollar);", "-          }", "-          else {", "-            // There is no $ in the className, we're at the outermost class and the", "-            // field still was not found", "-            break;", "-          }", "-          outerRt = (ReferenceType)_vm.classesByName(className).get(0);", "-          if (outerRt == null) {", "-            break;", "-          }", "-          field = outerRt.fieldByName(currName);", "-        }", "-        if (field != null) {", "-          // check if the field is static", "-          if (field.isStatic()) {", "-            currWatch.setValue(outerRt.getValue(field));", "-            try {", "-              currWatch.setType(field.type());", "+          // if the variable is not a field either, it's not defined in this ", "+          // ReferenceType's scope, keep going further out in scope.", "+          String className = outerRt.name();", "+          while (field == null) {", "+            ", "+            // crop off the $ if there is one and anything after it", "+            int indexOfDollar = className.lastIndexOf('$');    ", "+            if (indexOfDollar > -1) {", "+              className = className.substring(0, indexOfDollar);", "-            catch (ClassNotLoadedException cnle) {", "-              currWatch.setType(null);", "+            else {", "+              // There is no $ in the className, we're at the outermost class and the", "+              // field still was not found", "+              break;", "+            outerRt = (ReferenceType)_vm.classesByName(className).get(0);", "+            if (outerRt == null) {", "+              break;", "+            }", "+            field = outerRt.fieldByName(currName);", "-          else {", "-            StackFrame outerFrame = currFrame;", "-            // the field is not static", "-            // Check if the frame represents a native or static method and", "-            // keep going down the stack frame looking for the frame that", "-            // has the same ReferenceType that we found the Field in.", "-            // This is a hack, remove it to slightly improve performance but", "-            // at the loss of ever being able to watch outer instance", "-            // fields. If unremoved, this will work sometimes, but not always.", "-            while (outerFrame.thisObject() != null && ", "-                   !outerFrame.thisObject().referenceType().equals(outerRt) &&", "-                   stackIndex < frames.size()) {", "-              outerFrame = (StackFrame) frames.get(stackIndex);", "-              stackIndex++;", "-            }", "-            if (stackIndex < frames.size() && outerFrame.thisObject() != null) { ", "-              // then we found the right stack frame", "-              currWatch.setValue(outerFrame.thisObject().getValue(field));", "+          if (field != null) {", "+            // check if the field is static", "+            if (field.isStatic()) {", "+              currWatch.setValue(_getValue(outerRt.getValue(field)));", "-              currWatch.setValue(WatchUndefinedValue.Singleton);", "-              currWatch.setType(null);", "+              StackFrame outerFrame = currFrame;", "+              // the field is not static", "+              // Check if the frame represents a native or static method and", "+              // keep going down the stack frame looking for the frame that", "+              // has the same ReferenceType that we found the Field in.", "+              // This is a hack, remove it to slightly improve performance but", "+              // at the loss of ever being able to watch outer instance", "+              // fields. If unremoved, this will work sometimes, but not always.", "+              while (outerFrame.thisObject() != null && ", "+                     !outerFrame.thisObject().referenceType().equals(outerRt) &&", "+                     stackIndex < frames.size()) {", "+                outerFrame = (StackFrame) frames.get(stackIndex);", "+                stackIndex++;", "+              }", "+              if (stackIndex < frames.size() && outerFrame.thisObject() != null) { ", "+                // then we found the right stack frame", "+                currWatch.setValue(_getValue(outerFrame.thisObject().getValue(field)));", "+                try {", "+                  currWatch.setType(field.type());", "+                }", "+                catch (ClassNotLoadedException cnle) {", "+                  currWatch.setType(null);", "+                }", "+              }", "+              else {", "+                currWatch.setValue(WatchUndefinedValue.Singleton);", "+                currWatch.setType(null);", "+              }", "+          }", "+          else {", "+            currWatch.setValue(WatchUndefinedValue.Singleton);", "+            currWatch.setType(null);", "-          currWatch.setValue(WatchUndefinedValue.Singleton);", "-          currWatch.setType(null);", "-        }", "-      }", "-      else {", "-        currWatch.setValue(currFrame.getValue(localVar));", "-        try {", "-          currWatch.setType(localVar.type());", "-        }", "-        catch (ClassNotLoadedException cnle) {", "-          currWatch.setType(null);", "+          currWatch.setValue(_getValue(currFrame.getValue(localVar)));", "+          try {", "+            currWatch.setType(localVar.type());", "+          }", "+          catch (ClassNotLoadedException cnle) {", "+            currWatch.setType(null);", "+          }", "+    catch (IncompatibleThreadStateException itse) {", "+      return;", "+    }", "+    catch (InvalidStackFrameException isfe) {", "+      return;", "+    }"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "ae163a89b401e06004eed3f17a4ae49b", "repository": "http://git.code.sf.net/p/drjava/git_repo", "fileName": "drjava/src/edu/rice/cs/drjava/model/debug/JPDADebugger.java", "commitBeforeChange": "5c952c5847e3008cec3ed5ff89d03d335c050f54", "commitAfterChange": "e3e56a8c058b51612dfa6f1f21259a37eadcdcbb", "methodNumberBeforeChange": 61, "methodNumberAfterChange": 61, "signatureBeforeChange": "   private void _updateWatches() throws DebugException", "signatureAfterChange": "   private void _updateWatches() throws DebugException", "diff": ["-      throw new IllegalStateException(\"Cannot update watches if there \" +", "-                                      \"are no suspended threads.\");", "+      // Not suspended, so all watches are blank", "+      for (int i = 0; i < _watches.size(); i++) {", "+        DebugWatchData currWatch = _watches.elementAt(i);", "+        currWatch.hideValueAndType();", "+      }", "+      return;", "+      // note: obj is null if we're in a static context", "+      ", "+      // Get the name to determine how many $'s there are", "+      String rtName = rt.name();", "+      int numDollars = 0;", "+      int dollarIndex = rtName.indexOf(\"$\", 0);", "+      while (dollarIndex != -1) {", "+        numDollars++;", "+        dollarIndex = rtName.indexOf(\"$\", dollarIndex+1);", "+      }", "-            currWatch.setType(obj.type());", "+            currWatch.setType(String.valueOf(obj.type()));", "-            currWatch.setValue(DebugWatchUndefinedValue.ONLY);", "-            currWatch.setType(null);", "+            // \"this\" is not defined in a static context", "+            currWatch.setNoValue();", "+            currWatch.setNoType();", "-        //List frames = null;", "+        ", "+        // Look for a variable with this name", "-        ", "-        ReferenceType outerRt = rt;", "-        ObjectReference outer = obj;", "-        // if the variable being watched is not a local variable, check if it's a field", "-        if (localVar == null) {", "+", "+        if (localVar != null) {", "+          currWatch.setValue(_getValue(currFrame.getValue(localVar)));", "+          try {", "+            currWatch.setType(String.valueOf(localVar.type()));", "+          }", "+          catch (ClassNotLoadedException cnle) {", "+            currWatch.setNoType();", "+          }", "+        }", "+        // if the variable being watched is not a local variable,", "+        //  check if it's a field", "+        else {", "+          ReferenceType outerRt = rt;", "+          ObjectReference outer = obj;  // (null if static context)", "-          ", "-          // if the variable is not a field either, it's not defined in this", "-          // ReferenceType's scope, keep going further out in scope.", "-          Field outerThis = outerRt.fieldByName(\"this$0\");", "-          ", "+", "+          // If we don't find it here, loop through any enclosing classes", "+          //  Start at this$N, where N is the number of dollar signs in", "+          //  the reference type's name, minus one.", "+          int outerIndex = numDollars - 1;", "+          Field outerThis = outerRt.fieldByName(\"this$\" + outerIndex);", "-            //outer = (ObjectReference)outer.getValue(outerThis);//currFrame.getValue(var);", "-              outerThis = outerRt.fieldByName(\"this$0\");", "+              outerIndex--;", "+              outerThis = outerRt.fieldByName(\"this$\" + outerIndex);", "-          if (field != null) {", "-            currWatch.setValue(_getValue(outer.getValue(field)));", "+          // Try to set the value and type of the field.", "+          //  If the field is not static and we are in a static context", "+          //  (outer==null), we have to setNoValue.", "+          if ((field != null) &&", "+              (field.isStatic() || (outer != null))) {", "+            Value v = (field.isStatic()) ?", "+              outerRt.getValue(field) :", "+              outer.getValue(field);", "+            currWatch.setValue(_getValue(v));", "-              currWatch.setType(field.type());", "+              currWatch.setType(String.valueOf(field.type()));", "-              currWatch.setType(null);", "+              currWatch.setNoType();", "-          /*", "-            ", "-            // crop off the $ if there is one and anything after it", "-            int indexOfDollar = className.lastIndexOf('$');", "-            if (indexOfDollar > -1) {", "-              className = className.substring(0, indexOfDollar);", "-            }", "-            else {", "-              // There is no $ in the className, we're at the outermost class and the", "-              // field still was not found", "-              break;", "-            }", "-            outerRt = (ReferenceType)_vm.classesByName(className).get(0);", "-            if (outerRt == null) {", "-              break;", "-            }", "-            field = outerRt.fieldByName(currName);", "-          }", "-          if (field != null) {", "-            // check if the field is static", "-            if (field.isStatic()) {", "-              currWatch.setValue(_getValue(outerRt.getValue(field)));", "-              try {", "-                currWatch.setType(field.type());", "-              }", "-              catch (ClassNotLoadedException cnle) {", "-                currWatch.setType(null);", "-              }", "-            }", "-            else {", "-              LocalVariable var;", "-              ObjectReference outer;", "-              do {", "-                // get the object reference for outer classes", "-                var = currFrame.visibleVariableByName(\"this$0\");", "-                outer = (ObjectReference)currFrame.getValue(var);", "-              }", "-              while (!outer.referenceType().equals(outerRt));", "-                 ", "-              */", "-          ", "-              /*", "-              StackFrame outerFrame = currFrame;", "-              // the field is not static", "-              // Check if the frame represents a native or static method and", "-              // keep going down the stack frame looking for the frame that", "-              // has the same ReferenceType that we found the Field in.", "-              // This is a hack, remove it to slightly improve performance but", "-              // at the loss of ever being able to watch outer instance", "-              // fields. If unremoved, this will work sometimes, but not always.", "-              while (outerFrame.thisObject() != null &&", "-                     !outerFrame.thisObject().referenceType().equals(outerRt) &&", "-                     stackIndex < frames.size()) {", "-                outerFrame = (StackFrame) frames.get(stackIndex);", "-                stackIndex++;", "-              }", "-              if (stackIndex < frames.size() && outerFrame.thisObject() != null) {", "-                // then we found the right stack frame", "-                currWatch.setValue(_getValue(outerFrame.thisObject().getValue(field)));", "-                try {", "-                  currWatch.setType(field.type());", "-                }", "-                catch (ClassNotLoadedException cnle) {", "-                  currWatch.setType(null);", "-                }", "-              }", "-              else {", "-                currWatch.setValue(DebugWatchUndefinedValue.ONLY);", "-                currWatch.setType(null);", "-              }", "-              ", "-            }*/", "-            currWatch.setValue(DebugWatchUndefinedValue.ONLY);", "-            currWatch.setType(null);", "+            currWatch.setNoValue();", "+            currWatch.setNoType();", "-        else {", "-          currWatch.setValue(_getValue(currFrame.getValue(localVar)));", "-          try {", "-            currWatch.setType(localVar.type());", "-          }", "-          catch (ClassNotLoadedException cnle) {", "-            currWatch.setType(null);", "-          }", "-        }", "+        "]}], "num": 9390}