{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "10063933b7c404d08fbfebf9838d24cd", "detectedBy": ["AST_HIERARCHICAL"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "c239a5f412dfb9b58764eeab00f811c5", "repository": "http://git.code.sf.net/p/drjava/git_repo", "fileName": "drjava/src/edu/rice/cs/drjava/model/definitions/DefinitionsDocument.java", "commitBeforeChange": "a8db062e8dfd667df6324c059f7a6725afc99a1b", "commitAfterChange": "35da9b77b7d75aca3d6277e27e3ba3dc86f3eaa9", "methodNumberBeforeChange": 43, "methodNumberAfterChange": 43, "signatureBeforeChange": "   public String getNextTopLevelClassName(int startPos, int endPos)     throws ClassNameNotFoundException", "signatureAfterChange": "   public String getNextTopLevelClassName(int startPos, int endPos) throws ClassNameNotFoundException", "diff": ["-  public String getNextTopLevelClassName(int startPos, int endPos)", "-    throws ClassNameNotFoundException {", "-    // throwErrorHuh();", "+  public String getNextTopLevelClassName(int startPos, int endPos) throws ClassNameNotFoundException {", "-    int oldLocation = getCurrentLocation();", "-", "-    try {", "-      setCurrentLocation(startPos);", "-      final int textLength = endPos - startPos;", "-      final String text = getText(startPos, textLength);", "-", "-      boolean done;", "-      int index;", "-", "-      int indexOfClass = _findKeywordAtToplevel(\"class\", text, startPos);", "-      int indexOfInterface = _findKeywordAtToplevel(\"interface\", text, startPos);", "-      int indexOfEnum = _findKeywordAtToplevel(\"enum\",text,startPos);", "-        ", "-      //If class exists at top level AND either there is no interface at top level or the index of class precedes the index of the top", "-      //level interface, AND the same for top level enum, then the class is the first top level declaration", "-      if( (indexOfClass > -1) ", "-           && (indexOfInterface <= -1 || indexOfClass < indexOfInterface) ", "-           && (indexOfEnum <= -1 || indexOfClass < indexOfEnum) ) {", "-        index = indexOfClass + \"class\".length();", "-      }", "-      else if( (indexOfInterface > -1) ", "-                && (indexOfClass <= -1 || indexOfInterface < indexOfClass) ", "-                && (indexOfEnum <= -1 || indexOfInterface < indexOfEnum) ) {", "-        index = indexOfInterface + \"interface\".length();", "-      }", "-      else if( (indexOfEnum > -1)", "-                && (indexOfClass <= -1 || indexOfEnum < indexOfClass)   ", "-                && (indexOfInterface <= -1 || indexOfEnum < indexOfInterface)) {", "-        index = indexOfEnum + \"enum\".length();", "-      }", "-      else {", "-        // no index was valid", "-        throw new ClassNameNotFoundException(\"No top level class name found\");", "-      }", "-        ", "-      ", "-//      if (indexOfClass > -1) {", "-//", "-//        if (indexOfInterface > -1) {", "-//          // compare indices to find the lesser", "-//          index = (indexOfClass < indexOfInterface) ?", "-//            indexOfClass + \"class\".length() :", "-//            indexOfInterface + \"interface\".length();", "-//        }", "-//        else {", "-//          //top level class declaration found", "-//          index = indexOfClass + \"class\".length();", "-//        }", "-//      }", "-//      else {", "-//        if (indexOfInterface > -1) {", "-//          index = indexOfInterface + \"interface\".length();", "-//        }", "-//        else {", "-//          // neither index was valid", "-//          throw new ClassNameNotFoundException(\"No top level class name found\");", "-//        }", "-//      }", "-", "-      //if we make it here we have a valid index", "-", "-      //first find index of first non whitespace (from the index in document)", "-      index = getFirstNonWSCharPos(startPos + index) - startPos;", "-      if (index == -1) throw new ClassNameNotFoundException(\"No top level class name found\");", "-", "-      int endIndex = textLength; //just in case no whitespace at end of file", "-", "-      //find index of next delimiter or whitespace", "-      char c;", "-      for (int i = index; i < textLength; i++) {", "-        c = text.charAt(i);", "-        if (!Character.isJavaIdentifierPart(c)) {", "-          endIndex = i;", "-          break;", "-        }", "-      }", "-", "-      setCurrentLocation(oldLocation);", "-      return text.substring(index,endIndex);", "-    }", "-    catch (BadLocationException ble) { throw new UnexpectedException(ble); }", "-    finally { setCurrentLocation(oldLocation); }", "-  }", "+    int oldLocation = _currentLocation;", "+    readLock();", "+      try {", "+        setCurrentLocation(startPos);", "+        final int textLength = endPos - startPos;", "+        final String text = getText(startPos, textLength);", "+        ", "+        boolean done;", "+        int index;", "+        ", "+        int indexOfClass = _findKeywordAtToplevel(\"class\", text, startPos);", "+        int indexOfInterface = _findKeywordAtToplevel(\"interface\", text, startPos);", "+        int indexOfEnum = _findKeywordAtToplevel(\"enum\",text,startPos);", "+        ", "+        //If class exists at top level AND either there is no interface at top level or the index of class precedes the index of the top", "+        //level interface, AND the same for top level enum, then the class is the first top level declaration", "+        if (indexOfClass > -1 && (indexOfInterface <= -1 || indexOfClass < indexOfInterface) ", "+              && (indexOfEnum <= -1 || indexOfClass < indexOfEnum)) {", "+          index = indexOfClass + \"class\".length();", "+        }", "+        else if (indexOfInterface > -1 && (indexOfClass <= -1 || indexOfInterface < indexOfClass) ", "+                  && (indexOfEnum <= -1 || indexOfInterface < indexOfEnum)) {", "+          index = indexOfInterface + \"interface\".length();", "+        }", "+        else if (indexOfEnum > -1 && (indexOfClass <= -1 || indexOfEnum < indexOfClass)   ", "+                   && (indexOfInterface <= -1 || indexOfEnum < indexOfInterface)) {", "+          index = indexOfEnum + \"enum\".length();", "+        }", "+          // no index was valid", "+          throw new ClassNameNotFoundException(\"No top level class name found\");", "+        }", "+        //if we make it here we have a valid index", "+        ", "+        //first find index of first non whitespace (from the index in document)", "+        index = getFirstNonWSCharPos(startPos + index) - startPos;", "+        if (index == -1) throw new ClassNameNotFoundException(\"No top level class name found\");", "+        ", "+        int endIndex = textLength; //just in case no whitespace at end of file", "+        ", "+        //find index of next delimiter or whitespace", "+        char c;", "+        for (int i = index; i < textLength; i++) {", "+          c = text.charAt(i);", "+          if (!Character.isJavaIdentifierPart(c)) {", "+            endIndex = i;", "+        ", "+        setCurrentLocation(oldLocation);", "+        return text.substring(index,endIndex);", "+      catch (BadLocationException ble) { throw new UnexpectedException(ble); }", "+      finally { ", "+        setCurrentLocation(oldLocation);", "+        readUnlock();", "+      }"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "f0e9c65e6a41d1297716c819936da5af", "repository": "http://git.code.sf.net/p/drjava/git_repo", "fileName": "drjava/src/edu/rice/cs/drjava/model/definitions/DefinitionsDocument.java", "commitBeforeChange": "a8db062e8dfd667df6324c059f7a6725afc99a1b", "commitAfterChange": "35da9b77b7d75aca3d6277e27e3ba3dc86f3eaa9", "methodNumberBeforeChange": 40, "methodNumberAfterChange": 40, "signatureBeforeChange": "   public String getPackageName() throws InvalidPackageException", "signatureAfterChange": "   public String getPackageName() throws InvalidPackageException", "diff": ["+    int oldLocation;", "+    readLock();", "-      int oldLocation = getCurrentLocation();", "-      ", "+      oldLocation = _currentLocation;", "+        int firstNormalLocation;", "-        //      System.out.println(\"oldlocation: \" + oldLocation + \", doclength: \" + docLength + \", text: \\\"\" + text + \"\\\"\");", "-        // The location of the first non-whitespace character that", "-        // is not inside quote or comment.", "-        int firstNormalLocation = 0;", "-        while ((firstNormalLocation < docLength)) {", "+        // The location of the first non-whitespace character that is not inside a string or comment.", "+        firstNormalLocation = 0;", "+        while (firstNormalLocation < docLength) {", "-            if (!Character.isWhitespace(curChar)) {", "-              break;", "-            }", "+            if (! Character.isWhitespace(curChar)) break;", "-        ", "+", "-            ! text.substring(firstNormalLocation, endLocation).equals(\"package\"))", "-        {", "-          // the first normal text is not \"package\" or there is not enough", "-          // text for there to be a package statement.", "-          // thus, there is no valid package statement.", "+            ! text.substring(firstNormalLocation, endLocation).equals(\"package\")) {", "+          // The first normal text is not \"package\" or there is not enough text for there to be a package statement.", "+          // Thus, there is no valid package statement.", "-          ", "-          if (semicolonLocation == -1) {", "+          if (semicolonLocation == -1)", "-          }", "-        if (toReturn.equals(\"\")) {", "+        if (toReturn.equals(\"\"))", "-        }", "-        setCurrentLocation(0);", "+        setCurrentLocation(0);  // Why?", "+        readUnlock();  // _reduced lock will be released in the next instruction"]}], "num": 21523}