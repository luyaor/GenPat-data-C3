{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "e79c619ede17cbae61991330074af108", "detectedBy": ["DIFF_HIERARCHICAL", "DIFF_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "242d8bfd2925386c2f7d6a57e07ab0cb", "repository": "http://git.code.sf.net/p/drjava/git_repo", "fileName": "drjava/src/edu/rice/cs/drjava/model/definitions/DefinitionsDocument.java", "commitBeforeChange": "ba2b5ff7a570417e9dd4c8e447dbbd043b8c1381", "commitAfterChange": "098be4c27233835145531c86355bc697a3b62bfd", "methodNumberBeforeChange": 34, "methodNumberAfterChange": 36, "signatureBeforeChange": "   public String getEnclosingClassName(final int pos, final boolean qual) throws BadLocationException,      ClassNameNotFoundException", "signatureAfterChange": "   public String _getEnclosingClassName(final int pos, final boolean qual) throws BadLocationException,      ClassNameNotFoundException", "diff": ["-  public String getEnclosingClassName(final int pos, final boolean qual) throws BadLocationException, ", "+    */", "+  public String _getEnclosingClassName(final int pos, final boolean qual) throws BadLocationException, ", "-//    boolean oldLog = log; log = false;", "+    ", "+    assert isReadLocked();", "-    acquireReadLock();", "-    try {", "-      ", "-      final String text = getText(0, pos);  ", "-      ", "-      int curPos = pos;", "-      ", "-      do {", "+    final String text = getText(0, pos);  ", "+    ", "+    int curPos = pos;", "+    ", "+    do {", "-        ", "+      ", "-        ", "-        curPos = findPrevEnclosingBrace(curPos, '{', '}');", "-        if (curPos == -1) { break; }", "-        int classPos = _findPrevKeyword(text, \"class\", curPos);", "-        int interPos = _findPrevKeyword(text, \"interface\", curPos);", "-        int otherPos = findPrevDelimiter(curPos, delims);", "-        int newPos = -1;", "-        // see if there's a ) closer by", "-        int closeParenPos = findPrevNonWSCharPos(curPos);", "-        if (closeParenPos != -1 && text.charAt(closeParenPos) == ')') {", "-          // yes, find the matching (", "-          int openParenPos = findPrevEnclosingBrace(closeParenPos, '(', ')');", "-          if (openParenPos != -1 && text.charAt(openParenPos) == '(') {", "-            // this might be an inner class", "-            newPos = _findPrevKeyword(text, \"new\", openParenPos);", "+      ", "+      curPos = _findPrevEnclosingBrace(curPos, '{', '}');", "+      if (curPos == -1) { break; }", "+      int classPos = _findPrevKeyword(text, \"class\", curPos);", "+      int interPos = _findPrevKeyword(text, \"interface\", curPos);", "+      int otherPos = _findPrevDelimiter(curPos, delims);", "+      int newPos = -1;", "+      // see if there's a ) closer by", "+      int closeParenPos = findPrevNonWSCharPos(curPos);", "+      if (closeParenPos != -1 && text.charAt(closeParenPos) == ')') {", "+        // yes, find the matching (", "+        int openParenPos = _findPrevEnclosingBrace(closeParenPos, '(', ')');", "+        if (openParenPos != -1 && text.charAt(openParenPos) == '(') {", "+          // this might be an inner class", "+          newPos = _findPrevKeyword(text, \"new\", openParenPos);", "-            if (! _isAnonymousInnerClass(newPos, curPos)) {", "-              // not an anonymous inner class", "-              newPos = -1;", "-            }", "+          if (! _isAnonymousInnerClass(newPos, curPos)) {", "+            // not an anonymous inner class", "+            newPos = -1;", "+      }", "-        while (classPos != -1 || interPos != -1 || newPos != -1) {", "-          if (newPos != -1) {", "+      while (classPos != -1 || interPos != -1 || newPos != -1) {", "+        if (newPos != -1) {", "-            classPos = -1;", "-            interPos = -1;", "-            break;", "-          }", "-          else if (otherPos > classPos && otherPos > interPos) {", "-            if (text.charAt(otherPos) != '{' || text.charAt(otherPos) != '}') ++otherPos;", "-            curPos = findPrevEnclosingBrace(otherPos, '{', '}');", "-            classPos = _findPrevKeyword(text, \"class\", curPos);", "-            interPos = _findPrevKeyword(text, \"interface\", curPos);", "-            otherPos = findPrevDelimiter(curPos, delims);", "-            newPos = -1;", "-            // see if there's a ) closer by", "-            closeParenPos = findPrevNonWSCharPos(curPos);", "+          classPos = -1;", "+          interPos = -1;", "+          break;", "+        }", "+        else if (otherPos > classPos && otherPos > interPos) {", "+          if (text.charAt(otherPos) != '{' || text.charAt(otherPos) != '}') ++otherPos;", "+          curPos = _findPrevEnclosingBrace(otherPos, '{', '}');", "+          classPos = _findPrevKeyword(text, \"class\", curPos);", "+          interPos = _findPrevKeyword(text, \"interface\", curPos);", "+          otherPos = _findPrevDelimiter(curPos, delims);", "+          newPos = -1;", "+          // see if there's a ) closer by", "+          closeParenPos = findPrevNonWSCharPos(curPos);", "-            if (closeParenPos != -1 && text.charAt(closeParenPos) == ')') {", "-              // yes, find the matching (", "-              int openParenPos = findPrevEnclosingBrace(closeParenPos, '(', ')');", "-              if (openParenPos != -1 && text.charAt(openParenPos) == '(') {", "-                // this might be an inner class", "-                newPos = _findPrevKeyword(text, \"new\", openParenPos);", "+          if (closeParenPos != -1 && text.charAt(closeParenPos) == ')') {", "+            // yes, find the matching (", "+            int openParenPos = _findPrevEnclosingBrace(closeParenPos, '(', ')');", "+            if (openParenPos != -1 && text.charAt(openParenPos) == '(') {", "+              // this might be an inner class", "+              newPos = _findPrevKeyword(text, \"new\", openParenPos);", "-                if (! _isAnonymousInnerClass(newPos, curPos)) newPos = -1;", "-              }", "+              if (! _isAnonymousInnerClass(newPos, curPos)) newPos = -1;", "+          }", "-          }", "-          else {", "-            // either class or interface found first            ", "-            curPos = Math.max(classPos, Math.max(interPos, newPos));", "-            break;", "-          }", "+        else {", "+          // either class or interface found first            ", "+          curPos = Math.max(classPos, Math.max(interPos, newPos));", "+          break;", "+        }", "+      }", "+      ", "+      if (classPos != -1 || interPos != -1) {", "+        if (classPos > interPos) curPos += \"class\".length();  // class found first", "+        else curPos += \"interface\".length();                  // interface found first", "-        if (classPos != -1 || interPos != -1) {", "-          if (classPos > interPos) curPos += \"class\".length();  // class found first", "-          else curPos += \"interface\".length();                  // interface found first", "-          ", "-          int nameStart = getFirstNonWSCharPos(curPos);", "-          if (nameStart==-1) { throw new ClassNameNotFoundException(\"Cannot determine enclosing class name\"); }", "-          int nameEnd = nameStart + 1;", "-          while (nameEnd < text.length()) {", "-            if (! Character.isJavaIdentifierPart(text.charAt(nameEnd)) && text.charAt(nameEnd) != '.') break;", "-            ++nameEnd;", "-          }", "-          name = text.substring(nameStart,nameEnd) + '$' + name;", "+        int nameStart = _getFirstNonWSCharPos(curPos);", "+        if (nameStart==-1) { throw new ClassNameNotFoundException(\"Cannot determine enclosing class name\"); }", "+        int nameEnd = nameStart + 1;", "+        while (nameEnd < text.length()) {", "+          if (! Character.isJavaIdentifierPart(text.charAt(nameEnd)) && text.charAt(nameEnd) != '.') break;", "+          ++nameEnd;", "-        else if (newPos != -1) {", "-          name = String.valueOf(_getAnonymousInnerClassIndex(curPos)) + \"$\" + name;", "-          curPos = newPos;", "-        }", "-        else break; // neither class nor interface found (exiting loop if qual == true)", "-      } while(qual);", "-    }", "-    finally { releaseReadLock(); }", "+        name = text.substring(nameStart,nameEnd) + '$' + name;", "+      }", "+      else if (newPos != -1) {", "+        name = String.valueOf(_getAnonymousInnerClassIndex(curPos)) + \"$\" + name;", "+        curPos = newPos;", "+      }", "+      else break; // neither class nor interface found (exiting loop if qual == true)", "+    } while(qual);", "+//    }", "+//    finally { releaseReadLock(); }"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "24a71a27ad70c22dfd5b65ad96e4d183", "repository": "http://git.code.sf.net/p/drjava/git_repo", "fileName": "drjava/src/edu/rice/cs/drjava/model/definitions/DefinitionsDocument.java", "commitBeforeChange": "910d746e63f304ca12ddaf504f429a40f31bf858", "commitAfterChange": "5aa76b13dff40570c1cd7aec5ad8f4bfd4acc66f", "methodNumberBeforeChange": 34, "methodNumberAfterChange": 34, "signatureBeforeChange": "   public String getEnclosingClassName(int pos, boolean qual) throws BadLocationException, ClassNameNotFoundException", "signatureAfterChange": "   public String getEnclosingClassName(final int pos, final boolean qual) throws BadLocationException,      ClassNameNotFoundException", "diff": ["-  public String getEnclosingClassName(int pos, boolean qual) throws BadLocationException, ClassNameNotFoundException {    ", "+  public String getEnclosingClassName(final int pos, final boolean qual) throws BadLocationException, ", "+    ClassNameNotFoundException {    ", "+    ", "-    final StringBuilder keyBuf = new StringBuilder(\"getEnclosingClassName:\").append(pos);", "-    keyBuf.append(\":\").append(qual);", "-    String key = keyBuf.toString();", "-    String cached = (String) _checkCache(key);", "+    final Query key = new Query.EnclosingClassName(pos, qual);", "+    final String cached = (String) _checkCache(key);", "-    char[] delims = {'{','}','(',')','[',']','+','-','/','*',';',':','=',", "-      '!','@','#','$','%','^','~','\\\\','\"','`','|'};", "+    final char[] delims = {'{','}','(',')','[',']','+','-','/','*',';',':','=','!','@','#','$','%','^','~','\\\\','\"','`','|'};", "-      String text = getText(DOCSTART, pos+1);", "+      ", "+      final String text = getText(0, pos + 1);  // includes char at (to the right of) position pos", "-        if ((text.charAt(curPos)!='{') || (text.charAt(curPos)!='}')) { ++curPos; }", "+        if (text.charAt(curPos) != '{' || text.charAt(curPos) != '}') ++curPos;", "-        if (curPos==ERROR_INDEX) { break; }", "+        if (curPos == -1) { break; }", "-        int newPos = ERROR_INDEX;", "+        int newPos = -1;", "-        if ((closeParenPos!=ERROR_INDEX) && (text.charAt(closeParenPos)==')')) {", "+        if (closeParenPos != -1 && text.charAt(closeParenPos) == ')') {", "-          if ((openParenPos!=ERROR_INDEX) && (text.charAt(openParenPos)=='(')) {", "+          if (openParenPos != -1 && text.charAt(openParenPos) == '(') {", "-              newPos = ERROR_INDEX;", "+              newPos = -1;", "-        while((classPos!=ERROR_INDEX) || (interPos!=ERROR_INDEX) || (newPos!=ERROR_INDEX)) {", "-          if (newPos!=ERROR_INDEX) {", "+        while (classPos != -1 || interPos != -1 || newPos != -1) {", "+          if (newPos != -1) {", "-            classPos = ERROR_INDEX;", "-            interPos = ERROR_INDEX;", "+            classPos = -1;", "+            interPos = -1;", "-          else if ((otherPos>classPos) && (otherPos>interPos)) {", "-            if ((text.charAt(otherPos)!='{') || (text.charAt(otherPos)!='}')) { ++otherPos; }", "+          else if (otherPos > classPos && otherPos > interPos) {", "+            if (text.charAt(otherPos) != '{' || text.charAt(otherPos) != '}') ++otherPos;", "-            newPos = ERROR_INDEX;", "+            newPos = -1;", "-//            if (closeParenPos!=ERROR_INDEX) if (oldLog) System.out.println(\"nonWS before curPos = \" + closeParenPos + ", "+//            if (closeParenPos!=ERROR_INDEX (-1)) if (oldLog) System.out.println(\"nonWS before curPos = \" + closeParenPos + ", "-            if ((closeParenPos!=ERROR_INDEX) && (text.charAt(closeParenPos)==')')) {", "+            if (closeParenPos != -1 && text.charAt(closeParenPos) == ')') {", "-              if ((openParenPos!=ERROR_INDEX) && (text.charAt(openParenPos)=='(')) {", "+              if (openParenPos != -1 && text.charAt(openParenPos) == '(') {", "-                if (_isAnonymousInnerClass(newPos, curPos)) {", "-                  // yes, anonymous inner class", "-                }", "-                else {", "-                  newPos = ERROR_INDEX;", "-                }", "+                if (! _isAnonymousInnerClass(newPos, curPos)) newPos = -1;", "-        if ((classPos!=ERROR_INDEX) || (interPos!=ERROR_INDEX)) {", "-          if (classPos>interPos) {", "-            // class found first", "-            curPos += \"class\".length();", "-          }", "-          else {", "-            // interface found first", "-            curPos += \"interface\".length();", "-          }", "+        if (classPos != -1 || interPos != -1) {", "+          if (classPos > interPos) curPos += \"class\".length();  // class found first", "+          else curPos += \"interface\".length();                  // interface found first", "+          ", "-          if (nameStart==ERROR_INDEX) { throw new ClassNameNotFoundException(\"Cannot determine enclosing class name\"); }", "-          int nameEnd = nameStart+1;", "-          while(nameEnd<text.length()) {", "-            if ((!Character.isJavaIdentifierPart(text.charAt(nameEnd))) && (text.charAt(nameEnd)!='.')) {", "-              // delimiter found", "-              break;", "-            }", "+          if (nameStart==-1) { throw new ClassNameNotFoundException(\"Cannot determine enclosing class name\"); }", "+          int nameEnd = nameStart + 1;", "+          while (nameEnd < text.length()) {", "+            if (! Character.isJavaIdentifierPart(text.charAt(nameEnd)) && text.charAt(nameEnd) != '.') break;", "-        else if (newPos!=ERROR_INDEX) {", "+        else if (newPos != -1) {", "-        else {", "-          // neither class nor interface found", "-          break;", "-        }", "+        else break; // neither class nor interface found (exiting loop if qual == true)", "-    if (name.length()>0) name = name.substring(0, name.length()-1);", "+    if (name.length() > 0) name = name.substring(0, name.length() - 1);", "+    _storeInCache(key, name, pos);"]}], "num": 14381}