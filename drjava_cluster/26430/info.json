{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "ff415f5894436def23b4dc773d19b116", "detectedBy": ["AST_HIERARCHICAL"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "22b6aca0deb2340a34e9c4f30f6a3a42", "repository": "http://git.code.sf.net/p/drjava/git_repo", "fileName": "drjava/src/edu/rice/cs/util/text/ConsoleDocument.java", "commitBeforeChange": "8468328336764977b1a392d354ad9fa8332d6cf0", "commitAfterChange": "b5065bdb57d50a5108c714db64f9cb4417931362", "methodNumberBeforeChange": 15, "methodNumberAfterChange": 15, "signatureBeforeChange": "   public int getPositionBeforePrompt()", "signatureAfterChange": "   private int _getPositionBeforePrompt()", "diff": ["-  /** Gets the position immediately before the prompt, or the doc length if there is no prompt. */", "-  public int getPositionBeforePrompt() {", "-    acquireReadLock();", "+    * WriteLock is already held.*/", "+  private int _getPositionBeforePrompt() {", "-    try {", "-      if (_document.hasPrompt()) {", "-        int promptStart = _promptPos - _prompt.length();", "-        return (promptStart < len && promptStart >= 0) ? promptStart : len;  // ensure position is within document ", "-      }", "-      return len;", "+    if (_document.hasPrompt()) {", "+      int promptStart = _promptPos - _prompt.length();", "+      return (promptStart < len && promptStart >= 0) ? promptStart : len;  // ensure position is within document ", "-    finally { releaseReadLock(); }", "+    return len;"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "d2c308c9b1091f96b368c94534bf1bbb", "repository": "http://git.code.sf.net/p/drjava/git_repo", "fileName": "drjava/src/edu/rice/cs/drjava/model/AbstractDJDocument.java", "commitBeforeChange": "92fd06b34796984853343dde64251cfdd2a0ce25", "commitAfterChange": "ad91ad9028e35ded2c6aef6b30e8459151ecae7c", "methodNumberBeforeChange": 33, "methodNumberAfterChange": 33, "signatureBeforeChange": "   public int findPrevEnclosingBrace(int pos, char opening, char closing) throws BadLocationException", "signatureAfterChange": "   public int findPrevEnclosingBrace(int pos, char opening, char closing) throws BadLocationException", "diff": ["-    if ((pos >= getLength()) || (pos == DOCSTART)) { return ERROR_INDEX; }", "+    if (pos >= getLength() || pos == DOCSTART) { return ERROR_INDEX; }", "-    acquireReadLock();", "-    try {", "-      String text = getText(DOCSTART, pos);", "+    String text = getText(DOCSTART, pos);", "+    ", "+    synchronized(_reduced) {", "+      final int origLocation = _currentLocation;", "+      // Move reduced model to location pos", "+      _reduced.move(pos - origLocation);  // reduced model points to pos == reducedPos", "-      synchronized(_reduced) {", "-        final int origLocation = _currentLocation;", "-        // Move reduced model to location pos", "-        _reduced.move(pos - origLocation);  // reduced model points to pos == reducedPos", "+      // Walk backwards from specificed position", "+      for (i = pos-1; i >= DOCSTART; i--) {", "+        /* Invariant: reduced model points to reducedPos, text[i+1:pos] contains no valid delims, ", "+         * DOCSTART <= i < reducedPos <= pos */", "-        // Walk backwards from specificed position", "-        for (i = pos-1; i >= DOCSTART; i--) {", "-          /* Invariant: reduced model points to reducedPos, text[i+1:pos] contains no valid delims, ", "-           * DOCSTART <= i < reducedPos <= pos */", "+        if (match(text.charAt(i),delims)) {", "+          // Move reduced model to walker's location", "+          _reduced.move(i - reducedPos);  // reduced model points to i", "+          reducedPos = i;                 // reduced model points to reducedPos", "-          if (match(text.charAt(i),delims)) {", "-            // Move reduced model to walker's location", "-            _reduced.move(i - reducedPos);  // reduced model points to i", "-            reducedPos = i;                 // reduced model points to reducedPos", "-            ", "-            // Check if matching char should be ignored because it is within a comment, ", "-            // quotes, or ignored paren phrase", "-            ReducedModelState state = _reduced.getStateAtCurrent();", "-            if (!state.equals(ReducedModelState.FREE) || _isStartOfComment(text, i)", "-                  || ((i > 0) && _isStartOfComment(text, i - 1)))", "-              continue;  // ignore matching char ", "+          // Check if matching char should be ignored because it is within a comment, ", "+          // quotes, or ignored paren phrase", "+          ReducedModelState state = _reduced.getStateAtCurrent();", "+          if (! state.equals(ReducedModelState.FREE) || _isStartOfComment(text, i) || ", "+              (i > 0 && _isStartOfComment(text, i-1)))", "+            continue;  // ignore matching char ", "+          else {", "+            // found valid matching char", "+            if (text.charAt(i) == closing) ++braceBalance;", "-              // found valid matching char", "-              if (text.charAt(i)==closing) ++braceBalance;", "-              else {", "-                if (braceBalance==0) break; // found our opening brace", "-                --braceBalance;", "-              }", "+              if (braceBalance == 0) break; // found our opening brace", "+              --braceBalance;", "-        ", "-        /* Invariant: same as for loop except that DOCSTART-1 <= i <= reducedPos <= pos */", "-        ", "-        _reduced.move(origLocation - reducedPos);    // Restore the state of the reduced model;", "-      }  // end synchronized", "+      }", "-      if (i == DOCSTART-1) reducedPos = ERROR_INDEX; // No matching char was found", "-      _storeInCache(key, reducedPos);", "-    }", "-    finally { releaseReadLock(); }", "+      /* Invariant: same as for loop except that DOCSTART-1 <= i <= reducedPos <= pos */", "+      ", "+      _reduced.move(origLocation - reducedPos);    // Restore the state of the reduced model;", "+    }  // end synchronized", "+    ", "+    if (i == DOCSTART-1) reducedPos = ERROR_INDEX; // No matching char was found", "+    _storeInCache(key, reducedPos, pos);"]}], "num": 26430}