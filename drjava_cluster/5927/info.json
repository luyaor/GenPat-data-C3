{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "f217a0e718ca49edcf7a384ffc1c126f", "detectedBy": ["AST_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "6246700f26435a0a92f3c083a9b4c5d3", "repository": "http://git.code.sf.net/p/drjava/git_repo", "fileName": "drjava/src/edu/rice/cs/drjava/ui/AbstractConsoleController.java", "commitBeforeChange": "8468328336764977b1a392d354ad9fa8332d6cf0", "commitAfterChange": "b5065bdb57d50a5108c714db64f9cb4417931362", "methodNumberBeforeChange": 19, "methodNumberAfterChange": 18, "signatureBeforeChange": "     protected void _ensureLegalCaretPos()", "signatureAfterChange": "     protected void _ensureLegalCaretPos(DocumentEvent e)", "diff": ["-    protected void _ensureLegalCaretPos() {", "+    protected void _ensureLegalCaretPos(DocumentEvent e) {", "+//      System.err.println(\"_ensureLegalCaretPosition(\" + e + \") called\");", "-      int len = doc.getLength();", "-      if (_pane.getCaretPosition() > len) {", "-        _cachedCaretPos = len;", "-        _pane.setCaretPosition(len);", "+      int newPos = _pane.getCaretPosition();", "+      final int len = doc.getLength();", "+//      System.err.println(\"caretPos = \" + newPos + \" len = \" + len);", "+      if (newPos > len) {", "+        newPos = len;", "+        Utilities.invokeLater(new Runnable() { public void run() { _pane.setCaretPosition(len); } });", "+      setCachedCaretPos(newPos);"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "c8fb9602c8426d9e5e964c1d775141fb", "repository": "http://git.code.sf.net/p/drjava/git_repo", "fileName": "drjava/src/edu/rice/cs/drjava/ui/MainFrame.java", "commitBeforeChange": "8468328336764977b1a392d354ad9fa8332d6cf0", "commitAfterChange": "b5065bdb57d50a5108c714db64f9cb4417931362", "methodNumberBeforeChange": 472, "methodNumberAfterChange": 473, "signatureBeforeChange": "   public void uncommentLines()", "signatureAfterChange": "   public void uncommentLines()", "diff": ["-  // Uncomment out current selection using wing commenting.  Public for testing purposes only. */", "+  // Uncomment out current selection using wing commenting.  Public for testing purposes only. Only runs in event thread. */", "-    int newEnd = openDoc.uncommentLines(start, end);", "+    final int newEnd = openDoc.uncommentLines(start, end);", "-    if (startOffset != startPos.getOffset()) start -= 2;      ", "-    _currentDefPane.setCaretPosition(start);", "-    if (start != end) _currentDefPane.moveCaretPosition(newEnd);", "+    if (startOffset != startPos.getOffset()) start -= 2;", "+    final int f_start = start;", "+    final boolean moveSelection = start != end;", "+    Utilities.invokeAndWait(new Runnable() { ", "+      public void run() { ", "+        _currentDefPane.setCaretPosition(f_start);", "+        if (moveSelection) _currentDefPane.moveCaretPosition(newEnd);", "+      } ", "+    });   "]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "cb03fd6c4fae285bcb4409e27a26d31d", "repository": "http://git.code.sf.net/p/drjava/git_repo", "fileName": "drjava/src/edu/rice/cs/drjava/model/DefaultGlobalModel.java", "commitBeforeChange": "481944e3395dcc7a19e81902c59977be65ba633a", "commitAfterChange": "c682fca099b13e765e0e1f201629222d04fb1339", "methodNumberBeforeChange": 190, "methodNumberAfterChange": 193, "signatureBeforeChange": "     protected DefinitionsDocument getDocument()", "signatureAfterChange": "     protected DefinitionsDocument getDocument()", "diff": ["-      catch(IOException ioe) {", "+      catch(IOException ioe) { // document has been moved or deleted", "-          if (! isUntitled())  ", "-            _documentNavigator.refreshDocument(this, _file.getCanonicalFile().getParent());", "-          else throw new UnexpectedException(ioe); // Is this line reachable?", "-          ", "-        } catch(Throwable t) { throw new UnexpectedException(t); }", "-        //  System.out.println(\"DefaultGlobalModel: 1432: IOException should be handled by box that fixes everything.\");", "+          final String path = _file.getCanonicalFile().getParent();", "+          try {", "+            Utilities.invokeAndWait(new Runnable() {", "+              public void run() { _documentNavigator.refreshDocument(ConcreteOpenDefDoc.this, path); }", "+            });", "+            return _cacheAdapter.getDocument(); ", "+          }", "+          catch(InterruptedException e) { throw new UnexpectedException(e); }", "+        }", "+        catch(Throwable t) { throw new UnexpectedException(t); }", "-      ", "-      return null;"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "e27ef0e6a36b2cc1f4fdae1f8fc9520f", "repository": "http://git.code.sf.net/p/drjava/git_repo", "fileName": "drjava/src/edu/rice/cs/drjava/model/repl/InteractionsModel.java", "commitBeforeChange": "e753017eccbd872714e58c93831cb488b5045d2a", "commitAfterChange": "abaea23707eba81455db9185a249740d89273b85", "methodNumberBeforeChange": 28, "methodNumberAfterChange": 28, "signatureBeforeChange": "   public void loadHistory(FileOpenSelector selector) throws IOException", "signatureAfterChange": "   public void loadHistory(final FileOpenSelector selector) throws IOException", "diff": ["-  public void loadHistory(FileOpenSelector selector) throws IOException {", "+  public void loadHistory(final FileOpenSelector selector) throws IOException {", "-    _document.acquireWriteLock();", "-    try {", "-      _document.clearCurrentInteraction();", "-      ", "-      // Insert into the document and interpret", "-      final StringBuilder buf = new StringBuilder();", "-      for (String hist: histories) {", "-        ArrayList<String> interactions = _removeSeparators(hist);", "-        for (String curr: interactions) {", "-          int len = curr.length();", "-          buf.append(curr);", "-          if (len > 0 && curr.charAt(len - 1) != ';')  buf.append(';');", "-          buf.append(StringOps.EOL);", "+    final ArrayList<String> _histories = histories;", "+", "+    Utilities.invokeAndWait(new Runnable() {  // must run in event thread because caret is updated indivisibly", "+      public void run() {", "+        _document.acquireWriteLock();", "+        try {", "+          _document.clearCurrentInteraction();", "+          ", "+          // Insert into the document and interpret", "+          final StringBuilder buf = new StringBuilder();", "+          for (String hist: _histories) {", "+            ArrayList<String> interactions = _removeSeparators(hist);", "+            for (String curr: interactions) {", "+              int len = curr.length();", "+              buf.append(curr);", "+              if (len > 0 && curr.charAt(len - 1) != ';')  buf.append(';');", "+              buf.append(StringOps.EOL);", "+            }", "+          }", "+          String text = buf.toString().trim();", "+//          System.err.println(\"Histtory is: '\" + text + \"'\");", "+          append(text, InteractionsDocument.DEFAULT_STYLE);", "+        finally { _document.releaseWriteLock(); }", "+        interpretCurrentInteraction();  // Must be executed in event thread", "-      append(buf.toString().trim(), InteractionsDocument.DEFAULT_STYLE);", "-    }", "-    finally { _document.releaseWriteLock(); }", "-    interpretCurrentInteraction();", "+    });", "+    // Wait is necessary because interpretation can only be applied after history is loaded", "+//    System.err.println(\"Interpreting loaded history\");", "+"]}], "num": 5927}