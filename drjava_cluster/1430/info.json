{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "6c91656c3474097db3a6a161aaab7960", "detectedBy": ["DIFF_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "83a21ae9f76eb4f0704e87235f8515c4", "repository": "http://git.code.sf.net/p/drjava/git_repo", "fileName": "drjava/src/edu/rice/cs/drjava/model/AbstractDJDocument.java", "commitBeforeChange": "b552f36a1d45e65c0515c4425e1954dc75014315", "commitAfterChange": "4f7118cfc181d6dc991cba376f6e7b8942d8b8fc", "methodNumberBeforeChange": 36, "methodNumberAfterChange": 34, "signatureBeforeChange": "   public int _findPrevDelimiter(final int pos, final char[] delims, final boolean skipBracePhrases)     throws BadLocationException", "signatureAfterChange": "   public int findPrevDelimiter(final int pos, final char[] delims, final boolean skipBracePhrases)     throws BadLocationException", "diff": ["-  public int _findPrevDelimiter(final int pos, final char[] delims, final boolean skipBracePhrases)", "+  public int findPrevDelimiter(final int pos, final char[] delims, final boolean skipBracePhrases)", "-//      synchronized(_reduced) {", "-        final int origPos = _currentLocation;", "-        ", "-        // Walk backwards from specificed position, scanning current line for a delimiter", "-        for (i = pos - 1; i >= lineStartPos; i--) {", "-          /* Invariant: reduced model points to reducedPos, text[i+1:pos] contains no valid delims, ", "-           * 0 <= i < reducedPos <= pos */", "-          // Move reduced model to location pos", "-          int irel = i - lineStartPos;", "-          _setCurrentLocation(i);  // reduced model points to i", "-          if (_isShadowed() || isCommentOpen(line, irel)) {", "+      final int origPos = _currentLocation;", "+      ", "+      // Walk backwards from specificed position, scanning current line for a delimiter", "+      for (i = pos - 1; i >= lineStartPos; i--) {", "+        /* Invariant: reduced model points to reducedPos, text[i+1:pos] contains no valid delims, ", "+         * 0 <= i < reducedPos <= pos */", "+        // Move reduced model to location pos", "+        int irel = i - lineStartPos;", "+        setCurrentLocation(i);  // reduced model points to i", "+        if (isShadowed() || isCommentOpen(line, irel)) {", "-            continue;", "-          }", "-          char ch = line.charAt(irel);", "-          ", "-          if (_match(ch, delims) /* && ! isShadowed() && (! skipParenPhrases || ! posInParenPhrase())*/) {", "-            reducedPos = i;    // record valid match                                                                              ", "+          continue;", "+        }", "+        char ch = line.charAt(irel);", "+        ", "+        if (match(ch, delims) /* && ! isShadowed() && (! skipParenPhrases || ! posInParenPhrase())*/) {", "+          reducedPos = i;    // record valid match                                                                              ", "+          break;", "+        }", "+        ", "+        if (skipBracePhrases && match(ch, CLOSING_BRACES) ) {  // note that delims have already been matched", "+//            Utilities.show(\"closing bracket is '\" + ch + \"' at pos \" + i);", "+          setCurrentLocation(i + 1); // move cursor immediately to right of ch (a brace)", "+//            Utilities.show(\"_currentLocation = \" + _currentLocation);", "+          int dist = balanceBackward();  // bypasses redundant read locking", "+          if (dist == -1) { // if braces do not balance, return failure", "+            i = -1;", "+//              Utilities.show(\"dist = \" + dist + \" No matching brace found\");", "-          ", "-          if (skipBracePhrases && _match(ch, CLOSING_BRACES) ) {  // note that delims have already been matched", "-//            Utilities.show(\"closing bracket is '\" + ch + \"' at pos \" + i);", "-            _setCurrentLocation(i + 1); // move cursor immediately to right of ch (a brace)", "-//            Utilities.show(\"_currentLocation = \" + _currentLocation);", "-            int dist = balanceBackward();  // bypasses redundant read locking", "-            if (dist == -1) { // if braces do not balance, return failure", "-              i = -1;", "-//              Utilities.show(\"dist = \" + dist + \" No matching brace found\");", "-              break;", "-            }", "-            assert dist > 0;", "-//            Utilities.show(\"text = '\" + getText(i + 1 - dist, dist) + \"' dist = \" + dist + \" matching bracket is '\" + text.charAt(i) + \"' at pos \" + i);", "-            _setCurrentLocation(i + 1 - dist);  // skip over balanced brace text, decrementing _currentLocation", "-            i = _currentLocation;", "-            // Decrementing i skips over matching brace; could skip back into text preceding current line", "-            continue;", "-          }", "-        }  // end for", "-        ", "-        _setCurrentLocation(origPos);    // Restore the state of the reduced model;", "-//      }  // end synchronized", "+          assert dist > 0;", "+//            Utilities.show(\"text = '\" + getText(i + 1 - dist, dist) + \"' dist = \" + dist + \" matching bracket is '\" ", "+//            + text.charAt(i) + \"' at pos \" + i);", "+          setCurrentLocation(i + 1 - dist);  // skip over balanced brace text, decrementing _currentLocation", "+          i = _currentLocation;", "+          // Decrementing i skips over matching brace; could skip back into text preceding current line", "+          continue;", "+        }", "+      }  // end for", "+      ", "+      setCurrentLocation(origPos);    // Restore the state of the reduced model;", "-      else reducedPos = _findPrevDelimiter(i, delims, skipBracePhrases); ", "+      else reducedPos = findPrevDelimiter(i, delims, skipBracePhrases); "]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "c53da788d49ffd1237c909eda58f0c91", "repository": "http://git.code.sf.net/p/drjava/git_repo", "fileName": "drjava/src/edu/rice/cs/drjava/model/AbstractDJDocument.java", "commitBeforeChange": "0f4d2da263ed93d9981fed5c0de39394b1b0893c", "commitAfterChange": "fc51b2245942e6d87f48245a9b8cdb4aedbcacc2", "methodNumberBeforeChange": 38, "methodNumberAfterChange": 38, "signatureBeforeChange": "   public int findPrevDelimiter(final int pos, final char[] delims, final boolean skipBracePhrases)     throws BadLocationException", "signatureAfterChange": "   public int findPrevDelimiter(final int pos, final char[] delims, final boolean skipBracePhrases)     throws BadLocationException", "diff": ["-    ", "-      String text = getText(0, pos);", "+      int lineStartPos = getLineStartPos(pos);", "+      if (lineStartPos < 0) lineStartPos = 0;", "-      synchronized(_reduced) {", "-        final int origPos = _currentLocation;", "-        ", "-        // Walk backwards from specificed position", "-        for (i = pos - 1; i >= 0; i--) {", "-          /* Invariant: reduced model points to reducedPos, text[i+1:pos] contains no valid delims, ", "-           * 0 <= i < reducedPos <= pos */", "-          // Move reduced model to location pos", "-          _setCurrentLocation(i);  // reduced model points to i", "-          if (isShadowed() || isCommentOpen(text, i)) {", "+      if (lineStartPos >= pos) i = lineStartPos - 1;  // the line containing pos is empty  ", "+      else { ", "+        assert lineStartPos < pos;", "+        String line = getText(lineStartPos, pos - lineStartPos);  // the line containing pos", "+        synchronized(_reduced) {", "+          final int origPos = _currentLocation;", "+          ", "+          // Walk backwards from specificed position, scanning current line for a delimiter", "+          for (i = pos - 1; i >= lineStartPos; i--) {", "+            /* Invariant: reduced model points to reducedPos, text[i+1:pos] contains no valid delims, ", "+             * 0 <= i < reducedPos <= pos */", "+            // Move reduced model to location pos", "+            int irel = i - lineStartPos;", "+            _setCurrentLocation(i);  // reduced model points to i", "+            if (isShadowed() || isCommentOpen(line, irel)) {", "-            continue;", "-          }", "-          char ch = text.charAt(i);", "-          ", "-          if (match(ch, delims) /* && ! isShadowed() && (! skipParenPhrases || ! posInParenPhrase())*/) {", "-            reducedPos = i;    // record valid match                                                                              ", "-            break;", "-          }", "-          ", "-          if (skipBracePhrases && match(ch, CLOSING_BRACES) ) {  // note that delims have already been matched", "-//            Utilities.show(\"closing bracket is '\" + ch + \"' at pos \" + i);", "-            _setCurrentLocation(i + 1); // move cursor immediately to right of ch (a brace)", "-//            Utilities.show(\"_currentLocation = \" + _currentLocation);", "-            int dist = balanceBackward();", "-            if (dist == -1) { // if braces do not balance, return failure", "-              i = -1;", "-//              Utilities.show(\"dist = \" + dist + \" No matching brace found\");", "+              continue;", "+            }", "+            char ch = line.charAt(irel);", "+            ", "+            if (match(ch, delims) /* && ! isShadowed() && (! skipParenPhrases || ! posInParenPhrase())*/) {", "+              reducedPos = i;    // record valid match                                                                              ", "-            assert dist > 0;", "+            ", "+            if (skipBracePhrases && match(ch, CLOSING_BRACES) ) {  // note that delims have already been matched", "+//            Utilities.show(\"closing bracket is '\" + ch + \"' at pos \" + i);", "+              _setCurrentLocation(i + 1); // move cursor immediately to right of ch (a brace)", "+//            Utilities.show(\"_currentLocation = \" + _currentLocation);", "+              int dist = balanceBackward();", "+              if (dist == -1) { // if braces do not balance, return failure", "+                i = -1;", "+//              Utilities.show(\"dist = \" + dist + \" No matching brace found\");", "+                break;", "+              }", "+              assert dist > 0;", "-            _setCurrentLocation(i + 1 - dist);  // skip over balanced brace text, decrementing _currentLocation", "-            i = _currentLocation;", "-            // Decrementing i skips over matching brace", "-            continue;", "-          }", "-        }  // end for", "-        ", "-        /* Invariant: same as for loop except that -1 <= i <= reducedPos <= pos && 0 <= reducedPos */", "-        ", "-        _setCurrentLocation(origPos);    // Restore the state of the reduced model;", "-      }  // end synchronized", "+              _setCurrentLocation(i + 1 - dist);  // skip over balanced brace text, decrementing _currentLocation", "+              i = _currentLocation;", "+              // Decrementing i skips over matching brace; could skip back into text preceding current line", "+              continue;", "+            }", "+          }  // end for", "+          ", "+          _setCurrentLocation(origPos);    // Restore the state of the reduced model;", "+        }  // end synchronized", "+      } // end processing of text on same line as pos", "-      if (i == -1) reducedPos = -1; // No matching char was found", "+      /* Invariant: same as for loop except that lineStartPos-1 <= i <= reducedPos <= pos && 0 <= reducedPos */", "+      ", "+      if (i < lineStartPos) {  // No matching char was found on line containing pos; must look at preceding text", "+        if (i <= 0) reducedPos = -1;  // No preceding text left to search", "+        else reducedPos = findPrevDelimiter(i, delims, skipBracePhrases); ", "+      }", "+  ", "-    }", "+    } // end try"]}], "num": 1430}