{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "dcf1d74e8b228c7dbea3b5698ae40ab6", "detectedBy": ["DIFF_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "58c00a88102f7be58f4b47b569cc62e5", "repository": "http://git.code.sf.net/p/drjava/git_repo", "fileName": "drjava/src/edu/rice/cs/drjava/model/junit/JUnitTestManager.java", "commitBeforeChange": "25b42c6ab8532332033323c9856bcd81aff002d8", "commitAfterChange": "4e9024f79382344df7a15499ea8826062a420a5f", "methodNumberBeforeChange": 6, "methodNumberAfterChange": 6, "signatureBeforeChange": "   private JUnitError _makeJUnitError(TestFailure failure, List<String> classNames,                                      boolean isError, List<File> files)", "signatureAfterChange": "   private JUnitError _makeJUnitError(TestFailure failure, List<String> classNames, boolean isError, List<File> files)", "diff": ["-  private JUnitError _makeJUnitError(TestFailure failure, List<String> classNames,", "-                                     boolean isError, List<File> files) {", "+  private JUnitError _makeJUnitError(TestFailure failure, List<String> classNames, boolean isError, List<File> files) {", "-    /**", "-     * junit can come back with a string in two different formats:", "-     * so we'll parse both formats, and then decide which one to use", "-     */", "+    /** junit can return a string in two different formats; we parse both formats, and then decide which one to use. */", "-//    String ps = System.getProperty(\"file.separator\");", "-//    // replace periods with the System's file separator", "-//    className = StringOps.replace(className, \".\", ps);", "-//", "-//    // crop off the $ if there is one and anything after it", "-//    int indexOfDollar = className.indexOf('$');", "-//    if (indexOfDollar > -1) {", "-//      className = className.substring(0, indexOfDollar);", "-//    }", "-//", "-//    String filename = className + \".java\";", "-", "-    /**", "-     * if the classname is not in the stacktrace, then the test that", "-     * failed was inherited by a superclass. let's look for that classname", "+    /** If the classname is not in the stacktrace, then the test that failed was inherited from a superclass. let's look", "+     *  for that classname", "-      return new JUnitError(new File(\"nofile\"), 0,  //lineNum, ", "-                          0, exception, !isFailure, testName, className, stackTrace);", "+      return new JUnitError(new File(\"nofile\"), 0, 0, exception, !isFailure, testName, className, stackTrace);", "-    //The conditional has been added because of the augmented code in the .dj0 files - it causes the error to be highlighted on the wrong line", "-    //At the elementary level it should always be off by one", "-    //NOTE: this presupposes that ", "-    return new JUnitError(file, (file.getName().endsWith(\".dj0\") ? lineNum-1 : lineNum),  //lineNum, ", "-                          0, exception, !isFailure, testName, className, stackTrace);", "+    // The code augmentation for elementary and intermediate level files causes the error to be highlighted on", "+    // the wrong line.  The following code adjusts for this discrepancy.", "+    String name = file.getName();", "+    int adjLineNum;", "+    if (name.endsWith(\".dj0\") || name.endsWith(\".dj0\")) adjLineNum = lineNum - 1;", "+    else adjLineNum = lineNum;", "+    ", "+    return new JUnitError(file, adjLineNum, 0, exception, !isFailure, testName, className, stackTrace);"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "a1401e65059959950876565cf8ff206d", "repository": "http://git.code.sf.net/p/drjava/git_repo", "fileName": "drjava/src/edu/rice/cs/drjava/model/junit/JUnitTestManager.java", "commitBeforeChange": "a6ad77fef884f528ddfb31a18f08f168fcd5e3f2", "commitAfterChange": "20e19df5b6c16c841aeff102df396402e35bacf3", "methodNumberBeforeChange": 5, "methodNumberAfterChange": 5, "signatureBeforeChange": "   private JUnitError _makeJUnitError(TestFailure failure, List<String> classNames, boolean isError, List<File> files)", "signatureAfterChange": "   private JUnitError _makeJUnitError(TestFailure failure, List<String> classNames, boolean isError, List<File> files)", "diff": ["-    String stackTrace = StringOps.getStackTrace(failure.thrownException());", "+    String exception = failure.thrownException().toString();", "+    StackTraceElement[] stackTrace = failure.thrownException().getStackTrace();", "+    StringBuilder sb = new StringBuilder();", "+    sb.append(exception);", "+    sb.append('\\n');", "+    for(StackTraceElement s: stackTrace) {", "+      sb.append(\"\\tat \");", "+      sb.append(s);", "+    }", "+    String combined = sb.toString();", "-    if (stackTrace.indexOf(classNameAndTest) == -1) {", "+    if (combined.indexOf(classNameAndTest) == -1) {", "-      if (stackTrace.indexOf(className) == -1) {", "+      if (combined.indexOf(className) == -1) {", "-      lineNum = _lineNumber(stackTrace, classNameAndTest);", "+      lineNum = _lineNumber(combined, classNameAndTest);", "-    String exception =  (isError) ? failure.thrownException().toString(): ", "+    String message =  (isError) ? failure.thrownException().toString(): ", "-      // TODO: replace LL stack trace elements", "-      return new JUnitError(new File(\"nofile\"), 0, 0, exception, !isFailure, testName, className, stackTrace);", "+      return new JUnitError(new File(\"nofile\"), 0, 0, message, !isFailure, testName, className, exception, stackTrace);", "-    // The code augmentation for elementary and intermediate level files causes the error to be highlighted on", "-    // the wrong line.  The following code adjusts for this discrepancy.", "-    String name = file.getName();", "-    int adjLineNum;", "-    if (name.endsWith(\".dj0\") || name.endsWith(\".dj0\")) adjLineNum = lineNum - 1;", "-    else adjLineNum = lineNum;", "-    // TODO: replace LL stack trace elements", "-    return new JUnitError(file, adjLineNum, 0, exception, !isFailure, testName, className, stackTrace);", "+    return new JUnitError(file, lineNum, 0, message, !isFailure, testName, className, exception, stackTrace);"]}], "num": 29840}