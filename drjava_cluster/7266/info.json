{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "98e49d93be7ee175e95a516f602c5c02", "detectedBy": ["DIFF_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "b0deb3e47c0b32c6c29ecd6cca1f2c1d", "repository": "http://git.code.sf.net/p/drjava/git_repo", "fileName": "javalanglevels/src/edu/rice/cs/javalanglevels/FullJavaVisitor.java", "commitBeforeChange": "ce0ecf66ce1ecec7e4abe0bd534cf2fbbb576f91", "commitAfterChange": "4e52eec7688cbd5ec3584417f424923ba61a75e0", "methodNumberBeforeChange": 21, "methodNumberAfterChange": 22, "signatureBeforeChange": "   public Void forClassDef(ClassDef that)", "signatureAfterChange": "   public Void forClassDef(ClassDef that)", "diff": ["-", "-    String className = getQualifiedClassName(that.getName().getText());", "-//    System.err.println(\"Processing class \" + className);", "-    SymbolData sd = defineSymbolData(that, className);", "-    assert getQualifiedSymbolData(className, SourceInfo.NO_INFO, false) != null;", "-//    _enclosingClassName = className;", "-//    System.err.println(\"Setting _enclosingClassName to \" + className);", "-    that.getSuperclass().visit(this);  // formerly commented out.  Why?", "+", "+    String className = getQualifiedClassName(that.getName().getText());", "+", "+    // Create a new generic types table for visiting this inner class.", "+    // TODO: refactor this code to combine common code patterns in this method and forInnerClassDef", "+    HashMap<String, SymbolData> genericTypes = (HashMap<String, SymbolData>) _genericTypes.clone();", "+    TypeParameter[] tps = that.getTypeParameters();", "+    for (TypeParameter tp: tps) {", "+      final String typeName = tp.getVariable().getName();", "+      final String boundName = tp.getBound().getName();", "+      SymbolData boundSD = _identifyType(boundName, that.getSourceInfo(), _enclosingClassName);", "+      if (boundSD == null) { // create a dummy SymbolData ", "+        boundSD = SymbolData.NOT_FOUND; //  TODO: could create a separate SymbolData.NOT_BOUND singleton class?", "+//        System.err.println(\"Creating dummy SymbolData for bounding type \" + typeName + \" in inner class \" + name);", "+      }", "+      genericTypes.put(typeName, boundSD);", "+    }", "+    /* The following line is NOT in the scope of the new generic type table but should be.  Since we are not", "+     * performing generic type checking, we may get away with the error.  TODO: refactor this code to", "+     * create a new LLV for processing a generic class. */", "+    SymbolData sd = defineSymbolData(that, className);", "-    if (sd != null) identifyInnerClasses(that);", "-    ", "-    // Process fields of this ClassDef (the get method is misnamed!)", "-    for (int i = 0; i < that.getTypeParameters().length; i++) that.getTypeParameters()[i].visit(this);", "-    ", "+    /* The following two lines apparently do nothing. They are in the wrong generic type scope. */", "+    that.getSuperclass().visit(this);", "-      that.getBody().visit(new ClassBodyFullJavaVisitor(sd, className, _file, _package, _importedFiles, ", "-                                                        _importedPackages, _classesInThisFile, continuations, fixUps));", "+//      System.err.println(\"********** Calling identifyInnerClasses for SymbolData \" + sd.getName());", "+      identifyInnerClasses(that);", "+      ClassBodyFullJavaVisitor cbfjv = ", "+        new ClassBodyFullJavaVisitor(sd, _file, _package, _importedFiles, _importedPackages, _classesInThisFile, ", "+                                     continuations, fixUps, genericTypes);", "+      that.getBody().visit(cbfjv);", "+    "]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "f3963ff3b1f1e660f87649fca989571a", "repository": "http://git.code.sf.net/p/drjava/git_repo", "fileName": "javalanglevels/src/edu/rice/cs/javalanglevels/FullJavaVisitor.java", "commitBeforeChange": "ce0ecf66ce1ecec7e4abe0bd534cf2fbbb576f91", "commitAfterChange": "4e52eec7688cbd5ec3584417f424923ba61a75e0", "methodNumberBeforeChange": 25, "methodNumberAfterChange": 26, "signatureBeforeChange": "   public Void forInterfaceDef(InterfaceDef that)", "signatureAfterChange": "   public Void forInterfaceDef(InterfaceDef that)", "diff": ["-    // The following assert should be true because interfaces can't have fields!", "-    assert that.getTypeParameters().length == 0;", "+    // Create a new generic types table for visiting this inner class.", "+    // TODO: refactor this code to combine common code patterns in this method and forInnerClassDef", "+    HashMap<String, SymbolData> genericTypes = (HashMap<String, SymbolData>) _genericTypes.clone();", "+    TypeParameter[] tps = that.getTypeParameters();", "+    for (TypeParameter tp: tps) {", "+      final String typeName = tp.getVariable().getName();", "+      final String boundName = tp.getBound().getName();", "+      SymbolData boundSD = _identifyType(boundName, that.getSourceInfo(), _enclosingClassName);", "+      if (boundSD == null) { // create a dummy SymbolData ", "+        boundSD = SymbolData.NOT_FOUND; //  TODO: could create a separate SymbolData.NOT_BOUND singleton class?", "+//        System.err.println(\"Creating dummy SymbolData for bounding type \" + typeName + \" in inner class \" + name);", "+      }", "+      genericTypes.put(typeName, boundSD);", "+    }", "+    /* The following line apparently does nothing.  Note that it is NOT in the scope of the new generic types", "+     * table.  TODO: confirm that this line does nothing and eliminate it. */", "-      identifyInnerClasses(that);  // inner interfaces??", "-      that.getBody().visit(new InterfaceBodyFullJavaVisitor(sd, _file, _package, _importedFiles, _importedPackages,", "-                                                            _classesInThisFile, continuations, fixUps));", "+      identifyInnerClasses(that);", "+      InterfaceBodyFullJavaVisitor ibfjv =", "+        new InterfaceBodyFullJavaVisitor(sd, _file, _package, _importedFiles, _importedPackages, _classesInThisFile, ", "+                                         continuations, fixUps, genericTypes);", "+      that.getBody().visit(ibfjv);"]}], "num": 7266}