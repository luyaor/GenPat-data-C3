{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "1c193e3c71f346f550addb26138bd7eb", "detectedBy": ["DIFF_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "808657a6d37c027664f230cbbd952352", "repository": "http://git.eclipse.org/gitroot/jdt/eclipse.jdt.core.git", "fileName": "org.eclipse.jdt.core/compiler/org/eclipse/jdt/internal/compiler/ClassFile.java", "commitBeforeChange": "f0cc0529135fe43e5b6252dca937651f0a04d49c", "commitAfterChange": "79c1182746ff2f44f9956aeaf2f61882a4911acb", "methodNumberBeforeChange": 42, "methodNumberAfterChange": 37, "signatureBeforeChange": " \tpublic void completeMethodInfo( \t\t\tMethodBinding binding, \t\t\tint methodAttributeOffset, \t\t\tint attributesNumber)", "signatureAfterChange": " \tpublic void completeMethodInfo( \t\t\tMethodBinding binding, \t\t\tint methodAttributeOffset, \t\t\tint attributesNumber)", "diff": ["-", "+\t\t", "-\t\t\tList allTypeAnnotationContexts = ((TypeAnnotationCodeStream) this.codeStream).allTypeAnnotationContexts;", "+\t\t\tList allTypeAnnotationContexts = new ArrayList();", "-\t\t\tfor (int i = 0, max = this.codeStream.allLocalsCounter; i < max; i++) {", "-\t\t\t\tLocalVariableBinding localVariable = this.codeStream.locals[i];", "-\t\t\t\tLocalDeclaration declaration = localVariable.declaration;", "-\t\t\t\tif (declaration == null", "-\t\t\t\t\t\t|| (declaration.isArgument() && ((declaration.bits & ASTNode.IsUnionType) == 0))", "-\t\t\t\t\t\t|| (localVariable.initializationCount == 0)", "-\t\t\t\t\t\t|| ((declaration.bits & ASTNode.HasTypeAnnotations) == 0)) {", "-\t\t\t\t\tcontinue;", "-\t\t\t\t}", "-\t\t\t\tdeclaration.getAllAnnotationContexts(AnnotationTargetTypeConstants.LOCAL_VARIABLE, localVariable, allTypeAnnotationContexts);", "-\t\t\t}", "-\t\t\t\t\t\t\t\targument.getAllAnnotationContexts(AnnotationTargetTypeConstants.METHOD_PARAMETER, i, allTypeAnnotationContexts);", "+\t\t\t\t\t\t\t\targument.getAllAnnotationContexts(AnnotationTargetTypeConstants.METHOD_FORMAL_PARAMETER, i, allTypeAnnotationContexts);", "-\t\t\t\t\tAnnotation[] annotations = (methodDeclaration.receiver==null?null:methodDeclaration.receiver.annotations);", "-\t\t\t\t\tif (annotations != null) {", "-\t\t\t\t\t\tfor (int i = 0, max = annotations.length; i < max; i++) {", "-\t\t\t\t\t\t\tAnnotation annotation = annotations[i];", "-\t\t\t\t\t\t\tAnnotationContext annotationContext = null;", "-\t\t\t\t\t\t\tif (annotation.isRuntimeTypeInvisible()) {", "-\t\t\t\t\t\t\t\tannotationContext = new AnnotationContext(annotation, null, AnnotationTargetTypeConstants.METHOD_RECEIVER, null, AnnotationContext.INVISIBLE, null);", "-\t\t\t\t\t\t\t\tinvisibleTypeAnnotationsCounter++;", "-\t\t\t\t\t\t\t} else if (annotation.isRuntimeTypeVisible()) {", "-\t\t\t\t\t\t\t\tannotationContext = new AnnotationContext(annotation, null, AnnotationTargetTypeConstants.METHOD_RECEIVER, null, AnnotationContext.VISIBLE, null);", "-\t\t\t\t\t\t\t\tvisibleTypeAnnotationsCounter++;", "-\t\t\t\t\t\t\t}", "-\t\t\t\t\t\t\tif (annotationContext != null) {", "-\t\t\t\t\t\t\t\tallTypeAnnotationContexts.add(annotationContext);", "-\t\t\t\t\t\t\t}", "-\t\t\t\t\t\t}", "+\t\t\t\t\tReceiver receiver = methodDeclaration.receiver;", "+\t\t\t\t\tif (receiver != null && (receiver.type.bits & ASTNode.HasTypeAnnotations) != 0) {", "+\t\t\t\t\t\treceiver.type.getAllAnnotationContexts(AnnotationTargetTypeConstants.METHOD_RECEIVER, allTypeAnnotationContexts);", "-\t\t\t\t\tmethodDeclaration.getAllAnnotationContexts(AnnotationTargetTypeConstants.METHOD_RETURN_TYPE, allTypeAnnotationContexts);", "+\t\t\t\t\tmethodDeclaration.getAllAnnotationContexts(AnnotationTargetTypeConstants.METHOD_RETURN, allTypeAnnotationContexts);", "-\t\t\t\t\t\ttypeReference.getAllAnnotationContexts(AnnotationTargetTypeConstants.METHOD_RETURN_TYPE, allTypeAnnotationContexts);", "+\t\t\t\t\t\ttypeReference.getAllAnnotationContexts(AnnotationTargetTypeConstants.METHOD_RETURN, allTypeAnnotationContexts);", "-"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "c4b518e9e4e9e68c6b5cfd9d67be52a7", "repository": "http://git.eclipse.org/gitroot/jdt/eclipse.jdt.core.git", "fileName": "org.eclipse.jdt.core/compiler/org/eclipse/jdt/internal/compiler/ClassFile.java", "commitBeforeChange": "f0cc0529135fe43e5b6252dca937651f0a04d49c", "commitAfterChange": "79c1182746ff2f44f9956aeaf2f61882a4911acb", "methodNumberBeforeChange": 2, "methodNumberAfterChange": 30, "signatureBeforeChange": " \tprivate static int[] getWildcardLocations(TypeReference reference, Wildcard wildcard)", "signatureAfterChange": " \t \tpublic int generateTypeAnnotationsOnCodeAttribute()", "diff": ["-\t */", "-\tprivate static int[] getWildcardLocations(TypeReference reference, Wildcard wildcard) {", "-\t\tclass LocationCollector extends ASTVisitor {", "-\t\t\tStack currentIndexes;", "-\t\t\tboolean search = true;", "-\t\t\tWildcard currentWildcard;", "-\t\t\t", "-\t\t\tpublic LocationCollector(Wildcard currentWildcard) {", "-\t\t\t\tthis.currentIndexes = new Stack();", "-\t\t\t\tthis.currentWildcard = currentWildcard;", "-\t\t\t}", "-\t\t\tpublic boolean visit(ParameterizedSingleTypeReference typeReference, BlockScope scope) {", "-\t\t\t\tif (!this.search) return false;", "-\t\t\t\tTypeReference[] typeReferences = typeReference.typeArguments;", "-\t\t\t\tthis.currentIndexes.push(new Integer(0));", "-\t\t\t\tfor (int i = 0, max = typeReferences.length; i < max; i++) {", "-\t\t\t\t\ttypeReferences[i].traverse(this, scope);", "-\t\t\t\t\tif (!this.search) return false;", "-\t\t\t\t\tthis.currentIndexes.push(new Integer(((Integer) this.currentIndexes.pop()).intValue() + 1));", "-\t\t\t\t}", "-\t\t\t\tthis.currentIndexes.pop();", "-\t\t\t\treturn true;", "-\t\t\t}", "-\t\t\tpublic boolean visit(ParameterizedQualifiedTypeReference typeReference, BlockScope scope) {", "-\t\t\t\tif (!this.search) return false;", "-\t\t\t\tTypeReference[] typeReferences = typeReference.typeArguments[typeReference.typeArguments.length - 1];", "-\t\t\t\tthis.currentIndexes.push(new Integer(0));", "-\t\t\t\tfor (int i = 0, max = typeReferences.length; i < max; i++) {", "-\t\t\t\t\ttypeReferences[i].traverse(this, scope);", "-\t\t\t\t\tif (!this.search) return false;", "-\t\t\t\t\tthis.currentIndexes.push(new Integer(((Integer) this.currentIndexes.pop()).intValue() + 1));", "-\t\t\t\t}", "-\t\t\t\tthis.currentIndexes.pop();", "-\t\t\t\treturn true;", "-\t\t\t}", "-\t\t\tpublic boolean visit(Wildcard typeReference, BlockScope scope) {", "-\t\t\t\tif (!this.search) return false;", "-\t\t\t\tif (typeReference.equals(this.currentWildcard)) {", "-\t\t\t\t\tthis.search = false;", "-\t\t\t\t}", "-\t\t\t\treturn true;", "-\t\t\t}", "-\t\t\tpublic String toString() {", "-\t\t\t\tStringBuffer buffer = new StringBuffer();", "-\t\t\t\tbuffer", "-\t\t\t\t\t.append(\"search location for \") //$NON-NLS-1$", "-\t\t\t\t\t.append(this.currentWildcard)", "-\t\t\t\t\t.append(\"\\ncurrent indexes : \") //$NON-NLS-1$", "-\t\t\t\t\t.append(this.currentIndexes);", "-\t\t\t\treturn String.valueOf(buffer);", "-\t\t\t}", "-\t\t}", "-\t\tif (reference == null) return null;", "-\t\tLocationCollector collector = new LocationCollector(wildcard);", "-\t\treference.traverse(collector, (BlockScope) null);", "-\t\tif (collector.currentIndexes.isEmpty()) {", "-\t\t\treturn null;", "-\t\t}", "-\t\tint size = collector.currentIndexes.size();", "-\t\tint[] result = new int[size];", "-\t\tfor (int i = 0; i < size; i++) {", "-\t\t\tresult[size - i - 1] = ((Integer) collector.currentIndexes.pop()).intValue();", "-\t\t}", "-\t\treturn result;", "-\t}", "+\t", "+\tpublic int generateTypeAnnotationsOnCodeAttribute() {", "+\t\tint attributesNumber = 0;", "+\t\t", "+\t\tList allTypeAnnotationContexts = ((TypeAnnotationCodeStream) this.codeStream).allTypeAnnotationContexts;", "+\t\tint invisibleTypeAnnotationsCounter = 0;", "+\t\tint visibleTypeAnnotationsCounter = 0;", "+", "+\t\tfor (int i = 0, max = this.codeStream.allLocalsCounter; i < max; i++) {", "+\t\t\tLocalVariableBinding localVariable = this.codeStream.locals[i];", "+\t\t\tif (localVariable.isCatchParameter()) continue;", "+\t\t\tLocalDeclaration declaration = localVariable.declaration;", "+\t\t\tif (declaration == null", "+\t\t\t\t\t|| (declaration.isArgument() && ((declaration.bits & ASTNode.IsUnionType) == 0))", "+\t\t\t\t\t|| (localVariable.initializationCount == 0)", "+\t\t\t\t\t|| ((declaration.bits & ASTNode.HasTypeAnnotations) == 0)) {", "+\t\t\t\tcontinue;", "+\t\t\t}", "+\t\t\tint targetType = ((localVariable.tagBits & TagBits.IsResource) == 0) ? AnnotationTargetTypeConstants.LOCAL_VARIABLE : AnnotationTargetTypeConstants.RESOURCE_VARIABLE;", "+\t\t\tdeclaration.getAllAnnotationContexts(targetType, localVariable, allTypeAnnotationContexts);", "+\t\t}", "+\t\t", "+\t\tExceptionLabel[] exceptionLabels = this.codeStream.exceptionLabels;", "+\t\tint tableIndex = 0;", "+\t\tfor (int i = 0, max = this.codeStream.exceptionLabelsCounter; i < max; i++) {", "+\t\t\tExceptionLabel exceptionLabel = exceptionLabels[i];", "+\t\t\tif (exceptionLabel instanceof MultiCatchExceptionLabel) {", "+\t\t\t\tMultiCatchExceptionLabel multiCatchExceptionLabel = (MultiCatchExceptionLabel)exceptionLabel;", "+\t\t\t\ttableIndex += multiCatchExceptionLabel.getAllAnnotationContexts(tableIndex, allTypeAnnotationContexts);", "+\t\t\t} else {", "+\t\t\t\tif (exceptionLabel.exceptionTypeReference != null) { // ignore those which cannot be annotated", "+\t\t\t\t\texceptionLabel.exceptionTypeReference.getAllAnnotationContexts(AnnotationTargetTypeConstants.EXCEPTION_PARAMETER, tableIndex, allTypeAnnotationContexts);", "+\t\t\t\t}", "+\t\t\t\ttableIndex++;", "+\t\t\t}", "+\t\t}", "+\t\t", "+\t\tint size = allTypeAnnotationContexts.size();", "+\t\tif (size != 0) {", "+\t\t\tAnnotationContext[] allTypeAnnotationContextsArray = new AnnotationContext[size];", "+\t\t\tallTypeAnnotationContexts.toArray(allTypeAnnotationContextsArray);", "+\t\t\tfor (int j = 0, max2 = allTypeAnnotationContextsArray.length; j < max2; j++) {", "+\t\t\t\tAnnotationContext annotationContext = allTypeAnnotationContextsArray[j];", "+\t\t\t\tif ((annotationContext.visibility & AnnotationContext.INVISIBLE) != 0) {", "+\t\t\t\t\tinvisibleTypeAnnotationsCounter++;", "+\t\t\t\t} else {", "+\t\t\t\t\tvisibleTypeAnnotationsCounter++;", "+\t\t\t\t}", "+\t\t\t}", "+\t\t\tattributesNumber += generateRuntimeTypeAnnotations(", "+\t\t\t\t\tallTypeAnnotationContextsArray,", "+\t\t\t\t\tvisibleTypeAnnotationsCounter,", "+\t\t\t\t\tinvisibleTypeAnnotationsCounter);", "+\t\t}", "+\t\treturn attributesNumber;"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "c8dbf2db60ee227121cd0d7ff1ad4cc6", "repository": "http://git.eclipse.org/gitroot/jdt/eclipse.jdt.core.git", "fileName": "org.eclipse.jdt.core/compiler/org/eclipse/jdt/internal/compiler/ClassFile.java", "commitBeforeChange": "51c6ca3e4dfed3078a1640da7a2ab7f26c899e0a", "commitAfterChange": "de8aa9940086fe152901aa168536f30670945804", "methodNumberBeforeChange": 36, "methodNumberAfterChange": 42, "signatureBeforeChange": " \tpublic void completeMethodInfo( \t\t\tMethodBinding binding, \t\t\tint methodAttributeOffset, \t\t\tint attributesNumber)", "signatureAfterChange": " \tpublic void completeMethodInfo( \t\t\tMethodBinding binding, \t\t\tint methodAttributeOffset, \t\t\tint attributesNumber)", "diff": ["+", "+\t\tif ((this.produceAttributes & ClassFileConstants.ATTR_TYPE_ANNOTATION) != 0) {", "+\t\t\tList allTypeAnnotationContexts = ((TypeAnnotationCodeStream) this.codeStream).allTypeAnnotationContexts;", "+\t\t\tint invisibleTypeAnnotationsCounter = 0;", "+\t\t\tint visibleTypeAnnotationsCounter = 0;", "+\t\t\tfor (int i = 0, max = this.codeStream.allLocalsCounter; i < max; i++) {", "+\t\t\t\tLocalVariableBinding localVariable = this.codeStream.locals[i];", "+\t\t\t\tLocalDeclaration declaration = localVariable.declaration;", "+\t\t\t\tif (declaration == null", "+\t\t\t\t\t\t|| (declaration.isArgument() && ((declaration.bits & ASTNode.IsUnionType) == 0))", "+\t\t\t\t\t\t|| (localVariable.initializationCount == 0)", "+\t\t\t\t\t\t|| ((declaration.bits & ASTNode.HasTypeAnnotations) == 0)) {", "+\t\t\t\t\tcontinue;", "+\t\t\t\t}", "+\t\t\t\tdeclaration.getAllAnnotationContexts(AnnotationTargetTypeConstants.LOCAL_VARIABLE, localVariable, allTypeAnnotationContexts);", "+\t\t\t}", "+\t\t\tAbstractMethodDeclaration methodDeclaration = binding.sourceMethod();", "+\t\t\tif (methodDeclaration != null) {", "+\t\t\t\tif ((methodDeclaration.bits & ASTNode.HasTypeAnnotations) != 0) {", "+\t\t\t\t\tArgument[] arguments = methodDeclaration.arguments;", "+\t\t\t\t\tif (arguments != null) {", "+\t\t\t\t\t\tfor (int i = 0, max = arguments.length; i < max; i++) {", "+\t\t\t\t\t\t\tArgument argument = arguments[i];", "+\t\t\t\t\t\t\tif ((argument.bits & ASTNode.HasTypeAnnotations) != 0) {", "+\t\t\t\t\t\t\t\targument.getAllAnnotationContexts(AnnotationTargetTypeConstants.METHOD_PARAMETER, i, allTypeAnnotationContexts);", "+\t\t\t\t\t\t\t}", "+\t\t\t\t\t\t}", "+\t\t\t\t\t}", "+\t\t\t\t\tAnnotation[] annotations = (methodDeclaration.receiver==null?null:methodDeclaration.receiver.annotations);", "+\t\t\t\t\tif (annotations != null) {", "+\t\t\t\t\t\tfor (int i = 0, max = annotations.length; i < max; i++) {", "+\t\t\t\t\t\t\tAnnotation annotation = annotations[i];", "+\t\t\t\t\t\t\tAnnotationContext annotationContext = null;", "+\t\t\t\t\t\t\tif (annotation.isRuntimeTypeInvisible()) {", "+\t\t\t\t\t\t\t\tannotationContext = new AnnotationContext(annotation, null, AnnotationTargetTypeConstants.METHOD_RECEIVER, null, AnnotationContext.INVISIBLE, null);", "+\t\t\t\t\t\t\t\tinvisibleTypeAnnotationsCounter++;", "+\t\t\t\t\t\t\t} else if (annotation.isRuntimeTypeVisible()) {", "+\t\t\t\t\t\t\t\tannotationContext = new AnnotationContext(annotation, null, AnnotationTargetTypeConstants.METHOD_RECEIVER, null, AnnotationContext.VISIBLE, null);", "+\t\t\t\t\t\t\t\tvisibleTypeAnnotationsCounter++;", "+\t\t\t\t\t\t\t}", "+\t\t\t\t\t\t\tif (annotationContext != null) {", "+\t\t\t\t\t\t\t\tallTypeAnnotationContexts.add(annotationContext);", "+\t\t\t\t\t\t\t}", "+\t\t\t\t\t\t}", "+\t\t\t\t\t}", "+\t\t\t\t}", "+\t\t\t\tAnnotation[] annotations = methodDeclaration.annotations;", "+\t\t\t\tif (annotations != null && binding.returnType.id != T_void) {", "+\t\t\t\t\tmethodDeclaration.getAllAnnotationContexts(AnnotationTargetTypeConstants.METHOD_RETURN_TYPE, allTypeAnnotationContexts);", "+\t\t\t\t}", "+\t\t\t\tif (!methodDeclaration.isConstructor() && !methodDeclaration.isClinit() && binding.returnType.id != T_void) {", "+\t\t\t\t\tMethodDeclaration declaration = (MethodDeclaration) methodDeclaration;", "+\t\t\t\t\tTypeReference typeReference = declaration.returnType;", "+\t\t\t\t\tif ((typeReference.bits & ASTNode.HasTypeAnnotations) != 0) {", "+\t\t\t\t\t\ttypeReference.getAllAnnotationContexts(AnnotationTargetTypeConstants.METHOD_RETURN_TYPE, allTypeAnnotationContexts);", "+\t\t\t\t\t}", "+\t\t\t\t}", "+\t\t\t\tTypeReference[] thrownExceptions = methodDeclaration.thrownExceptions;", "+\t\t\t\tif (thrownExceptions != null) {", "+\t\t\t\t\tfor (int i = 0, max = thrownExceptions.length; i < max; i++) {", "+\t\t\t\t\t\tTypeReference thrownException = thrownExceptions[i];", "+\t\t\t\t\t\tthrownException.getAllAnnotationContexts(AnnotationTargetTypeConstants.THROWS, i, allTypeAnnotationContexts);", "+\t\t\t\t\t}", "+\t\t\t\t}", "+\t\t\t\tTypeParameter[] typeParameters = methodDeclaration.typeParameters();", "+\t\t\t\tif (typeParameters != null) {", "+\t\t\t\t\tfor (int i = 0, max = typeParameters.length; i < max; i++) {", "+\t\t\t\t\t\tTypeParameter typeParameter = typeParameters[i];", "+\t\t\t\t\t\tif ((typeParameter.bits & ASTNode.HasTypeAnnotations) != 0) {", "+\t\t\t\t\t\t\ttypeParameter.getAllAnnotationContexts(AnnotationTargetTypeConstants.METHOD_TYPE_PARAMETER, i, allTypeAnnotationContexts);", "+\t\t\t\t\t\t}", "+\t\t\t\t\t}", "+\t\t\t\t}", "+\t\t\t}", "+\t\t\tint size = allTypeAnnotationContexts.size();", "+\t\t\tif (size != 0) {", "+\t\t\t\tAnnotationContext[] allTypeAnnotationContextsArray = new AnnotationContext[size];", "+\t\t\t\tallTypeAnnotationContexts.toArray(allTypeAnnotationContextsArray);", "+\t\t\t\tfor (int j = 0, max2 = allTypeAnnotationContextsArray.length; j < max2; j++) {", "+\t\t\t\t\tAnnotationContext annotationContext = allTypeAnnotationContextsArray[j];", "+\t\t\t\t\tif ((annotationContext.visibility & AnnotationContext.INVISIBLE) != 0) {", "+\t\t\t\t\t\tinvisibleTypeAnnotationsCounter++;", "+\t\t\t\t\t} else {", "+\t\t\t\t\t\tvisibleTypeAnnotationsCounter++;", "+\t\t\t\t\t}", "+\t\t\t\t}", "+\t\t\t\tattributesNumber += generateRuntimeTypeAnnotations(", "+\t\t\t\t\t\tallTypeAnnotationContextsArray,", "+\t\t\t\t\t\tvisibleTypeAnnotationsCounter,", "+\t\t\t\t\t\tinvisibleTypeAnnotationsCounter);", "+\t\t\t}", "+\t\t}", "+"]}], "num": 43357}