{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "e75b0fc61a3e3589ce96334b4dee0da9", "detectedBy": ["DIFF_HIERARCHICAL"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "2fdb37b208157facf09e5286b02b7fb5", "repository": "http://git.eclipse.org/gitroot/jdt/eclipse.jdt.core.git", "fileName": "org.eclipse.jdt.apt.core/src/org/eclipse/jdt/apt/core/internal/APTDispatchRunnable.java", "commitBeforeChange": "f18746495477338a9b83fca4f673d973bc3b28e9", "commitAfterChange": "b7c75d5af8ed9aa46f28be9d8bc08449dc25dc4e", "methodNumberBeforeChange": 11, "methodNumberAfterChange": 15, "signatureBeforeChange": " \t \tprivate APTResult runAPT( \t\t\tfinal List<AnnotationProcessorFactory> factories, \t\t\tfinal ProcessorEnvImpl processorEnv)", "signatureAfterChange": " \t \tprivate APTResult runAPT( \t\t\tfinal List<AnnotationProcessorFactory> factories, \t\t\tfinal ProcessorEnvImpl processorEnv, \t\t\tfinal List<IFile> filesWithMissingType, \t\t\tfinal List<char[]> sourceForFiles)", "diff": ["+\t", "+\tprivate APTResult runAPT(", "+\t\t\tfinal List<AnnotationProcessorFactory> factories,", "+\t\t\tfinal ProcessorEnvImpl processorEnv,", "+\t\t\tfinal List<IFile> filesWithMissingType,", "+\t\t\tfinal List<char[]> sourceForFiles) ", "+\t{", "-\t\t*/", "+\t\t\t*/", "+\t\t\tfinal IFile[] files = processorEnv.getFiles();", "-\t\t\tfor( int i=0, len=_filesToProcess.length; i<len; i++ ){", "-\t\t\t\tfinal Set<IFile> genFiles = gfm.getGeneratedFilesForParent( _filesToProcess[i] );", "+\t\t\tfor( int i=0, len=files.length; i<len; i++ ){", "+\t\t\t\tfinal Set<IFile> genFiles = gfm.getGeneratedFilesForParent( files[i] );", "-\t\t\tif( shouldDispatchToBatchProcessor(factories, processorEnv) )", "-\t\t\t\trunAPTInMixedMode(factories, processorEnv);", "+\t\t\t", "+\t\t\tboolean mixedModeDispatch = shouldDispatchToBatchProcessor(factories, processorEnv);", "+\t\t\tif( mixedModeDispatch )", "+\t\t\t\trunAPTInMixedMode(factories, processorEnv, filesWithMissingType, sourceForFiles);", "-\t\t\t\trunAPTInFileBasedMode(factories, processorEnv);", "+\t\t\t\trunAPTInFileBasedMode(factories, processorEnv, filesWithMissingType, sourceForFiles);", "-\t\t\tfor( int i=0, len=_filesToProcess.length; i<len; i++ ){", "+\t\t\tfor( int i=0, len=files.length; i<len; i++ ){", "-\t\t\t\t\t\t\t_filesToProcess[i], ", "+\t\t\t\t\t\t\tfiles[i], ", "-\t\t\t}", "-\t\t\t", "+\t\t\t}\t\t", "-\t\t\t\t\t\t\t\t\t\t\t  processorEnv.getProblems(), processorEnv.getSourcePathChanged() );", "+\t\t\t\t\t\t\t\t\t\t\t  processorEnv.getProblems(), ", "+\t\t\t\t\t\t\t\t\t\t\t  processorEnv.getSourcePathChanged(),", "+\t\t\t\t\t\t\t\t\t\t\t  processorEnv.hasGeneratedClassFiles() || processorEnv.hasGeneratedSourceFiles());"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "30ba9056f781b0032392c9d85c6c3a7a", "repository": "http://git.eclipse.org/gitroot/jdt/eclipse.jdt.core.git", "fileName": "org.eclipse.jdt.apt.core/src/org/eclipse/jdt/apt/core/internal/APTDispatch.java", "commitBeforeChange": "72643ddaac52d3ea6e2573fbe40b9af5d9586d1e", "commitAfterChange": "965ee55c83771df9f7f21b38b9a78903a86f630d", "methodNumberBeforeChange": 2, "methodNumberAfterChange": 2, "signatureBeforeChange": "  \tprivate static Set<IFile> runAPT( \t\t\tfinal List<AnnotationProcessorFactory> factories, \t\t\tfinal ProcessorEnvImpl processorEnv)", "signatureAfterChange": "  \tprivate static APTResult runAPT( \t\t\tfinal List<AnnotationProcessorFactory> factories, \t\t\tfinal ProcessorEnvImpl processorEnv)", "diff": ["-\tprivate static Set<IFile> runAPT(", "+\tprivate static APTResult runAPT(", "-\t\t\tfinal ProcessorEnvImpl processorEnv) {", "+\t\t\tfinal ProcessorEnvImpl processorEnv) ", "+\t{", "-\t\t\t\treturn Collections.emptySet();", "-", "+\t\t\t{", "+\t\t\t\tif ( DEBUG ) trace( \"runAPT: leaving early because there are no factories\");", "+\t\t\t\treturn EMPTY_APT_RESULT;", "+\t\t\t}", "+\t\t\t\t", "-\t\t\t\treturn Collections.emptySet();", "-\t\t\t", "+\t\t\t{", "+\t\t\t\tif ( DEBUG ) trace( \"runAPT: leaving early because file doesn't exist\");", "+\t\t\t\treturn EMPTY_APT_RESULT;", "+\t\t\t}", "+\t\t\t\t", "+\t\t\t", "-\t\t\t\treturn Collections.emptySet();", "+\t\t\t{", "+\t\t\t\tif ( DEBUG ) trace ( \"runAPT:  leaving early because annotationDecls is empty\" );", "+\t\t\t\treturn EMPTY_APT_RESULT;", "+\t\t\t}", "+\t\t\tGeneratedFileManager gfm = GeneratedFileManager.getGeneratedFileManager( processorEnv.getJavaProject().getProject() );", "+\t\t\tSet<IFile> lastGeneratedFiles = gfm.getGeneratedFilesForParent( processorEnv.getFile() );", "+\t\t\t", "+\t\t\t\t\t{", "+\t\t\t\t\t\tif ( DEBUG ) trace( \"runAPT: invoking processor \" + processor.getClass().getName() );", "+\t\t\t\t\t}", "-\t\t\tfinal Set<IFile> generatedFiles = new HashSet<IFile>();", "-\t\t\tgeneratedFiles.addAll( processorEnv.getGeneratedFiles() );", "+\t\t\tfinal Set<IFile> allGeneratedFiles = new HashSet<IFile>();", "+\t\t\tSet<IFile> modifiedFiles = new HashSet<IFile>();", "+\t\t\tMap<IFile, Boolean> filesMap = processorEnv.getGeneratedFiles();", "+\t\t\tfor (Map.Entry<IFile, Boolean> entry : filesMap.entrySet()) {", "+\t\t\t\tallGeneratedFiles.add(entry.getKey());", "+\t\t\t\tif (entry.getValue()) {", "+\t\t\t\t\tmodifiedFiles.add(entry.getKey());", "+\t\t\t\t}", "+\t\t\t}", "+\t\t\t", "+\t\t\t// any files that were generated for this parent on the last", "+\t\t\t// run, but are no longer generated should be removed", "+\t\t\tSet<IFile> deletedFiles = cleanupNoLongerGeneratedFiles( processorEnv.getFile(), lastGeneratedFiles, allGeneratedFiles, gfm );", "+", "+\t\t\tAPTResult result = new APTResult( modifiedFiles, deletedFiles, processorEnv.getTypeDependencies() );", "-\t\t\treturn generatedFiles;", "+\t\t\treturn result;", "-\t\treturn Collections.emptySet();", "+\t\treturn EMPTY_APT_RESULT;"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "735bbf34652e64d4b9a54cfe90d46896", "repository": "http://git.eclipse.org/gitroot/jdt/eclipse.jdt.core.git", "fileName": "org.eclipse.jdt.apt.core/src/org/eclipse/jdt/apt/core/internal/APTDispatchRunnable.java", "commitBeforeChange": "dafcaed018e710da1dd812dc260b3ece76bb3e1d", "commitAfterChange": "a28933ffb03bd99d79fd8fce531cad43e24a3c4c", "methodNumberBeforeChange": 14, "methodNumberAfterChange": 14, "signatureBeforeChange": " \t \tprivate APTResult runAPT( \t\t\tfinal Map<AnnotationProcessorFactory, FactoryPath.Attributes> factories, \t\t\tfinal ProcessorEnvImpl processorEnv, \t\t\tfinal List<IFile> filesWithMissingType, \t\t\tfinal List<ICompilationUnit> unitsForFiles, \t\t\tfinal int internalRound)", "signatureAfterChange": " \t \tprivate APTResult runAPT( \t\t\tfinal Map<AnnotationProcessorFactory, FactoryPath.Attributes> factories, \t\t\tfinal ProcessorEnvImpl processorEnv, \t\t\tfinal List<IFile> filesWithMissingType, \t\t\tfinal List<ICompilationUnit> unitsForFiles, \t\t\tfinal int internalRound)", "diff": ["-\t\t\tfinal Set<IFile> lastGeneratedFiles = new HashSet<IFile>();", "-\t\t\tfor( int i=0, len=files.length; i<len; i++ ){", "-\t\t\t\tfinal Set<IFile> genFiles = gfm.getGeneratedFilesForParent( files[i] );", "-\t\t\t\tif( genFiles != null )", "-\t\t\t\t\tlastGeneratedFiles.addAll(genFiles);", "+\t\t\tfinal Map<IFile,Set<IFile>> lastGeneratedFiles = new HashMap<IFile,Set<IFile>>();", "+\t\t\tfor( IFile parentIFile : files ){", "+\t\t\t\tlastGeneratedFiles.put(parentIFile, gfm.getGeneratedFilesForParent(parentIFile));", "-\t\t\tfinal Set<IFile> allGeneratedFiles = new HashSet<IFile>();", "-\t\t\tSet<IFile> modifiedFiles = new HashSet<IFile>();", "-\t\t\tMap<IFile, Boolean> filesMap = processorEnv.getGeneratedFiles();", "-\t\t\tfor (Map.Entry<IFile, Boolean> entry : filesMap.entrySet()) {", "-\t\t\t\tallGeneratedFiles.add(entry.getKey());", "-\t\t\t\tif (entry.getValue()) {", "-\t\t\t\t\tmodifiedFiles.add(entry.getKey());", "-\t\t\t\t}", "-\t\t\t}", "+\t\t\tfinal Map<IFile, Set<IFile>> allGeneratedFiles = processorEnv.getAllGeneratedFiles();", "+\t\t\tfinal Set<IFile> modifiedGeneratedFiles = processorEnv.getModifiedGeneratedFiles();", "-\t\t\tfor( int i=0, len=files.length; i<len; i++ ){", "+\t\t\tfor( IFile file : files ){", "+\t\t\t\tSet<IFile> generatedFiles = allGeneratedFiles.get(file);", "+\t\t\t\tif (generatedFiles == null)", "+\t\t\t\t\tgeneratedFiles = Collections.emptySet();", "-\t\t\t\t\t\t\tfiles[i], ", "+\t\t\t\t\t\t\tfile, ", "-\t\t\t\t\t\t\tlastGeneratedFiles, ", "-\t\t\t\t\t\t\tallGeneratedFiles, ", "+\t\t\t\t\t\t\tlastGeneratedFiles.get(file), ", "+\t\t\t\t\t\t\tgeneratedFiles, ", "-\t\t\tAPTResult result = new APTResult( modifiedFiles, ", "+\t\t\tAPTResult result = new APTResult( modifiedGeneratedFiles, "]}], "num": 61559}