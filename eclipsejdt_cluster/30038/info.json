{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "bd4d1e84c0173e48bfc82489b9ecbb9f", "detectedBy": ["AST_HIERARCHICAL"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "289c8a8417aedb25902d28dba06dfefb", "repository": "http://git.eclipse.org/gitroot/jdt/eclipse.jdt.core.git", "fileName": "org.eclipse.jdt.apt.core/src/org/eclipse/jdt/apt/core/internal/APTDispatchRunnable.java", "commitBeforeChange": "2894ba75386697d7bf484434d073fb6ffaf6cec9", "commitAfterChange": "c5ef0e6fd93c55fc5204e498f5b58ab9f95c6ab7", "methodNumberBeforeChange": 14, "methodNumberAfterChange": 14, "signatureBeforeChange": " \t \tprivate APTResult runAPT( \t\t\tfinal Map<AnnotationProcessorFactory, FactoryPath.Attributes> factories, \t\t\tfinal ProcessorEnvImpl processorEnv, \t\t\tfinal List<IFile> filesWithMissingType, \t\t\tfinal List<ICompilationUnit> unitsForFiles, \t\t\tfinal int internalRound)", "signatureAfterChange": " \tprivate Set<AnnotationProcessorFactory> build(final ProcessorEnvImpl processorEnv)", "diff": ["-\t", "-\tprivate APTResult runAPT(", "-\t\t\tfinal Map<AnnotationProcessorFactory, FactoryPath.Attributes> factories,", "-\t\t\tfinal ProcessorEnvImpl processorEnv,", "-\t\t\tfinal List<IFile> filesWithMissingType,", "-\t\t\tfinal List<ICompilationUnit> unitsForFiles,", "-\t\t\tfinal int internalRound) ", "+\tprivate Set<AnnotationProcessorFactory> build(final ProcessorEnvImpl processorEnv)", "-\t\t\tif (factories.size() == 0)", "-\t\t\t{", "-\t\t\t\tif ( AptPlugin.DEBUG ) ", "-\t\t\t\t\ttrace( \"runAPT: leaving early because there are no factories\", //$NON-NLS-1$ ", "-\t\t\t\t\t\t\tprocessorEnv );", "-\t\t\t\treturn EMPTY_APT_RESULT;", "-\t\t\t}", "-\t\t", "-\t\t\tfinal IFile[] files = processorEnv.getFiles();", "+\t\t\tfinal ICompilationParticipantResult[] results = processorEnv.getFilesWithAnnotation();", "-\t\t\tfor( IFile parentIFile : files ){", "+\t\t\tfor( ICompilationParticipantResult result : results ){", "+\t\t\t\tfinal IFile parentIFile = result.getFile();", "-\t\t\tboolean mixedModeDispatch = shouldDispatchToBatchProcessor(factories, processorEnv);", "-\t\t\tfinal Set<AnnotationProcessorFactory> currentRoundDispatchedBatchFactories;", "+\t\t\tboolean mixedModeDispatch = shouldDispatchToBatchProcessor(processorEnv);", "-\t\t\t\tcurrentRoundDispatchedBatchFactories = new LinkedHashSet<AnnotationProcessorFactory>();", "-\t\t\t\trunAPTInMixedMode(factories, currentRoundDispatchedBatchFactories, processorEnv, filesWithMissingType, unitsForFiles, internalRound);", "+\t\t\t\trunAPTInMixedMode(lastGeneratedFiles, processorEnv);", "-\t\t\t\tcurrentRoundDispatchedBatchFactories = Collections.emptySet();", "-\t\t\t\trunAPTInFileBasedMode(factories, processorEnv, filesWithMissingType, unitsForFiles);", "+\t\t\t\trunAPTInFileBasedMode(processorEnv, lastGeneratedFiles);", "-\t\t\t", "-", "-\t\t\tfinal Map<IFile, Set<IFile>> allGeneratedFiles = processorEnv.getAllGeneratedFiles();", "-\t\t\tfinal Set<IFile> modifiedGeneratedSourceFiles = processorEnv.getModifiedGeneratedSourceFiles();", "-\t\t\t// any files that were generated for this parent on the last", "-\t\t\t// run, but are no longer generated should be removed", "-\t\t\t// BUGZILLA 103183 - reconcile-path disabled until type-generation in reconcile is turned on", "-\t\t\tSet<IFile> allDeletedFiles = new HashSet<IFile>();", "-\t\t\tfor( IFile file : files ){", "-\t\t\t\tSet<IFile> generatedFiles = allGeneratedFiles.get(file);", "-\t\t\t\tif (generatedFiles == null)", "-\t\t\t\t\tgeneratedFiles = Collections.emptySet();", "-\t\t\t\tfinal Set<IFile> deletedFiles = cleanupNoLongerGeneratedFiles( ", "-\t\t\t\t\t\t\tfile, ", "-\t\t\t\t\t\t\tprocessorEnv.getCompilationUnit(), ", "-\t\t\t\t\t\t\tlastGeneratedFiles.get(file), ", "-\t\t\t\t\t\t\tgeneratedFiles, ", "-\t\t\t\t\t\t\tgfm,", "-\t\t\t\t\t\t\tprocessorEnv);", "-\t\t\t\tif(deletedFiles != null )", "-\t\t\t\t\tallDeletedFiles.addAll(deletedFiles);\t\t", "-\t\t\t}\t\t", "-\t\t\tAPTResult result = new APTResult( modifiedGeneratedSourceFiles, ", "-\t\t\t\t\t\t\t\t\t\t\t  allDeletedFiles, ", "-\t\t\t\t\t\t\t\t\t\t\t  currentRoundDispatchedBatchFactories,", "-\t\t\t\t\t\t\t\t\t\t\t  processorEnv.getTypeDependencies(), ", "-\t\t\t\t\t\t\t\t\t\t\t  processorEnv.getProblems(), ", "-\t\t\t\t\t\t\t\t\t\t\t  processorEnv.hasGeneratedClassFiles() || processorEnv.hasGeneratedSourceFiles());", "+\t\t\tif( _filesWithoutAnnotation != null ){", "+\t\t\t\t/*final Set<IFile> deletedFiles = */ ", "+\t\t\t\t\tcleanupAllGeneratedFilesFrom(_filesWithoutAnnotation, null);", "+\t\t\t\t// TODO: figure out where to report <code>deletedFiles</code>", "+\t\t\t}", "+\t\t\t", "-\t\t\treturn result;", "-\t\treturn EMPTY_APT_RESULT;", "+\t\t", "+\t\treturn Collections.emptySet();"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "61301da32534750e9a9a5b121698312b", "repository": "http://git.eclipse.org/gitroot/jdt/eclipse.jdt.core.git", "fileName": "org.eclipse.jdt.apt.core/src/org/eclipse/jdt/apt/core/internal/APTDispatchRunnable.java", "commitBeforeChange": "2894ba75386697d7bf484434d073fb6ffaf6cec9", "commitAfterChange": "c5ef0e6fd93c55fc5204e498f5b58ab9f95c6ab7", "methodNumberBeforeChange": 5, "methodNumberAfterChange": 5, "signatureBeforeChange": " \t \tpublic void run(IProgressMonitor monitor)", "signatureAfterChange": "\t \t \tpublic void run(IProgressMonitor monitor)", "diff": ["+\tpublic void run(IProgressMonitor monitor) ", "+\t{\t", "+\t\tbuild();", "-\tpublic void run(IProgressMonitor monitor) ", "-\t{\t", "-\t\tif ( !shouldProcess() )", "-", "-\t\t\tSet<IFile> allDeletedFiles = new HashSet<IFile>();", "-\t\t\tif( !_isFullBuild ){", "-\t\t\t\tfor( int i=0, len = _allFilesRequireProcessing.length; i<len; i++ ){", "-\t\t\t\t\tIFile f = _allFilesRequireProcessing[i];", "-\t\t\t\t\tfinal Set<IFile> deletedFiles = ", "-\t\t\t\t\t\tcleanupAllGeneratedFilesForParent( f, _compilationUnit, null );", "-\t\t\t\t\tif( deletedFiles != null )", "-\t\t\t\t\t\tallDeletedFiles.addAll(deletedFiles);", "-\t\t\t\t}", "-\t\t\t\tfor( int i=0, len=_remainingFiles.length; i<len; i++ ){", "-\t\t\t\t\tIFile f = _remainingFiles[i];", "-\t\t\t\t\tfinal Set<IFile> deletedFiles = ", "-\t\t\t\t\t\tcleanupAllGeneratedFilesForParent( f, _compilationUnit, null );", "-\t\t\t\t\tif( deletedFiles != null )", "-\t\t\t\t\t\tallDeletedFiles.addAll(deletedFiles);", "-\t\t\t\t}", "-\t\t\t}", "-\t\t\t", "-\t\t\tif ( allDeletedFiles.size() == 0 )", "-\t\t\t\t_result =  EMPTY_APT_RESULT;", "-\t\t\telse", "-\t\t\t\t_result = new APTResult( Collections.<IFile>emptySet(), ", "-\t\t\t\t\t\t\t\t\t\t allDeletedFiles,", "-\t\t\t\t\t\t\t\t\t\t Collections.<AnnotationProcessorFactory>emptySet(),", "-\t\t\t\t\t\t\t\t\t\t Collections.<IFile, Set<String>>emptyMap(),", "-\t\t\t\t\t\t\t\t\t\t Collections.<IFile, List<IProblem>>emptyMap(), ", "-\t\t\t\t\t\t\t\t\t\t false );", "-\t\t\tProcessorEnvImpl processorEnv;", "-\t\t\t", "-\t\t\tif ( _compilationUnit != null )", "-\t\t\t{", "-\t\t\t\tprocessorEnv = ProcessorEnvImpl", "-\t\t\t\t\t.newReconcileEnv(_compilationUnit, _aptProject.getJavaProject());", "-\t\t\t}", "-\t\t\telse", "-\t\t\t{", "-\t\t\t\tprocessorEnv = ProcessorEnvImpl", "-\t\t\t\t\t.newBuildEnv( _allFilesRequireProcessing, _remainingFiles, _aptProject.getJavaProject());", "-\t\t\t}\t\t\t", "-\t\t\t_result = runAPT(_factories, processorEnv);"]}], "num": 30038}