{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "716d0779e0ee5f64830e0a6aa477f31f", "detectedBy": ["DIFF_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "523c835d906845b03693cdaec5ea1a51", "repository": "http://git.eclipse.org/gitroot/jdt/eclipse.jdt.core.git", "fileName": "org.eclipse.jdt.core/compiler/org/eclipse/jdt/internal/compiler/ast/FakedTrackingVariable.java", "commitBeforeChange": "60105dfcc44d74dc319b1919727afc1b3907fff9", "commitAfterChange": "0747d5e7c6159c917fde8175fc9c67a8bade55fc", "methodNumberBeforeChange": 26, "methodNumberAfterChange": 26, "signatureBeforeChange": " \tpublic static FakedTrackingVariable pickVarForReporting(Set varsOfScope, BlockScope scope, boolean atExit)", "signatureAfterChange": "  \t\tpublic IteratorForReporting(List<FakedTrackingVariable> variables, Scope scope, boolean atExit)", "diff": ["-\tpublic static FakedTrackingVariable pickVarForReporting(Set varsOfScope, BlockScope scope, boolean atExit) {", "-\t\tif (varsOfScope.isEmpty()) return null;", "-\t\tFakedTrackingVariable trackingVar = (FakedTrackingVariable) varsOfScope.iterator().next();", "-\t\twhile (trackingVar.outerTracker != null) {", "-\t\t\t// resource is wrapped, is wrapper defined in this scope?", "-\t\t\tif (varsOfScope.contains(trackingVar.outerTracker)) {", "-\t\t\t\t// resource from same scope, travel up the wrapper chain", "-\t\t\t\ttrackingVar = trackingVar.outerTracker;", "-\t\t\t} else if (atExit) {", "-\t\t\t\t// at an exit point we report against inner despite a wrapper that may/may not be closed later", "-\t\t\t\tbreak;", "-\t\t\t} else {", "-\t\t\t\tBlockScope outerTrackerScope = trackingVar.outerTracker.binding.declaringScope;", "-\t\t\t\tif (outerTrackerScope == scope) {", "-\t\t\t\t\t// outerTracker is from same scope and already processed -> pick trackingVar now", "-\t\t\t\t\tbreak;", "-\t\t\t\t} else {", "-\t\t\t\t\t// outer resource is from other (outer?) scope", "-\t\t\t\t\tScope currentScope = scope;", "-\t\t\t\t\twhile ((currentScope = currentScope.parent) instanceof BlockScope) {", "-\t\t\t\t\t\tif (outerTrackerScope == currentScope) {", "-\t\t\t\t\t\t\t// at end of block pass responsibility for inner resource to outer scope holding a wrapper", "-\t\t\t\t\t\t\tvarsOfScope.remove(trackingVar); // drop this one", "-\t\t\t\t\t\t\t// pick a next candidate:", "-\t\t\t\t\t\t\treturn pickVarForReporting(varsOfScope, scope, atExit);", "+", "+\t\tpublic IteratorForReporting(List<FakedTrackingVariable> variables, Scope scope, boolean atExit) {", "+\t\t\tthis.varSet = new HashSet<>(variables);", "+\t\t\tthis.scope = scope;", "+\t\t\tthis.atExit = atExit;", "+\t\t\tsetUpForStage(Stage.OuterLess);", "+\t\t}", "-\t\t\t\t\tbreak; // not parent owned -> pick this var", "-\t\t\t\t}", "-\t\tvarsOfScope.remove(trackingVar);", "-\t\treturn trackingVar;"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "d99b755cb47e774d6492d7f6bf84d97e", "repository": "http://git.eclipse.org/gitroot/jdt/eclipse.jdt.core.git", "fileName": "org.eclipse.jdt.core/compiler/org/eclipse/jdt/internal/compiler/ast/MessageSend.java", "commitBeforeChange": "0001b1dcd0c4e435d76a7a88b7548ff6832acf06", "commitAfterChange": "bd260a80ad431844690d641f800683459b9c2904", "methodNumberBeforeChange": 0, "methodNumberAfterChange": 0, "signatureBeforeChange": "  public FlowInfo analyseCode(BlockScope currentScope, FlowContext flowContext, FlowInfo flowInfo)", "signatureAfterChange": "  public FlowInfo analyseCode(BlockScope currentScope, FlowContext flowContext, FlowInfo flowInfo)", "diff": ["+", "-\tif (analyseResources && CharOperation.equals(TypeConstants.CLOSE, this.selector)) ", "-\t{", "-\t\tFakedTrackingVariable trackingVariable = FakedTrackingVariable.getCloseTrackingVariable(this.receiver, flowInfo, flowContext);", "-\t\tif (trackingVariable != null) { // null happens if receiver is not a local variable or not an AutoCloseable", "-\t\t\tif (trackingVariable.methodScope == currentScope.methodScope()) {", "-\t\t\t\ttrackingVariable.markClose(flowInfo, flowContext);", "-\t\t\t} else {", "-\t\t\t\ttrackingVariable.markClosedInNestedMethod();", "+\tif (analyseResources) {", "+\t\tExpression closeTarget = null;", "+\t\tif (nonStatic) {", "+\t\t\t// closeable.close()", "+\t\t\tif (CharOperation.equals(TypeConstants.CLOSE, this.selector)) {", "+\t\t\t\tcloseTarget = this.receiver;", "+\t\t\t}", "+\t\t} else if (this.arguments != null && this.arguments.length > 0 && FakedTrackingVariable.isAnyCloseable(this.arguments[0].resolvedType)) {", "+\t\t\t// Helper.closeMethod(closeable, ..)", "+\t\t\tfor (int i=0; i<TypeConstants.closeMethods.length; i++) {", "+\t\t\t\tCloseMethodRecord record = TypeConstants.closeMethods[i];", "+\t\t\t\tif (CharOperation.equals(record.selector, this.selector)", "+\t\t\t\t\t\t&& CharOperation.equals(record.typeName, this.binding.declaringClass.compoundName)) ", "+\t\t\t\t{", "+\t\t\t\t\tcloseTarget = this.arguments[0];", "+\t\t\t\t\tbreak;", "+\t\t\t\t}", "+\t\t\t}", "+\t\t}", "+\t\tif (closeTarget != null) {", "+\t\t\tFakedTrackingVariable trackingVariable = FakedTrackingVariable.getCloseTrackingVariable(closeTarget, flowInfo, flowContext);", "+\t\t\tif (trackingVariable != null) { // null happens if target is not a local variable or not an AutoCloseable", "+\t\t\t\tif (trackingVariable.methodScope == currentScope.methodScope()) {", "+\t\t\t\t\ttrackingVariable.markClose(flowInfo, flowContext);", "+\t\t\t\t} else {", "+\t\t\t\t\ttrackingVariable.markClosedInNestedMethod();", "+\t\t\t\t}", "+"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "f9a920bce58e09b67d0c71d2d1d17266", "repository": "http://git.eclipse.org/gitroot/jdt/eclipse.jdt.core.git", "fileName": "org.eclipse.jdt.core/compiler/org/eclipse/jdt/internal/compiler/ast/MessageSend.java", "commitBeforeChange": "2c8186e7489f922689211662fed2641fe910c44e", "commitAfterChange": "277792ba446c3713bcfdc898c37875d45fc06c18", "methodNumberBeforeChange": 0, "methodNumberAfterChange": 0, "signatureBeforeChange": "  public FlowInfo analyseCode(BlockScope currentScope, FlowContext flowContext, FlowInfo flowInfo)", "signatureAfterChange": "  public FlowInfo analyseCode(BlockScope currentScope, FlowContext flowContext, FlowInfo flowInfo)", "diff": ["+", "-\tif (analyseResources && CharOperation.equals(TypeConstants.CLOSE, this.selector)) ", "-\t{", "-\t\tFakedTrackingVariable trackingVariable = FakedTrackingVariable.getCloseTrackingVariable(this.receiver, flowInfo, flowContext);", "-\t\tif (trackingVariable != null) { // null happens if receiver is not a local variable or not an AutoCloseable", "-\t\t\tif (trackingVariable.methodScope == currentScope.methodScope()) {", "-\t\t\t\ttrackingVariable.markClose(flowInfo, flowContext);", "-\t\t\t} else {", "-\t\t\t\ttrackingVariable.markClosedInNestedMethod();", "+\tif (analyseResources) {", "+\t\tExpression closeTarget = null;", "+\t\tif (nonStatic) {", "+\t\t\t// closeable.close()", "+\t\t\tif (CharOperation.equals(TypeConstants.CLOSE, this.selector)) {", "+\t\t\t\tcloseTarget = this.receiver;", "+\t\t\t}", "+\t\t} else if (this.arguments != null && this.arguments.length > 0 && FakedTrackingVariable.isAnyCloseable(this.arguments[0].resolvedType)) {", "+\t\t\t// Helper.closeMethod(closeable, ..)", "+\t\t\tfor (int i=0; i<TypeConstants.closeMethods.length; i++) {", "+\t\t\t\tCloseMethodRecord record = TypeConstants.closeMethods[i];", "+\t\t\t\tif (CharOperation.equals(record.selector, this.selector)", "+\t\t\t\t\t\t&& CharOperation.equals(record.typeName, this.binding.declaringClass.compoundName)) ", "+\t\t\t\t{", "+\t\t\t\t\tcloseTarget = this.arguments[0];", "+\t\t\t\t\tbreak;", "+\t\t\t\t}", "+\t\t\t}", "+\t\t}", "+\t\tif (closeTarget != null) {", "+\t\t\tFakedTrackingVariable trackingVariable = FakedTrackingVariable.getCloseTrackingVariable(closeTarget, flowInfo, flowContext);", "+\t\t\tif (trackingVariable != null) { // null happens if target is not a local variable or not an AutoCloseable", "+\t\t\t\tif (trackingVariable.methodScope == currentScope.methodScope()) {", "+\t\t\t\t\ttrackingVariable.markClose(flowInfo, flowContext);", "+\t\t\t\t} else {", "+\t\t\t\t\ttrackingVariable.markClosedInNestedMethod();", "+\t\t\t\t}", "+"]}], "num": 37129}