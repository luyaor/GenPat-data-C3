{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "a47e4238e3a805e4583c99642a8a849d", "detectedBy": ["AST_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "e7d6fe0e2c82d59975e95394fe31e995", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Printing/gtk/org/eclipse/swt/printing/PrintDialog.java", "commitBeforeChange": "ac473adfcb9983f414d3da15b8b15f56fca50498", "commitAfterChange": "7171ce75440e1c2f381de2d9486e536f525ae21d", "methodNumberBeforeChange": 2, "methodNumberAfterChange": 11, "signatureBeforeChange": " public PrinterData open()", "signatureAfterChange": " public PrinterData open()", "diff": ["- */", "-public PrinterData open() {", "-\t/* Return the first printer in the list */", "-\tPrinterData[] printers = Printer.getPrinterList();", "-\tif (printers.length > 0) return printers[0];", "-\treturn null;", "+ */", "+public PrinterData open() {", "+\tif (OS.GTK_VERSION < OS.VERSION (2, 9, 0)) {", "+\t\treturn Printer.getDefaultPrinterData();", "+\t} else {", "+\t\tbyte [] titleBytes = Converter.wcsToMbcs (null, getText(), true);", "+\t\tint /*long*/ topHandle = getParent().handle;", "+\t\twhile (topHandle != 0 && !OS.GTK_IS_WINDOW(topHandle)) {", "+\t\t\ttopHandle = OS.gtk_widget_get_parent(topHandle);", "+\t\t}", "+\t\thandle = OS.gtk_print_unix_dialog_new(titleBytes, topHandle);", "+\t\t\t\t", "+\t\t//TODO: Not currently implemented. May need new API. For now, disable 'Current' in the dialog. (see gtk bug 344519)", "+\t\tOS.gtk_print_unix_dialog_set_current_page(handle, -1);", "+\t\t", "+\t\tOS.gtk_print_unix_dialog_set_manual_capabilities(handle,", "+\t\t\tOS.GTK_PRINT_CAPABILITY_COLLATE | OS.GTK_PRINT_CAPABILITY_COPIES | OS.GTK_PRINT_CAPABILITY_PAGE_SET);", "+\t\t", "+\t\t/* Set state into print dialog settings. */", "+\t\tint /*long*/ settings = OS.gtk_print_settings_new();", "+\t\tint /*long*/ page_setup = OS.gtk_page_setup_new();", "+\t\tPrinter.setScope(settings, scope, startPage, endPage);", "+\t\tif (printToFile) {", "+\t\t\tbyte [] buffer = Converter.wcsToMbcs (null, \"Print to File\", true); //$NON-NLS-1$", "+\t\t\tOS.gtk_print_settings_set_printer(settings, buffer);", "+\t\t}", "+\t\tOS.gtk_print_unix_dialog_set_settings(handle, settings);", "+\t\tOS.gtk_print_unix_dialog_set_page_setup(handle, page_setup);", "+\t\tOS.g_object_unref(settings);", "+\t\tOS.g_object_unref(page_setup);", "+", "+\t\tPrinterData data = null;", "+\t\t//TODO: Handle 'Print Preview' (GTK_RESPONSE_APPLY).", "+\t\tif (OS.gtk_dialog_run (handle) == OS.GTK_RESPONSE_OK) {", "+\t\t\tint /*long*/ printer = OS.gtk_print_unix_dialog_get_selected_printer(handle);", "+\t\t\tif (printer != 0) {", "+\t\t\t\t/* Get state from print dialog. */", "+\t\t\t\tsettings = OS.gtk_print_unix_dialog_get_settings(handle); // must unref", "+\t\t\t\tpage_setup = OS.gtk_print_unix_dialog_get_page_setup(handle); // do not unref", "+\t\t\t\tdata = Printer.printerDataFromGtkPrinter(printer);", "+\t\t\t\tint print_pages = OS.gtk_print_settings_get_print_pages(settings);", "+\t\t\t\tswitch (print_pages) {", "+\t\t\t\t\tcase OS.GTK_PRINT_PAGES_ALL:", "+\t\t\t\t\t\tscope = PrinterData.ALL_PAGES;", "+\t\t\t\t\t\tbreak;", "+\t\t\t\t\tcase OS.GTK_PRINT_PAGES_RANGES:", "+\t\t\t\t\t\tscope = PrinterData.PAGE_RANGE;", "+\t\t\t\t\t\tint[] num_ranges = new int[1];", "+\t\t\t\t\t\tint /*long*/ page_ranges = OS.gtk_print_settings_get_page_ranges(settings, num_ranges);", "+\t\t\t\t\t\tint [] pageRange = new int[2];", "+\t\t\t\t\t\tint length = num_ranges[0];", "+\t\t\t\t\t\tint min = Integer.MAX_VALUE, max = 0;", "+\t\t\t\t\t\tfor (int i = 0; i < length; i++) {", "+\t\t\t\t\t\t\tOS.memmove(pageRange, page_ranges + i * pageRange.length * 4, pageRange.length * 4);", "+\t\t\t\t\t\t\tmin = Math.min(min, pageRange[0] + 1);", "+\t\t\t\t\t\t\tmax = Math.max(max, pageRange[1] + 1);", "+\t\t\t\t\t\t}", "+\t\t\t\t\t\tOS.g_free(page_ranges);", "+\t\t\t\t\t\tstartPage = min == Integer.MAX_VALUE ? 1 : min;", "+\t\t\t\t\t\tendPage = max == 0 ? 1 : max;", "+\t\t\t\t\t\tbreak;", "+\t\t\t\t\tcase OS.GTK_PRINT_PAGES_CURRENT:", "+\t\t\t\t\t\t//TODO: Disabled in dialog (see above). This code will not run. (see gtk bug 344519)", "+\t\t\t\t\t\tscope = PrinterData.SELECTION;", "+\t\t\t\t\t\tstartPage = endPage = OS.gtk_print_unix_dialog_get_current_page(handle);", "+\t\t\t\t\t\tbreak;", "+\t\t\t\t}", "+\t\t\t\t", "+\t\t\t\tprintToFile = data.name.equals(\"Print to File\"); //$NON-NLS-1$", "+\t\t\t\tif (printToFile) {", "+\t\t\t\t\tint /*long*/ address = OS.gtk_print_settings_get(settings, OS.GTK_PRINT_SETTINGS_OUTPUT_URI);", "+\t\t\t\t\tint length = OS.strlen (address);", "+\t\t\t\t\tbyte [] buffer = new byte [length];", "+\t\t\t\t\tOS.memmove (buffer, address, length);", "+\t\t\t\t\tdata.fileName = new String (Converter.mbcsToWcs (null, buffer));", "+\t\t\t\t}", "+", "+\t\t\t\tdata.scope = scope;", "+\t\t\t\tdata.startPage = startPage;", "+\t\t\t\tdata.endPage = endPage;", "+\t\t\t\tdata.printToFile = printToFile;", "+\t\t\t\tdata.copyCount = OS.gtk_print_settings_get_n_copies(settings);", "+\t\t\t\tdata.collate = OS.gtk_print_settings_get_collate(settings);", "+", "+\t\t\t\t/* Save other print_settings data as key/value pairs in otherData. */", "+\t\t\t\tCallback printSettingsCallback = new Callback(this, \"GtkPrintSettingsFunc\", 3); //$NON-NLS-1$", "+\t\t\t\tint /*long*/ GtkPrintSettingsFunc = printSettingsCallback.getAddress();", "+\t\t\t\tif (GtkPrintSettingsFunc == 0) SWT.error (SWT.ERROR_NO_MORE_CALLBACKS);", "+\t\t\t\tindex = 0;", "+\t\t\t\tsettingsData = new byte[1024];", "+\t\t\t\tOS.gtk_print_settings_foreach (settings, GtkPrintSettingsFunc, 0);", "+\t\t\t\tprintSettingsCallback.dispose ();", "+\t\t\t\tindex++; // extra null terminator after print_settings and before page_setup", "+", "+\t\t\t\t/* Save page_setup data as key/value pairs in otherData.", "+\t\t\t\t * Note that page_setup properties must be stored and restored in the same order.", "+\t\t\t\t */", "+\t\t\t\tstore(\"orientation\", OS.gtk_page_setup_get_orientation(page_setup)); //$NON-NLS-1$", "+\t\t\t\tstore(\"top_margin\", OS.gtk_page_setup_get_top_margin(page_setup, OS.GTK_UNIT_MM)); //$NON-NLS-1$", "+\t\t\t\tstore(\"bottom_margin\", OS.gtk_page_setup_get_bottom_margin(page_setup, OS.GTK_UNIT_MM)); //$NON-NLS-1$", "+\t\t\t\tstore(\"left_margin\", OS.gtk_page_setup_get_left_margin(page_setup, OS.GTK_UNIT_MM)); //$NON-NLS-1$", "+\t\t\t\tstore(\"right_margin\", OS.gtk_page_setup_get_right_margin(page_setup, OS.GTK_UNIT_MM)); //$NON-NLS-1$", "+\t\t\t\tint /*long*/ paper_size = OS.gtk_page_setup_get_paper_size(page_setup); //$NON-NLS-1$", "+\t\t\t\tstoreBytes(\"paper_size_name\", OS.gtk_paper_size_get_name(paper_size)); //$NON-NLS-1$", "+\t\t\t\tstoreBytes(\"paper_size_display_name\", OS.gtk_paper_size_get_display_name(paper_size)); //$NON-NLS-1$", "+\t\t\t\tstoreBytes(\"paper_size_ppd_name\", OS.gtk_paper_size_get_ppd_name(paper_size)); //$NON-NLS-1$", "+\t\t\t\tstore(\"paper_size_width\", OS.gtk_paper_size_get_width(paper_size, OS.GTK_UNIT_MM)); //$NON-NLS-1$", "+\t\t\t\tstore(\"paper_size_height\", OS.gtk_paper_size_get_height(paper_size, OS.GTK_UNIT_MM)); //$NON-NLS-1$", "+\t\t\t\tstore(\"paper_size_is_custom\", OS.gtk_paper_size_is_custom(paper_size)); //$NON-NLS-1$", "+\t\t\t\tdata.otherData = settingsData;", "+\t\t\t\tOS.g_object_unref(settings);", "+\t\t\t}", "+\t\t}", "+\t\tOS.gtk_widget_destroy (handle);", "+\t\treturn data;", "+\t}", "+}"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "9104d91ed72aec66291625ab2ab3e0a3", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT/gtk/org/eclipse/swt/graphics/TextLayout.java", "commitBeforeChange": "ac974de9da95e2001454f2d3c2ad1159e165254a", "commitAfterChange": "6eed09ef63d812f113250ffc9b38871b7bfdd632", "methodNumberBeforeChange": 10, "methodNumberAfterChange": 10, "signatureBeforeChange": "  void drawBorder(GC gc, int x, int y, GdkColor selectionColor)", "signatureAfterChange": "  void drawBorder(GC gc, int x, int y, GdkColor selectionColor)", "diff": ["-\t\tif (style.underline && style.underlineColor != null && OS.GTK_VERSION < OS.VERSION(2, 6, 0)) drawUnderline = true;", "+\t\tif (style.underline && style.underlineColor != null) drawUnderline = true;", "-\t\tif (style.strikeout && style.strikeoutColor != null && OS.GTK_VERSION < OS.VERSION(2, 6, 0)) drawStrikeout = true;", "+\t\tif (style.strikeout && style.strikeoutColor != null) drawStrikeout = true;", "-\t\tint byteStart = (int)/*64*/(OS.g_utf8_offset_to_pointer(ptr, styles[i].start) - ptr);", "-\t\tint byteEnd = (int)/*64*/(OS.g_utf8_offset_to_pointer(ptr, styles[i+1].start) - ptr);", "+\t\tint start = translateOffset(styles[i].start);", "+\t\tint end = translateOffset(styles[i+1].start - 1);", "+\t\tint byteStart = (int)/*64*/(OS.g_utf8_offset_to_pointer(ptr, start) - ptr);", "+\t\tint byteEnd = (int)/*64*/(OS.g_utf8_offset_to_pointer(ptr, end + 1) - ptr);", "-\t\t\t\tGdkColor color = selectionColor;", "+\t\t\t\tGdkColor color = null;", "+\t\t\t\tif (color == null && selectionColor != null) color = selectionColor;", "-\t\t\t\tGdkColor color = selectionColor;", "+\t\t\t\tGdkColor color = null;", "+\t\t\t\tif (color == null && selectionColor != null) color = selectionColor;", "+\t\t\t\tif (color == null && style.foreground != null) color = style.foreground.handle;", "-\t\t\t\tOS.gdk_gc_set_foreground(gdkGC, color);", "+\t\t\t\tif (cairo != 0 && OS.GTK_VERSION >= OS.VERSION(2, 8, 0)) {", "+\t\t\t\t\tCairo.cairo_set_source_rgba(cairo, (color.red & 0xFFFF) / (float)0xFFFF, (color.green & 0xFFFF) / (float)0xFFFF, (color.blue & 0xFFFF) / (float)0xFFFF, data.alpha / (float)0xFF);", "+\t\t\t\t} else {", "+\t\t\t\t\tOS.gdk_gc_set_foreground(gdkGC, color);", "+\t\t\t\t}", "+\t\t\t\tint underlinePosition = -1;", "-\t\t\t\tOS.gdk_gc_set_line_attributes(gdkGC, underlineThickness, OS.GDK_LINE_SOLID, OS.GDK_CAP_BUTT, OS.GDK_JOIN_MITER);", "+\t\t\t\tif (OS.GTK_VERSION >= OS.VERSION(2, 6, 0)) {", "+\t\t\t\t\tFont font = style.font;", "+\t\t\t\t\tif (font == null) font = this.font;", "+\t\t\t\t\tif (font == null) font = device.systemFont;", "+\t\t\t\t\tint /*long*/ lang = OS.pango_context_get_language(context);", "+\t\t\t\t\tint /*long*/ metrics = OS.pango_context_get_metrics(context, font.handle, lang);", "+\t\t\t\t\tunderlinePosition = OS.PANGO_PIXELS(OS.pango_font_metrics_get_underline_position(metrics));", "+\t\t\t\t\tunderlineThickness = OS.PANGO_PIXELS(OS.pango_font_metrics_get_underline_thickness(metrics));", "+\t\t\t\t\tOS.pango_font_metrics_unref(metrics);", "+\t\t\t\t}", "-\t\t\t\t\tint underlineY = rect.y + metrics.ascent + 1 - style.rise;", "+\t\t\t\t\tint underlineY = rect.y + metrics.ascent - underlinePosition - style.rise;", "-\t\t\t\t\t\t\tOS.gdk_draw_lines(data.drawable, gdkGC, points, points.length / 2);", "+\t\t\t\t\t\t\tif (cairo != 0 && OS.GTK_VERSION >= OS.VERSION(2, 8, 0)) {", "+\t\t\t\t\t\t\t\tCairo.cairo_set_line_width(cairo, squigglyThickness);", "+\t\t\t\t\t\t\t\tCairo.cairo_set_line_cap(cairo, Cairo.CAIRO_LINE_CAP_BUTT);", "+\t\t\t\t\t\t\t\tCairo.cairo_set_line_join(cairo, Cairo.CAIRO_LINE_JOIN_MITER);", "+\t\t\t\t\t\t\t\tif (points.length > 0) {", "+\t\t\t\t\t\t\t\t\tdouble xOffset = 0.5, yOffset = 0.5; ", "+\t\t\t\t\t\t\t\t\tCairo.cairo_move_to(cairo, points[0] + xOffset, points[1] + yOffset);", "+\t\t\t\t\t\t\t\t\tfor (int k = 2; k < points.length; k += 2) {", "+\t\t\t\t\t\t\t\t\t\tCairo.cairo_line_to(cairo, points[k] + xOffset, points[k + 1] + yOffset);", "+\t\t\t\t\t\t\t\t\t}", "+\t\t\t\t\t\t\t\t\tCairo.cairo_stroke(cairo);", "+\t\t\t\t\t\t\t\t}", "+\t\t\t\t\t\t\t} else {\t", "+\t\t\t\t\t\t\t\tOS.gdk_gc_set_line_attributes(gdkGC, squigglyThickness, OS.GDK_LINE_SOLID, OS.GDK_CAP_BUTT, OS.GDK_JOIN_MITER);", "+\t\t\t\t\t\t\t\tOS.gdk_draw_lines(data.drawable, gdkGC, points, points.length / 2);", "+\t\t\t\t\t\t\t}", "-\t\t\t\t\t\t\tOS.gdk_draw_line(data.drawable, gdkGC, rect.x, underlineY + underlineThickness * 2, rect.x + rect.width, underlineY + underlineThickness * 2);", "+\t\t\t\t\t\t\tif (cairo != 0 && OS.GTK_VERSION >= OS.VERSION(2, 8, 0)) {", "+\t\t\t\t\t\t\t\tCairo.cairo_rectangle(cairo, rect.x, underlineY + underlineThickness * 2, rect.width, underlineThickness);", "+\t\t\t\t\t\t\t\tCairo.cairo_fill(cairo);", "+\t\t\t\t\t\t\t} else {", "+\t\t\t\t\t\t\t\tOS.gdk_draw_rectangle(data.drawable, gdkGC, 1, rect.x, underlineY + underlineThickness * 2, rect.width, underlineThickness);", "+\t\t\t\t\t\t\t}", "-\t\t\t\t\t\t\tOS.gdk_draw_line(data.drawable, gdkGC, rect.x, underlineY, rect.x + rect.width, underlineY);", "+\t\t\t\t\t\t\tif (cairo != 0 && OS.GTK_VERSION >= OS.VERSION(2, 8, 0)) {", "+\t\t\t\t\t\t\t\tCairo.cairo_rectangle(cairo, rect.x, underlineY, rect.width, underlineThickness);", "+\t\t\t\t\t\t\t\tCairo.cairo_fill(cairo);", "+\t\t\t\t\t\t\t} else {", "+\t\t\t\t\t\t\t\tOS.gdk_draw_rectangle(data.drawable, gdkGC, 1, rect.x, underlineY, rect.width, underlineThickness);", "+\t\t\t\t\t\t\t}", "-\t\t\t\tGdkColor color = selectionColor;", "+\t\t\t\tGdkColor color = null;", "+\t\t\t\tif (color == null && selectionColor != null) color = selectionColor;", "+\t\t\t\tif (color == null && style.foreground != null) color = style.foreground.handle;", "-\t\t\t\tOS.gdk_gc_set_foreground(gdkGC, color);", "+\t\t\t\tif (cairo != 0 && OS.GTK_VERSION >= OS.VERSION(2, 8, 0)) {", "+\t\t\t\t\tCairo.cairo_set_source_rgba(cairo, (color.red & 0xFFFF) / (float)0xFFFF, (color.green & 0xFFFF) / (float)0xFFFF, (color.blue & 0xFFFF) / (float)0xFFFF, data.alpha / (float)0xFF);", "+\t\t\t\t} else {", "+\t\t\t\t\tOS.gdk_gc_set_foreground(gdkGC, color);", "+\t\t\t\t}", "+\t\t\t\tint strikeoutPosition = -1;", "-\t\t\t\tOS.gdk_gc_set_line_attributes(gdkGC, strikeoutThickness, OS.GDK_LINE_SOLID, OS.GDK_CAP_BUTT, OS.GDK_JOIN_MITER);", "+\t\t\t\tif (OS.GTK_VERSION >= OS.VERSION(2, 6, 0)) {", "+\t\t\t\t\tFont font = style.font;", "+\t\t\t\t\tif (font == null) font = this.font;", "+\t\t\t\t\tif (font == null) font = device.systemFont;", "+\t\t\t\t\tint /*long*/ lang = OS.pango_context_get_language(context);", "+\t\t\t\t\tint /*long*/ metrics = OS.pango_context_get_metrics(context, font.handle, lang);", "+\t\t\t\t\tstrikeoutPosition = OS.PANGO_PIXELS(OS.pango_font_metrics_get_strikethrough_position(metrics));", "+\t\t\t\t\tstrikeoutThickness = OS.PANGO_PIXELS(OS.pango_font_metrics_get_strikethrough_thickness(metrics));", "+\t\t\t\t\tOS.pango_font_metrics_unref(metrics);", "+\t\t\t\t}", "-\t\t\t\t\tint strikeoutY = rect.y + rect.height / 2;", "-\t\t\t\t\tOS.gdk_draw_line(data.drawable, gdkGC, rect.x, strikeoutY, rect.x + rect.width - 1, strikeoutY);", "+\t\t\t\t\tint strikeoutY = rect.y + rect.height / 2 - style.rise;", "+\t\t\t\t\tif (OS.GTK_VERSION >= OS.VERSION(2, 6, 0)) {", "+\t\t\t\t\t\tint offset = getOffset(rect.x - x, rect.y - y, null);", "+\t\t\t\t\t\tint lineIndex = getLineIndex(offset);", "+\t\t\t\t\t\tFontMetrics metrics = getLineMetrics(lineIndex);", "+\t\t\t\t\t\tstrikeoutY = rect.y + metrics.ascent - strikeoutPosition - style.rise;", "+\t\t\t\t\t}", "+\t\t\t\t\tif (cairo != 0 && OS.GTK_VERSION >= OS.VERSION(2, 8, 0)) {", "+\t\t\t\t\t\tCairo.cairo_rectangle(cairo, rect.x, strikeoutY, rect.width, strikeoutThickness);", "+\t\t\t\t\t\tCairo.cairo_fill(cairo);", "+\t\t\t\t\t} else {", "+\t\t\t\t\t\tOS.gdk_draw_rectangle(data.drawable, gdkGC, 1, rect.x, strikeoutY, rect.width, strikeoutThickness);", "+\t\t\t\t\t}"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "0ffe28fef26075f9f3e737c26669ef85", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT/carbon/org/eclipse/swt/widgets/Tracker.java", "commitBeforeChange": "f664172a0e735d142051b2da26600fbd256e07a6", "commitAfterChange": "894e6297387f95786ffea31acd399cd5951b0afc", "methodNumberBeforeChange": 13, "methodNumberAfterChange": 13, "signatureBeforeChange": " public boolean open ()", "signatureAfterChange": " public boolean open ()", "diff": ["-\treturn false;", "+\tboolean cancelled = false;", "+\ttracking = true;", "+\tint window = display.createOverlayWindow ();", "+\tOS.ShowWindow (window);", "+\tdrawRectangles (window, false);", "+\tPoint cursorPos;", "+\tif (OS.StillDown ()) {", "+\t\torg.eclipse.swt.internal.carbon.Point pt = new org.eclipse.swt.internal.carbon.Point ();", "+\t\tOS.GetGlobalMouse (pt);", "+\t\tcursorPos = new Point (pt.h, pt.v);", "+\t} else {", "+\t\tif ((style & SWT.RESIZE) != 0) {", "+\t\t\tcursorPos = adjustResizeCursor ();", "+\t\t} else {", "+\t\t\tcursorPos = adjustMoveCursor ();", "+\t\t}", "+\t}", "+\t", "+\tint oldX = cursorPos.x, oldY = cursorPos.y;", "+\t/*", "+\t* Tracker behaves like a Dialog with its own OS event loop.", "+\t*/", "+\tEvent event = new Event ();", "+\tint [] outEvent  = new int [1];", "+\twhile (tracking && !cancelled) {", "+\t\tint status = OS.ReceiveNextEvent (0, null, OS.kEventDurationNoWait, true, outEvent);", "+\t\tif (status != OS.noErr) continue;", "+\t\tint eventClass = OS.GetEventClass (outEvent [0]);", "+\t\tint eventKind = OS.GetEventKind (outEvent [0]);", "+\t\tint newX = oldX, newY = oldY;\t", "+\t\tswitch (eventClass) {", "+\t\t\tcase OS.kEventClassMouse: {", "+\t\t\t\tswitch (eventKind) {", "+\t\t\t\t\tcase OS.kEventMouseUp:", "+\t\t\t\t\tcase OS.kEventMouseMoved:", "+\t\t\t\t\tcase OS.kEventMouseDragged:", "+\t\t\t\t\t\tint sizeof = org.eclipse.swt.internal.carbon.Point.sizeof;", "+\t\t\t\t\t\torg.eclipse.swt.internal.carbon.Point where = new org.eclipse.swt.internal.carbon.Point ();", "+\t\t\t\t\t\tOS.GetEventParameter (outEvent [0], OS.kEventParamMouseLocation, OS.typeQDPoint, null, sizeof, null, where);", "+\t\t\t\t\t\tnewX = where.h;", "+\t\t\t\t\t\tnewY = where.v;\t", "+\t\t\t\t\t\tif (newX != oldX || newY != oldY) {", "+\t\t\t\t\t\t\tdrawRectangles (window, true);", "+\t\t\t\t\t\t\tevent.x = newX;", "+\t\t\t\t\t\t\tevent.y = newY;", "+\t\t\t\t\t\t\tif ((style & SWT.RESIZE) != 0) {", "+\t\t\t\t\t\t\t   resizeRectangles (newX - oldX, newY - oldY);", "+\t\t\t\t\t\t\t\tcursorPos = adjustResizeCursor ();", "+\t\t\t\t\t\t\t\tnewX = cursorPos.x; newY = cursorPos.y;", "+\t\t\t\t\t\t\t\tinEvent = true;", "+\t\t\t\t\t\t\t\tsendEvent (SWT.Resize, event);", "+\t\t\t\t\t\t\t} else {", "+\t\t\t\t\t\t\t\tmoveRectangles (newX - oldX, newY - oldY);", "+\t\t\t\t\t\t\t\tinEvent = true;", "+\t\t\t\t\t\t\t\tsendEvent (SWT.Move, event);", "+\t\t\t\t\t\t\t}", "+\t\t\t\t\t\t\tinEvent = false;", "+\t\t\t\t\t\t\t/*", "+\t\t\t\t\t\t\t* It is possible (but unlikely), that application", "+\t\t\t\t\t\t\t* code could have disposed the widget in the move", "+\t\t\t\t\t\t\t* event.  If this happens, return false to indicate", "+\t\t\t\t\t\t\t* that the tracking has failed.", "+\t\t\t\t\t\t\t*/", "+\t\t\t\t\t\t\tif (isDisposed ()) return false;", "+\t\t\t\t\t\t\tdrawRectangles (window, false);", "+\t\t\t\t\t\t\toldX = newX;  oldY = newY;", "+\t\t\t\t\t\t}", "+\t\t\t\t\t\ttracking = eventKind != OS.kEventMouseUp;", "+\t\t\t\t\t\tbreak;", "+\t\t\t\t}", "+\t\t\t\tbreak;", "+\t\t\t}", "+\t\t\tcase OS.kEventClassKeyboard: {", "+\t\t\t\tswitch (eventKind) {", "+\t\t\t\t\tcase OS.kEventRawKeyDown:", "+\t\t\t\t\tcase OS.kEventRawKeyModifiersChanged:", "+\t\t\t\t\tcase OS.kEventRawKeyRepeat: {", "+\t\t\t\t\t\tint [] keyCode = new int [1];", "+\t\t\t\t\t\tOS.GetEventParameter (outEvent [0], OS.kEventParamKeyCode, OS.typeUInt32, null, keyCode.length * 4, null, keyCode);", "+\t\t\t\t\t\tint [] modifiers = new int [1];", "+\t\t\t\t\t\tOS.GetEventParameter (outEvent [0], OS.kEventParamKeyModifiers, OS.typeUInt32, null, 4, null, modifiers);", "+\t\t\t\t\t\tint stepSize = (modifiers [0] & OS.controlKey) != 0 ? STEPSIZE_SMALL : STEPSIZE_LARGE;", "+\t\t\t\t\t\tint xChange = 0, yChange = 0;", "+\t\t\t\t\t\tswitch (keyCode [0]) {", "+\t\t\t\t\t\t\tcase 53: /* Esc */", "+\t\t\t\t\t\t\t\tcancelled = true;", "+\t\t\t\t\t\t\t\ttracking = false;", "+\t\t\t\t\t\t\t\tbreak;", "+\t\t\t\t\t\t\tcase 36: /* Return */", "+\t\t\t\t\t\t\t\ttracking = false;", "+\t\t\t\t\t\t\t\tbreak;", "+\t\t\t\t\t\t\tcase 123: /* Left arrow */", "+\t\t\t\t\t\t\t\txChange = -stepSize;", "+\t\t\t\t\t\t\t\tbreak;", "+\t\t\t\t\t\t\tcase 124: /* Right arrow */", "+\t\t\t\t\t\t\t\txChange = stepSize;", "+\t\t\t\t\t\t\t\tbreak;", "+\t\t\t\t\t\t\tcase 126: /* Up arrow */", "+\t\t\t\t\t\t\t\tyChange = -stepSize;", "+\t\t\t\t\t\t\t\tbreak;", "+\t\t\t\t\t\t\tcase 125: /* Down arrow */", "+\t\t\t\t\t\t\t\tyChange = stepSize;", "+\t\t\t\t\t\t\t\tbreak;", "+\t\t\t\t\t\t}", "+\t\t\t\t\t\tif (xChange != 0 || yChange != 0) {", "+\t\t\t\t\t\t\tdrawRectangles (window, true);", "+\t\t\t\t\t\t\tnewX = oldX + xChange;", "+\t\t\t\t\t\t\tnewY = oldY + yChange;", "+\t\t\t\t\t\t\tevent.x = newX;", "+\t\t\t\t\t\t\tevent.y = newY;", "+\t\t\t\t\t\t\tif ((style & SWT.RESIZE) != 0) {", "+\t\t\t\t\t\t\t\tresizeRectangles (xChange, yChange);", "+\t\t\t\t\t\t\t\tcursorPos = adjustResizeCursor ();", "+\t\t\t\t\t\t\t\tinEvent = true;", "+\t\t\t\t\t\t\t\tsendEvent (SWT.Resize, event);", "+\t\t\t\t\t\t\t} else {", "+\t\t\t\t\t\t\t\tmoveRectangles (xChange, yChange);", "+\t\t\t\t\t\t\t\tcursorPos = adjustMoveCursor ();", "+\t\t\t\t\t\t\t\tinEvent = true;", "+\t\t\t\t\t\t\t\tsendEvent (SWT.Move, event);", "+\t\t\t\t\t\t\t}", "+\t\t\t\t\t\t\tinEvent = false;", "+\t\t\t\t\t\t\t/*", "+\t\t\t\t\t\t\t* It is possible (but unlikely) that application", "+\t\t\t\t\t\t\t* code could have disposed the widget in the move", "+\t\t\t\t\t\t\t* event.  If this happens return false to indicate", "+\t\t\t\t\t\t\t* that the tracking has failed.", "+\t\t\t\t\t\t\t*/", "+\t\t\t\t\t\t\tif (isDisposed ()) return false;", "+\t\t\t\t\t\t\tdrawRectangles (window, false);", "+\t\t\t\t\t\t\toldX = cursorPos.x;  oldY = cursorPos.y;", "+\t\t\t\t\t\t}", "+\t\t\t\t\t\tbreak;", "+\t\t\t\t\t}", "+\t\t\t\t}", "+\t\t\t}", "+\t\t}", "+\t\t/*", "+\t\t* Don't dispatch mouse and key events in general, EXCEPT once this", "+\t\t* tracker has finished its work.", "+\t\t*/", "+\t\tboolean dispatch = true;", "+\t\tif (tracking && !cancelled) {", "+\t\t\tif (eventClass == OS.kEventClassMouse) dispatch = false;", "+\t\t\tif (eventClass == OS.kEventClassKeyboard) dispatch = false;", "+\t\t}", "+\t\tif (dispatch) OS.SendEventToEventTarget (outEvent [0], OS.GetEventDispatcherTarget ());", "+\t\tOS.ReleaseEvent (outEvent [0]);", "+\t\tif (clientCursor != null && resizeCursor == null) {", "+\t\t\tdisplay.setCursor (clientCursor.handle);", "+\t\t}", "+\t}", "+\tdrawRectangles (window, true);", "+\tOS.DisposeWindow (window);", "+\ttracking = false;", "+\tdisplay.grabControl = null;", "+\treturn !cancelled;"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "62cb029d053173ddcce823c382caf28d", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT/win32/org/eclipse/swt/widgets/Combo.java", "commitBeforeChange": "e4a5b4039e34eaefc26de1944535bb7eeddf7be0", "commitAfterChange": "d05349824e51056345d3e4d57c688edd41637c64", "methodNumberBeforeChange": 84, "methodNumberAfterChange": 94, "signatureBeforeChange": "  long windowProc (long hwnd, int msg, long wParam, long lParam)", "signatureAfterChange": "  long windowProc (long hwnd, int msg, long wParam, long lParam)", "diff": ["+\t\t\tboolean processSegments = false, redraw = false;", "-\t\t\t\tcase OS.WM_CHAR:\t\tresult = wmChar (hwnd, wParam, lParam); break;", "+\t\t\t\tcase OS.WM_CHAR:", "+\t\t\t\t\tprocessSegments = (hooks (SWT.Segments) || filters (SWT.Segments)) && !ignoreCharacter && OS.GetKeyState (OS.VK_CONTROL) >= 0 && OS.GetKeyState (OS.VK_MENU) >= 0;", "+\t\t\t\t\tresult = wmChar (hwnd, wParam, lParam);", "+\t\t\t\t\tbreak;", "-\t\t\t\tcase OS.WM_KEYDOWN:\t\tresult = wmKeyDown (hwnd, wParam, lParam); break;", "+\t\t\t\tcase OS.WM_KEYDOWN:", "+\t\t\t\t\tprocessSegments = wParam == OS.VK_DELETE && (hooks (SWT.Segments) || filters (SWT.Segments));", "+\t\t\t\t\tresult = wmKeyDown (hwnd, wParam, lParam);", "+\t\t\t\t\tbreak;", "-\t\t\t\t\t", "+", "+\t\t\t\tcase OS.EM_CANUNDO:", "+\t\t\t\t\tif (hooks (SWT.Segments) || filters (SWT.Segments)) return 0;", "+\t\t\t\t\tbreak;", "+\t\t\t\tcase OS.WM_UNDO:", "+\t\t\t\tcase OS.EM_UNDO:", "+\t\t\t\t\tif (hooks (SWT.Segments) || filters (SWT.Segments)) return 0;", "+\t\t\t\tcase OS.WM_COPY:", "-\t\t\t\tcase OS.WM_UNDO:", "-\t\t\t\tcase OS.EM_UNDO:", "+\t\t\t\t\tprocessSegments = hooks (SWT.Segments) || filters (SWT.Segments);", "+", "+\t\t\tif (processSegments) {", "+\t\t\t\tif (getDrawing () && OS.IsWindowVisible (hwndText)) {", "+\t\t\t\t\tredraw = true;", "+\t\t\t\t\tOS.DefWindowProc (hwndText, OS.WM_SETREDRAW, 0, 0);", "+\t\t\t\t}", "+\t\t\t\tclearSegments (true);", "+\t\t\t\tlong /*int*/ code = callWindowProc (hwnd, msg, wParam, lParam);", "+\t\t\t\tapplyEditSegments ();", "+\t\t\t\tif (redraw) {", "+\t\t\t\t\tOS.DefWindowProc (hwndText, OS.WM_SETREDRAW, 1, 0);", "+\t\t\t\t\tOS.InvalidateRect (hwndText, null, true);", "+\t\t\t\t}", "+\t\t\t\treturn code;", "+\t\t\t}", "-\tif (msg == OS.CB_SETCURSEL) {", "-\t\tif ((style & SWT.READ_ONLY) != 0) {", "-\t\t\tif (hooks (SWT.Verify) || filters (SWT.Verify)) {", "-\t\t\t\tString oldText = getText (), newText = null;", "-\t\t\t\tif (wParam == -1) {", "-\t\t\t\t\tnewText = \"\";", "-\t\t\t\t} else {", "-\t\t\t\t\tif (0 <= wParam && wParam < getItemCount ()) {", "-\t\t\t\t\t\tnewText = getItem ((int)/*64*/wParam);", "+\tswitch (msg) {", "+\t\tcase OS.CB_SETCURSEL: {", "+\t\t\tlong /*int*/ code = OS.CB_ERR;", "+\t\t\tint index = (int)/*64*/ wParam;", "+\t\t\tif ((style & SWT.READ_ONLY) != 0) {", "+\t\t\t\tif (hooks (SWT.Verify) || filters (SWT.Verify)) {", "+\t\t\t\t\tString oldText = getText (), newText = null;", "+\t\t\t\t\tif (wParam == -1) {", "+\t\t\t\t\t\tnewText = \"\";", "+\t\t\t\t\t} else {", "+\t\t\t\t\t\tif (0 <= wParam && wParam < getItemCount ()) {", "+\t\t\t\t\t\t\tnewText = getItem ((int)/*64*/wParam);", "+\t\t\t\t\t\t}", "-\t\t\t\t}", "-\t\t\t\tif (newText != null && !newText.equals (oldText)) {", "-\t\t\t\t\tint length = OS.GetWindowTextLength (handle);", "-\t\t\t\t\toldText = newText;", "-\t\t\t\t\tnewText = verifyText (newText, 0, length, null);", "-\t\t\t\t\tif (newText == null) return 0;", "-\t\t\t\t\tif (!newText.equals (oldText)) {", "-\t\t\t\t\t\tint index = indexOf (newText);", "-\t\t\t\t\t\tif (index != -1 && index != wParam) {", "-\t\t\t\t\t\t\treturn callWindowProc (handle, OS.CB_SETCURSEL, index, lParam);", "+\t\t\t\t\tif (newText != null && !newText.equals (oldText)) {", "+\t\t\t\t\t\tint length = OS.GetWindowTextLength (handle);", "+\t\t\t\t\t\toldText = newText;", "+\t\t\t\t\t\tnewText = verifyText (newText, 0, length, null);", "+\t\t\t\t\t\tif (newText == null) return 0;", "+\t\t\t\t\t\tif (!newText.equals (oldText)) {", "+\t\t\t\t\t\t\tindex = indexOf (newText);", "+\t\t\t\t\t\t\tif (index != -1 && index != wParam) {", "+\t\t\t\t\t\t\t\treturn callWindowProc (handle, OS.CB_SETCURSEL, index, lParam);", "+\t\t\t\t\t\t\t}", "+\t\t\tif (hooks (SWT.Segments) || filters (SWT.Segments)) {", "+\t\t\t\tcode = super.windowProc (hwnd, msg, wParam, lParam);", "+\t\t\t\tif (!(code == OS.CB_ERR || code == OS.CB_ERRSPACE)) {", "+\t\t\t\t\tsegments = null;", "+\t\t\t\t\tEvent event = getSegments (items [index]);", "+\t\t\t\t\tif (event != null) segments = event.segments;", "+\t\t\t\t\treturn code;", "+\t\t\t\t}", "+\t\t\t}", "+\t\t}", "+\t\tcase OS.CB_ADDSTRING:", "+\t\tcase OS.CB_INSERTSTRING:", "+\t\tcase OS.CB_FINDSTRINGEXACT:", "+\t\t\tif (lParam != 0 && (hooks (SWT.Segments) || filters (SWT.Segments))) {", "+\t\t\t\tlong /*int*/ code = OS.CB_ERR;", "+\t\t\t\tint length = OS.IsUnicode ? OS.wcslen (lParam) : OS.strlen (lParam);", "+\t\t\t\tTCHAR buffer = new TCHAR (getCodePage (), length);", "+\t\t\t\tOS.MoveMemory (buffer, lParam, buffer.length () * TCHAR.sizeof);", "+\t\t\t\tString string = buffer.toString (0, length);", "+\t\t\t\tEvent event = getSegments (string);", "+\t\t\t\tif (event != null && event.segments != null) {", "+\t\t\t\t\tbuffer = new TCHAR (getCodePage (), getSegmentsText (string, event), true);", "+\t\t\t\t\tlong /*int*/ hHeap = OS.GetProcessHeap ();", "+\t\t\t\t\tlength = buffer.length() * TCHAR.sizeof;", "+\t\t\t\t\tlong /*int*/ pszText = OS.HeapAlloc (hHeap, OS.HEAP_ZERO_MEMORY, length);", "+\t\t\t\t\tOS.MoveMemory (pszText, buffer, length); ", "+\t\t\t\t\tcode = super.windowProc (hwnd, msg, wParam, pszText);", "+\t\t\t\t\tOS.HeapFree (hHeap, 0, pszText);", "+\t\t\t\t}", "+\t\t\t\tif (msg == OS.CB_ADDSTRING || msg == OS.CB_INSERTSTRING) {", "+\t\t\t\t\tint index = msg == OS.CB_ADDSTRING ? items.length : (int)/*64*/ wParam;", "+\t\t\t\t\tString [] newItems = new String [items.length + 1];", "+\t\t\t\t\tSystem.arraycopy (items, 0, newItems, 0, index);", "+\t\t\t\t\tnewItems [index] = string;", "+\t\t\t\t\tSystem.arraycopy (items, index, newItems, index + 1, items.length - index);", "+\t\t\t\t\titems = newItems;", "+\t\t\t\t}", "+\t\t\t\tif (code != OS.CB_ERR && code != OS.CB_ERRSPACE) return code;", "+\t\t\t}", "+\t\t\tbreak;", "+\t\tcase OS.CB_DELETESTRING: {", "+\t\t\tif (hooks (SWT.Segments) || filters (SWT.Segments)) {", "+\t\t\t\tlong /*int*/ code = super.windowProc (hwnd, msg, wParam, lParam);", "+\t\t\t\tif (code != OS.CB_ERR && code != OS.CB_ERRSPACE) {", "+\t\t\t\t\tint index = (int)/*64*/ wParam;", "+\t\t\t\t\tString [] newItems = new String [items.length - 1];", "+\t\t\t\t\tSystem.arraycopy (items, 0, newItems, 0, index);", "+\t\t\t\t\tSystem.arraycopy (items, index + 1, newItems, index, items.length - index - 1);", "+\t\t\t\t\titems = newItems;", "+\t\t\t\t\tif (!noSelection) {", "+\t\t\t\t\t\tindex = (int)/*64*/OS.SendMessage (handle, OS.CB_GETCURSEL, 0, 0);", "+\t\t\t\t\t\tif (index == wParam) {", "+\t\t\t\t\t\t\tclearSegments (false);", "+\t\t\t\t\t\t\tapplyEditSegments ();", "+\t\t\t\t\t\t}", "+\t\t\t\t\t}", "+\t\t\t\t}", "+\t\t\t\treturn code;", "+\t\t\t}", "+\t\t\tbreak;", "+\t\t}", "+\t\tcase OS.CB_RESETCONTENT: {", "+\t\t\tif (hooks (SWT.Segments) || filters (SWT.Segments)) {", "+\t\t\t\tif (items.length > 0) items = new String [0];", "+\t\t\t\tclearSegments (false);", "+\t\t\t\tapplyEditSegments ();", "+\t\t\t}", "+\t\t\tbreak;"]}], "num": 51530}