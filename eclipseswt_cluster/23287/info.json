{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "8c7847bef9023c117aaf329a56041ff0", "detectedBy": ["DIFF_HIERARCHICAL"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "9fc6b10df0492c93dc4dcfc91f9eeddf", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Custom Widgets/common/org/eclipse/swt/custom/StyledText.java", "commitBeforeChange": "635a9e5d0a5f495ec272194dbb750eddc745876f", "commitAfterChange": "e83d77b7ddccf5500d06ea30a64ce0d090ac4b10", "methodNumberBeforeChange": 330, "methodNumberAfterChange": 189, "signatureBeforeChange": " void internalRedraw()", "signatureAfterChange": " void internalRedrawRange(int start, int length)", "diff": ["- */", "-void internalRedraw() {", "-\tsuper.redraw();", "+void internalRedrawRange(int start, int length) {", "+\tif (length <= 0) return;", "+\tint end = start + length - 1;", "+\tint partialTopIndex = getPartialTopIndex();", "+\tint lineOffset = content.getOffsetAtLine(firstLine);", "+\t\tstart = lineOffset;", "+\tif (partialBottomIndex < lastLine) {", "+\t\tlastLine = partialBottomIndex;", "+\t\tend = content.getOffsetAtLine(lastLine) + content.getLine(lastLine).length();", "+\tRectangle clientArea = getClientArea();", "+\tboolean fullSelection = (getStyle() & SWT.FULL_SELECTION) != 0;", "+\t//redraw first line from start to end", "+\tTextLayout layout = renderer.getTextLayout(firstLine);", "+\tRectangle rect = layout.getBounds(start - lineOffset, end - lineOffset);", "+\trect.x += leftMargin - horizontalScrollOffset;", "+\trect.y += getLinePixel(firstLine);", "+\tif (end - lineOffset >= layout.getText().length()) {", "+\t\tif (fullSelection) {", "+\t\t\trect.width = clientArea.width;", "+\t\t} else {", "+\t\t\trect.width += renderer.getLineEndSpace();", "+\t\t}", "+\t} else {", "+\t\tif (wordWrap && fullSelection) {", "+\t\t\tif (layout.getLineIndex(start - lineOffset) != layout.getLineIndex(end - lineOffset)) {", "+\t\t\t\trect.width = clientArea.width;", "+\t\t\t}", "+\t\t}", "+\trenderer.disposeTextLayout(layout);", "+\t//emtpy lines can have no height", "+\tif (rect.height == 0) rect.height = renderer.getLineHeight();", "+\tsuper.redraw(rect.x, rect.y, rect.width, rect.height, false);", "+\tint lineCount = lastLine - firstLine + 1;", "+\tif (lineCount > 1) {", "+\t\t// redraw center lines completely", "+\t\tint lastLineY = getLinePixel(lastLine);", "+\t\tif (lineCount > 2) {", "+\t\t\trect.y += rect.height;", "+\t\t\tsuper.redraw(0, rect.y, clientArea.width, lastLineY - rect.y, false);", "+\t\t}", "+", "+\t\t// redraw last line from zero to end", "+\t\tlayout = renderer.getTextLayout(lastLine);", "+\t\tlineOffset = content.getOffsetAtLine(lastLine);", "+\t\trect = layout.getBounds(0, end - lineOffset);", "+\t\trect.x += leftMargin - horizontalScrollOffset;", "+\t\trect.y += lastLineY;", "+\t\tif (end - lineOffset >= layout.getText().length()) {", "+\t\t\tif (fullSelection) {", "+\t\t\t\trect.width = clientArea.width;", "+\t\t\t} else {", "+\t\t\t\trect.width += renderer.getLineEndSpace();", "+\t\t\t}", "+\t\t} else {", "+\t\t\tif (wordWrap && fullSelection) {", "+\t\t\t\tif (0 != layout.getLineIndex(end - lineOffset)) {", "+\t\t\t\t\trect.width = clientArea.width;", "+\t\t\t\t}", "+\t\t\t}", "+\t\t}", "+\t\trenderer.disposeTextLayout(layout);", "+//\t\temtpy lines can have no height", "+\t\tif (rect.height == 0) rect.height = renderer.getLineHeight();", "+\t\tsuper.redraw(rect.x, rect.y, rect.width, rect.height, false);", "+\t}"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "4125eed05699795722987fb260ec3e5a", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Custom Widgets/common/org/eclipse/swt/custom/StyledText.java", "commitBeforeChange": "5544ce1d748561f71c4f1d1997c431f82e5c4c86", "commitAfterChange": "24e0049851c0d0a09cb9f25e5892d112e2936fed", "methodNumberBeforeChange": 251, "methodNumberAfterChange": 244, "signatureBeforeChange": " void redrawLines(int firstLine, int offsetInFirstLine, int lastLine, int endOffset, boolean clearBackground)", "signatureAfterChange": " void redrawLines(int firstLine, int offsetInFirstLine, int lastLine, int endOffset, boolean clearBackground)", "diff": ["-\tint redrawX = getXAtOffset(line, firstLine, offsetInFirstLine) - leftMargin;", "-\tint redrawStopX;", "-\tint redrawY = firstLine * lineHeight - verticalScrollOffset;", "+\tint redrawY, redrawWidth;", "-\tboolean fullLineRedraw = ((getStyle() & SWT.FULL_SELECTION) != 0 && lastLine > firstLine);", "-", "+\tboolean fullLineRedraw;", "+\tStyledTextEvent event;", "+\tRectangle clientArea = getClientArea();", "+\t", "+\tfullLineRedraw = ((getStyle() & SWT.FULL_SELECTION) != 0 && lastLine > firstLine);", "-\t}", "-\t// calculate redraw stop location", "-\tif (fullLineRedraw) {", "-\t\tredrawStopX = getClientArea().width - leftMargin;", "-\t}", "-\telse {", "-\t\tredrawStopX = getXAtOffset(line, firstLine, endOffset - firstLineOffset) - leftMargin;", "-\t}", "-\tdraw(redrawX, redrawY, redrawStopX - redrawX, lineHeight, clearBackground);", "+\t}\t", "+\tevent = renderer.getLineStyleData(firstLineOffset, line);", "+\tTextLayout layout = renderer.getTextLayout(line, firstLineOffset, event);", "+\tRectangle rect = layout.getBounds(offsetInFirstLine, Math.min(endOffset, line.length()) - 1);", "+\trenderer.disposeTextLayout(layout, event);", "+\trect.x -= horizontalScrollOffset;", "+\trect.intersect(clientArea);", "+\tredrawY = firstLine * lineHeight - verticalScrollOffset;", "+\tredrawWidth = fullLineRedraw ? clientArea.width - leftMargin - rightMargin : rect.width;", "+\tdraw(rect.x, redrawY, redrawWidth, lineHeight, clearBackground);", "+\t", "-\t\t\tif (fullLineRedraw) {", "-\t\t\t\tredrawStopX = getClientArea().width - leftMargin;", "-\t\t\t}", "-\t\t\telse {", "-\t\t\t\tredrawStopX = getXAtOffset(line, lastLine, offsetInLastLine) - leftMargin;", "-\t\t\t}", "+\t\t\tline = content.getLine(lastLine);", "+\t\t\tevent = renderer.getLineStyleData(offsetInLastLine, line);", "+\t\t\tlayout = renderer.getTextLayout(line, endOffset, event);", "+\t\t\trect = layout.getBounds(0, offsetInLastLine - 1);", "+\t\t\trenderer.disposeTextLayout(layout, event);", "+\t\t\trect.x -= horizontalScrollOffset;", "+\t\t\trect.intersect(clientArea);", "-\t\t\tdraw(0, redrawY, redrawStopX, lineHeight, clearBackground);", "+\t\t\tredrawWidth = fullLineRedraw ? clientArea.width - leftMargin - rightMargin : rect.width;", "+\t\t\tdraw(rect.x, redrawY, redrawWidth, lineHeight, clearBackground);"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "67e70e675c8d85ec2198db5239ac2c38", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Custom Widgets/common/org/eclipse/swt/custom/StyledText.java", "commitBeforeChange": "635a9e5d0a5f495ec272194dbb750eddc745876f", "commitAfterChange": "e83d77b7ddccf5500d06ea30a64ce0d090ac4b10", "methodNumberBeforeChange": 377, "methodNumberAfterChange": 234, "signatureBeforeChange": " void redrawLines(int firstLine, int offsetInFirstLine, int lastLine, int endOffset, boolean clearBackground)", "signatureAfterChange": " void redrawLines(int startLine, int lineCount)", "diff": ["- */", "-void redrawLines(int firstLine, int offsetInFirstLine, int lastLine, int endOffset, boolean clearBackground) {", "-\tString line = content.getLine(firstLine);", "-\tint lineCount = lastLine - firstLine + 1;", "-\tint redrawY, redrawWidth;", "-\tint lineOffset = content.getOffsetAtLine(firstLine);", "-\tboolean fullLineRedraw;", "-\tRectangle clientArea = getClientArea();", "-\t", "-\tfullLineRedraw = ((getStyle() & SWT.FULL_SELECTION) != 0 && lastLine > firstLine);", "-\t// if redraw range includes last character on the first line, ", "-\t// clear background to right widget border. fixes bug 19595.", "-\tif (clearBackground && endOffset - lineOffset >= line.length()) {", "-\t\tfullLineRedraw = true;", "-\t}\t", "-\tTextLayout layout = renderer.getTextLayout(line, lineOffset);", "-\tRectangle rect = layout.getBounds(offsetInFirstLine, Math.min(endOffset, line.length()) - 1);", "-\trenderer.disposeTextLayout(layout);", "-\trect.x -= horizontalScrollOffset;", "-\trect.intersect(clientArea);", "-\tredrawY = firstLine * lineHeight - verticalScrollOffset;", "-\tredrawWidth = fullLineRedraw ? clientArea.width - leftMargin - rightMargin : rect.width;", "-\tdraw(rect.x, redrawY, redrawWidth, lineHeight, clearBackground);", "-\t", "-\t// redraw last line if more than one line needs redrawing ", "-\tif (lineCount > 1) {", "-\t\tlineOffset = content.getOffsetAtLine(lastLine);", "-\t\tint offsetInLastLine = endOffset - lineOffset;\t", "-\t\t// no redraw necessary if redraw offset is 0", "-\t\tif (offsetInLastLine > 0) {", "-\t\t\tline = content.getLine(lastLine);", "-\t\t\t// if redraw range includes last character on the last line, ", "-\t\t\t// clear background to right widget border. fixes bug 19595.", "-\t\t\tif (clearBackground && offsetInLastLine >= line.length()) {", "-\t\t\t\tfullLineRedraw = true;", "-\t\t\t}", "-\t\t\tline = content.getLine(lastLine);", "-\t\t\tlayout = renderer.getTextLayout(line, lineOffset);", "-\t\t\trect = layout.getBounds(0, offsetInLastLine - 1);", "-\t\t\trenderer.disposeTextLayout(layout);", "-\t\t\trect.x -= horizontalScrollOffset;", "-\t\t\trect.intersect(clientArea);", "-\t\t\tredrawY = lastLine * lineHeight - verticalScrollOffset;", "-\t\t\tredrawWidth = fullLineRedraw ? clientArea.width - leftMargin - rightMargin : rect.width;", "-\t\t\tdraw(rect.x, redrawY, redrawWidth, lineHeight, clearBackground);", "-\t\t}", "+void redrawLines(int startLine, int lineCount) {", "+\t// do nothing if redraw range is completely invisible\t", "+\tint partialBottomIndex = getPartialBottomIndex();", "+\tif (startLine > partialBottomIndex || startLine + lineCount - 1 < topIndex) {", "+\t\treturn;", "-}", "+\t// only redraw visible lines", "+\tif (startLine < topIndex) {", "+\t\tlineCount -= topIndex - startLine;", "+\t\tstartLine = topIndex;", "+\tif (startLine + lineCount - 1 > partialBottomIndex) {", "+\t\tlineCount = partialBottomIndex - startLine + 1;", "+\tstartLine -= topIndex;", "+\tint redrawTop = getLinePixel(startLine);", "+\tint redrawBottom = getLinePixel(startLine + lineCount);", "+\tint redrawWidth = getClientArea().width - leftMargin - rightMargin; ", "+\tsuper.redraw(leftMargin, redrawTop, redrawWidth, redrawBottom - redrawTop, true);"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "7a127637346e49dbda6dd9f3f8a340f7", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Custom Widgets/common/org/eclipse/swt/custom/StyledText2.java", "commitBeforeChange": "60a9b0215b046632b51b65b9dcf0569516e0686e", "commitAfterChange": "610b674161bbe6c03029856ff3ee4570430b9973", "methodNumberBeforeChange": 188, "methodNumberAfterChange": 191, "signatureBeforeChange": " void internalRedrawRange(int start, int length, boolean clearBackground)", "signatureAfterChange": " void internalRedrawRange(int start, int length, boolean clearBackground)", "diff": ["-\tint offsetInFirstLine;", "-\tint partialTopIndex = getLineIndex(0);", "+\tint partialTopIndex = getPartialTopIndex();", "+\tint offsetInFirstLine;", "-\tredrawLines(firstLine, offsetInFirstLine, lastLine, end, clearBackground);", "+\t\t", "+\t// redraw the first line", "+\tString line = content.getLine(firstLine);", "+\tint lineOffset = content.getOffsetAtLine(firstLine);", "+\tboolean fullLineRedraw = (getStyle() & SWT.FULL_SELECTION) != 0 && lastLine > firstLine;", "+\tRectangle clientArea = getClientArea();", "+\tRectangle rect;", "+\tint lineLength = line.length(); ", "+\tif (lineLength > 0) {", "+\t\tTextLayout layout = renderer.getTextLayout(line, lineOffset);\t\t", "+\t\trect = layout.getBounds(offsetInFirstLine, end - lineOffset - 1);", "+\t\tlineLength = Math.max(0, layout.getLineOffsets()[layout.getLineIndex(offsetInFirstLine) + 1] - 1);", "+\t\trenderer.disposeTextLayout(layout);", "+\t} else {", "+\t\trect = new Rectangle(0, 0, renderer.getLineEndSpace(), lineHeight);", "+\t}", "+\t// if redraw range includes last character on the first line, ", "+\t// clear background to right widget border. fixes bug 19595.", "+\tif (clearBackground && end - lineOffset >= lineLength) {", "+\t\tfullLineRedraw = true;", "+\t}", "+\trect.x += leftMargin - horizontalScrollOffset;", "+\trect.y += getLinePixel(firstLine);", "+\tif (fullLineRedraw) rect.width = clientArea.width - leftMargin - rightMargin;\t", "+\tif (clearBackground) {", "+\t\tsuper.redraw(rect.x, rect.y, rect.width, rect.height, false);", "+\t} else {", "+\t\tdraw(rect.x, rect.y, rect.width, rect.height);", "+\t}", "-\t// redraw entire center lines if redraw range includes more than two lines", "-\tif (lastLine - firstLine > 1) {", "-\t\tRectangle clientArea = getClientArea();", "-\t\tint redrawY = getLinePixel(firstLine);", "-\t\tredrawY += lineCache.getLineHeight(firstLine);", "-\t\tint redrawStopY = getLinePixel(lastLine);\t", "-\t\tdraw(0, redrawY, clientArea.width, redrawStopY - redrawY, clearBackground);", "+\tint lineCount = lastLine - firstLine + 1;", "+\tif (lineCount > 1) {", "+\t\tint lastLineTop = getLinePixel(lastLine);", "+\t\t", "+\t\t// redraw center lines", "+\t\tif (lineCount > 2) {", "+\t\t\trect.y += rect.height;", "+\t\t\tif (clearBackground) {", "+\t\t\t\tsuper.redraw(0, rect.y, clientArea.width, lastLineTop - rect.y, false);", "+\t\t\t} else {", "+\t\t\t\tdraw(0, rect.y, clientArea.width, lastLineTop - rect.y);", "+\t\t\t}", "+\t\t}", "+", "+\t\t// redraw last line ", "+\t\tlineOffset = content.getOffsetAtLine(lastLine);", "+\t\tint offsetInLastLine = end - lineOffset;\t", "+\t\t// no redraw necessary if redraw offset is 0", "+\t\tif (offsetInLastLine > 0) {", "+\t\t\tline = content.getLine(lastLine);", "+\t\t\tlineLength = line.length();", "+\t\t\tif (lineLength > 0) {", "+\t\t\t\tTextLayout layout = renderer.getTextLayout(line, lineOffset);\t\t", "+\t\t\t\trect = layout.getBounds(0, offsetInLastLine - 1);", "+\t\t\t\trenderer.disposeTextLayout(layout);", "+\t\t\t} else {", "+\t\t\t\trect = new Rectangle(0, 0, renderer.getLineEndSpace(), lineHeight);", "+\t\t\t}", "+\t\t\t// if redraw range includes last character on the last line, ", "+\t\t\t// clear background to right widget border. fixes bug 19595.", "+\t\t\tif (clearBackground && offsetInLastLine >= lineLength) {", "+\t\t\t\tfullLineRedraw = true;", "+\t\t\t}", "+\t\t\trect.x += leftMargin - horizontalScrollOffset;", "+\t\t\trect.y += lastLineTop;", "+\t\t\tif (fullLineRedraw) rect.width = clientArea.width - leftMargin - rightMargin;", "+\t\t\tif (clearBackground) {", "+\t\t\t\tsuper.redraw(rect.x, rect.y, rect.width, rect.height, false);", "+\t\t\t} else {", "+\t\t\t\tdraw(rect.x, rect.y, rect.width, rect.height);", "+\t\t\t}", "+\t\t}"]}], "num": 23287}