{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "16a8fbf769ea4bb878d04590115afd84", "detectedBy": ["AST_HIERARCHICAL", "AST_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "21f1756768196727787cdb83c271c808", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Drag and Drop/motif/org/eclipse/swt/dnd/Clipboard.java", "commitBeforeChange": "147d1615f621339f30d0227193f0b040907c9480", "commitAfterChange": "4f94a8e41c5f58fd8cc31f50891f992413c14d7f", "methodNumberBeforeChange": 4, "methodNumberAfterChange": 4, "signatureBeforeChange": " public void setContents(Object[] data, Transfer[] dataTypes)", "signatureAfterChange": " public void setContents(Object[] data, Transfer[] dataTypes)", "diff": ["-\tif (xDisplay == 0)", "-\t\tDND.error(DND.ERROR_CANNOT_SET_CLIPBOARD);", "+\tif (xDisplay == 0) DND.error(DND.ERROR_CANNOT_SET_CLIPBOARD);", "-\tif (xWindow == 0)", "-\t\tDND.error(DND.ERROR_CANNOT_SET_CLIPBOARD);", "-\t\t", "+\tif (xWindow == 0) DND.error(DND.ERROR_CANNOT_SET_CLIPBOARD);\t", "-\tint retries = 0;", "-\tint status = OS.XmClipboardStartCopy(xDisplay, xWindow, 0, OS.XtLastTimestampProcessed(xDisplay), shellHandle, 0, item_id);", "-\twhile ( status == OS.XmClipboardLocked && retries < MAX_RETRIES) {", "-\t\tretries ++;", "-\t\tstatus = OS.XmClipboardStartCopy(xDisplay, xWindow, 0, OS.XtLastTimestampProcessed(xDisplay), shellHandle, 0, item_id);", "-\t};", "-\tif (status != OS.XmClipboardSuccess)", "+\tif (OS.XmClipboardStartCopy(xDisplay, xWindow, 0, OS.XtLastTimestampProcessed(xDisplay), shellHandle, 0, item_id) != OS.XmClipboardSuccess){", "-\t", "-\t// copy data directly over to System clipboard (not deferred)", "-\tfor (int i = 0; i < dataTypes.length; i++) {", "-\t\tint[] ids = dataTypes[i].getTypeIds();", "-\t\tString[] names = dataTypes[i].getTypeNames();", "-\t\tfor (int j = 0; j < names.length; j++) {", "-\t\t\tTransferData transferData = new TransferData();", "-\t\t\t/* Use the character encoding for the default locale */", "-\t\t\ttransferData.type = ids[j];", "-\t\t\tdataTypes[i].javaToNative(data[i], transferData);", "-\t\t\tstatus = OS.XmClipboardFail;", "-\t\t\tif (transferData.result == 1) {", "-\t\t\t\tif (transferData.format == 8){", "+\t}", "+\ttry {", "+\t\t// copy data directly over to System clipboard (not deferred)", "+\t\tfor (int i = 0; i < dataTypes.length; i++) {", "+\t\t\tint[] ids = dataTypes[i].getTypeIds();", "+\t\t\tString[] names = dataTypes[i].getTypeNames();", "+\t\t\tfor (int j = 0; j < names.length; j++) {", "+\t\t\t\tTransferData transferData = new TransferData();", "+\t\t\t\ttransferData.type = ids[j];", "+\t\t\t\tdataTypes[i].javaToNative(data[i], transferData);", "+\t\t\t\tif (transferData.result != 1) DND.error(DND.ERROR_CANNOT_SET_CLIPBOARD);", "+\t\t\t\ttry {", "+\t\t\t\t\tif (transferData.format != 8) DND.error(DND.ERROR_CANNOT_SET_CLIPBOARD);", "-\t\t\t\t\tstatus = OS.XmClipboardCopy(xDisplay, xWindow, item_id[0], bName, buffer, transferData.length, 0, null);", "+\t\t\t\t\tif (OS.XmClipboardCopy(xDisplay, xWindow, item_id[0], bName, buffer, transferData.length, 0, null) != OS.XmClipboardSuccess) {", "+\t\t\t\t\t\tDND.error(DND.ERROR_CANNOT_SET_CLIPBOARD);", "+\t\t\t\t\t}", "+\t\t\t\t} finally {", "+\t\t\t\t\tOS.XtFree(transferData.pValue);", "-\t\t\t// Clean up allocated memory", "-\t\t\tif (transferData.pValue != 0) {", "-\t\t\t\tOS.XtFree(transferData.pValue);", "-\t\t\t}", "+\t} finally {", "+\t\t// close clipboard  for setting", "+\t\tOS.XmClipboardEndCopy(xDisplay, xWindow, item_id[0]);", "-\t", "-\t// close clipboard  for setting", "-\tOS.XmClipboardEndCopy(xDisplay, xWindow, item_id[0]);", "-\t", "-\tif (status != OS.XmClipboardSuccess)", "-\t\tDND.error(DND.ERROR_CANNOT_SET_CLIPBOARD);", "-\t"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "530c4ad025df88c6da79b0fa8d7ea354", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Drag and Drop/motif/org/eclipse/swt/dnd/Clipboard.java", "commitBeforeChange": "147d1615f621339f30d0227193f0b040907c9480", "commitAfterChange": "4f94a8e41c5f58fd8cc31f50891f992413c14d7f", "methodNumberBeforeChange": 3, "methodNumberAfterChange": 3, "signatureBeforeChange": " public Object getContents(Transfer transfer)", "signatureAfterChange": " public Object getContents(Transfer transfer)", "diff": ["-\tint retries = 0;", "-\tint status = OS.XmClipboardStartRetrieve(xDisplay, xWindow, OS.XtLastTimestampProcessed(xDisplay));", "-\twhile ( status == OS.XmClipboardLocked && retries < MAX_RETRIES) {", "-\t\tretries ++;", "-\t\tstatus = OS.XmClipboardStartRetrieve(xDisplay, xWindow, OS.XtLastTimestampProcessed(xDisplay));", "-\t};", "-\tif (status != OS.XmClipboardSuccess) return null;", "-\t", "-\t// Does Clipboard have data in required format?", "-\tbyte[] type = null;", "-\tint[] length = new int[1];", "-\tString[] supportedTypes = transfer.getTypeNames();", "-\tfor (int i = 0; i < supportedTypes.length; i++) {", "-\t\tbyte[] bName = Converter.wcsToMbcs(null, supportedTypes[i], true);", "-\t\tif (OS.XmClipboardInquireLength(xDisplay, xWindow, bName, length) == 1 /*OS.XmClipboardSuccess*/ ) {", "-\t\t\ttype = bName;", "-\t\t\tbreak;", "-\t\t}", "-\t}", "-\t", "-\t// Retrieve data from Clipboard", "+\tif (OS.XmClipboardStartRetrieve(xDisplay, xWindow, OS.XtLastTimestampProcessed(xDisplay)) != OS.XmClipboardSuccess) return null;", "-\tif (type != null) {", "-\t\tdata = new byte[length[0]];", "-\t\tstatus = OS.XmClipboardRetrieve(xDisplay, xWindow, type, data, length[0], new int[1], new int[1]);", "-\t\tif (status != OS.XmClipboardSuccess) {", "-\t\t\tdata = null;", "+\tbyte[] type = null;", "+\ttry {", "+\t\t// Does Clipboard have data in required format?", "+\t\tint[] length = new int[1];", "+\t\tString[] supportedTypes = transfer.getTypeNames();", "+\t\tfor (int i = 0; i < supportedTypes.length; i++) {", "+\t\t\tbyte[] bName = Converter.wcsToMbcs(null, supportedTypes[i], true);", "+\t\t\tif (OS.XmClipboardInquireLength(xDisplay, xWindow, bName, length) == OS.XmClipboardSuccess) {", "+\t\t\t\ttype = bName;", "+\t\t\t\tbreak;", "+\t\t\t}", "+\t\t// Retrieve data from Clipboard", "+\t\tif (type == null) return null;", "+\t\tdata = new byte[length[0]];", "+\t\tif (OS.XmClipboardRetrieve(xDisplay, xWindow, type, data, length[0], new int[1], new int[1]) != OS.XmClipboardSuccess) {", "+\t\t\treturn null;", "+\t\t}", "+\t} finally {", "+\t\t// Close Clipboard", "+\t\tOS.XmClipboardEndRetrieve(xDisplay, xWindow);", "-\t// Close Clipboard", "-\tstatus = OS.XmClipboardEndRetrieve(xDisplay, xWindow);", "-\t", "-\tif (data == null) return null;", "-", "-\tTransferData transferData = new TransferData();", "-\t/* Use the character encoding for the default locale */", "-\ttransferData.type = OS.XmInternAtom (xDisplay, type, true);", "-\ttransferData.pValue = OS.XtMalloc(data.length);", "-\tOS.memmove(transferData.pValue, data, data.length);", "-\ttransferData.length = data.length;", "-\ttransferData.format = 8;", "-\ttransferData.result = 1;", "-\t", "-\tObject result = transfer.nativeToJava(transferData);", "-\t", "-\t// Clean up allocated memory", "-\tOS.XtFree(transferData.pValue);", "-\t", "-\treturn result;", "+\tint pValue = OS.XtMalloc(data.length);", "+\tif (pValue == 0) return null;", "+\ttry {", "+\t\tOS.memmove(pValue, data, data.length);", "+\t\tTransferData transferData = new TransferData();", "+\t\ttransferData.type = OS.XmInternAtom (xDisplay, type, true);", "+\t\ttransferData.length = data.length;", "+\t\ttransferData.format = 8;", "+\t\ttransferData.pValue = pValue;", "+\t\ttransferData.result = 1;", "+\t\treturn transfer.nativeToJava(transferData);", "+\t} finally {", "+\t\t// Clean up allocated memory", "+\t\tOS.XtFree(pValue);", "+\t}"]}], "num": 23750}