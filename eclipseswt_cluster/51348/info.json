{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "38361203398f153029501c333a072f13", "detectedBy": ["DIFF_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "a7c31b4679672d140725f460c4179a93", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT/carbon/org/eclipse/swt/widgets/MenuItem.java", "commitBeforeChange": "6d149cea8448c374e850448d1db5d08377d92850", "commitAfterChange": "56fed3385518b20c64346b78a2691795f28c0e47", "methodNumberBeforeChange": 23, "methodNumberAfterChange": 23, "signatureBeforeChange": " public void setMenu (Menu menu)", "signatureAfterChange": " public void setMenu (Menu menu)", "diff": ["-\t/* Assign the new menu in the OS */", "+\tif (parent == null) {", "+\t\tSystem.out.println(\"MenuItem.setMenu: parent == null\");", "+\t\treturn;", "+\t}", "-\t/*", "-\t* Feature in Windows.  When SetMenuItemInfo () is used to", "-\t* set a submenu and the menu item already has a submenu,", "-\t* Windows destroys the previous menu.  This is undocumented", "-\t* and unexpected but not necessarily wrong.  The fix is to", "-\t* remove the item with RemoveMenu () which does not destroy", "-\t* the submenu and then insert the item with InsertMenuItem ().", "-\t*/", "+\t/* Assign the new menu in the OS */", "-\t/* AW", "-\tMENUITEMINFO info = new MENUITEMINFO ();", "-\tinfo.cbSize = MENUITEMINFO.sizeof;", "-\tinfo.fMask = OS.MIIM_ID;", "-\tint index = 0;", "-\twhile (OS.GetMenuItemInfo (hMenu, index, true, info)) {", "-\t\tif (info.wID == id) break;", "-\t\tindex++;", "-\t}", "-\tif (info.wID != id) return;", "-\tint cch = 128;", "-\tint hHeap = OS.GetProcessHeap ();", "-\tint byteCount = cch * TCHAR.sizeof;", "-\tint pszText = OS.HeapAlloc (hHeap, OS.HEAP_ZERO_MEMORY, byteCount);", "-\tinfo.fMask = OS.MIIM_STATE | OS.MIIM_ID | OS.MIIM_TYPE;", "-\tinfo.dwTypeData = pszText;", "-\tinfo.cch = cch;", "-\tboolean success = OS.GetMenuItemInfo (hMenu, index, true, info);", "+\tint newMenuHandle= 0;", "-\t\tmenu.cascade = this; ", "-\t\tinfo.fMask |= OS.MIIM_SUBMENU;", "-\t\tinfo.hSubMenu = menu.handle;", "+\t\tmenu.cascade = this;", "+\t\tnewMenuHandle= menu.handle;", "-\tOS.RemoveMenu (hMenu, index, OS.MF_BYPOSITION);", "-\tif (OS.IsWinCE) {", "-\t\tsuccess = OS.InsertMenu (hMenu, index, OS.MF_BYPOSITION, id, null); ", "-\t\tif (success) success = OS.SetMenuItemInfo (hMenu, index, true, info);", "-\t} else {", "-\t\tsuccess = OS.InsertMenuItem (hMenu, index, true, info);", "-\t}", "-\tif (pszText != 0) OS.HeapFree (hHeap, 0, pszText);", "-\tif (!success) error (SWT.ERROR_CANNOT_SET_MENU);", "-\tparent.destroyAcceleratorTable ();", "-\t*/", "-\t\tOS.SetMenuItemHierarchicalMenu(hMenu, index[0], menu.handle);", "-\t\t// we set the menu's title to the item's title", "-\t\tint sHandle= 0;", "-\t\ttry {", "-\t\t\tsHandle= OS.CFStringCreateWithCharacters(removeMnemonicsAndShortcut(getText()));", "-\t\t\tOS.SetMenuTitleWithCFString(menu.handle, sHandle);", "-\t\t} finally {", "-\t\t\tif (sHandle != 0)", "-\t\t\t\tOS.CFRelease(sHandle);", "-\t\t}", "+\t\tif (OS.SetMenuItemHierarchicalMenu(hMenu, index[0], newMenuHandle) == OS.kNoErr) {", "+\t\t\tif (menu != null) {", "+\t\t\t\t// we set the menu's title to the item's title", "+\t\t\t\tint sHandle= 0;", "+\t\t\t\ttry {", "+\t\t\t\t\tsHandle= OS.CFStringCreateWithCharacters(removeMnemonicsAndShortcut(getText()));", "+\t\t\t\t\tOS.SetMenuTitleWithCFString(menu.handle, sHandle);", "+\t\t\t\t} finally {", "+\t\t\t\t\tif (sHandle != 0)", "+\t\t\t\t\t\tOS.CFRelease(sHandle);", "+\t\t\t\t}", "+\t\t\t}", "+\t\t} else", "+\t\t\terror (SWT.ERROR_CANNOT_SET_MENU);", "+\t", "+\tparent.destroyAcceleratorTable ();"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "99e58c826c4175373583b6abc49c6a96", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT/win32/org/eclipse/swt/widgets/MenuItem.java", "commitBeforeChange": "3619e05678dc1ff8c0482f066150e6e0bbd77bcf", "commitAfterChange": "443e66e6e7f734ef4a3874238f6ed709ca15a64b", "methodNumberBeforeChange": 32, "methodNumberAfterChange": 31, "signatureBeforeChange": "  void setMenu (Menu menu, boolean dispose)", "signatureAfterChange": "  void setMenu (Menu menu, boolean dispose)", "diff": ["-\t\t/*", "-\t\t* Feature in Windows.  When SetMenuItemInfo () is used to", "-\t\t* set a submenu and the menu item already has a submenu,", "-\t\t* Windows destroys the previous menu.  This is undocumented", "-\t\t* and unexpected but not necessarily wrong.  The fix is to", "-\t\t* remove the item with RemoveMenu () which does not destroy", "-\t\t* the submenu and then insert the item with InsertMenuItem ().", "-\t\t*/", "-\t\tboolean restoreBitmap = false, success = false;", "-\t\t", "+\t\tint cch = 128;", "+\t\tint /*long*/ hHeap = OS.GetProcessHeap ();", "+\t\tint byteCount = cch * TCHAR.sizeof;", "+\t\tint /*long*/ pszText = OS.HeapAlloc (hHeap, OS.HEAP_ZERO_MEMORY, byteCount);", "+\t\tinfo.fMask = OS.MIIM_STATE | OS.MIIM_ID | OS.MIIM_DATA;", "-\t\t* The fix is to temporarily remove the bitmap and restore it after", "-\t\t* the text and submenu have been set.", "+\t\t* The fix is use MIIM_BITMAP and MIIM_STRING.", "-\t\t\tinfo.fMask = OS.MIIM_BITMAP;", "-\t\t\tOS.GetMenuItemInfo (hMenu, index, true, info);", "-\t\t\trestoreBitmap = info.hbmpItem != 0 || parent.foreground != -1;", "-\t\t\tif (restoreBitmap) {", "-\t\t\t\tinfo.hbmpItem = 0;", "-\t\t\t\tsuccess = OS.SetMenuItemInfo (hMenu, id, false, info);", "-\t\t\t}", "+\t\t\tinfo.fMask |= OS.MIIM_BITMAP | OS.MIIM_STRING;", "+\t\t} else {", "+\t\t\tinfo.fMask |= OS.MIIM_TYPE;", "-\t\t", "-\t\tint cch = 128;", "-\t\tint /*long*/ hHeap = OS.GetProcessHeap ();", "-\t\tint byteCount = cch * TCHAR.sizeof;", "-\t\tint /*long*/ pszText = OS.HeapAlloc (hHeap, OS.HEAP_ZERO_MEMORY, byteCount);", "-\t\tinfo.fMask = OS.MIIM_STATE | OS.MIIM_ID | OS.MIIM_TYPE | OS.MIIM_DATA;", "-\t\tsuccess = OS.GetMenuItemInfo (hMenu, index, true, info);", "+\t\tboolean success = OS.GetMenuItemInfo (hMenu, index, true, info);", "+\t\t\t\t/*", "+\t\t\t\t* Feature in Windows.  When SetMenuItemInfo () is used to", "+\t\t\t\t* set a submenu and the menu item already has a submenu,", "+\t\t\t\t* Windows destroys the previous menu.  This is undocumented", "+\t\t\t\t* and unexpected but not necessarily wrong.  The fix is to", "+\t\t\t\t* remove the item with RemoveMenu () which does not destroy", "+\t\t\t\t* the submenu and then insert the item with InsertMenuItem ().", "+\t\t\t\t*/", "-\t\t\t}", "-\t\t\t/*", "-\t\t\t* Restore the bitmap that was removed to work around a problem", "-\t\t\t* in GetMenuItemInfo() and menu items that have bitmaps set with", "-\t\t\t* MIIM_BITMAP.", "-\t\t\t*/", "-\t\t\tif (OS.WIN32_VERSION >= OS.VERSION (4, 10)) {", "-\t\t\t\tif (restoreBitmap) {", "-\t\t\t\t\tinfo.fMask = OS.MIIM_BITMAP;", "-\t\t\t\t\tif (parent.foreground != -1) {", "-\t\t\t\t\t\tinfo.hbmpItem = OS.HBMMENU_CALLBACK;", "-\t\t\t\t\t} else {", "-\t\t\t\t\t\tif (!OS.IsWinCE && OS.WIN32_VERSION >= OS.VERSION (6, 0)) {", "-\t\t\t\t\t\t\tinfo.hbmpItem = hBitmap;", "-\t\t\t\t\t\t} else {", "-\t\t\t\t\t\t\tinfo.hbmpItem = OS.HBMMENU_CALLBACK;", "-\t\t\t\t\t\t}", "-\t\t\t\t\t}", "-\t\t\t\t\tsuccess = OS.SetMenuItemInfo (hMenu, id, false, info);", "-\t\t\t\t}"]}], "num": 51348}