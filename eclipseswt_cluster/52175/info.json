{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "edeed80e9a9f4fc5a72d62da5e13f3c4", "detectedBy": ["AST_HIERARCHICAL", "AST_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "133d74543b9c03317a7f1d9e9a7baa80", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Browser/mozilla/org/eclipse/swt/browser/Browser.java", "commitBeforeChange": "6c3d59784993cf9f24627e85a98a27ad93288a97", "commitAfterChange": "9ccebed33043dedbeb920e86948db21c9cf76ff5", "methodNumberBeforeChange": 106, "methodNumberAfterChange": 106, "signatureBeforeChange": "  int OnStateChange(int aWebProgress, int aRequest, int aStateFlags, int aStatus)", "signatureAfterChange": "  int OnStateChange(int aWebProgress, int aRequest, int aStateFlags, int aStatus)", "diff": ["-\t\t\t * bytes with UTF-16 data.", "+\t\t\t * bytes with UTF-8 data.", "-\t\t\tint length = html.length();", "-\t\t\tchar[] src = new char[length];", "-\t\t\thtml.getChars(0, length, src, 0);", "+\t\t\tbyte[] data = null;", "+\t\t\ttry {", "+\t\t\t\tdata = html.getBytes(\"UTF-8\"); //$NON-NLS-1$", "+\t\t\t} catch (UnsupportedEncodingException e) {", "+\t\t\t}", "-\t\t\tbyte[] data = new byte[length * 2];", "-\t\t\tXPCOM.memmove(data, src, length * 2);", "-", "-\t\t\t/* render HTML in memory */", "-\t\t\tString contentType = \"text/html\"; //$NON-NLS-1$", "-\t\t\t", "-\t\t\tInputStream inputStream = new InputStream(data);", "-\t\t\tinputStream.AddRef();", "-", "-\t\t\tint[] result = new int[1];", "-\t\t\tint rc = webBrowser.QueryInterface(nsIInterfaceRequestor.NS_IINTERFACEREQUESTOR_IID, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_ERROR_NO_INTERFACE);", "+\t\t\tif (data != null) {", "+\t\t\t\t/* render HTML in memory */", "+\t\t\t\tString contentType = \"text/html\"; //$NON-NLS-1$", "+\t\t\t\t", "+\t\t\t\tInputStream inputStream = new InputStream(data);", "+\t\t\t\tinputStream.AddRef();", "-\t\t\tnsIInterfaceRequestor interfaceRequestor = new nsIInterfaceRequestor(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\trc = interfaceRequestor.GetInterface(nsIContentViewerContainer.NS_ICONTENTVIEWERCONTAINER_IID, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_ERROR_NO_INTERFACE);", "-\t\t\tinterfaceRequestor.Release();", "-\t", "-\t\t\tnsIContentViewerContainer contentViewerContainer = new nsIContentViewerContainer(result[0]);", "-\t\t\tresult[0] = 0;", "-\t", "-\t\t\trc = XPCOM.NS_GetServiceManager(result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "+\t\t\t\tint[] result = new int[1];", "+\t\t\t\tint rc = webBrowser.QueryInterface(nsIInterfaceRequestor.NS_IINTERFACEREQUESTOR_IID, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_ERROR_NO_INTERFACE);", "-\t\t\tnsIServiceManager serviceManager = new nsIServiceManager(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\trc = serviceManager.GetService(XPCOM.NS_IOSERVICE_CID, nsIIOService.NS_IIOSERVICE_IID, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);\t\t", "-\t", "-\t\t\tnsIIOService ioService = new nsIIOService(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\t/*", "-\t\t\t* Note. Mozilla ignores LINK tags used to load CSS stylesheets", "-\t\t\t* when the URI protocol for the nsInputStreamChannel", "-\t\t\t* is about:blank. The fix is to specify the file protocol.", "-\t\t\t*/", "-\t\t\tbyte[] aString = \"file:\".getBytes(); //$NON-NLS-1$", "-\t\t\tint aSpec = XPCOM.nsCString_new(aString, aString.length);", "-\t\t\trc = ioService.NewURI(aSpec, null, 0, result);", "-\t\t\tXPCOM.nsCString_delete(aSpec);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "-\t\t\tioService.Release();", "-\t", "-\t\t\tnsIURI uri = new nsIURI(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\trc = XPCOM.NS_GetComponentManager(result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "-\t", "-\t\t\tnsIComponentManager componentManager = new nsIComponentManager(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\trc = componentManager.CreateInstance(XPCOM.NS_LOADGROUP_CID, 0, nsILoadGroup.NS_ILOADGROUP_IID, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "-\t\t\tnsILoadGroup loadGroup = new nsILoadGroup(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\trc = componentManager.CreateInstance(XPCOM.NS_INPUTSTREAMCHANNEL_CID, 0, nsIInputStreamChannel.NS_IINPUTSTREAMCHANNEL_IID, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);\t", "-\t\t\tnsIInputStreamChannel inputStreamChannel = new nsIInputStreamChannel(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\tcomponentManager.Release();\t", "+\t\t\t\tnsIInterfaceRequestor interfaceRequestor = new nsIInterfaceRequestor(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\trc = interfaceRequestor.GetInterface(nsIContentViewerContainer.NS_ICONTENTVIEWERCONTAINER_IID, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_ERROR_NO_INTERFACE);", "+\t\t\t\tinterfaceRequestor.Release();", "+\t\t", "+\t\t\t\tnsIContentViewerContainer contentViewerContainer = new nsIContentViewerContainer(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t", "+\t\t\t\trc = XPCOM.NS_GetServiceManager(result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "-\t\t\trc = inputStreamChannel.SetURI(uri.getAddress());", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\trc = inputStreamChannel.SetContentStream(inputStream.getAddress());", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tbyte[] buffer = contentType.getBytes();", "-\t\t\tbyte[] contentTypeBuffer = new byte[buffer.length + 1];", "-\t\t\tSystem.arraycopy(buffer, 0, contentTypeBuffer, 0, buffer.length);", "-\t\t\tint aContentType = XPCOM.nsCString_new(contentTypeBuffer, contentTypeBuffer.length);", "-\t\t\trc = inputStreamChannel.SetContentType(aContentType);", "-\t\t\tXPCOM.nsCString_delete(aContentType);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tbyte[] contentCharsetBuffer = \"UTF-16\".getBytes();", "-\t\t\tint aContentCharset = XPCOM.nsCString_new(contentCharsetBuffer, contentCharsetBuffer.length);", "-\t\t\trc = inputStreamChannel.SetContentCharset(aContentCharset);", "-\t\t\tXPCOM.nsCString_delete(aContentCharset);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\trc = inputStreamChannel.SetLoadGroup(loadGroup.getAddress());", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t", "-\t\t\tbuffer = XPCOM.NS_CATEGORYMANAGER_CONTRACTID.getBytes();", "-\t\t\tbyte[] aContractID = new byte[buffer.length + 1];", "-\t\t\tSystem.arraycopy(buffer, 0, aContractID, 0, buffer.length);", "-\t\t\trc = serviceManager.GetServiceByContractID(aContractID, nsICategoryManager.NS_ICATEGORYMANAGER_IID, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);\t\t", "-\t", "-\t\t\tnsICategoryManager categoryManager = new nsICategoryManager(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\tbuffer = \"Gecko-Content-Viewers\".getBytes(); //$NON-NLS-1$", "-\t\t\tbyte[] aCategory = new byte[buffer.length + 1];", "-\t\t\tSystem.arraycopy(buffer, 0, aCategory, 0, buffer.length);", "-\t\t\trc = categoryManager.GetCategoryEntry(aCategory, contentTypeBuffer, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "-\t\t\tcategoryManager.Release();", "-\t", "-\t\t\tlength = XPCOM.strlen(result[0]);", "-\t\t\taContractID = new byte[length + 1];", "-\t\t\tXPCOM.memmove(aContractID, result[0], length);", "-\t\t\trc = serviceManager.GetServiceByContractID(aContractID, nsIDocumentLoaderFactory.NS_IDOCUMENTLOADERFACTORY_IID, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);\t", "-\t", "-\t\t\tnsIDocumentLoaderFactory documentLoaderFactory = new nsIDocumentLoaderFactory(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\tbuffer = \"view\".getBytes(); //$NON-NLS-1$", "-\t\t\tbyte[] aCommand = new byte[buffer.length + 1];", "-\t\t\tSystem.arraycopy(buffer, 0, aCommand, 0, buffer.length);", "-\t\t\tint[] aDocListenerResult = new int[1];", "-\t\t\trc = documentLoaderFactory.CreateInstance(aCommand, inputStreamChannel.getAddress(), loadGroup.getAddress(),", "-\t\t\t\t\tcontentTypeBuffer, contentViewerContainer.getAddress(), 0, aDocListenerResult, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (aDocListenerResult[0] == 0) error(XPCOM.NS_NOINTERFACE);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "-\t\t\tdocumentLoaderFactory.Release();", "-\t", "-\t\t\tnsIContentViewer contentViewer = new nsIContentViewer(result[0]);", "-\t\t\tnsIStreamListener streamListener = new nsIStreamListener(aDocListenerResult[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\trc = contentViewer.SetContainer(contentViewerContainer.getAddress());", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\trc = contentViewerContainer.Embed(contentViewer.getAddress(), aCommand, 0);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tcontentViewer.Release();", "-\t", "-\t\t\trc = inputStreamChannel.QueryInterface(nsIRequest.NS_IREQUEST_IID, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "-\t", "-\t\t\tnsIRequest request = new nsIRequest(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\trc = streamListener.OnStartRequest(request.getAddress(), 0);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t", "-\t\t\t/* append */", "-\t\t\trc = streamListener.OnDataAvailable(request.getAddress(), 0, inputStream.getAddress(), 0, data.length);", "-\t\t\t", "-\t\t\t/*", "-\t\t\t* Note.   Mozilla returns a NS_ERROR_HTMLPARSER_UNRESOLVEDDTD if the given content", "-\t\t\t* cannot be rendered as HTML.  Silently ignore this error. ", "-\t\t\t*/", "-\t\t\tif (rc != XPCOM.NS_ERROR_HTMLPARSER_UNRESOLVEDDTD && rc != XPCOM.NS_OK) error(rc);", "-\t", "-\t\t\t/* close */", "-\t\t\trc = streamListener.OnStopRequest(request.getAddress(), 0, XPCOM.NS_OK);", "-\t\t\tif (rc != XPCOM.NS_ERROR_HTMLPARSER_UNRESOLVEDDTD && rc != XPCOM.NS_OK) error(rc);", "-\t", "-\t\t\trequest.Release();", "-\t\t\tstreamListener.Release();", "-\t\t\tserviceManager.Release();", "-\t\t\tinputStreamChannel.Release();", "-\t\t\tloadGroup.Release();", "-\t\t\turi.Release();", "-\t\t\tcontentViewerContainer.Release();", "-\t\t\tinputStream.Release();", "+\t\t\t\tnsIServiceManager serviceManager = new nsIServiceManager(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\trc = serviceManager.GetService(XPCOM.NS_IOSERVICE_CID, nsIIOService.NS_IIOSERVICE_IID, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);\t\t", "+\t\t", "+\t\t\t\tnsIIOService ioService = new nsIIOService(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\t/*", "+\t\t\t\t* Note.  Mozilla ignores LINK tags used to load CSS stylesheets", "+\t\t\t\t* when the URI protocol for the nsInputStreamChannel", "+\t\t\t\t* is about:blank.  The fix is to specify the file protocol.", "+\t\t\t\t*/", "+\t\t\t\tbyte[] aString = \"file:\".getBytes(); //$NON-NLS-1$", "+\t\t\t\tint aSpec = XPCOM.nsCString_new(aString, aString.length);", "+\t\t\t\trc = ioService.NewURI(aSpec, null, 0, result);", "+\t\t\t\tXPCOM.nsCString_delete(aSpec);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "+\t\t\t\tioService.Release();", "+\t\t", "+\t\t\t\tnsIURI uri = new nsIURI(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\trc = XPCOM.NS_GetComponentManager(result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "+\t\t", "+\t\t\t\tnsIComponentManager componentManager = new nsIComponentManager(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\trc = componentManager.CreateInstance(XPCOM.NS_LOADGROUP_CID, 0, nsILoadGroup.NS_ILOADGROUP_IID, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "+\t\t\t\tnsILoadGroup loadGroup = new nsILoadGroup(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\trc = componentManager.CreateInstance(XPCOM.NS_INPUTSTREAMCHANNEL_CID, 0, nsIInputStreamChannel.NS_IINPUTSTREAMCHANNEL_IID, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);\t", "+\t\t\t\tnsIInputStreamChannel inputStreamChannel = new nsIInputStreamChannel(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\tcomponentManager.Release();\t", "+\t\t\t\t", "+\t\t\t\trc = inputStreamChannel.SetURI(uri.getAddress());", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\trc = inputStreamChannel.SetContentStream(inputStream.getAddress());", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tbyte[] buffer = contentType.getBytes();", "+\t\t\t\tbyte[] contentTypeBuffer = new byte[buffer.length + 1];", "+\t\t\t\tSystem.arraycopy(buffer, 0, contentTypeBuffer, 0, buffer.length);", "+\t\t\t\tint aContentType = XPCOM.nsCString_new(contentTypeBuffer, contentTypeBuffer.length);", "+\t\t\t\trc = inputStreamChannel.SetContentType(aContentType);", "+\t\t\t\tXPCOM.nsCString_delete(aContentType);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tbyte[] contentCharsetBuffer = \"UTF-8\".getBytes(); //$NON-NLS-1$", "+\t\t\t\tint aContentCharset = XPCOM.nsCString_new(contentCharsetBuffer, contentCharsetBuffer.length);", "+\t\t\t\trc = inputStreamChannel.SetContentCharset(aContentCharset);", "+\t\t\t\tXPCOM.nsCString_delete(aContentCharset);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\trc = inputStreamChannel.SetLoadGroup(loadGroup.getAddress());", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t", "+\t\t\t\tbuffer = XPCOM.NS_CATEGORYMANAGER_CONTRACTID.getBytes();", "+\t\t\t\tbyte[] aContractID = new byte[buffer.length + 1];", "+\t\t\t\tSystem.arraycopy(buffer, 0, aContractID, 0, buffer.length);", "+\t\t\t\trc = serviceManager.GetServiceByContractID(aContractID, nsICategoryManager.NS_ICATEGORYMANAGER_IID, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);\t\t", "+\t\t", "+\t\t\t\tnsICategoryManager categoryManager = new nsICategoryManager(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\tbuffer = \"Gecko-Content-Viewers\".getBytes(); //$NON-NLS-1$", "+\t\t\t\tbyte[] aCategory = new byte[buffer.length + 1];", "+\t\t\t\tSystem.arraycopy(buffer, 0, aCategory, 0, buffer.length);", "+\t\t\t\trc = categoryManager.GetCategoryEntry(aCategory, contentTypeBuffer, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "+\t\t\t\tcategoryManager.Release();", "+\t\t", "+\t\t\t\tint length = XPCOM.strlen(result[0]);", "+\t\t\t\taContractID = new byte[length + 1];", "+\t\t\t\tXPCOM.memmove(aContractID, result[0], length);", "+\t\t\t\trc = serviceManager.GetServiceByContractID(aContractID, nsIDocumentLoaderFactory.NS_IDOCUMENTLOADERFACTORY_IID, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);\t", "+\t\t", "+\t\t\t\tnsIDocumentLoaderFactory documentLoaderFactory = new nsIDocumentLoaderFactory(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\tbuffer = \"view\".getBytes(); //$NON-NLS-1$", "+\t\t\t\tbyte[] aCommand = new byte[buffer.length + 1];", "+\t\t\t\tSystem.arraycopy(buffer, 0, aCommand, 0, buffer.length);", "+\t\t\t\tint[] aDocListenerResult = new int[1];", "+\t\t\t\trc = documentLoaderFactory.CreateInstance(aCommand, inputStreamChannel.getAddress(), loadGroup.getAddress(),", "+\t\t\t\t\t\tcontentTypeBuffer, contentViewerContainer.getAddress(), 0, aDocListenerResult, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (aDocListenerResult[0] == 0) error(XPCOM.NS_NOINTERFACE);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "+\t\t\t\tdocumentLoaderFactory.Release();", "+\t\t", "+\t\t\t\tnsIContentViewer contentViewer = new nsIContentViewer(result[0]);", "+\t\t\t\tnsIStreamListener streamListener = new nsIStreamListener(aDocListenerResult[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\trc = contentViewer.SetContainer(contentViewerContainer.getAddress());", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\trc = contentViewerContainer.Embed(contentViewer.getAddress(), aCommand, 0);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tcontentViewer.Release();", "+\t\t", "+\t\t\t\trc = inputStreamChannel.QueryInterface(nsIRequest.NS_IREQUEST_IID, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "+\t\t", "+\t\t\t\tnsIRequest request = new nsIRequest(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\trc = streamListener.OnStartRequest(request.getAddress(), 0);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t", "+\t\t\t\t/* append */", "+\t\t\t\trc = streamListener.OnDataAvailable(request.getAddress(), 0, inputStream.getAddress(), 0, data.length);", "+\t\t\t\t", "+\t\t\t\t/*", "+\t\t\t\t* Note.   Mozilla returns a NS_ERROR_HTMLPARSER_UNRESOLVEDDTD if the given content", "+\t\t\t\t* cannot be rendered as HTML.  Silently ignore this error. ", "+\t\t\t\t*/", "+\t\t\t\tif (rc != XPCOM.NS_ERROR_HTMLPARSER_UNRESOLVEDDTD && rc != XPCOM.NS_OK) error(rc);", "+\t\t", "+\t\t\t\t/* close */", "+\t\t\t\trc = streamListener.OnStopRequest(request.getAddress(), 0, XPCOM.NS_OK);", "+\t\t\t\tif (rc != XPCOM.NS_ERROR_HTMLPARSER_UNRESOLVEDDTD && rc != XPCOM.NS_OK) error(rc);", "+\t\t", "+\t\t\t\trequest.Release();", "+\t\t\t\tstreamListener.Release();", "+\t\t\t\tserviceManager.Release();", "+\t\t\t\tinputStreamChannel.Release();", "+\t\t\t\tloadGroup.Release();", "+\t\t\t\turi.Release();", "+\t\t\t\tcontentViewerContainer.Release();", "+\t\t\t\tinputStream.Release();", "+\t\t\t}"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "5742e2249e188a7b71017c0eed03cc77", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Browser/motif/org/eclipse/swt/browser/Browser.java", "commitBeforeChange": "f583ce777b499cca4aaaa2f88ac939554f6b0b09", "commitAfterChange": "823efcc35e97b5b939c67536005ceecfb7d691b5", "methodNumberBeforeChange": 108, "methodNumberAfterChange": 113, "signatureBeforeChange": "  int OnStateChange(int aWebProgress, int aRequest, int aStateFlags, int aStatus)", "signatureAfterChange": "  int OnStateChange(int aWebProgress, int aRequest, int aStateFlags, int aStatus)", "diff": ["-\t\t\t * bytes with UTF-16 data.", "+\t\t\t * bytes with UTF-8 data.", "-\t\t\tint length = html.length();", "-\t\t\tchar[] src = new char[length];", "-\t\t\thtml.getChars(0, length, src, 0);", "+\t\t\tbyte[] data = null;", "+\t\t\ttry {", "+\t\t\t\tdata = html.getBytes(\"UTF-8\"); //$NON-NLS-1$", "+\t\t\t} catch (UnsupportedEncodingException e) {", "+\t\t\t}", "-\t\t\tbyte[] data = new byte[length * 2];", "-\t\t\tXPCOM.memmove(data, src, length * 2);", "-", "-\t\t\t/* render HTML in memory */", "-\t\t\tString contentType = \"text/html\"; //$NON-NLS-1$", "-\t\t\t", "-\t\t\tInputStream inputStream = new InputStream(data);", "-\t\t\tinputStream.AddRef();", "-", "-\t\t\tint[] result = new int[1];", "-\t\t\tint rc = webBrowser.QueryInterface(nsIInterfaceRequestor.NS_IINTERFACEREQUESTOR_IID, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_ERROR_NO_INTERFACE);", "+\t\t\tif (data != null) {", "+\t\t\t\t/* render HTML in memory */", "+\t\t\t\tString contentType = \"text/html\"; //$NON-NLS-1$", "+\t\t\t\t", "+\t\t\t\tInputStream inputStream = new InputStream(data);", "+\t\t\t\tinputStream.AddRef();", "-\t\t\tnsIInterfaceRequestor interfaceRequestor = new nsIInterfaceRequestor(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\trc = interfaceRequestor.GetInterface(nsIContentViewerContainer.NS_ICONTENTVIEWERCONTAINER_IID, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_ERROR_NO_INTERFACE);", "-\t\t\tinterfaceRequestor.Release();", "-\t", "-\t\t\tnsIContentViewerContainer contentViewerContainer = new nsIContentViewerContainer(result[0]);", "-\t\t\tresult[0] = 0;", "-\t", "-\t\t\trc = XPCOM.NS_GetServiceManager(result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "+\t\t\t\tint[] result = new int[1];", "+\t\t\t\tint rc = webBrowser.QueryInterface(nsIInterfaceRequestor.NS_IINTERFACEREQUESTOR_IID, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_ERROR_NO_INTERFACE);", "-\t\t\tnsIServiceManager serviceManager = new nsIServiceManager(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\trc = serviceManager.GetService(XPCOM.NS_IOSERVICE_CID, nsIIOService.NS_IIOSERVICE_IID, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);\t\t", "-\t", "-\t\t\tnsIIOService ioService = new nsIIOService(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\t/*", "-\t\t\t* Note. Mozilla ignores LINK tags used to load CSS stylesheets", "-\t\t\t* when the URI protocol for the nsInputStreamChannel", "-\t\t\t* is about:blank. The fix is to specify the file protocol.", "-\t\t\t*/", "-\t\t\tbyte[] aString = \"file:\".getBytes(); //$NON-NLS-1$", "-\t\t\tint aSpec = XPCOM.nsCString_new(aString, aString.length);", "-\t\t\trc = ioService.NewURI(aSpec, null, 0, result);", "-\t\t\tXPCOM.nsCString_delete(aSpec);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "-\t\t\tioService.Release();", "-\t", "-\t\t\tnsIURI uri = new nsIURI(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\trc = XPCOM.NS_GetComponentManager(result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "-\t", "-\t\t\tnsIComponentManager componentManager = new nsIComponentManager(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\trc = componentManager.CreateInstance(XPCOM.NS_LOADGROUP_CID, 0, nsILoadGroup.NS_ILOADGROUP_IID, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "-\t\t\tnsILoadGroup loadGroup = new nsILoadGroup(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\trc = componentManager.CreateInstance(XPCOM.NS_INPUTSTREAMCHANNEL_CID, 0, nsIInputStreamChannel.NS_IINPUTSTREAMCHANNEL_IID, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);\t", "-\t\t\tnsIInputStreamChannel inputStreamChannel = new nsIInputStreamChannel(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\tcomponentManager.Release();\t", "+\t\t\t\tnsIInterfaceRequestor interfaceRequestor = new nsIInterfaceRequestor(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\trc = interfaceRequestor.GetInterface(nsIContentViewerContainer.NS_ICONTENTVIEWERCONTAINER_IID, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_ERROR_NO_INTERFACE);", "+\t\t\t\tinterfaceRequestor.Release();", "+\t\t", "+\t\t\t\tnsIContentViewerContainer contentViewerContainer = new nsIContentViewerContainer(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t", "+\t\t\t\trc = XPCOM.NS_GetServiceManager(result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "-\t\t\trc = inputStreamChannel.SetURI(uri.getAddress());", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\trc = inputStreamChannel.SetContentStream(inputStream.getAddress());", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tbyte[] buffer = contentType.getBytes();", "-\t\t\tbyte[] contentTypeBuffer = new byte[buffer.length + 1];", "-\t\t\tSystem.arraycopy(buffer, 0, contentTypeBuffer, 0, buffer.length);", "-\t\t\tint aContentType = XPCOM.nsCString_new(contentTypeBuffer, contentTypeBuffer.length);", "-\t\t\trc = inputStreamChannel.SetContentType(aContentType);", "-\t\t\tXPCOM.nsCString_delete(aContentType);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tbyte[] contentCharsetBuffer = new byte[1];", "-\t\t\tint aContentCharset = XPCOM.nsCString_new(contentCharsetBuffer, contentCharsetBuffer.length);", "-\t\t\trc = inputStreamChannel.SetContentCharset(aContentCharset);", "-\t\t\tXPCOM.nsCString_delete(aContentCharset);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\trc = inputStreamChannel.SetLoadGroup(loadGroup.getAddress());", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t", "-\t\t\tbuffer = XPCOM.NS_CATEGORYMANAGER_CONTRACTID.getBytes();", "-\t\t\tbyte[] aContractID = new byte[buffer.length + 1];", "-\t\t\tSystem.arraycopy(buffer, 0, aContractID, 0, buffer.length);", "-\t\t\trc = serviceManager.GetServiceByContractID(aContractID, nsICategoryManager.NS_ICATEGORYMANAGER_IID, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);\t\t", "-\t", "-\t\t\tnsICategoryManager categoryManager = new nsICategoryManager(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\tbuffer = \"Gecko-Content-Viewers\".getBytes(); //$NON-NLS-1$", "-\t\t\tbyte[] aCategory = new byte[buffer.length + 1];", "-\t\t\tSystem.arraycopy(buffer, 0, aCategory, 0, buffer.length);", "-\t\t\trc = categoryManager.GetCategoryEntry(aCategory, contentTypeBuffer, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "-\t\t\tcategoryManager.Release();", "-\t", "-\t\t\tlength = XPCOM.strlen(result[0]);", "-\t\t\taContractID = new byte[length + 1];", "-\t\t\tXPCOM.memmove(aContractID, result[0], length);", "-\t\t\trc = serviceManager.GetServiceByContractID(aContractID, nsIDocumentLoaderFactory.NS_IDOCUMENTLOADERFACTORY_IID, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);\t", "-\t", "-\t\t\tnsIDocumentLoaderFactory documentLoaderFactory = new nsIDocumentLoaderFactory(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\tbuffer = \"view\".getBytes(); //$NON-NLS-1$", "-\t\t\tbyte[] aCommand = new byte[buffer.length + 1];", "-\t\t\tSystem.arraycopy(buffer, 0, aCommand, 0, buffer.length);", "-\t\t\tint[] aDocListenerResult = new int[1];", "-\t\t\trc = documentLoaderFactory.CreateInstance(aCommand, inputStreamChannel.getAddress(), loadGroup.getAddress(),", "-\t\t\t\t\tcontentTypeBuffer, contentViewerContainer.getAddress(), 0, aDocListenerResult, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (aDocListenerResult[0] == 0) error(XPCOM.NS_NOINTERFACE);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "-\t\t\tdocumentLoaderFactory.Release();", "-\t", "-\t\t\tnsIContentViewer contentViewer = new nsIContentViewer(result[0]);", "-\t\t\tnsIStreamListener streamListener = new nsIStreamListener(aDocListenerResult[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\trc = contentViewer.SetContainer(contentViewerContainer.getAddress());", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\trc = contentViewerContainer.Embed(contentViewer.getAddress(), aCommand, 0);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tcontentViewer.Release();", "-\t", "-\t\t\trc = inputStreamChannel.QueryInterface(nsIRequest.NS_IREQUEST_IID, result);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "-\t", "-\t\t\tnsIRequest request = new nsIRequest(result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\trc = streamListener.OnStartRequest(request.getAddress(), 0);", "-\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "-\t", "-\t\t\t/* append */", "-\t\t\trc = streamListener.OnDataAvailable(request.getAddress(), 0, inputStream.getAddress(), 0, data.length);", "-\t\t\t", "-\t\t\t/*", "-\t\t\t* Note.   Mozilla returns a NS_ERROR_HTMLPARSER_UNRESOLVEDDTD if the given content", "-\t\t\t* cannot be rendered as HTML.  Silently ignore this error. ", "-\t\t\t*/", "-\t\t\tif (rc != XPCOM.NS_ERROR_HTMLPARSER_UNRESOLVEDDTD && rc != XPCOM.NS_OK) error(rc);", "-\t", "-\t\t\t/* close */", "-\t\t\trc = streamListener.OnStopRequest(request.getAddress(), 0, XPCOM.NS_OK);", "-\t\t\tif (rc != XPCOM.NS_ERROR_HTMLPARSER_UNRESOLVEDDTD && rc != XPCOM.NS_OK) error(rc);", "-\t", "-\t\t\trequest.Release();", "-\t\t\tstreamListener.Release();", "-\t\t\tserviceManager.Release();", "-\t\t\tinputStreamChannel.Release();", "-\t\t\tloadGroup.Release();", "-\t\t\turi.Release();", "-\t\t\tcontentViewerContainer.Release();", "-\t\t\tinputStream.Release();", "+\t\t\t\tnsIServiceManager serviceManager = new nsIServiceManager(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\trc = serviceManager.GetService(XPCOM.NS_IOSERVICE_CID, nsIIOService.NS_IIOSERVICE_IID, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);\t\t", "+\t\t", "+\t\t\t\tnsIIOService ioService = new nsIIOService(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\t/*", "+\t\t\t\t* Note.  Mozilla ignores LINK tags used to load CSS stylesheets", "+\t\t\t\t* when the URI protocol for the nsInputStreamChannel", "+\t\t\t\t* is about:blank.  The fix is to specify the file protocol.", "+\t\t\t\t*/", "+\t\t\t\tbyte[] aString = \"file:\".getBytes(); //$NON-NLS-1$", "+\t\t\t\tint aSpec = XPCOM.nsCString_new(aString, aString.length);", "+\t\t\t\trc = ioService.NewURI(aSpec, null, 0, result);", "+\t\t\t\tXPCOM.nsCString_delete(aSpec);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "+\t\t\t\tioService.Release();", "+\t\t", "+\t\t\t\tnsIURI uri = new nsIURI(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\trc = XPCOM.NS_GetComponentManager(result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "+\t\t", "+\t\t\t\tnsIComponentManager componentManager = new nsIComponentManager(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\trc = componentManager.CreateInstance(XPCOM.NS_LOADGROUP_CID, 0, nsILoadGroup.NS_ILOADGROUP_IID, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "+\t\t\t\tnsILoadGroup loadGroup = new nsILoadGroup(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\trc = componentManager.CreateInstance(XPCOM.NS_INPUTSTREAMCHANNEL_CID, 0, nsIInputStreamChannel.NS_IINPUTSTREAMCHANNEL_IID, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);\t", "+\t\t\t\tnsIInputStreamChannel inputStreamChannel = new nsIInputStreamChannel(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\tcomponentManager.Release();\t", "+\t\t\t\t", "+\t\t\t\trc = inputStreamChannel.SetURI(uri.getAddress());", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\trc = inputStreamChannel.SetContentStream(inputStream.getAddress());", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tbyte[] buffer = contentType.getBytes();", "+\t\t\t\tbyte[] contentTypeBuffer = new byte[buffer.length + 1];", "+\t\t\t\tSystem.arraycopy(buffer, 0, contentTypeBuffer, 0, buffer.length);", "+\t\t\t\tint aContentType = XPCOM.nsCString_new(contentTypeBuffer, contentTypeBuffer.length);", "+\t\t\t\trc = inputStreamChannel.SetContentType(aContentType);", "+\t\t\t\tXPCOM.nsCString_delete(aContentType);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tbyte[] contentCharsetBuffer = \"UTF-8\".getBytes(); //$NON-NLS-1$", "+\t\t\t\tint aContentCharset = XPCOM.nsCString_new(contentCharsetBuffer, contentCharsetBuffer.length);", "+\t\t\t\trc = inputStreamChannel.SetContentCharset(aContentCharset);", "+\t\t\t\tXPCOM.nsCString_delete(aContentCharset);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\trc = inputStreamChannel.SetLoadGroup(loadGroup.getAddress());", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t", "+\t\t\t\tbuffer = XPCOM.NS_CATEGORYMANAGER_CONTRACTID.getBytes();", "+\t\t\t\tbyte[] aContractID = new byte[buffer.length + 1];", "+\t\t\t\tSystem.arraycopy(buffer, 0, aContractID, 0, buffer.length);", "+\t\t\t\trc = serviceManager.GetServiceByContractID(aContractID, nsICategoryManager.NS_ICATEGORYMANAGER_IID, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);\t\t", "+\t\t", "+\t\t\t\tnsICategoryManager categoryManager = new nsICategoryManager(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\tbuffer = \"Gecko-Content-Viewers\".getBytes(); //$NON-NLS-1$", "+\t\t\t\tbyte[] aCategory = new byte[buffer.length + 1];", "+\t\t\t\tSystem.arraycopy(buffer, 0, aCategory, 0, buffer.length);", "+\t\t\t\trc = categoryManager.GetCategoryEntry(aCategory, contentTypeBuffer, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "+\t\t\t\tcategoryManager.Release();", "+\t\t", "+\t\t\t\tint length = XPCOM.strlen(result[0]);", "+\t\t\t\taContractID = new byte[length + 1];", "+\t\t\t\tXPCOM.memmove(aContractID, result[0], length);", "+\t\t\t\trc = serviceManager.GetServiceByContractID(aContractID, nsIDocumentLoaderFactory.NS_IDOCUMENTLOADERFACTORY_IID, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);\t", "+\t\t", "+\t\t\t\tnsIDocumentLoaderFactory documentLoaderFactory = new nsIDocumentLoaderFactory(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\tbuffer = \"view\".getBytes(); //$NON-NLS-1$", "+\t\t\t\tbyte[] aCommand = new byte[buffer.length + 1];", "+\t\t\t\tSystem.arraycopy(buffer, 0, aCommand, 0, buffer.length);", "+\t\t\t\tint[] aDocListenerResult = new int[1];", "+\t\t\t\trc = documentLoaderFactory.CreateInstance(aCommand, inputStreamChannel.getAddress(), loadGroup.getAddress(),", "+\t\t\t\t\t\tcontentTypeBuffer, contentViewerContainer.getAddress(), 0, aDocListenerResult, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (aDocListenerResult[0] == 0) error(XPCOM.NS_NOINTERFACE);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "+\t\t\t\tdocumentLoaderFactory.Release();", "+\t\t", "+\t\t\t\tnsIContentViewer contentViewer = new nsIContentViewer(result[0]);", "+\t\t\t\tnsIStreamListener streamListener = new nsIStreamListener(aDocListenerResult[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\trc = contentViewer.SetContainer(contentViewerContainer.getAddress());", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\trc = contentViewerContainer.Embed(contentViewer.getAddress(), aCommand, 0);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tcontentViewer.Release();", "+\t\t", "+\t\t\t\trc = inputStreamChannel.QueryInterface(nsIRequest.NS_IREQUEST_IID, result);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t\t\tif (result[0] == 0) error(XPCOM.NS_NOINTERFACE);", "+\t\t", "+\t\t\t\tnsIRequest request = new nsIRequest(result[0]);", "+\t\t\t\tresult[0] = 0;", "+\t\t\t\trc = streamListener.OnStartRequest(request.getAddress(), 0);", "+\t\t\t\tif (rc != XPCOM.NS_OK) error(rc);", "+\t\t", "+\t\t\t\t/* append */", "+\t\t\t\trc = streamListener.OnDataAvailable(request.getAddress(), 0, inputStream.getAddress(), 0, data.length);", "+\t\t\t\t", "+\t\t\t\t/*", "+\t\t\t\t* Note.   Mozilla returns a NS_ERROR_HTMLPARSER_UNRESOLVEDDTD if the given content", "+\t\t\t\t* cannot be rendered as HTML.  Silently ignore this error. ", "+\t\t\t\t*/", "+\t\t\t\tif (rc != XPCOM.NS_ERROR_HTMLPARSER_UNRESOLVEDDTD && rc != XPCOM.NS_OK) error(rc);", "+\t\t", "+\t\t\t\t/* close */", "+\t\t\t\trc = streamListener.OnStopRequest(request.getAddress(), 0, XPCOM.NS_OK);", "+\t\t\t\tif (rc != XPCOM.NS_ERROR_HTMLPARSER_UNRESOLVEDDTD && rc != XPCOM.NS_OK) error(rc);", "+\t\t", "+\t\t\t\trequest.Release();", "+\t\t\t\tstreamListener.Release();", "+\t\t\t\tserviceManager.Release();", "+\t\t\t\tinputStreamChannel.Release();", "+\t\t\t\tloadGroup.Release();", "+\t\t\t\turi.Release();", "+\t\t\t\tcontentViewerContainer.Release();", "+\t\t\t\tinputStream.Release();", "+\t\t\t}"]}], "num": 52175}