{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "f0b0ee77fb82060db629c16d70f9d3c6", "detectedBy": ["DIFF_HIERARCHICAL"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "078773ff893071dc14471457f6ae142b", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT WebKit/win32/org/eclipse/swt/browser/WebFrameLoadDelegate.java", "commitBeforeChange": "73bece2a93a84ede732dede8b40b2d8c17119094", "commitAfterChange": "3684f6f68db473f62f594c1867c30510d320282b", "methodNumberBeforeChange": 25, "methodNumberAfterChange": 25, "signatureBeforeChange": "  int didFinishLoadForFrame (int webview, int frame)", "signatureAfterChange": "  int didFinishLoadForFrame (int webview, int frame)", "diff": ["-\tif (top) {", "-\t\t/*", "-\t\t * If html is not null then there is html from a previous setText() call", "-\t\t * waiting to be set into the about:blank page once it has completed loading. ", "-\t\t */", "-\t\tif (html != null) {", "-\t\t\tif (getUrl ().startsWith (WebKit.ABOUT_BLANK)) {", "-\t\t\t\t((WebKit)browser.webBrowser).loadingText = true;", "-\t\t\t\tint /*long*/ string = WebKit.createBSTR (html);", "-\t\t\t\tint /*long*/ URLString;", "-\t\t\t\tif (((WebKit)browser.webBrowser).untrustedText) {", "-\t\t\t\t\tURLString = WebKit.createBSTR (WebKit.ABOUT_BLANK);", "-\t\t\t\t} else {", "-\t\t\t\t\tURLString = WebKit.createBSTR (WebKit.URI_FILEROOT);", "-\t\t\t\t}", "-\t\t\t\tIWebFrame mainFrame = new IWebFrame (frame);", "-\t\t\t\tmainFrame.loadHTMLString (string, URLString);", "-\t\t\t\thtml = null;", "-\t\t\t}", "-\t\t}", "+\tif (!top) return COM.S_OK;", "-\t\t/*", "-\t\t* The loadHTMLString() invocation above will trigger a second webView_didFinishLoadForFrame", "-\t\t* callback when it is completed.  If text was just set into the browser then wait for this", "-\t\t* second callback to come before sending the title or completed events.", "-\t\t*/", "-\t\tif (!((WebKit)browser.webBrowser).loadingText) {", "-\t\t\tif (browser.isDisposed ()) return COM.S_OK;", "-\t\t\t/*", "-\t\t\t* To be consistent with other platforms a title event should be fired when a", "-\t\t\t* page has completed loading.  A page with a <title> tag will do this", "-\t\t\t* automatically when the didReceiveTitle callback is received.  However a page", "-\t\t\t* without a <title> tag will not do this by default, so fire the event", "-\t\t\t* here with the page's url as the title.", "-\t\t\t*/", "-\t\t\tDisplay display = browser.getDisplay ();", "+\t/*", "+\t * If html is not null then there is html from a previous setText() call", "+\t * waiting to be set into the about:blank page once it has completed loading. ", "+\t */", "+\tif (html != null) {", "+\t\tif (getUrl ().startsWith (WebKit.ABOUT_BLANK)) {", "+\t\t\t((WebKit)browser.webBrowser).loadingText = true;", "+\t\t\tint /*long*/ string = WebKit.createBSTR (html);", "+\t\t\tint /*long*/ URLString;", "+\t\t\tif (((WebKit)browser.webBrowser).untrustedText) {", "+\t\t\t\tURLString = WebKit.createBSTR (WebKit.ABOUT_BLANK);", "+\t\t\t} else {", "+\t\t\t\tURLString = WebKit.createBSTR (WebKit.URI_FILEROOT);", "+\t\t\t}", "-\t\t\tint /*long*/[] result = new int /*long*/[1];", "-\t\t\thr = mainFrame.dataSource (result);", "-\t\t\tif (hr != COM.S_OK || result[0] == 0) {", "-\t\t\t\treturn COM.S_OK;", "-\t\t    }", "-\t\t\tIWebDataSource dataSource = new IWebDataSource (result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\thr = dataSource.pageTitle (result);", "-\t\t\tdataSource.Release ();", "-\t\t\tif (hr != COM.S_OK) {", "-\t\t\t\treturn COM.S_OK;", "-\t\t    }", "-\t\t\tString title = null;", "-\t\t\tif (result[0] != 0) {", "-\t\t\t\ttitle = WebKit.extractBSTR (result[0]);", "-\t\t\t\tCOM.SysFreeString (result[0]);", "-\t\t\t}", "-\t\t\tif (title == null || title.length () == 0) {\t/* page has no title */", "-\t\t\t\tTitleEvent newEvent = new TitleEvent (browser);", "-\t\t\t\tnewEvent.display = display;", "-\t\t\t\tnewEvent.widget = browser;", "-\t\t\t\tnewEvent.title = getUrl ();", "-\t\t\t\tTitleListener[] titleListeners = browser.webBrowser.titleListeners;", "-\t\t\t\tfor (int i = 0; i < titleListeners.length; i++) {", "-\t\t\t\t\ttitleListeners[i].changed (newEvent);", "-\t\t\t\t}", "-\t\t\t\tif (browser.isDisposed ()) return COM.S_OK;", "-\t\t\t}", "-", "-\t\t\tProgressEvent progress = new ProgressEvent (browser);", "-\t\t\tprogress.display = display;", "-\t\t\tprogress.widget = browser;", "-\t\t\tprogress.current = WebKit.MAX_PROGRESS;", "-\t\t\tprogress.total = WebKit.MAX_PROGRESS;", "-\t\t\tProgressListener[] progressListeners = browser.webBrowser.progressListeners;", "-\t\t\tfor (int i = 0; i < progressListeners.length; i++) {", "-\t\t\t\tprogressListeners[i].completed (progress);", "-\t\t\t}", "+\t\t\tmainFrame.loadHTMLString (string, URLString);", "+\t\t\thtml = null;", "-\t\t((WebKit)browser.webBrowser).loadingText = false;", "+\t}", "+", "+\t/*", "+\t* The loadHTMLString() invocation above will trigger a second didFinishLoadForFrame", "+\t* callback when it is completed.  If text was just set into the browser then wait for this", "+\t* second callback to come before sending the title or completed events.", "+\t*/", "+\tif (!((WebKit)browser.webBrowser).loadingText) {", "+\t\tif (browser.isDisposed ()) return COM.S_OK;", "+\t\t/*", "+\t\t* To be consistent with other platforms a title event should be fired when a", "+\t\t* page has completed loading.  A page with a <title> tag will do this", "+\t\t* automatically when the didReceiveTitle callback is received.  However a page", "+\t\t* without a <title> tag will not do this by default, so fire the event", "+\t\t* here with the page's url as the title.", "+\t\t*/", "+\t\tDisplay display = browser.getDisplay ();", "+\t\tIWebFrame mainFrame = new IWebFrame (frame);", "+\t\tint /*long*/[] result = new int /*long*/[1];", "+\t\thr = mainFrame.dataSource (result);", "+\t\tif (hr != COM.S_OK || result[0] == 0) {", "+\t\t\treturn COM.S_OK;", "+\t\t}", "+\t\tIWebDataSource dataSource = new IWebDataSource (result[0]);", "+\t\tresult[0] = 0;", "+\t\thr = dataSource.pageTitle (result);", "+\t\tdataSource.Release ();", "+\t\tif (hr != COM.S_OK) {", "+\t\t\treturn COM.S_OK;", "+\t\t}", "+\t\tString title = null;", "+\t\tif (result[0] != 0) {", "+\t\t\ttitle = WebKit.extractBSTR (result[0]);", "+\t\t\tCOM.SysFreeString (result[0]);", "+\t\t}", "+\t\tif (title == null || title.length () == 0) {\t/* page has no title */", "+\t\t\tTitleEvent newEvent = new TitleEvent (browser);", "+\t\t\tnewEvent.display = display;", "+\t\t\tnewEvent.widget = browser;", "+\t\t\tnewEvent.title = getUrl ();", "+\t\t\tTitleListener[] titleListeners = browser.webBrowser.titleListeners;", "+\t\t\tfor (int i = 0; i < titleListeners.length; i++) {", "+\t\t\t\ttitleListeners[i].changed (newEvent);", "+\t\t\t}", "+\t\t\tif (browser.isDisposed ()) return COM.S_OK;", "+\t\t}", "+", "+\t\tProgressEvent progress = new ProgressEvent (browser);", "+\t\tprogress.display = display;", "+\t\tprogress.widget = browser;", "+\t\tprogress.current = WebKit.MAX_PROGRESS;", "+\t\tprogress.total = WebKit.MAX_PROGRESS;", "+\t\tProgressListener[] progressListeners = browser.webBrowser.progressListeners;", "+\t\tfor (int i = 0; i < progressListeners.length; i++) {", "+\t\t\tprogressListeners[i].completed (progress);", "+\t\t}", "+\t((WebKit)browser.webBrowser).loadingText = false;"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "8411f9117c101f103a8e29e621a846a8", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Browser/win32/org/eclipse/swt/browser/WebSite.java", "commitBeforeChange": "7ea7044dce58068771791c523ae5bf28b951b0a6", "commitAfterChange": "216f5ab7fb691dae8d48f705c5a563bf2b62146e", "methodNumberBeforeChange": 96, "methodNumberAfterChange": 96, "signatureBeforeChange": "  Variant convertToJS (Object value)", "signatureAfterChange": "  Variant convertToJS (Object value)", "diff": ["+\t\t/* get IHTMLDocument2 */", "+\t\tIE browser = (IE)((Browser)getParent ().getParent ()).webBrowser;", "+\t\tOleAutomation auto = browser.auto;", "+\t\tint[] rgdispid = auto.getIDsOfNames (new String[] {\"Document\"}); //$NON-NLS-1$", "+\t\tif (rgdispid == null) return new Variant ();", "+\t\tVariant pVarResult = auto.getProperty (rgdispid[0]);", "+\t\tif (pVarResult == null) return new Variant ();", "+\t\tif (pVarResult.getType () == COM.VT_EMPTY) {", "+\t\t\tpVarResult.dispose ();", "+\t\t\treturn new Variant ();", "+\t\t}", "+\t\tOleAutomation document = pVarResult.getAutomation ();", "+\t\tpVarResult.dispose ();", "+", "+\t\t/* get IHTMLWindow2 */", "+\t\trgdispid = document.getIDsOfNames (new String[] {\"parentWindow\"}); //$NON-NLS-1$", "+\t\tif (rgdispid == null) {", "+\t\t\tdocument.dispose ();", "+\t\t\treturn new Variant ();", "+\t\t}", "+\t\tpVarResult = document.getProperty (rgdispid[0]);", "+\t\tif (pVarResult == null || pVarResult.getType () == COM.VT_EMPTY) {", "+\t\t\tif (pVarResult != null) pVarResult.dispose ();", "+\t\t\tdocument.dispose ();", "+\t\t\treturn new Variant ();\t", "+\t\t}", "+\t\tOleAutomation ihtmlWindow2 = pVarResult.getAutomation ();", "+\t\tpVarResult.dispose ();", "+\t\tdocument.dispose ();", "+", "+\t\t/* create a new JS array to be returned */", "+\t\trgdispid = ihtmlWindow2.getIDsOfNames (new String[] {\"Array\"}); //$NON-NLS-1$", "+\t\tif (rgdispid == null) {", "+\t\t\tihtmlWindow2.dispose ();", "+\t\t\treturn new Variant ();", "+\t\t}", "+\t\tVariant arrayType = ihtmlWindow2.getProperty (rgdispid[0]);", "+\t\tihtmlWindow2.dispose ();", "+\t\tIDispatch arrayTypeDispatch = arrayType.getDispatch ();", "+\t\tarrayType.dispose ();", "+", "+\t\tint /*long*/[] result = new int /*long*/[1];", "+\t\tint rc = arrayTypeDispatch.QueryInterface (COM.IIDIDispatchEx, result);", "+\t\tif (rc != COM.S_OK) return new Variant ();", "+\t\tIDispatchEx arrayTypeDispatchEx = new IDispatchEx (result[0]);", "+\t\tresult[0] = 0;", "+\t\tint /*long*/ resultPtr = OS.GlobalAlloc (OS.GMEM_FIXED | OS.GMEM_ZEROINIT, VARIANT.sizeof);", "+\t\tDISPPARAMS params = new DISPPARAMS ();", "+\t\trc = arrayTypeDispatchEx.InvokeEx (COM.DISPID_VALUE, COM.LOCALE_USER_DEFAULT, COM.DISPATCH_CONSTRUCT, params, resultPtr, null, 0);", "+\t\tif (rc != COM.S_OK) {", "+\t\t\tOS.GlobalFree (resultPtr);", "+\t\t\treturn new Variant ();\t", "+\t\t}", "+\t\tVariant array = Variant.win32_new (resultPtr);", "+\t\tOS.GlobalFree (resultPtr);", "+", "+\t\t/* populate the array */", "-\t\tif (length > 0) {", "-\t\t\t/* get IHTMLDocument2 */", "-\t\t\tIE browser = (IE)((Browser)getParent ().getParent ()).webBrowser;", "-\t\t\tOleAutomation auto = browser.auto;", "-\t\t\tint[] rgdispid = auto.getIDsOfNames (new String[] {\"Document\"}); //$NON-NLS-1$", "-\t\t\tif (rgdispid == null) return new Variant ();", "-\t\t\tVariant pVarResult = auto.getProperty (rgdispid[0]);", "-\t\t\tif (pVarResult == null) return new Variant ();", "-\t\t\tif (pVarResult.getType () == COM.VT_EMPTY) {", "-\t\t\t\tpVarResult.dispose ();", "-\t\t\t\treturn new Variant ();", "-\t\t\t}", "-\t\t\tOleAutomation document = pVarResult.getAutomation ();", "-\t\t\tpVarResult.dispose ();", "-", "-\t\t\t/* get IHTMLWindow2 */", "-\t\t\trgdispid = document.getIDsOfNames (new String[] {\"parentWindow\"}); //$NON-NLS-1$", "-\t\t\tif (rgdispid == null) {", "-\t\t\t\tdocument.dispose ();", "-\t\t\t\treturn new Variant ();", "-\t\t\t}", "-\t\t\tpVarResult = document.getProperty (rgdispid[0]);", "-\t\t\tif (pVarResult == null || pVarResult.getType () == COM.VT_EMPTY) {", "-\t\t\t\tif (pVarResult != null) pVarResult.dispose ();", "-\t\t\t\tdocument.dispose ();", "-\t\t\t\treturn new Variant ();\t", "-\t\t\t}", "-\t\t\tOleAutomation ihtmlWindow2 = pVarResult.getAutomation ();", "-\t\t\tpVarResult.dispose ();", "-\t\t\tdocument.dispose ();", "-", "-\t\t\t/* create a new JS array to be returned */", "-\t\t\trgdispid = ihtmlWindow2.getIDsOfNames (new String[] {\"Array\"}); //$NON-NLS-1$", "-\t\t\tif (rgdispid == null) {", "-\t\t\t\tihtmlWindow2.dispose ();", "-\t\t\t\treturn new Variant ();", "-\t\t\t}", "-\t\t\tVariant arrayType = ihtmlWindow2.getProperty (rgdispid[0]);", "-\t\t\tihtmlWindow2.dispose ();", "-\t\t\tIDispatch arrayTypeDispatch = arrayType.getDispatch ();", "-\t\t\tarrayType.dispose ();", "-", "-\t\t\tint /*long*/[] result = new int /*long*/[1];", "-\t\t\tint rc = arrayTypeDispatch.QueryInterface (COM.IIDIDispatchEx, result);", "-\t\t\tif (rc != COM.S_OK) return new Variant ();", "-\t\t\tIDispatchEx arrayTypeDispatchEx = new IDispatchEx (result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\tint /*long*/ resultPtr = OS.GlobalAlloc (OS.GMEM_FIXED | OS.GMEM_ZEROINIT, VARIANT.sizeof);", "-\t\t\tDISPPARAMS params = new DISPPARAMS ();", "-\t\t\trc = arrayTypeDispatchEx.InvokeEx (COM.DISPID_VALUE, COM.LOCALE_USER_DEFAULT, COM.DISPATCH_CONSTRUCT, params, resultPtr, null, 0);", "-\t\t\tif (rc != COM.S_OK) {", "-\t\t\t\tOS.GlobalFree (resultPtr);", "-\t\t\t\treturn new Variant ();\t", "-\t\t\t}", "-\t\t\tVariant array = Variant.win32_new (resultPtr);", "-\t\t\tOS.GlobalFree (resultPtr);", "-", "-\t\t\t/* populate the array */", "-\t\t\tauto = array.getAutomation ();", "-\t\t\tint[] rgdispids = auto.getIDsOfNames (new String[] {\"push\"}); //$NON-NLS-1$", "-\t\t\tif (rgdispids != null) {", "-\t\t\t\tfor (int i = 0; i < length; i++) {", "-\t\t\t\t\tObject currentObject = arrayValue[i];", "-\t\t\t\t\ttry {", "-\t\t\t\t\t\tVariant variant = convertToJS (currentObject);", "-\t\t\t\t\t\tauto.invoke (rgdispids[0], new Variant[] {variant});", "-\t\t\t\t\t\tvariant.dispose ();", "-\t\t\t\t\t} catch (SWTException e) {", "-\t\t\t\t\t\t/* invalid return value type */", "-\t\t\t\t\t\tauto.dispose ();", "-\t\t\t\t\t\tarray.dispose ();", "-\t\t\t\t\t\tthrow e;", "-\t\t\t\t\t}", "+\t\tauto = array.getAutomation ();", "+\t\tint[] rgdispids = auto.getIDsOfNames (new String[] {\"push\"}); //$NON-NLS-1$", "+\t\tif (rgdispids != null) {", "+\t\t\tfor (int i = 0; i < length; i++) {", "+\t\t\t\tObject currentObject = arrayValue[i];", "+\t\t\t\ttry {", "+\t\t\t\t\tVariant variant = convertToJS (currentObject);", "+\t\t\t\t\tauto.invoke (rgdispids[0], new Variant[] {variant});", "+\t\t\t\t\tvariant.dispose ();", "+\t\t\t\t} catch (SWTException e) {", "+\t\t\t\t\t/* invalid return value type */", "+\t\t\t\t\tauto.dispose ();", "+\t\t\t\t\tarray.dispose ();", "+\t\t\t\t\tthrow e;", "-\t\t\tauto.dispose ();", "-\t\t\treturn array;", "+\t\tauto.dispose ();", "+\t\treturn array;"]}], "num": 22495}