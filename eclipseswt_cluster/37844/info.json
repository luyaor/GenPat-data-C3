{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "c8ecfc2a5896fc1e41f30ea9710ab1a2", "detectedBy": ["AST_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "a4fc0dba83e57134adc35d1ebb6c8551", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT/win32/org/eclipse/swt/widgets/Menu.java", "commitBeforeChange": "d4eb14ad4f7b1074d4935c2b9211f94b2750616d", "commitAfterChange": "7d562ae8941ad5655a314eac8dd19e3b2aaef50c", "methodNumberBeforeChange": 11, "methodNumberAfterChange": 11, "signatureBeforeChange": "\r \r void createItem (MenuItem item, int index)", "signatureAfterChange": "\r \r void createItem (MenuItem item, int index)", "diff": ["-\tint count = OS.GetMenuItemCount (handle);\r", "+\tint count = GetMenuItemCount (handle);\r", "-\t/*\r", "-\t* Bug in Windows.  For some reason, when InsertMenuItem ()\r", "-\t* is used to insert an item without text, it is not possible\r", "-\t* to use SetMenuItemInfo () to set the text at a later time.\r", "-\t* The fix is to insert the item with an empty string.\r", "-\t*/\r", "-\tint hHeap = OS.GetProcessHeap ();\r", "-\tint pszText = OS.HeapAlloc (hHeap, OS.HEAP_ZERO_MEMORY, 1);\r", "-\tMENUITEMINFO info = new MENUITEMINFO ();\r", "-\tinfo.cbSize = MENUITEMINFO.sizeof;\r", "-\tinfo.fMask = OS.MIIM_ID | OS.MIIM_TYPE;\r", "-\tinfo.wID = item.id;\r", "-\tinfo.fType = item.widgetStyle ();\r", "-\tinfo.dwTypeData = pszText;\r", "-\tboolean success = OS.InsertMenuItem (handle, index, true, info);\r", "-\tif (pszText != 0) OS.HeapFree (hHeap, 0, pszText);\r", "+\tboolean success = false;\r", "+\tif (OS.IsWinCE) {\r", "+\t\tint flags = OS.MF_BYPOSITION;\r", "+\t\tif ((style & SWT.SEPARATOR) != 0) flags |= OS.MF_SEPARATOR;\r", "+\t\tsuccess = OS.InsertMenu (handle, index, flags, item.id, null); \r", "+\t} else {\r", "+\t\t/*\r", "+\t\t* Bug in Windows.  For some reason, when InsertMenuItem ()\r", "+\t\t* is used to insert an item without text, it is not possible\r", "+\t\t* to use SetMenuItemInfo () to set the text at a later time.\r", "+\t\t* The fix is to insert the item with an empty string.\r", "+\t\t*/\r", "+\t\tint hHeap = OS.GetProcessHeap ();\r", "+\t\tint pszText = OS.HeapAlloc (hHeap, OS.HEAP_ZERO_MEMORY, TCHAR.sizeof);\r", "+\t\tMENUITEMINFO info = new MENUITEMINFO ();\r", "+\t\tinfo.cbSize = MENUITEMINFO.sizeof;\r", "+\t\tinfo.fMask = OS.MIIM_ID | OS.MIIM_TYPE;\r", "+\t\tinfo.wID = item.id;\r", "+\t\tinfo.fType = item.widgetStyle ();\r", "+\t\tinfo.dwTypeData = pszText;\r", "+\t\tsuccess = OS.InsertMenuItem (handle, index, true, info);\r", "+\t\tif (pszText != 0) OS.HeapFree (hHeap, 0, pszText);\r", "+\t}\r"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "82b433a06dee727de17ad2f80c23d359", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT/win32/org/eclipse/swt/widgets/MenuItem.java", "commitBeforeChange": "d4eb14ad4f7b1074d4935c2b9211f94b2750616d", "commitAfterChange": "7d562ae8941ad5655a314eac8dd19e3b2aaef50c", "methodNumberBeforeChange": 24, "methodNumberAfterChange": 24, "signatureBeforeChange": "\r public void setMenu (Menu menu)", "signatureAfterChange": "\r public void setMenu (Menu menu)", "diff": ["-\tint index = 0, count = OS.GetMenuItemCount (hMenu);\r", "-\twhile (index < count) {\r", "-\t\tif (OS.GetMenuItemInfo (hMenu, index, true, info) && (info.wID == id)) {\r", "-\t\t\tbreak;\r", "-\t\t}\r", "+\tint index = 0;\r", "+\twhile (OS.GetMenuItemInfo (hMenu, index, true, info)) {\r", "+\t\tif (info.wID == id) break;\r", "-\tif (index == count) return;\r", "+\tif (info.wID != id) return;\r", "+\tint cch = 128;\r", "-\tint pszText = OS.HeapAlloc (hHeap, OS.HEAP_ZERO_MEMORY, 128);\r", "+\tint byteCount = cch * TCHAR.sizeof;\r", "+\tint pszText = OS.HeapAlloc (hHeap, OS.HEAP_ZERO_MEMORY, byteCount);\r", "-\tinfo.cch = 128;\r", "+\tinfo.cch = cch;\r", "-\tsuccess = OS.InsertMenuItem (hMenu, index, true, info);\r", "+\tif (OS.IsWinCE) {\r", "+\t\tsuccess = OS.InsertMenu (hMenu, index, OS.MF_BYPOSITION, id, null); \r", "+\t\tif (success) success = OS.SetMenuItemInfo (hMenu, index, true, info);\r", "+\t} else {\r", "+\t\tsuccess = OS.InsertMenuItem (hMenu, index, true, info);\r", "+\t}\r"]}], "num": 37844}