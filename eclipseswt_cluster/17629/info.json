{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "238bf45aec6a2fceacaeeaf4fb2907e3", "detectedBy": ["AST_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "70626c37f687a40f7614c2cd1a7b602a", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT/win32/org/eclipse/swt/graphics/TextLayout.java", "commitBeforeChange": "49004903cea627f8e18ec7beb495ed69bd7515bf", "commitAfterChange": "74b446f0656f1cd959b11120c70a3b24ba9958b8", "methodNumberBeforeChange": 10, "methodNumberAfterChange": 10, "signatureBeforeChange": " public void draw (GC gc, int x, int y, int selectionStart, int selectionEnd, Color selectionForeground, Color selectionBackground, int flags)", "signatureAfterChange": " public void draw (GC gc, int x, int y, int selectionStart, int selectionEnd, Color selectionForeground, Color selectionBackground, int flags)", "diff": ["-\t\t\t\t\tint end = run.start + run.length - 1;", "-\t\t\t\t\tboolean fullSelection = hasSelection && selectionStart <= run.start && selectionEnd >= end;", "-\t\t\t\t\tif (fullSelection) {", "-\t\t\t\t\t\tif (gdip) {", "-\t\t\t\t\t\t\tGdip.Graphics_FillRectangle(gdipGraphics, selBrush, drawX, drawY, run.width, lineHeight);", "-\t\t\t\t\t\t} else {", "-\t\t\t\t\t\t\tOS.SelectObject(hdc, selBrush);", "-\t\t\t\t\t\t\tOS.PatBlt(hdc, drawX, drawY, run.width, lineHeight, OS.PATCOPY);", "-\t\t\t\t\t\t}", "+\t\t\t\t\tOS.SetRect(rect, drawX, drawY, drawX + run.width, drawY + lineHeight);", "+\t\t\t\t\tif (gdip) {", "+\t\t\t\t\t\tdrawRunBackgroundGDIP(run, gdipGraphics, rect, selectionStart, selectionEnd, alpha, selBrush, hasSelection);", "-\t\t\t\t\t\tif (run.style != null && run.style.background != null) {", "-\t\t\t\t\t\t\tint bg = run.style.background.handle;", "-\t\t\t\t\t\t\tif (gdip) {", "-\t\t\t\t\t\t\t\tint argb = ((alpha & 0xFF) << 24) | ((bg >> 16) & 0xFF) | (bg & 0xFF00) | ((bg & 0xFF) << 16);", "-\t\t\t\t\t\t\t\tint /*long*/ color = Gdip.Color_new(argb); ", "-\t\t\t\t\t\t\t\tint /*long*/ brush = Gdip.SolidBrush_new(color);", "-\t\t\t\t\t\t\t\tGdip.Graphics_FillRectangle(gdipGraphics, brush, drawX, drawY, run.width, lineHeight);", "-\t\t\t\t\t\t\t\tGdip.Color_delete(color);", "-\t\t\t\t\t\t\t\tGdip.SolidBrush_delete(brush);", "-\t\t\t\t\t\t\t} else {", "-\t\t\t\t\t\t\t\tint /*long*/ hBrush = OS.CreateSolidBrush (bg);", "-\t\t\t\t\t\t\t\tint /*long*/ oldBrush = OS.SelectObject(hdc, hBrush);", "-\t\t\t\t\t\t\t\tOS.PatBlt(hdc, drawX, drawY, run.width, lineHeight, OS.PATCOPY);", "-\t\t\t\t\t\t\t\tOS.SelectObject(hdc, oldBrush);", "-\t\t\t\t\t\t\t\tOS.DeleteObject(hBrush);", "-\t\t\t\t\t\t\t}", "-\t\t\t\t\t\t}", "-\t\t\t\t\t\tboolean partialSelection = hasSelection && !(selectionStart > end || run.start > selectionEnd);", "-\t\t\t\t\t\tif (partialSelection) {", "-\t\t\t\t\t\t\tint selStart = Math.max(selectionStart, run.start) - run.start;", "-\t\t\t\t\t\t\tint selEnd = Math.min(selectionEnd, end) - run.start;", "-\t\t\t\t\t\t\tint cChars = run.length;", "-\t\t\t\t\t\t\tint gGlyphs = run.glyphCount;", "-\t\t\t\t\t\t\tint[] piX = new int[1];", "-\t\t\t\t\t\t\tint /*long*/ advances = run.justify != 0 ? run.justify : run.advances;", "-\t\t\t\t\t\t\tOS.ScriptCPtoX(selStart, false, cChars, gGlyphs, run.clusters, run.visAttrs, advances, run.analysis, piX);", "-\t\t\t\t\t\t\tint runX = (orientation & SWT.RIGHT_TO_LEFT) != 0 ? run.width - piX[0] : piX[0];", "-\t\t\t\t\t\t\trect.left = drawX + runX;", "-\t\t\t\t\t\t\trect.top = drawY;", "-\t\t\t\t\t\t\tOS.ScriptCPtoX(selEnd, true, cChars, gGlyphs, run.clusters, run.visAttrs, advances, run.analysis, piX);", "-\t\t\t\t\t\t\trunX = (orientation & SWT.RIGHT_TO_LEFT) != 0 ? run.width - piX[0] : piX[0];", "-\t\t\t\t\t\t\trect.right = drawX + runX;", "-\t\t\t\t\t\t\trect.bottom = drawY + lineHeight;", "-\t\t\t\t\t\t\tif (gdip) {", "-\t\t\t\t\t\t\t\tif (rect.left > rect.right) {", "-\t\t\t\t\t\t\t\t\tint tmp = rect.left;", "-\t\t\t\t\t\t\t\t\trect.left = rect.right;", "-\t\t\t\t\t\t\t\t\trect.right = tmp;", "-\t\t\t\t\t\t\t\t}", "-\t\t\t\t\t\t\t\tGdip.Graphics_FillRectangle(gdipGraphics, selBrush, rect.left, rect.top, rect.right - rect.left, rect.bottom - rect.top);", "-\t\t\t\t\t\t\t} else {", "-\t\t\t\t\t\t\t\tOS.SelectObject(hdc, selBrush);", "-\t\t\t\t\t\t\t\tOS.PatBlt(hdc, rect.left, rect.top, rect.right - rect.left, rect.bottom - rect.top, OS.PATCOPY);", "-\t\t\t\t\t\t\t}", "-\t\t\t\t\t\t}", "+\t\t\t\t\t\tdrawRunBackground(run, hdc, rect, selectionStart, selectionEnd, selBrush, hasSelection);", "+\t}", "+}"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "de81ca857539e6792364222de42c46fa", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT/win32/org/eclipse/swt/graphics/TextLayout.java", "commitBeforeChange": "58383f412ad2510abd15afdf3cb00667e6c434a4", "commitAfterChange": "c53caa95e55e48c3856ff305cfe3f6f8e3107f36", "methodNumberBeforeChange": 14, "methodNumberAfterChange": 14, "signatureBeforeChange": "  RECT drawBorder(boolean advance, int graphics, int x, int y, int lineHeight, int color, int selectionColor, boolean fullSelection, RECT clipRect, RECT rect, int alpha, StyleItem[] line, int index, int selectionStart, int selectionEnd)", "signatureAfterChange": "  RECT drawBorder(int hdc, int x, int y, int lineHeight, StyleItem[] line, int index, int color, int selectionColor, RECT clipRect, RECT pRect, int selectionStart, int selectionEnd)", "diff": ["+", "+RECT drawBorder(int /*long*/ hdc, int x, int y, int lineHeight, StyleItem[] line, int index, int /*long*/ color, int /*long*/ selectionColor, RECT clipRect, RECT pRect, int selectionStart, int selectionEnd) {", "+\tStyleItem run = line[index]; ", "+\tTextStyle style = run.style;", "+\tif (style == null) return null;", "+\tif (style.borderStyle == SWT.NONE) return null;", "+\tclipRect = addClipRect(run, clipRect, pRect, selectionStart, selectionEnd);", "+\tif (index + 1 >= line.length || !style.isAdherentBorder(line[index + 1].style)) {", "+\t\tint left = run.x;", "+\t\tint start = run.start;", "+\t\tint end = run.start + run.length - 1;", "+\t\tfor (int i = index; i > 0 && style.isAdherentBorder(line[i - 1].style); i--) {", "+\t\t\tleft = line[i - 1].x;", "+\t\t\tstart = Math.min(start, line[i - 1].start);", "+\t\t\tend = Math.max(end, line[i - 1].start + line[i - 1].length - 1);", "+\t\t}", "+\t\tboolean hasSelection = selectionStart <= selectionEnd && selectionStart != -1 && selectionEnd != -1;", "+\t\tboolean fullSelection = hasSelection && selectionStart <= start && end <= selectionEnd;", "+\t\tif (style.borderColor != null) {", "+\t\t\tcolor = style.borderColor.handle;", "+\t\t\tclipRect = null;", "+\t\t} else {", "+\t\t\tif (fullSelection) {", "+\t\t\t\tcolor = selectionColor;", "+\t\t\t\tclipRect = null;", "+\t\t\t} else {", "+\t\t\t\tif (style.foreground != null) {", "+\t\t\t\t\tcolor = style.foreground.handle;", "+\t\t\t\t}", "+\t\t\t}", "+\t\t}", "+\t\tint lineWidth = 1;", "+\t\tint lineStyle = OS.PS_SOLID;", "+\t\tswitch (style.borderStyle) {", "+\t\t\tcase SWT.BORDER_SOLID: break;", "+\t\t\tcase SWT.BORDER_DASH: lineStyle = OS.PS_DASH; break;", "+\t\t\tcase SWT.BORDER_DOT: lineStyle = OS.PS_DOT; break;", "+\t\t}", "+\t\tint /*long*/ oldBrush = OS.SelectObject(hdc, OS.GetStockObject(OS.NULL_BRUSH));", "+\t\tLOGBRUSH logBrush = new LOGBRUSH();", "+\t\tlogBrush.lbStyle = OS.BS_SOLID;", "+\t\tlogBrush.lbColor = /*64*/(int)color;", "+\t\tint /*long*/ newPen = OS.ExtCreatePen(lineStyle | OS.PS_GEOMETRIC, Math.max(1, lineWidth), logBrush, 0, null);", "+\t\tint /*long*/ oldPen = OS.SelectObject(hdc, newPen);", "+\t\tOS.Rectangle(hdc, x + left, y, x + run.x + run.width, y + lineHeight);", "+\t\tOS.SelectObject(hdc, oldPen);", "+\t\tOS.DeleteObject(newPen);", "+\t\tif (clipRect != null) {", "+\t\t\tint state = OS.SaveDC(hdc);", "+\t\t\tif (clipRect.left == -1) clipRect.left = 0;", "+\t\t\tif (clipRect.right == -1) clipRect.right = 0x7ffff;", "+\t\t\tOS.IntersectClipRect(hdc, clipRect.left, clipRect.top, clipRect.right, clipRect.bottom);", "+\t\t\tlogBrush.lbColor = /*64*/(int)selectionColor;", "+\t\t\tint /*long*/ selPen = OS.ExtCreatePen (lineStyle | OS.PS_GEOMETRIC, Math.max(1, lineWidth), logBrush, 0, null);", "+\t\t\toldPen = OS.SelectObject(hdc, selPen);", "+\t\t\tOS.Rectangle(hdc, x + left, y, x + run.x + run.width, y + lineHeight);", "+\t\t\tOS.RestoreDC(hdc, state);", "+\t\t\tOS.SelectObject(hdc, oldPen);", "+\t\t\tOS.DeleteObject(selPen);", "+\t\t}", "+\t\tOS.SelectObject(hdc, oldBrush);", "+\t\treturn null;", "+\t}", "+\treturn clipRect;", "+}", "-RECT drawBorder(boolean advance, int /*long*/ graphics, int x, int y, int lineHeight, int /*long*/ color, int /*long*/ selectionColor, boolean fullSelection, RECT clipRect, RECT rect, int alpha, StyleItem[] line, int index, int selectionStart, int selectionEnd) {", "-\tStyleItem run = line[index]; ", "-\tTextStyle style = run.style;", "-\tif (style == null) return null;", "-\tif (style.borderStyle == SWT.NONE) return null;", "-\tif (rect != null) {", "-\t\tif (clipRect == null) {", "-\t\t\tclipRect = new RECT ();", "-\t\t\tOS.SetRect(clipRect, -1, rect.top, -1, rect.bottom);", "-\t\t}", "-\t\tboolean isRTL = (orientation & SWT.RIGHT_TO_LEFT) != 0;", "-\t\tif (run.start <= selectionStart && selectionStart <= run.start + run.length) {", "-\t\t\tif (run.analysis.fRTL ^ isRTL) {", "-\t\t\t\tclipRect.right = rect.left;", "-\t\t\t} else {", "-\t\t\t\tclipRect.left = rect.left;", "-\t\t\t}", "-\t\t}", "-\t\tif (run.start <= selectionEnd && selectionEnd <= run.start + run.length) {", "-\t\t\tif (run.analysis.fRTL ^ isRTL) {", "-\t\t\t\tclipRect.left = rect.right;", "-\t\t\t} else {", "-\t\t\t\tclipRect.right = rect.right;", "-\t\t\t}", "-\tif (index + 1 >= line.length || !style.isAdherentBorder(line[index + 1].style)) {", "-\t\tint left = run.x;", "-\t\tfor (int i = index; i > 0 && style.isAdherentBorder(line[i - 1].style); i--) {", "-\t\t\tleft = line[i - 1].x;", "-\t\tif (advance) {", "-\t\t\tint /*long*/ brush = color;", "-\t\t\tint customColor = -1;", "-\t\t\tif (style.borderColor != null) {", "-\t\t\t\tcustomColor = style.borderColor.handle;", "-\t\t\t} else {", "-\t\t\t\tif (style.foreground != null) {", "-\t\t\t\t\tcustomColor = style.foreground.handle;", "-\t\t\t\t}", "-\t\t\t\tif (fullSelection && clipRect == null) {", "-\t\t\t\t\tcustomColor = -1;", "-\t\t\t\t\tbrush = selectionColor;", "-\t\t\t\t}", "-\t\t\t}", "-\t\t\tif (customColor != -1) {", "-\t\t\t\tint argb = ((alpha & 0xFF) << 24) | ((customColor >> 16) & 0xFF) | (customColor & 0xFF00) | ((customColor & 0xFF) << 16);", "-\t\t\t\tint /*long*/ gdiColor = Gdip.Color_new(argb); ", "-\t\t\t\tbrush = Gdip.SolidBrush_new(gdiColor);", "-\t\t\t\tGdip.Color_delete(gdiColor);\t", "-\t\t\t}", "-\t\t\tint lineWidth = 1;", "-\t\t\tint lineStyle = Gdip.DashStyleSolid;", "-\t\t\tswitch (style.borderStyle) {", "-\t\t\t\tcase SWT.BORDER_SOLID: break;", "-\t\t\t\tcase SWT.BORDER_DASH: lineStyle = Gdip.DashStyleDash; break;", "-\t\t\t\tcase SWT.BORDER_DOT: lineStyle = Gdip.DashStyleDot; break;", "-\t\t\t}", "-\t\t\tint /*long*/ pen = Gdip.Pen_new(brush, lineWidth);", "-\t\t\tGdip.Pen_SetDashStyle(pen, lineStyle);", "-\t\t\tfloat gdipXOffset = 0.5f, gdipYOffset = 0.5f;", "-\t\t\tGdip.Graphics_TranslateTransform(graphics, gdipXOffset, gdipYOffset, Gdip.MatrixOrderPrepend);", "-\t\t\tif (style.borderColor == null && clipRect != null) {", "-\t\t\t\tint gstate = Gdip.Graphics_Save(graphics);", "-\t\t\t\tif (clipRect.left == -1) clipRect.left = 0;", "-\t\t\t\tif (clipRect.right == -1) clipRect.right = 0x7ffff;", "-\t\t\t\tRect gdipRect = new Rect();", "-\t\t\t\tgdipRect.X = clipRect.left;", "-\t\t\t\tgdipRect.Y = clipRect.top;", "-\t\t\t\tgdipRect.Width = clipRect.right - clipRect.left;", "-\t\t\t\tgdipRect.Height = clipRect.bottom - clipRect.top;", "-\t\t\t\tGdip.Graphics_SetClip(graphics, gdipRect, Gdip.CombineModeExclude);", "-\t\t\t\tGdip.Graphics_DrawRectangle(graphics, pen, x + left, y, run.x + run.width - left - 1, lineHeight - 1);", "-\t\t\t\tGdip.Graphics_Restore(graphics, gstate);", "-\t\t\t\tgstate = Gdip.Graphics_Save(graphics);", "-\t\t\t\tGdip.Graphics_SetClip(graphics, gdipRect, Gdip.CombineModeIntersect);", "-\t\t\t\tint /*long*/ selPen = Gdip.Pen_new(selectionColor, lineWidth);", "-\t\t\t\tGdip.Pen_SetDashStyle(pen, lineStyle);", "-\t\t\t\tGdip.Graphics_DrawRectangle(graphics, selPen, x + left, y, run.x + run.width - left - 1, lineHeight - 1);", "-\t\t\t\tGdip.Pen_delete(selPen);", "-\t\t\t\tGdip.Graphics_Restore(graphics, gstate);", "-\t\t\t} else {", "-\t\t\t\tGdip.Graphics_DrawRectangle(graphics, pen, x + left, y, run.x + run.width - left - 1, lineHeight - 1);", "-\t\t\t}", "-\t\t\tGdip.Graphics_TranslateTransform(graphics, -gdipXOffset, -gdipYOffset, Gdip.MatrixOrderPrepend);", "-\t\t\tGdip.Pen_delete(pen);", "-\t\t\tif (customColor != -1) Gdip.SolidBrush_delete(brush);", "-\t\t\tif (style.borderColor != null) {", "-\t\t\t\tcolor = style.borderColor.handle;", "-\t\t\t\tif (fullSelection && clipRect == null) {", "-\t\t\t\t\tcolor = selectionColor;", "-\t\t\t\t}", "-\t\t\tint lineWidth = 1;", "-\t\t\tint lineStyle = OS.PS_SOLID;", "-\t\t\tswitch (style.borderStyle) {", "-\t\t\t\tcase SWT.BORDER_SOLID: break;", "-\t\t\t\tcase SWT.BORDER_DASH: lineStyle = OS.PS_DASH; break;", "-\t\t\t\tcase SWT.BORDER_DOT: lineStyle = OS.PS_DOT; break;", "-\t\t\t}", "-\t\t\tLOGBRUSH logBrush = new LOGBRUSH();", "-\t\t\tlogBrush.lbStyle = OS.BS_SOLID;", "-\t\t\tlogBrush.lbColor = /*64*/(int)color;", "-\t\t\tint /*long*/ newPen = OS.ExtCreatePen(lineStyle | OS.PS_GEOMETRIC, Math.max(1, lineWidth), logBrush, 0, null);", "-\t\t\tint /*long*/ oldPen = OS.SelectObject(graphics, newPen);", "-\t\t\tint /*long*/ oldBrush = OS.SelectObject(graphics, OS.GetStockObject(OS.NULL_BRUSH));", "-\t\t\tOS.Rectangle(graphics, x + left, y, x + run.x + run.width, y + lineHeight);", "-\t\t\tif (style.borderColor == null && clipRect != null && color != selectionColor) {", "-\t\t\t\tint state = OS.SaveDC(graphics);", "-\t\t\t\tif (clipRect.left == -1) clipRect.left = 0;", "-\t\t\t\tif (clipRect.right == -1) clipRect.right = 0x7ffff;", "-\t\t\t\tOS.IntersectClipRect(graphics, clipRect.left, clipRect.top, clipRect.right, clipRect.bottom);", "-\t\t\t\tlogBrush.lbColor = /*64*/(int)selectionColor;", "-\t\t\t\tint /*long*/ selPen = OS.ExtCreatePen (lineStyle | OS.PS_GEOMETRIC, Math.max(1, lineWidth), logBrush, 0, null);", "-\t\t\t\tOS.SelectObject(graphics, selPen);", "-\t\t\t\tOS.Rectangle(graphics, x + left, y, x + run.x + run.width, y + lineHeight);", "-\t\t\t\tOS.RestoreDC(graphics, state);", "-\t\t\t\tOS.SelectObject(graphics, newPen);", "-\t\t\t\tOS.DeleteObject(selPen);", "-\t\t\t}", "-\t\t\tOS.SelectObject(graphics, oldBrush);", "-\t\t\tOS.SelectObject(graphics, oldPen);", "-\t\t\tOS.DeleteObject(newPen);"]}], "num": 17629}