{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "51a7c2643d5b2a1b17141c9bc67cf904", "detectedBy": ["DIFF_HIERARCHICAL", "DIFF_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "4ef1142d610b65c88de749d9e63cecfe", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Printing/cocoa/org/eclipse/swt/printing/Printer.java", "commitBeforeChange": "36e21f6aba5204fa5195a71658979a8b334d36bf", "commitAfterChange": "77b4feca7776d7a102f6b78d108d292827dbe92c", "methodNumberBeforeChange": 5, "methodNumberAfterChange": 5, "signatureBeforeChange": " protected void create(DeviceData deviceData)", "signatureAfterChange": " protected void create(DeviceData deviceData)", "diff": ["-\tdata = (PrinterData)deviceData;", "-\tif (data.otherData != null) {", "-\t\tNSData nsData = NSData.dataWithBytes(data.otherData, data.otherData.length);", "-\t\tprintInfo = new NSPrintInfo(NSKeyedUnarchiver.unarchiveObjectWithData(nsData).id);", "-\t} else {", "-\t\tprintInfo = NSPrintInfo.sharedPrintInfo();", "+\tNSAutoreleasePool pool = (NSAutoreleasePool) new NSAutoreleasePool().alloc().init();", "+\ttry {", "+\t\tdata = (PrinterData)deviceData;", "+\t\tif (data.otherData != null) {", "+\t\t\tNSData nsData = NSData.dataWithBytes(data.otherData, data.otherData.length);", "+\t\t\tprintInfo = new NSPrintInfo(NSKeyedUnarchiver.unarchiveObjectWithData(nsData).id);", "+\t\t} else {", "+\t\t\tprintInfo = NSPrintInfo.sharedPrintInfo();", "+\t\t}", "+\t\tprintInfo.retain();", "+\t\tprinter = NSPrinter.printerWithName(NSString.stringWith(data.name));", "+\t\tif (printer != null) {", "+\t\t\tprinter.retain();", "+\t\t\tprintInfo.setPrinter(printer);", "+\t\t}", "+\t\t/*", "+\t\t* Bug in Cocoa.  For some reason, the output still goes to the printer when", "+\t\t* the user chooses the preview button.  The fix is to reset the job disposition.", "+\t\t*/", "+\t\tNSString job = printInfo.jobDisposition();", "+\t\tif (job.isEqual(new NSString(OS.NSPrintPreviewJob()))) {", "+\t\t\tprintInfo.setJobDisposition(job);", "+\t\t}", "+\t\tNSRect rect = new NSRect();", "+\t\twindow = (NSWindow)new NSWindow().alloc();", "+\t\twindow.initWithContentRect(rect, OS.NSBorderlessWindowMask, OS.NSBackingStoreBuffered, false);", "+\t\tString className = \"SWTPrinterView\"; //$NON-NLS-1$", "+\t\tif (OS.objc_lookUpClass(className) == 0) {", "+\t\t\tIsFlipped = new Callback(getClass(), \"isFlipped\", 2); //$NON-NLS-1$", "+\t\t\tint /*long*/ cls = OS.objc_allocateClassPair(OS.class_NSView, className, 0);", "+\t\t\tOS.class_addMethod(cls, OS.sel_isFlipped, IsFlipped.getAddress(), \"@:\");", "+\t\t\tOS.objc_registerClassPair(cls);", "+\t\t}", "+\t\tview = (NSView)new SWTPrinterView().alloc();", "+\t\tview.initWithFrame(rect);", "+\t\twindow.setContentView(view);", "+\t\toperation = NSPrintOperation.printOperationWithView(view, printInfo);", "+\t\toperation.retain();", "+\t\toperation.setShowsPrintPanel(false);", "+\t\toperation.setShowsProgressPanel(false);", "+\t} finally {", "+\t\tpool.release();", "-\tprintInfo.retain();", "-\tprinter = NSPrinter.printerWithName(NSString.stringWith(data.name));", "-\tif (printer != null) {", "-\t\tprinter.retain();", "-\t\tprintInfo.setPrinter(printer);", "-\t}", "-\t/*", "-\t* Bug in Cocoa.  For some reason, the output still goes to the printer when", "-\t* the user chooses the preview button.  The fix is to reset the job disposition.", "-\t*/", "-\tNSString job = printInfo.jobDisposition();", "-\tif (job.isEqual(new NSString(OS.NSPrintPreviewJob()))) {", "-\t\tprintInfo.setJobDisposition(job);", "-\t}", "-\tNSRect rect = new NSRect();", "-\twindow = (NSWindow)new NSWindow().alloc();", "-\twindow.initWithContentRect(rect, OS.NSBorderlessWindowMask, OS.NSBackingStoreBuffered, false);", "-\tString className = \"SWTPrinterView\"; //$NON-NLS-1$", "-\tif (OS.objc_lookUpClass(className) == 0) {", "-\t\tIsFlipped = new Callback(getClass(), \"isFlipped\", 2); //$NON-NLS-1$", "-\t\tint /*long*/ cls = OS.objc_allocateClassPair(OS.class_NSView, className, 0);", "-\t\tOS.class_addMethod(cls, OS.sel_isFlipped, IsFlipped.getAddress(), \"@:\");", "-\t\tOS.objc_registerClassPair(cls);", "-\t}", "-\tview = (NSView)new SWTPrinterView().alloc();", "-\tview.initWithFrame(rect);", "-\twindow.setContentView(view);", "-\toperation = NSPrintOperation.printOperationWithView(view, printInfo);", "-\toperation.retain();", "-\toperation.setShowsPrintPanel(false);", "-\toperation.setShowsProgressPanel(false);"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "24313a9fbd0079b02c79c4fecb4ff9bf", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Printing/cocoa/org/eclipse/swt/printing/Printer.java", "commitBeforeChange": "5a273c2ef1049cff7bd4d5ace6d67f7530a2ce69", "commitAfterChange": "d82f468e8a6accd5f41ed231ffa40f1a1b2c192a", "methodNumberBeforeChange": 5, "methodNumberAfterChange": 5, "signatureBeforeChange": " protected void create(DeviceData deviceData)", "signatureAfterChange": " protected void create(DeviceData deviceData)", "diff": ["-\tNSThread nsthread = NSThread.currentThread();", "-\tNSMutableDictionary dictionary = nsthread.threadDictionary();", "-\tNSString key = NSString.stringWith(\"SWT_NSAutoreleasePool\");", "-\tpool = new NSAutoreleasePool(dictionary.objectForKey(key));", "-", "-\tdata = (PrinterData)deviceData;", "-\tif (data.otherData != null) {", "-\t\tNSData nsData = NSData.dataWithBytes(data.otherData, data.otherData.length);", "-\t\tprintInfo = new NSPrintInfo(NSKeyedUnarchiver.unarchiveObjectWithData(nsData).id);", "-\t} else {", "-\t\tprintInfo = NSPrintInfo.sharedPrintInfo();", "+\tNSAutoreleasePool pool = null;", "+\tif (!NSThread.isMainThread()) pool = (NSAutoreleasePool) new NSAutoreleasePool().alloc().init();", "+\ttry {", "+\t\tdata = (PrinterData)deviceData;", "+\t\tif (data.otherData != null) {", "+\t\t\tNSData nsData = NSData.dataWithBytes(data.otherData, data.otherData.length);", "+\t\t\tprintInfo = new NSPrintInfo(NSKeyedUnarchiver.unarchiveObjectWithData(nsData).id);", "+\t\t} else {", "+\t\t\tprintInfo = NSPrintInfo.sharedPrintInfo();", "+\t\t}", "+\t\tprintInfo.retain();", "+\t\tprinter = NSPrinter.printerWithName(NSString.stringWith(data.name));", "+\t\tif (printer != null) {", "+\t\t\tprinter.retain();", "+\t\t\tprintInfo.setPrinter(printer);", "+\t\t}", "+\t\t/*", "+\t\t* Bug in Cocoa.  For some reason, the output still goes to the printer when", "+\t\t* the user chooses the preview button.  The fix is to reset the job disposition.", "+\t\t*/", "+\t\tNSString job = printInfo.jobDisposition();", "+\t\tif (job.isEqual(new NSString(OS.NSPrintPreviewJob()))) {", "+\t\t\tprintInfo.setJobDisposition(job);", "+\t\t}", "+\t\tNSRect rect = new NSRect();", "+\t\twindow = (NSWindow)new NSWindow().alloc();", "+\t\twindow.initWithContentRect(rect, OS.NSBorderlessWindowMask, OS.NSBackingStoreBuffered, false);", "+\t\tString className = \"SWTPrinterView\"; //$NON-NLS-1$", "+\t\tif (OS.objc_lookUpClass(className) == 0) {", "+\t\t\tIsFlipped = new Callback(getClass(), \"isFlipped\", 2); //$NON-NLS-1$", "+\t\t\tint /*long*/ cls = OS.objc_allocateClassPair(OS.class_NSView, className, 0);", "+\t\t\tOS.class_addMethod(cls, OS.sel_isFlipped, IsFlipped.getAddress(), \"@:\");", "+\t\t\tOS.objc_registerClassPair(cls);", "+\t\t}", "+\t\tview = (NSView)new SWTPrinterView().alloc();", "+\t\tview.initWithFrame(rect);", "+\t\twindow.setContentView(view);", "+\t\toperation = NSPrintOperation.printOperationWithView(view, printInfo);", "+\t\toperation.retain();", "+\t\toperation.setShowsPrintPanel(false);", "+\t\toperation.setShowsProgressPanel(false);", "+\t} finally {", "+\t\tif (pool != null) pool.release();", "-\tprintInfo.retain();", "-\tprinter = NSPrinter.printerWithName(NSString.stringWith(data.name));", "-\tif (printer != null) {", "-\t\tprinter.retain();", "-\t\tprintInfo.setPrinter(printer);", "-\t}", "-\t/*", "-\t* Bug in Cocoa.  For some reason, the output still goes to the printer when", "-\t* the user chooses the preview button.  The fix is to reset the job disposition.", "-\t*/", "-\tNSString job = printInfo.jobDisposition();", "-\tif (job.isEqual(new NSString(OS.NSPrintPreviewJob()))) {", "-\t\tprintInfo.setJobDisposition(job);", "-\t}", "-\tNSRect rect = new NSRect();", "-\twindow = (NSWindow)new NSWindow().alloc();", "-\twindow.initWithContentRect(rect, OS.NSBorderlessWindowMask, OS.NSBackingStoreBuffered, false);", "-\tString className = \"SWTPrinterView\"; //$NON-NLS-1$", "-\tif (OS.objc_lookUpClass(className) == 0) {", "-\t\tIsFlipped = new Callback(getClass(), \"isFlipped\", 2); //$NON-NLS-1$", "-\t\tint /*long*/ cls = OS.objc_allocateClassPair(OS.class_NSView, className, 0);", "-\t\tOS.class_addMethod(cls, OS.sel_isFlipped, IsFlipped.getAddress(), \"@:\");", "-\t\tOS.objc_registerClassPair(cls);", "-\t}", "-\tview = (NSView)new SWTPrinterView().alloc();", "-\tview.initWithFrame(rect);", "-\twindow.setContentView(view);", "-\toperation = NSPrintOperation.printOperationWithView(view, printInfo);", "-\toperation.retain();", "-\toperation.setShowsPrintPanel(false);", "-\toperation.setShowsProgressPanel(false);"]}], "num": 22035}