{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "34e9226d6ca7607aa8a739fdf55e42bb", "detectedBy": ["DIFF_HIERARCHICAL"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "b6782552fdc4b20f3734c6b5554a2254", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Drag and Drop/gtk/org/eclipse/swt/dnd/TextTransfer.java", "commitBeforeChange": "67976c6abaf5a07314770e0734a67e21100216a3", "commitAfterChange": "8e7bdacd1dbbc7e29ab695539fe4d98a2a8aee35", "methodNumberBeforeChange": 3, "methodNumberAfterChange": 3, "signatureBeforeChange": " public Object nativeToJava(TransferData transferData)", "signatureAfterChange": " public Object nativeToJava(TransferData transferData)", "diff": ["-\t// get byte array from super", "-\tbyte[] buffer = (byte[])super.nativeToJava(transferData);", "+\tbyte[] buffer = null;", "+\tif (transferData.type == TYPEID1) { // COMPOUND_TEXT", "+\t\tint[] list = new int[1];", "+\t\tint count = OS.gdk_text_property_to_utf8_list(transferData.type, transferData.format, transferData.pValue, transferData.length, list);", "+\t\tif (count == 0) {", "+\t\t\ttransferData.result = 0;", "+\t\t} else {", "+\t\t\tint[] ptr = new int[1];", "+\t\t\tOS.memmove(ptr, list[0], 4);", "+\t\t\tint length = OS.g_utf8_strlen(ptr[0], -1) * 8;", "+\t\t\tbuffer = new byte[length];", "+\t\t\tOS.memmove(buffer, ptr[0], length);", "+\t\t\tOS.g_strfreev(list[0]);", "+\t\t}", "+\t} else {", "+\t\tbuffer = (byte[])super.nativeToJava(transferData);", "+\t}"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "94d1eaa493d282425a2fe40f50c8a439", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Drag and Drop/gtk/org/eclipse/swt/dnd/TextTransfer.java", "commitBeforeChange": "67976c6abaf5a07314770e0734a67e21100216a3", "commitAfterChange": "8e7bdacd1dbbc7e29ab695539fe4d98a2a8aee35", "methodNumberBeforeChange": 2, "methodNumberAfterChange": 2, "signatureBeforeChange": " public void javaToNative (Object object, TransferData transferData)", "signatureAfterChange": " public void javaToNative (Object object, TransferData transferData)", "diff": ["-\tsuper.javaToNative(buffer, transferData);", "+\tif  (transferData.type ==  TYPEID1) { // COMPOUND_TEXT", "+\t\tint[] encoding = new int[1];", "+\t\tint[] format = new int[1];", "+\t\tint[] ctext = new int[1];", "+\t\tint[] length = new int[1];", "+\t\tboolean result = OS.gdk_utf8_to_compound_text(buffer, encoding, format, ctext, length);", "+\t\tif (!result) {", "+\t\t\ttransferData.result = 0;", "+\t\t} else {", "+\t\t\ttransferData.type = encoding[0];", "+\t\t\ttransferData.format = format[0];", "+\t\t\ttransferData.length = length[0];", "+\t\t\ttransferData.pValue = ctext[0];", "+\t\t\ttransferData.result = 1;", "+\t\t}", "+\t} else {", "+\t\tsuper.javaToNative(buffer, transferData);", "+\t}"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "6ad594bf60c14c82d6777c7b2d40bc03", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Drag and Drop/motif/org/eclipse/swt/dnd/TextTransfer.java", "commitBeforeChange": "33f2a3b50a61626d5964cb87570beb2c3096fcc1", "commitAfterChange": "40ae2a746cec0132025185d602a721edfecbbfea", "methodNumberBeforeChange": 2, "methodNumberAfterChange": 2, "signatureBeforeChange": " public void javaToNative (Object object, TransferData transferData)", "signatureAfterChange": " public void javaToNative (Object object, TransferData transferData)", "diff": ["-\tbyte [] buffer = Converter.wcsToMbcs (null, (String)object, true);\r", "-\tsuper.javaToNative(buffer, transferData);\r", "+\tbyte[] buffer = Converter.wcsToMbcs (null, (String)object, true);\r", "+\tif (transferData.type == TYPEID1) { // COMPOUND_TEXT\r", "+\t\tDisplay display = Display.getCurrent();\r", "+\t\tif (display == null) {\r", "+\t\t\ttransferData.result = 0;\r", "+\t\t\treturn;\r", "+\t\t}\r", "+\t\tint xDisplay = display.xDisplay;\r", "+\t\tint pBuffer = OS.XtMalloc(buffer.length);\r", "+\t\tOS.memmove(pBuffer, buffer, buffer.length);\r", "+\t\tint list = OS.XtMalloc(4);\r", "+\t\tOS.memmove(list, new int[] {pBuffer}, 4);\r", "+\t\tXTextProperty text_prop_return = new XTextProperty();\r", "+\t\tint result = OS.XmbTextListToTextProperty (xDisplay, list, 1, OS.XCompoundTextStyle, text_prop_return);\r", "+\t\tOS.XtFree(pBuffer);\r", "+\t\tOS.XtFree(list);\r", "+\t\tif (result != 0){\r", "+\t\t\ttransferData.result = 0;\r", "+\t\t} else {\t\r", "+\t\t\ttransferData.format = text_prop_return.format;\r", "+\t\t\ttransferData.length = text_prop_return.nitems;\r", "+\t\t\ttransferData.pValue = text_prop_return.value;\r", "+\t\t\ttransferData.type = text_prop_return.encoding;\r", "+\t\t\ttransferData.result = 1;\r", "+\t\t}\r", "+\t} else {\r", "+\t\tsuper.javaToNative(buffer, transferData);\r", "+\t}\r"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "557da40838d8a964b864ffa64606f6c1", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Drag and Drop/motif/org/eclipse/swt/dnd/TextTransfer.java", "commitBeforeChange": "33f2a3b50a61626d5964cb87570beb2c3096fcc1", "commitAfterChange": "40ae2a746cec0132025185d602a721edfecbbfea", "methodNumberBeforeChange": 3, "methodNumberAfterChange": 3, "signatureBeforeChange": " public Object nativeToJava(TransferData transferData)", "signatureAfterChange": " public Object nativeToJava(TransferData transferData)", "diff": ["-\tbyte[] buffer = (byte[])super.nativeToJava(transferData);\r", "+\tbyte[] buffer = null;\r", "+\tif (transferData.type == TYPEID1){ //COMPOUND_TEXT\r", "+\t\tDisplay display = Display.getCurrent();\r", "+\t\tif (display == null) return null;\r", "+\t\tint xDisplay = display.xDisplay;\r", "+\t\tXTextProperty text_prop = new XTextProperty();\r", "+\t\ttext_prop.encoding = transferData.type;\r", "+\t\ttext_prop.format = transferData.format;\r", "+\t\ttext_prop.nitems = transferData.length;\r", "+\t\ttext_prop.value = transferData.pValue;\r", "+\t\tint[] list_return = new int[1];\r", "+\t\tint[] count_return = new int[1];\r", "+\t\tint result = OS.XmbTextPropertyToTextList (xDisplay, text_prop, list_return, count_return);\r", "+\t\tif (result != 0) return null;\r", "+\t\t//Note: only handling the first string in list\r", "+\t\tint[] ptr = new int[1];\r", "+\t\tOS.memmove(ptr, list_return[0], 4);\r", "+\t\tint length = OS.strlen(ptr[0]);\r", "+\t\tbuffer = new byte[length];\r", "+\t\tOS.memmove(buffer, ptr[0], buffer.length);\r", "+\t\tOS.XFreeStringList(list_return[0]);\r", "+\t} else {\r", "+\t\tbuffer = (byte[])super.nativeToJava(transferData);\r", "+\t}\r"]}], "num": 5098}