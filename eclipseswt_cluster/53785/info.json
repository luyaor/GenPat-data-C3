{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "66f7b83e55c9ee971ef0379503c254c8", "detectedBy": ["DIFF_HIERARCHICAL", "DIFF_DBSCAN", "AST_HIERARCHICAL", "AST_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "1cb59eb25ab711d3d23db8305aee860a", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Drag and Drop/win32/org/eclipse/swt/dnd/RTFTransfer.java", "commitBeforeChange": "5be038b998cd27bf503c68ee3f43ba54105e38ff", "commitAfterChange": "fb65c554be6a3a1e1959739ca6c1354d5cc361a3", "methodNumberBeforeChange": 3, "methodNumberAfterChange": 3, "signatureBeforeChange": "\r public Object nativeToJava(TransferData transferData)", "signatureAfterChange": "\r public Object nativeToJava(TransferData transferData)", "diff": ["-\t// get byte array from super\r", "-\tbyte[] buffer = (byte[])super.nativeToJava(transferData);\r", "-\tif (buffer == null) return null;\r", "-\t// convert byte array to a string\r", "-\tString string = new String(buffer);\r", "-\t// remove null terminator\r", "-\tint index = string.indexOf(\"\\0\");\r", "-\tstring = string.substring(0, index);\r", "-\treturn string;\r", "+\tif (!isSupportedType(transferData) || transferData.pIDataObject == 0) {\r", "+\t\ttransferData.result = COM.E_FAIL;\r", "+\t\treturn null;\r", "+\t}\r", "+\t\r", "+\tIDataObject data = new IDataObject(transferData.pIDataObject);\r", "+\tdata.AddRef();\r", "+\tSTGMEDIUM stgmedium = new STGMEDIUM();\r", "+\tFORMATETC formatetc = transferData.formatetc;\r", "+\tstgmedium.tymed = COM.TYMED_HGLOBAL;\t\r", "+\ttransferData.result = data.GetData(formatetc, stgmedium);\r", "+\tdata.Release();\t\r", "+\tif (transferData.result != COM.S_OK) return null;\r", "+\r", "+\tint lpMultiByteStr = COM.GlobalLock(stgmedium.unionField);\r", "+\tif (lpMultiByteStr != 0) {\r", "+\t\ttry {\r", "+\t\t\tint cchWideChar  = OS.MultiByteToWideChar (CodePage, OS.MB_PRECOMPOSED, lpMultiByteStr, -1, null, 0);\r", "+\t\t\tif (cchWideChar != 0) {\r", "+\t\t\t\tchar[] lpWideCharStr = new char [cchWideChar];\r", "+\t\t\t\tOS.MultiByteToWideChar (CodePage, OS.MB_PRECOMPOSED, lpMultiByteStr, -1, lpWideCharStr, cchWideChar);\r", "+\t\t\t\treturn new String(lpWideCharStr);\r", "+\t\t\t}\r", "+\t\t} finally {\r", "+\t\t\tCOM.GlobalUnlock(lpMultiByteStr);\r", "+\t\t}\r", "+\t}\r", "+\treturn null;\r"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "bd925a265ba3c52087450c99b50f036e", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Drag and Drop/win32/org/eclipse/swt/dnd/TextTransfer.java", "commitBeforeChange": "0965c047c4647355d2d59defeda7977f1c34f584", "commitAfterChange": "cc500238418d38b85dc837cf8469541ca5f69f28", "methodNumberBeforeChange": 3, "methodNumberAfterChange": 3, "signatureBeforeChange": "\r public Object nativeToJava(TransferData transferData)", "signatureAfterChange": "\r public Object nativeToJava(TransferData transferData)", "diff": ["-\t// get byte array from super\r", "-\tbyte[] buffer = (byte[])super.nativeToJava(transferData);\r", "-\tif (buffer == null) return null;\r", "-\t// convert byte array to a string\r", "-\tString string = new String(buffer);\r", "-\t// remove null terminator\r", "-\tint index = string.indexOf(\"\\0\");\r", "-\tstring = string.substring(0, index);\r", "-\treturn string;\r", "+\tif (!isSupportedType(transferData) || transferData.pIDataObject == 0) {\r", "+\t\ttransferData.result = COM.E_FAIL;\r", "+\t\treturn null;\r", "+\t}\r", "+\t\r", "+\tIDataObject data = new IDataObject(transferData.pIDataObject);\r", "+\tdata.AddRef();\r", "+\t\r", "+\tFORMATETC formatetc = transferData.formatetc;\r", "+\r", "+\tSTGMEDIUM stgmedium = new STGMEDIUM();\r", "+\tstgmedium.tymed = COM.TYMED_HGLOBAL;\t\r", "+\ttransferData.result = data.GetData(formatetc, stgmedium);\r", "+\tdata.Release();\r", "+\t\t\r", "+\tif (transferData.result != COM.S_OK) {\r", "+\t\treturn null;\r", "+\t}\r", "+\t\r", "+\tint size = COM.GlobalSize(stgmedium.unionField);\r", "+\tTCHAR buffer = new TCHAR(0, size / TCHAR.sizeof);\r", "+\tint ptr = COM.GlobalLock(stgmedium.unionField);\r", "+\tCOM.MoveMemory(buffer, ptr, size);\r", "+\tCOM.GlobalUnlock(ptr);\t\r", "+\tCOM.GlobalFree(stgmedium.unionField);\r", "+\treturn buffer.toString(0, buffer.strlen());\r"]}], "num": 53785}