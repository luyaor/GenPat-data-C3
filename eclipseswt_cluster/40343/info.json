{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "142a5a4260c2a150f1462e587843ca58", "detectedBy": ["DIFF_HIERARCHICAL", "DIFF_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "12cd38fe198bab64c5ce1dd44f62447b", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Drag and Drop/win32/org/eclipse/swt/dnd/RTFTransfer.java", "commitBeforeChange": "5be038b998cd27bf503c68ee3f43ba54105e38ff", "commitAfterChange": "fb65c554be6a3a1e1959739ca6c1354d5cc361a3", "methodNumberBeforeChange": 2, "methodNumberAfterChange": 2, "signatureBeforeChange": "\r public void javaToNative (Object object, TransferData transferData)", "signatureAfterChange": "\r public void javaToNative (Object object, TransferData transferData)", "diff": ["-\tif (object == null || !(object instanceof String)) return;\r", "-\t\t\r", "+\tif (object == null || !(object instanceof String)) {\r", "+\t\ttransferData.result = COM.E_FAIL;\r", "+\t\treturn;\r", "+\t}\r", "-\t// create a byte array from object\r", "-\tString text = (String) object+'\\0';\r", "-\t// pass byte array on to super to convert to native\r", "-\tsuper.javaToNative(text.getBytes(), transferData);\r", "+\tif (isSupportedType(transferData)) {\r", "+\t\tString string = (String)object;\r", "+\t\tint count = string.length ();\r", "+\t\tchar [] buffer = new char [count + 1];\r", "+\t\tstring.getChars (0, count, buffer, 0);\r", "+\t\tint cchMultiByte = OS.WideCharToMultiByte (CodePage, 0, buffer, -1, null, 0, null, null);\r", "+\t\tif (cchMultiByte == 0) {\r", "+\t\t\ttransferData.stgmedium = new STGMEDIUM();\r", "+\t\t\ttransferData.result = COM.DV_E_STGMEDIUM;\r", "+\t\t\treturn;\r", "+\t\t}\r", "+\t\tint lpMultiByteStr = COM.GlobalAlloc(COM.GMEM_FIXED | COM.GMEM_ZEROINIT, cchMultiByte);\r", "+\t\tOS.WideCharToMultiByte (CodePage, 0, buffer, -1, lpMultiByteStr, cchMultiByte, null, null);\r", "+\t\ttransferData.stgmedium = new STGMEDIUM();\r", "+\t\ttransferData.stgmedium.tymed = COM.TYMED_HGLOBAL;\r", "+\t\ttransferData.stgmedium.unionField = lpMultiByteStr;\r", "+\t\ttransferData.stgmedium.pUnkForRelease = 0;\r", "+\t\ttransferData.result = COM.S_OK;\r", "+\t\treturn;\r", "+\t}\r", "+\t\r", "+\t// did not match the TYMED\r", "+\ttransferData.stgmedium = new STGMEDIUM();\r", "+\ttransferData.result = COM.DV_E_TYMED;\r"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "fbb2c707eb2e3b9f252579cc63db8fd7", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Drag and Drop/win32/org/eclipse/swt/dnd/TextTransfer.java", "commitBeforeChange": "0965c047c4647355d2d59defeda7977f1c34f584", "commitAfterChange": "cc500238418d38b85dc837cf8469541ca5f69f28", "methodNumberBeforeChange": 2, "methodNumberAfterChange": 2, "signatureBeforeChange": "\r public void javaToNative (Object object, TransferData transferData)", "signatureAfterChange": "\r public void javaToNative (Object object, TransferData transferData)", "diff": ["-\tif (object == null || !(object instanceof String)) return;\r", "+\tif (object == null || !(object instanceof String)) {\r", "+\t\ttransferData.result = COM.E_FAIL;\r", "+\t\treturn;\r", "+\t}\r", "+\t\r", "+\tif (isSupportedType(transferData)) {\r", "+\t\tTCHAR buffer = new TCHAR(0, (String)object, true);\r", "+\t\tint byteCount = buffer.length() * TCHAR.sizeof;\r", "+\t\tint newPtr = COM.GlobalAlloc(COM.GMEM_FIXED | COM.GMEM_ZEROINIT, byteCount);\r", "+\t\tCOM.MoveMemory(newPtr, buffer, byteCount);\r", "-\t// CF_TEXT is stored as a null terminated byte array\r", "-\t// create a byte array from object\r", "-\tString text = (String) object+'\\0';\r", "-\t// pass byte array on to super to convert to native\r", "-\tsuper.javaToNative(text.getBytes(), transferData);\r", "+\t\ttransferData.stgmedium = new STGMEDIUM();\r", "+\t\ttransferData.stgmedium.tymed = COM.TYMED_HGLOBAL;\r", "+\t\ttransferData.stgmedium.unionField = newPtr;\r", "+\t\ttransferData.stgmedium.pUnkForRelease = 0;\r", "+\t\ttransferData.result = COM.S_OK;\r", "+\t\treturn;\r", "+\t}\r", "+\t\r", "+\t// did not match the TYMED\r", "+\ttransferData.stgmedium = new STGMEDIUM();\r", "+\ttransferData.result = COM.DV_E_TYMED;\r", "+\t\r"]}], "num": 40343}