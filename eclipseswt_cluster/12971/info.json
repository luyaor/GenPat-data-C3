{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "88aad98161d3fe315e18af1baf2cb3b9", "detectedBy": ["DIFF_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "078773ff893071dc14471457f6ae142b", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT WebKit/win32/org/eclipse/swt/browser/WebFrameLoadDelegate.java", "commitBeforeChange": "73bece2a93a84ede732dede8b40b2d8c17119094", "commitAfterChange": "3684f6f68db473f62f594c1867c30510d320282b", "methodNumberBeforeChange": 25, "methodNumberAfterChange": 25, "signatureBeforeChange": "  int didFinishLoadForFrame (int webview, int frame)", "signatureAfterChange": "  int didFinishLoadForFrame (int webview, int frame)", "diff": ["-\tif (top) {", "-\t\t/*", "-\t\t * If html is not null then there is html from a previous setText() call", "-\t\t * waiting to be set into the about:blank page once it has completed loading. ", "-\t\t */", "-\t\tif (html != null) {", "-\t\t\tif (getUrl ().startsWith (WebKit.ABOUT_BLANK)) {", "-\t\t\t\t((WebKit)browser.webBrowser).loadingText = true;", "-\t\t\t\tint /*long*/ string = WebKit.createBSTR (html);", "-\t\t\t\tint /*long*/ URLString;", "-\t\t\t\tif (((WebKit)browser.webBrowser).untrustedText) {", "-\t\t\t\t\tURLString = WebKit.createBSTR (WebKit.ABOUT_BLANK);", "-\t\t\t\t} else {", "-\t\t\t\t\tURLString = WebKit.createBSTR (WebKit.URI_FILEROOT);", "-\t\t\t\t}", "-\t\t\t\tIWebFrame mainFrame = new IWebFrame (frame);", "-\t\t\t\tmainFrame.loadHTMLString (string, URLString);", "-\t\t\t\thtml = null;", "-\t\t\t}", "-\t\t}", "+\tif (!top) return COM.S_OK;", "-\t\t/*", "-\t\t* The loadHTMLString() invocation above will trigger a second webView_didFinishLoadForFrame", "-\t\t* callback when it is completed.  If text was just set into the browser then wait for this", "-\t\t* second callback to come before sending the title or completed events.", "-\t\t*/", "-\t\tif (!((WebKit)browser.webBrowser).loadingText) {", "-\t\t\tif (browser.isDisposed ()) return COM.S_OK;", "-\t\t\t/*", "-\t\t\t* To be consistent with other platforms a title event should be fired when a", "-\t\t\t* page has completed loading.  A page with a <title> tag will do this", "-\t\t\t* automatically when the didReceiveTitle callback is received.  However a page", "-\t\t\t* without a <title> tag will not do this by default, so fire the event", "-\t\t\t* here with the page's url as the title.", "-\t\t\t*/", "-\t\t\tDisplay display = browser.getDisplay ();", "+\t/*", "+\t * If html is not null then there is html from a previous setText() call", "+\t * waiting to be set into the about:blank page once it has completed loading. ", "+\t */", "+\tif (html != null) {", "+\t\tif (getUrl ().startsWith (WebKit.ABOUT_BLANK)) {", "+\t\t\t((WebKit)browser.webBrowser).loadingText = true;", "+\t\t\tint /*long*/ string = WebKit.createBSTR (html);", "+\t\t\tint /*long*/ URLString;", "+\t\t\tif (((WebKit)browser.webBrowser).untrustedText) {", "+\t\t\t\tURLString = WebKit.createBSTR (WebKit.ABOUT_BLANK);", "+\t\t\t} else {", "+\t\t\t\tURLString = WebKit.createBSTR (WebKit.URI_FILEROOT);", "+\t\t\t}", "-\t\t\tint /*long*/[] result = new int /*long*/[1];", "-\t\t\thr = mainFrame.dataSource (result);", "-\t\t\tif (hr != COM.S_OK || result[0] == 0) {", "-\t\t\t\treturn COM.S_OK;", "-\t\t    }", "-\t\t\tIWebDataSource dataSource = new IWebDataSource (result[0]);", "-\t\t\tresult[0] = 0;", "-\t\t\thr = dataSource.pageTitle (result);", "-\t\t\tdataSource.Release ();", "-\t\t\tif (hr != COM.S_OK) {", "-\t\t\t\treturn COM.S_OK;", "-\t\t    }", "-\t\t\tString title = null;", "-\t\t\tif (result[0] != 0) {", "-\t\t\t\ttitle = WebKit.extractBSTR (result[0]);", "-\t\t\t\tCOM.SysFreeString (result[0]);", "-\t\t\t}", "-\t\t\tif (title == null || title.length () == 0) {\t/* page has no title */", "-\t\t\t\tTitleEvent newEvent = new TitleEvent (browser);", "-\t\t\t\tnewEvent.display = display;", "-\t\t\t\tnewEvent.widget = browser;", "-\t\t\t\tnewEvent.title = getUrl ();", "-\t\t\t\tTitleListener[] titleListeners = browser.webBrowser.titleListeners;", "-\t\t\t\tfor (int i = 0; i < titleListeners.length; i++) {", "-\t\t\t\t\ttitleListeners[i].changed (newEvent);", "-\t\t\t\t}", "-\t\t\t\tif (browser.isDisposed ()) return COM.S_OK;", "-\t\t\t}", "-", "-\t\t\tProgressEvent progress = new ProgressEvent (browser);", "-\t\t\tprogress.display = display;", "-\t\t\tprogress.widget = browser;", "-\t\t\tprogress.current = WebKit.MAX_PROGRESS;", "-\t\t\tprogress.total = WebKit.MAX_PROGRESS;", "-\t\t\tProgressListener[] progressListeners = browser.webBrowser.progressListeners;", "-\t\t\tfor (int i = 0; i < progressListeners.length; i++) {", "-\t\t\t\tprogressListeners[i].completed (progress);", "-\t\t\t}", "+\t\t\tmainFrame.loadHTMLString (string, URLString);", "+\t\t\thtml = null;", "-\t\t((WebKit)browser.webBrowser).loadingText = false;", "+\t}", "+", "+\t/*", "+\t* The loadHTMLString() invocation above will trigger a second didFinishLoadForFrame", "+\t* callback when it is completed.  If text was just set into the browser then wait for this", "+\t* second callback to come before sending the title or completed events.", "+\t*/", "+\tif (!((WebKit)browser.webBrowser).loadingText) {", "+\t\tif (browser.isDisposed ()) return COM.S_OK;", "+\t\t/*", "+\t\t* To be consistent with other platforms a title event should be fired when a", "+\t\t* page has completed loading.  A page with a <title> tag will do this", "+\t\t* automatically when the didReceiveTitle callback is received.  However a page", "+\t\t* without a <title> tag will not do this by default, so fire the event", "+\t\t* here with the page's url as the title.", "+\t\t*/", "+\t\tDisplay display = browser.getDisplay ();", "+\t\tIWebFrame mainFrame = new IWebFrame (frame);", "+\t\tint /*long*/[] result = new int /*long*/[1];", "+\t\thr = mainFrame.dataSource (result);", "+\t\tif (hr != COM.S_OK || result[0] == 0) {", "+\t\t\treturn COM.S_OK;", "+\t\t}", "+\t\tIWebDataSource dataSource = new IWebDataSource (result[0]);", "+\t\tresult[0] = 0;", "+\t\thr = dataSource.pageTitle (result);", "+\t\tdataSource.Release ();", "+\t\tif (hr != COM.S_OK) {", "+\t\t\treturn COM.S_OK;", "+\t\t}", "+\t\tString title = null;", "+\t\tif (result[0] != 0) {", "+\t\t\ttitle = WebKit.extractBSTR (result[0]);", "+\t\t\tCOM.SysFreeString (result[0]);", "+\t\t}", "+\t\tif (title == null || title.length () == 0) {\t/* page has no title */", "+\t\t\tTitleEvent newEvent = new TitleEvent (browser);", "+\t\t\tnewEvent.display = display;", "+\t\t\tnewEvent.widget = browser;", "+\t\t\tnewEvent.title = getUrl ();", "+\t\t\tTitleListener[] titleListeners = browser.webBrowser.titleListeners;", "+\t\t\tfor (int i = 0; i < titleListeners.length; i++) {", "+\t\t\t\ttitleListeners[i].changed (newEvent);", "+\t\t\t}", "+\t\t\tif (browser.isDisposed ()) return COM.S_OK;", "+\t\t}", "+", "+\t\tProgressEvent progress = new ProgressEvent (browser);", "+\t\tprogress.display = display;", "+\t\tprogress.widget = browser;", "+\t\tprogress.current = WebKit.MAX_PROGRESS;", "+\t\tprogress.total = WebKit.MAX_PROGRESS;", "+\t\tProgressListener[] progressListeners = browser.webBrowser.progressListeners;", "+\t\tfor (int i = 0; i < progressListeners.length; i++) {", "+\t\t\tprogressListeners[i].completed (progress);", "+\t\t}", "+\t((WebKit)browser.webBrowser).loadingText = false;"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "d42c43c828e540aef10d4985e5710276", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT Mozilla/common/org/eclipse/swt/browser/Mozilla.java", "commitBeforeChange": "9fcaeb8ee69976fa279be4d81dbb74efb586ed73", "commitAfterChange": "318109a09b77020cb8d7f8d97b41b87933157e53", "methodNumberBeforeChange": 149, "methodNumberAfterChange": 150, "signatureBeforeChange": "  int HandleEvent (int event)", "signatureAfterChange": "  int HandleEvent (int event)", "diff": ["+\tif (XPCOM.DOMEVENT_KEYDOWN.equals (typeString)) {", "+\t\tint /*long*/[] result = new int /*long*/[1];", "+\t\trc = domEvent.QueryInterface (nsIDOMKeyEvent.NS_IDOMKEYEVENT_IID, result);", "+\t\tif (rc != XPCOM.NS_OK) error (rc);", "+\t\tif (result[0] == 0) error (XPCOM.NS_NOINTERFACE);", "+\t\tnsIDOMKeyEvent domKeyEvent = new nsIDOMKeyEvent (result[0]);", "+\t\tresult[0] = 0;", "+", "+\t\tint[] aKeyCode = new int[1]; /* PRUint32 */", "+\t\trc = domKeyEvent.GetKeyCode (aKeyCode);", "+\t\tif (rc != XPCOM.NS_OK) error (rc);", "+\t\tint keyCode = translateKey (aKeyCode[0]);", "+", "+\t\t/*", "+\t\t* if keyCode == lastKeyCode then either a repeating key like Shift", "+\t\t* is being held or a key for which key events are not sent has been", "+\t\t* pressed.  In both of these cases a KeyDown should not be sent.", "+\t\t*/", "+\t\tif (keyCode != lastKeyCode) {", "+\t\t\tlastKeyCode = keyCode;", "+\t\t\tswitch (lastKeyCode) {", "+\t\t\t\tcase SWT.SHIFT:", "+\t\t\t\tcase SWT.CONTROL:", "+\t\t\t\tcase SWT.ALT:", "+\t\t\t\tcase SWT.CAPS_LOCK:", "+\t\t\t\tcase SWT.NUM_LOCK:", "+\t\t\t\tcase SWT.SCROLL_LOCK:", "+\t\t\t\tcase SWT.COMMAND: {", "+\t\t\t\t\t/* keypress events will not be received for these keys, so send KeyDowns for them now */", "+\t\t\t\t\tboolean[] aAltKey = new boolean[1], aCtrlKey = new boolean[1], aShiftKey = new boolean[1], aMetaKey = new boolean[1]; ", "+\t\t\t\t\trc = domKeyEvent.GetAltKey (aAltKey);", "+\t\t\t\t\tif (rc != XPCOM.NS_OK) error (rc);", "+\t\t\t\t\trc = domKeyEvent.GetCtrlKey (aCtrlKey);", "+\t\t\t\t\tif (rc != XPCOM.NS_OK) error (rc);", "+\t\t\t\t\trc = domKeyEvent.GetShiftKey (aShiftKey);", "+\t\t\t\t\tif (rc != XPCOM.NS_OK) error (rc);", "+\t\t\t\t\trc = domKeyEvent.GetMetaKey (aMetaKey);", "+\t\t\t\t\tif (rc != XPCOM.NS_OK) error (rc);", "+", "+\t\t\t\t\tEvent keyEvent = new Event ();", "+\t\t\t\t\tkeyEvent.widget = browser;", "+\t\t\t\t\tkeyEvent.type = SWT.KeyDown;", "+\t\t\t\t\tkeyEvent.keyCode = lastKeyCode;", "+\t\t\t\t\tkeyEvent.stateMask = (aAltKey[0] ? SWT.ALT : 0) | (aCtrlKey[0] ? SWT.CTRL : 0) | (aShiftKey[0] ? SWT.SHIFT : 0) | (aMetaKey[0] ? SWT.MOD1 : 0);", "+\t\t\t\t\tkeyEvent.stateMask &= ~lastKeyCode;\t\t/* remove current keydown if it's a state key */", "+\t\t\t\t\tbrowser.notifyListeners (keyEvent.type, keyEvent);", "+\t\t\t\t}", "+\t\t\t\tdefault: {", "+\t\t\t\t\t/* do nothing, KeyDown event will be sent for this key by keypress listener */", "+\t\t\t\t}", "+\t\t\t}", "+\t\t}", "+\t\tdomKeyEvent.Release ();", "+\t\treturn XPCOM.NS_OK;", "+\t}", "+", "+\tif (XPCOM.DOMEVENT_KEYPRESS.equals (typeString)) {", "+\t\t/*", "+\t\t* if keydown could not determine a keycode for this key then it's a", "+\t\t* key for which key events are not sent (eg.- the Windows key)", "+\t\t*/", "+\t\tif (lastKeyCode == 0) return XPCOM.NS_OK;", "+", "+\t\t/*", "+\t\t* On linux only, unexpected keypress events are received for some", "+\t\t* modifier keys.  The workaround is to ignore these events since", "+\t\t* KeyDown events are sent for these keys in the keydown listener.  ", "+\t\t*/", "+\t\tswitch (lastKeyCode) {", "+\t\t\tcase SWT.CAPS_LOCK:", "+\t\t\tcase SWT.NUM_LOCK:", "+\t\t\tcase SWT.SCROLL_LOCK: return XPCOM.NS_OK;", "+\t\t}", "+", "+\t\tint /*long*/[] result = new int /*long*/[1];", "+\t\trc = domEvent.QueryInterface (nsIDOMKeyEvent.NS_IDOMKEYEVENT_IID, result);", "+\t\tif (rc != XPCOM.NS_OK) error (rc);", "+\t\tif (result[0] == 0) error (XPCOM.NS_NOINTERFACE);", "+\t\tnsIDOMKeyEvent domKeyEvent = new nsIDOMKeyEvent (result[0]);", "+\t\tresult[0] = 0;", "+", "+\t\tboolean[] aAltKey = new boolean[1], aCtrlKey = new boolean[1], aShiftKey = new boolean[1], aMetaKey = new boolean[1]; ", "+\t\trc = domKeyEvent.GetAltKey (aAltKey);", "+\t\tif (rc != XPCOM.NS_OK) error (rc);", "+\t\trc = domKeyEvent.GetCtrlKey (aCtrlKey);", "+\t\tif (rc != XPCOM.NS_OK) error (rc);", "+\t\trc = domKeyEvent.GetShiftKey (aShiftKey);", "+\t\tif (rc != XPCOM.NS_OK) error (rc);", "+\t\trc = domKeyEvent.GetMetaKey (aMetaKey);", "+\t\tif (rc != XPCOM.NS_OK) error (rc);", "+\t\tdomKeyEvent.Release ();", "+", "+\t\tint[] aCharCode = new int[1]; /* PRUint32 */", "+\t\trc = domKeyEvent.GetCharCode (aCharCode);", "+\t\tif (rc != XPCOM.NS_OK) error (rc);", "+\t\tlastCharCode = aCharCode[0];", "+\t\tif (lastCharCode == 0) {", "+\t\t\tswitch (lastKeyCode) {", "+\t\t\t\tcase SWT.TAB: lastCharCode = SWT.TAB; break;", "+\t\t\t\tcase SWT.CR: lastCharCode = SWT.CR; break;", "+\t\t\t\tcase SWT.BS: lastCharCode = SWT.BS; break;", "+\t\t\t\tcase SWT.ESC: lastCharCode = SWT.ESC; break;", "+\t\t\t\tcase SWT.DEL: lastCharCode = SWT.DEL; break;", "+\t\t\t}", "+\t\t}", "+\t\tif (aCtrlKey[0] && (0 <= lastCharCode && lastCharCode <= 0x7F)) {", "+\t\t\tif ('a'  <= lastCharCode && lastCharCode <= 'z') lastCharCode -= 'a' - 'A';", "+\t\t\tif (64 <= lastCharCode && lastCharCode <= 95) lastCharCode -= 64;", "+\t\t}", "+", "+\t\tEvent keyEvent = new Event ();", "+\t\tkeyEvent.widget = browser;", "+\t\tkeyEvent.type = SWT.KeyDown;", "+\t\tkeyEvent.keyCode = lastKeyCode;", "+\t\tkeyEvent.character = (char)lastCharCode;", "+\t\tkeyEvent.stateMask = (aAltKey[0] ? SWT.ALT : 0) | (aCtrlKey[0] ? SWT.CTRL : 0) | (aShiftKey[0] ? SWT.SHIFT : 0) | (aMetaKey[0] ? SWT.MOD1 : 0);", "+\t\tbrowser.notifyListeners (keyEvent.type, keyEvent);", "+\t\treturn XPCOM.NS_OK;", "+\t}", "+", "+\tif (XPCOM.DOMEVENT_KEYUP.equals (typeString)) {", "+\t\tint /*long*/[] result = new int /*long*/[1];", "+\t\trc = domEvent.QueryInterface (nsIDOMKeyEvent.NS_IDOMKEYEVENT_IID, result);", "+\t\tif (rc != XPCOM.NS_OK) error (rc);", "+\t\tif (result[0] == 0) error (XPCOM.NS_NOINTERFACE);", "+\t\tnsIDOMKeyEvent domKeyEvent = new nsIDOMKeyEvent (result[0]);", "+\t\tresult[0] = 0;", "+", "+\t\tint[] aKeyCode = new int[1]; /* PRUint32 */", "+\t\trc = domKeyEvent.GetKeyCode (aKeyCode);", "+\t\tif (rc != XPCOM.NS_OK) error (rc);", "+\t\tint keyCode = translateKey (aKeyCode[0]);", "+\t\tif (keyCode == 0) {", "+\t\t\t/* indicates a key for which key events are not sent */", "+\t\t\tdomKeyEvent.Release ();", "+\t\t\treturn XPCOM.NS_OK;", "+\t\t}", "+\t\tif (keyCode != lastKeyCode) {", "+\t\t\t/* keyup does not correspond to the last keydown */", "+\t\t\tlastKeyCode = keyCode;", "+\t\t\tlastCharCode = 0;", "+\t\t}", "+", "+\t\tboolean[] aAltKey = new boolean[1], aCtrlKey = new boolean[1], aShiftKey = new boolean[1], aMetaKey = new boolean[1]; ", "+\t\trc = domKeyEvent.GetAltKey (aAltKey);", "+\t\tif (rc != XPCOM.NS_OK) error (rc);", "+\t\trc = domKeyEvent.GetCtrlKey (aCtrlKey);", "+\t\tif (rc != XPCOM.NS_OK) error (rc);", "+\t\trc = domKeyEvent.GetShiftKey (aShiftKey);", "+\t\tif (rc != XPCOM.NS_OK) error (rc);", "+\t\trc = domKeyEvent.GetMetaKey (aMetaKey);", "+\t\tif (rc != XPCOM.NS_OK) error (rc);", "+\t\tdomKeyEvent.Release ();", "+", "+\t\tEvent keyEvent = new Event ();", "+\t\tkeyEvent.widget = browser;", "+\t\tkeyEvent.type = SWT.KeyUp;", "+\t\tkeyEvent.keyCode = lastKeyCode;", "+\t\tkeyEvent.character = (char)lastCharCode;", "+\t\tkeyEvent.stateMask = (aAltKey[0] ? SWT.ALT : 0) | (aCtrlKey[0] ? SWT.CTRL : 0) | (aShiftKey[0] ? SWT.SHIFT : 0) | (aMetaKey[0] ? SWT.MOD1 : 0);", "+\t\tswitch (lastKeyCode) {", "+\t\t\tcase SWT.SHIFT:", "+\t\t\tcase SWT.CONTROL:", "+\t\t\tcase SWT.ALT:", "+\t\t\tcase SWT.COMMAND: {", "+\t\t\t\tkeyEvent.stateMask |= lastKeyCode;", "+\t\t\t}", "+\t\t}", "+\t\tbrowser.notifyListeners (keyEvent.type, keyEvent);", "+\t\tlastKeyCode = lastCharCode = 0;", "+\t\treturn XPCOM.NS_OK;", "+\t}", "+"]}], "num": 12971}