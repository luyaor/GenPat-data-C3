{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "1bdd8642438ce3166640ec5cd36fc1e1", "detectedBy": ["AST_HIERARCHICAL", "AST_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "bfc3f5900e1dee4df4651c05866f0efc", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT OLE Win32/win32/org/eclipse/swt/ole/win32/OleClientSite.java", "commitBeforeChange": "647ee8ac0b4674688a64286f665d0bc51c0718e8", "commitAfterChange": "8c113a426e5f05549192616bd0df00498451eac3", "methodNumberBeforeChange": 90, "methodNumberAfterChange": 91, "signatureBeforeChange": " private boolean saveToTraditionalFile(File file)", "signatureAfterChange": " private boolean saveToTraditionalFile(File file)", "diff": ["-\t", "-\t/*", "-\t* Bug in Office 2007. Saving Office 2007 documents to compound file storage object", "-\t* causes the output file to be corrupted. The fix is to detect Office 2007 documents", "-\t* using the program ID and save only the content of the 'Package' stream. ", "-\t*/", "-\tif (isOffice2007()) {", "-\t\t/* Excel fails to open the package stream when the PersistStorage is not in hands off mode */", "-\t\tint /*long*/[] ppv = new int /*long*/[1];", "-\t\tIPersistStorage iPersistStorage = null;", "-\t\tif (objIUnknown.QueryInterface(COM.IIDIPersistStorage, ppv) == COM.S_OK) {", "-\t\t\tiPersistStorage = new IPersistStorage(ppv[0]);", "-\t\t\ttempStorage.AddRef();", "-\t\t\tiPersistStorage.HandsOffStorage();", "-\t\t}", "-\t\tboolean result = false;", "-\t\tint /*long*/[] address = new int /*long*/[1];", "-\t\tint grfMode = COM.STGM_DIRECT | COM.STGM_READ | COM.STGM_SHARE_EXCLUSIVE;", "-\t\tif (tempStorage.OpenStream(\"Package\", 0, grfMode, 0, address) == COM.S_OK) { //$NON-NLS-1$", "-\t\t\tresult = saveFromContents(address[0], file);", "-\t\t}", "-\t\tif (iPersistStorage != null) {", "-\t\t\tiPersistStorage.SaveCompleted(tempStorage.getAddress());", "-\t\t\ttempStorage.Release();", "-\t\t\tiPersistStorage.Release();", "-\t\t}", "-\t\treturn result;", "-\t}"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "d495dac32e109dbfcbf6bd5be1d32baf", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT OLE Win32/win32/org/eclipse/swt/ole/win32/OleClientSite.java", "commitBeforeChange": "306f95301b97e9d8ba82cad67812ad605a6ab86b", "commitAfterChange": "de5b9b1f68cbb466a86733b45d1a63f217e8c701", "methodNumberBeforeChange": 86, "methodNumberAfterChange": 62, "signatureBeforeChange": " private boolean saveOffice2007(File file)", "signatureAfterChange": " private boolean isOffice2007()", "diff": ["+private boolean isOffice2007() {", "+\tString programID = getProgramID();", "+\tif (programID == null) return false;", "+\tif (programID.equals(\"Word.Document.12\")) return true; //$NON-NLS-1$ ", "+\tif (programID.equals(\"Excel.Sheet.12\")) return true; //$NON-NLS-1$ ", "+\tif (programID.equals(\"PowerPoint.Show.12\")) return true; //$NON-NLS-1$ ", "+\treturn false;", "+}", "-private boolean saveOffice2007(File file) {", "-\tif (file == null || file.isDirectory()) return false;", "-\tif (!updateStorage()) return false;", "-\tboolean result = false;", "-\t", "-\t/* Excel fails to open the package stream when the PersistStorage is not in hands off mode */", "-\tint /*long*/[] ppv = new int /*long*/[1];", "-\tIPersistStorage iPersistStorage = null;", "-\tif (objIUnknown.QueryInterface(COM.IIDIPersistStorage, ppv) == COM.S_OK) {", "-\t\tiPersistStorage = new IPersistStorage(ppv[0]);", "-\t\ttempStorage.AddRef();", "-\t\tiPersistStorage.HandsOffStorage();", "-\t}", "-\tint /*long*/[] address = new int /*long*/[1];", "-\tint grfMode = COM.STGM_DIRECT | COM.STGM_READ | COM.STGM_SHARE_EXCLUSIVE;", "-\tif (tempStorage.OpenStream(\"Package\", 0, grfMode, 0, address) == COM.S_OK) { //$NON-NLS-1$", "-\t\tresult = saveFromContents(address[0], file);", "-\t}", "-\tif (iPersistStorage != null) {", "-\t\tiPersistStorage.SaveCompleted(tempStorage.getAddress());", "-\t\ttempStorage.Release();", "-\t\tiPersistStorage.Release();", "-\t}", "-\treturn result;", "-}"]}], "num": 23207}