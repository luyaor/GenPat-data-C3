{"@class": "de.fau.cs.inf2.cthree.data.Cluster", "id": "62fd78cf787bf9484bc9ef66bfd8894a", "detectedBy": ["DIFF_HIERARCHICAL", "DIFF_DBSCAN"], "members": [{"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "de81ca857539e6792364222de42c46fa", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT/win32/org/eclipse/swt/graphics/TextLayout.java", "commitBeforeChange": "58383f412ad2510abd15afdf3cb00667e6c434a4", "commitAfterChange": "c53caa95e55e48c3856ff305cfe3f6f8e3107f36", "methodNumberBeforeChange": 14, "methodNumberAfterChange": 14, "signatureBeforeChange": "  RECT drawBorder(boolean advance, int graphics, int x, int y, int lineHeight, int color, int selectionColor, boolean fullSelection, RECT clipRect, RECT rect, int alpha, StyleItem[] line, int index, int selectionStart, int selectionEnd)", "signatureAfterChange": "  RECT drawBorder(int hdc, int x, int y, int lineHeight, StyleItem[] line, int index, int color, int selectionColor, RECT clipRect, RECT pRect, int selectionStart, int selectionEnd)", "diff": ["+", "+RECT drawBorder(int /*long*/ hdc, int x, int y, int lineHeight, StyleItem[] line, int index, int /*long*/ color, int /*long*/ selectionColor, RECT clipRect, RECT pRect, int selectionStart, int selectionEnd) {", "+\tStyleItem run = line[index]; ", "+\tTextStyle style = run.style;", "+\tif (style == null) return null;", "+\tif (style.borderStyle == SWT.NONE) return null;", "+\tclipRect = addClipRect(run, clipRect, pRect, selectionStart, selectionEnd);", "+\tif (index + 1 >= line.length || !style.isAdherentBorder(line[index + 1].style)) {", "+\t\tint left = run.x;", "+\t\tint start = run.start;", "+\t\tint end = run.start + run.length - 1;", "+\t\tfor (int i = index; i > 0 && style.isAdherentBorder(line[i - 1].style); i--) {", "+\t\t\tleft = line[i - 1].x;", "+\t\t\tstart = Math.min(start, line[i - 1].start);", "+\t\t\tend = Math.max(end, line[i - 1].start + line[i - 1].length - 1);", "+\t\t}", "+\t\tboolean hasSelection = selectionStart <= selectionEnd && selectionStart != -1 && selectionEnd != -1;", "+\t\tboolean fullSelection = hasSelection && selectionStart <= start && end <= selectionEnd;", "+\t\tif (style.borderColor != null) {", "+\t\t\tcolor = style.borderColor.handle;", "+\t\t\tclipRect = null;", "+\t\t} else {", "+\t\t\tif (fullSelection) {", "+\t\t\t\tcolor = selectionColor;", "+\t\t\t\tclipRect = null;", "+\t\t\t} else {", "+\t\t\t\tif (style.foreground != null) {", "+\t\t\t\t\tcolor = style.foreground.handle;", "+\t\t\t\t}", "+\t\t\t}", "+\t\t}", "+\t\tint lineWidth = 1;", "+\t\tint lineStyle = OS.PS_SOLID;", "+\t\tswitch (style.borderStyle) {", "+\t\t\tcase SWT.BORDER_SOLID: break;", "+\t\t\tcase SWT.BORDER_DASH: lineStyle = OS.PS_DASH; break;", "+\t\t\tcase SWT.BORDER_DOT: lineStyle = OS.PS_DOT; break;", "+\t\t}", "+\t\tint /*long*/ oldBrush = OS.SelectObject(hdc, OS.GetStockObject(OS.NULL_BRUSH));", "+\t\tLOGBRUSH logBrush = new LOGBRUSH();", "+\t\tlogBrush.lbStyle = OS.BS_SOLID;", "+\t\tlogBrush.lbColor = /*64*/(int)color;", "+\t\tint /*long*/ newPen = OS.ExtCreatePen(lineStyle | OS.PS_GEOMETRIC, Math.max(1, lineWidth), logBrush, 0, null);", "+\t\tint /*long*/ oldPen = OS.SelectObject(hdc, newPen);", "+\t\tOS.Rectangle(hdc, x + left, y, x + run.x + run.width, y + lineHeight);", "+\t\tOS.SelectObject(hdc, oldPen);", "+\t\tOS.DeleteObject(newPen);", "+\t\tif (clipRect != null) {", "+\t\t\tint state = OS.SaveDC(hdc);", "+\t\t\tif (clipRect.left == -1) clipRect.left = 0;", "+\t\t\tif (clipRect.right == -1) clipRect.right = 0x7ffff;", "+\t\t\tOS.IntersectClipRect(hdc, clipRect.left, clipRect.top, clipRect.right, clipRect.bottom);", "+\t\t\tlogBrush.lbColor = /*64*/(int)selectionColor;", "+\t\t\tint /*long*/ selPen = OS.ExtCreatePen (lineStyle | OS.PS_GEOMETRIC, Math.max(1, lineWidth), logBrush, 0, null);", "+\t\t\toldPen = OS.SelectObject(hdc, selPen);", "+\t\t\tOS.Rectangle(hdc, x + left, y, x + run.x + run.width, y + lineHeight);", "+\t\t\tOS.RestoreDC(hdc, state);", "+\t\t\tOS.SelectObject(hdc, oldPen);", "+\t\t\tOS.DeleteObject(selPen);", "+\t\t}", "+\t\tOS.SelectObject(hdc, oldBrush);", "+\t\treturn null;", "+\t}", "+\treturn clipRect;", "+}", "-RECT drawBorder(boolean advance, int /*long*/ graphics, int x, int y, int lineHeight, int /*long*/ color, int /*long*/ selectionColor, boolean fullSelection, RECT clipRect, RECT rect, int alpha, StyleItem[] line, int index, int selectionStart, int selectionEnd) {", "-\tStyleItem run = line[index]; ", "-\tTextStyle style = run.style;", "-\tif (style == null) return null;", "-\tif (style.borderStyle == SWT.NONE) return null;", "-\tif (rect != null) {", "-\t\tif (clipRect == null) {", "-\t\t\tclipRect = new RECT ();", "-\t\t\tOS.SetRect(clipRect, -1, rect.top, -1, rect.bottom);", "-\t\t}", "-\t\tboolean isRTL = (orientation & SWT.RIGHT_TO_LEFT) != 0;", "-\t\tif (run.start <= selectionStart && selectionStart <= run.start + run.length) {", "-\t\t\tif (run.analysis.fRTL ^ isRTL) {", "-\t\t\t\tclipRect.right = rect.left;", "-\t\t\t} else {", "-\t\t\t\tclipRect.left = rect.left;", "-\t\t\t}", "-\t\t}", "-\t\tif (run.start <= selectionEnd && selectionEnd <= run.start + run.length) {", "-\t\t\tif (run.analysis.fRTL ^ isRTL) {", "-\t\t\t\tclipRect.left = rect.right;", "-\t\t\t} else {", "-\t\t\t\tclipRect.right = rect.right;", "-\t\t\t}", "-\tif (index + 1 >= line.length || !style.isAdherentBorder(line[index + 1].style)) {", "-\t\tint left = run.x;", "-\t\tfor (int i = index; i > 0 && style.isAdherentBorder(line[i - 1].style); i--) {", "-\t\t\tleft = line[i - 1].x;", "-\t\tif (advance) {", "-\t\t\tint /*long*/ brush = color;", "-\t\t\tint customColor = -1;", "-\t\t\tif (style.borderColor != null) {", "-\t\t\t\tcustomColor = style.borderColor.handle;", "-\t\t\t} else {", "-\t\t\t\tif (style.foreground != null) {", "-\t\t\t\t\tcustomColor = style.foreground.handle;", "-\t\t\t\t}", "-\t\t\t\tif (fullSelection && clipRect == null) {", "-\t\t\t\t\tcustomColor = -1;", "-\t\t\t\t\tbrush = selectionColor;", "-\t\t\t\t}", "-\t\t\t}", "-\t\t\tif (customColor != -1) {", "-\t\t\t\tint argb = ((alpha & 0xFF) << 24) | ((customColor >> 16) & 0xFF) | (customColor & 0xFF00) | ((customColor & 0xFF) << 16);", "-\t\t\t\tint /*long*/ gdiColor = Gdip.Color_new(argb); ", "-\t\t\t\tbrush = Gdip.SolidBrush_new(gdiColor);", "-\t\t\t\tGdip.Color_delete(gdiColor);\t", "-\t\t\t}", "-\t\t\tint lineWidth = 1;", "-\t\t\tint lineStyle = Gdip.DashStyleSolid;", "-\t\t\tswitch (style.borderStyle) {", "-\t\t\t\tcase SWT.BORDER_SOLID: break;", "-\t\t\t\tcase SWT.BORDER_DASH: lineStyle = Gdip.DashStyleDash; break;", "-\t\t\t\tcase SWT.BORDER_DOT: lineStyle = Gdip.DashStyleDot; break;", "-\t\t\t}", "-\t\t\tint /*long*/ pen = Gdip.Pen_new(brush, lineWidth);", "-\t\t\tGdip.Pen_SetDashStyle(pen, lineStyle);", "-\t\t\tfloat gdipXOffset = 0.5f, gdipYOffset = 0.5f;", "-\t\t\tGdip.Graphics_TranslateTransform(graphics, gdipXOffset, gdipYOffset, Gdip.MatrixOrderPrepend);", "-\t\t\tif (style.borderColor == null && clipRect != null) {", "-\t\t\t\tint gstate = Gdip.Graphics_Save(graphics);", "-\t\t\t\tif (clipRect.left == -1) clipRect.left = 0;", "-\t\t\t\tif (clipRect.right == -1) clipRect.right = 0x7ffff;", "-\t\t\t\tRect gdipRect = new Rect();", "-\t\t\t\tgdipRect.X = clipRect.left;", "-\t\t\t\tgdipRect.Y = clipRect.top;", "-\t\t\t\tgdipRect.Width = clipRect.right - clipRect.left;", "-\t\t\t\tgdipRect.Height = clipRect.bottom - clipRect.top;", "-\t\t\t\tGdip.Graphics_SetClip(graphics, gdipRect, Gdip.CombineModeExclude);", "-\t\t\t\tGdip.Graphics_DrawRectangle(graphics, pen, x + left, y, run.x + run.width - left - 1, lineHeight - 1);", "-\t\t\t\tGdip.Graphics_Restore(graphics, gstate);", "-\t\t\t\tgstate = Gdip.Graphics_Save(graphics);", "-\t\t\t\tGdip.Graphics_SetClip(graphics, gdipRect, Gdip.CombineModeIntersect);", "-\t\t\t\tint /*long*/ selPen = Gdip.Pen_new(selectionColor, lineWidth);", "-\t\t\t\tGdip.Pen_SetDashStyle(pen, lineStyle);", "-\t\t\t\tGdip.Graphics_DrawRectangle(graphics, selPen, x + left, y, run.x + run.width - left - 1, lineHeight - 1);", "-\t\t\t\tGdip.Pen_delete(selPen);", "-\t\t\t\tGdip.Graphics_Restore(graphics, gstate);", "-\t\t\t} else {", "-\t\t\t\tGdip.Graphics_DrawRectangle(graphics, pen, x + left, y, run.x + run.width - left - 1, lineHeight - 1);", "-\t\t\t}", "-\t\t\tGdip.Graphics_TranslateTransform(graphics, -gdipXOffset, -gdipYOffset, Gdip.MatrixOrderPrepend);", "-\t\t\tGdip.Pen_delete(pen);", "-\t\t\tif (customColor != -1) Gdip.SolidBrush_delete(brush);", "-\t\t\tif (style.borderColor != null) {", "-\t\t\t\tcolor = style.borderColor.handle;", "-\t\t\t\tif (fullSelection && clipRect == null) {", "-\t\t\t\t\tcolor = selectionColor;", "-\t\t\t\t}", "-\t\t\tint lineWidth = 1;", "-\t\t\tint lineStyle = OS.PS_SOLID;", "-\t\t\tswitch (style.borderStyle) {", "-\t\t\t\tcase SWT.BORDER_SOLID: break;", "-\t\t\t\tcase SWT.BORDER_DASH: lineStyle = OS.PS_DASH; break;", "-\t\t\t\tcase SWT.BORDER_DOT: lineStyle = OS.PS_DOT; break;", "-\t\t\t}", "-\t\t\tLOGBRUSH logBrush = new LOGBRUSH();", "-\t\t\tlogBrush.lbStyle = OS.BS_SOLID;", "-\t\t\tlogBrush.lbColor = /*64*/(int)color;", "-\t\t\tint /*long*/ newPen = OS.ExtCreatePen(lineStyle | OS.PS_GEOMETRIC, Math.max(1, lineWidth), logBrush, 0, null);", "-\t\t\tint /*long*/ oldPen = OS.SelectObject(graphics, newPen);", "-\t\t\tint /*long*/ oldBrush = OS.SelectObject(graphics, OS.GetStockObject(OS.NULL_BRUSH));", "-\t\t\tOS.Rectangle(graphics, x + left, y, x + run.x + run.width, y + lineHeight);", "-\t\t\tif (style.borderColor == null && clipRect != null && color != selectionColor) {", "-\t\t\t\tint state = OS.SaveDC(graphics);", "-\t\t\t\tif (clipRect.left == -1) clipRect.left = 0;", "-\t\t\t\tif (clipRect.right == -1) clipRect.right = 0x7ffff;", "-\t\t\t\tOS.IntersectClipRect(graphics, clipRect.left, clipRect.top, clipRect.right, clipRect.bottom);", "-\t\t\t\tlogBrush.lbColor = /*64*/(int)selectionColor;", "-\t\t\t\tint /*long*/ selPen = OS.ExtCreatePen (lineStyle | OS.PS_GEOMETRIC, Math.max(1, lineWidth), logBrush, 0, null);", "-\t\t\t\tOS.SelectObject(graphics, selPen);", "-\t\t\t\tOS.Rectangle(graphics, x + left, y, x + run.x + run.width, y + lineHeight);", "-\t\t\t\tOS.RestoreDC(graphics, state);", "-\t\t\t\tOS.SelectObject(graphics, newPen);", "-\t\t\t\tOS.DeleteObject(selPen);", "-\t\t\t}", "-\t\t\tOS.SelectObject(graphics, oldBrush);", "-\t\t\tOS.SelectObject(graphics, oldPen);", "-\t\t\tOS.DeleteObject(newPen);"]}, {"@class": "de.fau.cs.inf2.cthree.data.CodeChange", "id": "c1f7a80b4d425d1dbab04901fbd9654d", "repository": "http://git.eclipse.org/gitroot/platform/eclipse.platform.swt.git", "fileName": "bundles/org.eclipse.swt/Eclipse SWT/win32/org/eclipse/swt/graphics/TextLayout.java", "commitBeforeChange": "2a453289bd44f7a775eb792bac5c0306a39048d4", "commitAfterChange": "00044d960d22ae0ff107fa60b140159a76aa4f68", "methodNumberBeforeChange": 8, "methodNumberAfterChange": 8, "signatureBeforeChange": " public void draw (GC gc, int x, int y, int selectionStart, int selectionEnd, Color selectionForeground, Color selectionBackground)", "signatureAfterChange": " public void draw (GC gc, int x, int y, int selectionStart, int selectionEnd, Color selectionForeground, Color selectionBackground)", "diff": ["+\tRectangle clip = gc.getClipping();", "-\t\tStyleItem[] lineRuns = runs[line];", "-\t\tFontMetrics metrics = getLineMetrics(line);", "-\t\tint baseline = metrics.getAscent() + metrics.getLeading();", "-\t\tint lineHeight = metrics.getHeight();", "+\t\tif (drawX > clip.x + clip.width) continue;", "+\t\tif (drawX + lineWidth[line] < clip.x) continue;", "+\t\tStyleItem[] lineRuns = runs[line];", "+\t\tFontMetrics metrics = getLineMetrics(line);", "+\t\tint baseline = metrics.getAscent() + metrics.getLeading();", "+\t\tint lineHeight = metrics.getHeight();", "-\t\t\tif (!run.lineBreak || run.softBreak) {", "-\t\t\t\tint end = run.start + run.length - 1;", "-\t\t\t\tboolean fullSelection = hasSelection && selectionStart <= run.start && selectionEnd >= end;", "-\t\t\t\tif (fullSelection) {", "-\t\t\t\t\tOS.SelectObject(hdc, selBrush);", "-\t\t\t\t\tOS.PatBlt(hdc, drawX, drawY, run.width, lineHeight, dwRop);", "-\t\t\t\t} else {", "-\t\t\t\t\tif (run.style != null && run.style.background != null) {", "-\t\t\t\t\t\tint bg = run.style.background.handle;", "-\t\t\t\t\t\tFont font = null;", "-\t\t\t\t\t\tif (run.style != null) font = run.style.font;", "-\t\t\t\t\t\tif (font == null) font = this.font;", "-\t\t\t\t\t\tif (font == null) font = device.getSystemFont();", "-\t\t\t\t\t\tOS.SelectObject(hdc, font.handle);", "-\t\t\t\t\t\tOS.GetTextMetrics(hdc, lptm);", "-\t\t\t\t\t\tint drawRunY = drawY + (baseline - lptm.tmAscent);", "-\t\t\t\t\t\tint hBrush = OS.CreateSolidBrush (bg);", "-\t\t\t\t\t\tint oldBrush = OS.SelectObject(hdc, hBrush);", "-\t\t\t\t\t\tOS.PatBlt(hdc, drawX, drawRunY, run.width, run.height, dwRop);", "-\t\t\t\t\t\tOS.SelectObject(hdc, oldBrush);", "-\t\t\t\t\t\tOS.DeleteObject(hBrush);", "-\t\t\t\t\t}", "-\t\t\t\t\tboolean partialSelection = hasSelection && !(selectionStart > end || run.start > selectionEnd);", "-\t\t\t\t\tif (partialSelection) {", "+\t\t\tif (drawX > clip.x + clip.width) break;", "+\t\t\tif (drawX + run.width >= clip.x) {", "+\t\t\t\tif (!run.lineBreak || run.softBreak) {", "+\t\t\t\t\tint end = run.start + run.length - 1;", "+\t\t\t\t\tboolean fullSelection = hasSelection && selectionStart <= run.start && selectionEnd >= end;", "+\t\t\t\t\tif (fullSelection) {", "+\t\t\t\t\t\tOS.PatBlt(hdc, drawX, drawY, run.width, lineHeight, dwRop);", "+\t\t\t\t\t} else {", "+\t\t\t\t\t\tif (run.style != null && run.style.background != null) {", "+\t\t\t\t\t\t\tint bg = run.style.background.handle;", "+\t\t\t\t\t\t\tFont font = null;", "+\t\t\t\t\t\t\tif (run.style != null) font = run.style.font;", "+\t\t\t\t\t\t\tif (font == null) font = this.font;", "+\t\t\t\t\t\t\tif (font == null) font = device.getSystemFont();", "+\t\t\t\t\t\t\tOS.SelectObject(hdc, font.handle);", "+\t\t\t\t\t\t\tOS.GetTextMetrics(hdc, lptm);", "+\t\t\t\t\t\t\tint drawRunY = drawY + (baseline - lptm.tmAscent);", "+\t\t\t\t\t\t\tint hBrush = OS.CreateSolidBrush (bg);", "+\t\t\t\t\t\t\tint oldBrush = OS.SelectObject(hdc, hBrush);", "+\t\t\t\t\t\t\tOS.PatBlt(hdc, drawX, drawRunY, run.width, run.height, dwRop);", "+\t\t\t\t\t\t\tOS.SelectObject(hdc, oldBrush);", "+\t\t\t\t\t\t\tOS.DeleteObject(hBrush);", "+\t\t\t\t\t\t}", "+\t\t\t\t\t\tboolean partialSelection = hasSelection && !(selectionStart > end || run.start > selectionEnd);", "+\t\t\t\t\t\tif (partialSelection) {", "+\t\t\t\t\t\t\tOS.SelectObject(hdc, selBrush);", "+\t\t\t\t\t\t\tint selStart = Math.max(selectionStart, run.start) - run.start;", "+\t\t\t\t\t\t\tint selEnd = Math.min(selectionEnd, end) - run.start;", "+\t\t\t\t\t\t\tint cChars = run.length;", "+\t\t\t\t\t\t\tint gGlyphs = run.glyphCount;", "+\t\t\t\t\t\t\tint[] piX = new int[1];", "+\t\t\t\t\t\t\tOS.ScriptCPtoX(selStart, false, cChars, gGlyphs, run.clusters, run.visAttrs, run.advances, run.analysis, piX);", "+\t\t\t\t\t\t\tint runX = (orientation & SWT.RIGHT_TO_LEFT) != 0 ? run.width - piX[0] : piX[0];", "+\t\t\t\t\t\t\trect.left = drawX + runX;", "+\t\t\t\t\t\t\trect.top = drawY;", "+\t\t\t\t\t\t\tOS.ScriptCPtoX(selEnd, true, cChars, gGlyphs, run.clusters, run.visAttrs, run.advances, run.analysis, piX);", "+\t\t\t\t\t\t\trunX = (orientation & SWT.RIGHT_TO_LEFT) != 0 ? run.width - piX[0] : piX[0];", "+\t\t\t\t\t\t\trect.right = drawX + runX;", "+\t\t\t\t\t\t\trect.bottom = drawY + lineHeight;", "+\t\t\t\t\t\t\tOS.PatBlt(hdc, rect.left, rect.top, rect.right - rect.left, rect.bottom - rect.top, dwRop);", "+\t\t\t\t\t\t}", "+\t\t\t\t\t}", "+\t\t\t\t}", "+\t\t\t}", "+\t\t\tdrawX += run.width;", "+\t\t}", "+\t\tdrawX = alignmentX;", "+\t\tfor (int i = 0; i < lineRuns.length; i++) {", "+\t\t\tStyleItem run = lineRuns[i];", "+\t\t\tif (run.length == 0) continue;", "+\t\t\tif (drawX > clip.x + clip.width) break;", "+\t\t\tif (drawX + run.width >= clip.x) {", "+\t\t\t\tif (!run.tab && (!run.lineBreak || run.softBreak)) {", "+\t\t\t\t\tint end = run.start + run.length - 1;", "+\t\t\t\t\tint fg = foreground;", "+\t\t\t\t\tboolean fullSelection = hasSelection && selectionStart <= run.start && selectionEnd >= end;", "+\t\t\t\t\tif (fullSelection) {", "+\t\t\t\t\t\tfg = selectionForeground.handle;", "+\t\t\t\t\t} else {", "+\t\t\t\t\t\tif (run.style != null && run.style.foreground != null) fg = run.style.foreground.handle;", "+\t\t\t\t\t}", "+\t\t\t\t\tOS.SetTextColor(hdc, fg);", "+\t\t\t\t\tFont font = null;", "+\t\t\t\t\tif (run.style != null) font = run.style.font;", "+\t\t\t\t\tif (font == null) font = this.font;", "+\t\t\t\t\tif (font == null) font = device.getSystemFont();", "+\t\t\t\t\tOS.SelectObject(hdc, font.handle);", "+\t\t\t\t\tOS.GetTextMetrics(hdc, lptm);", "+\t\t\t\t\tint drawRunY = drawY + (baseline - lptm.tmAscent);", "+\t\t\t\t\tOS.ScriptTextOut(hdc, run.psc, drawX, drawRunY, 0, null, run.analysis , 0, 0, run.glyphs, run.glyphCount, run.advances, null, run.goffsets);", "+\t\t\t\t\tboolean partialSelection = hasSelection && !(selectionStart > end || run.start > selectionEnd);", "+\t\t\t\t\tif (!fullSelection && partialSelection && fg != selectionForeground.handle) {", "+\t\t\t\t\t\tOS.SetTextColor(hdc, selectionForeground.handle);", "-\t\t\t\t\t\tOS.PatBlt(hdc, rect.left, rect.top, rect.right - rect.left, rect.bottom - rect.top, dwRop);", "+\t\t\t\t\t\tOS.ScriptTextOut(hdc, run.psc, drawX, drawRunY, OS.ETO_CLIPPED, rect, run.analysis , 0, 0, run.glyphs, run.glyphCount, run.advances, null, run.goffsets);", "-\t\t\t\t}", "-\t\t\t}", "-\t\t\tdrawX += run.width;", "-\t\t}", "-\t\tdrawX = alignmentX;", "-\t\tfor (int i = 0; i < lineRuns.length; i++) {", "-\t\t\tStyleItem run = lineRuns[i];", "-\t\t\tif (run.length == 0) continue;", "-\t\t\tif (!run.tab && (!run.lineBreak || run.softBreak)) {", "-\t\t\t\tint end = run.start + run.length - 1;", "-\t\t\t\tint fg = foreground;", "-\t\t\t\tboolean fullSelection = hasSelection && selectionStart <= run.start && selectionEnd >= end;", "-\t\t\t\tif (fullSelection) {", "-\t\t\t\t\tfg = selectionForeground.handle;", "-\t\t\t\t} else {", "-\t\t\t\t\tif (run.style != null && run.style.foreground != null) fg = run.style.foreground.handle;", "-\t\t\t\t}", "-\t\t\t\tOS.SetTextColor(hdc, fg);", "-\t\t\t\tFont font = null;", "-\t\t\t\tif (run.style != null) font = run.style.font;", "-\t\t\t\tif (font == null) font = this.font;", "-\t\t\t\tif (font == null) font = device.getSystemFont();", "-\t\t\t\tOS.SelectObject(hdc, font.handle);", "-\t\t\t\tOS.GetTextMetrics(hdc, lptm);", "-\t\t\t\tint drawRunY = drawY + (baseline - lptm.tmAscent);", "-\t\t\t\tOS.ScriptTextOut(hdc, run.psc, drawX, drawRunY, 0, null, run.analysis , 0, 0, run.glyphs, run.glyphCount, run.advances, null, run.goffsets);", "-\t\t\t\tboolean partialSelection = hasSelection && !(selectionStart > end || run.start > selectionEnd);", "-\t\t\t\tif (!fullSelection && partialSelection && fg != selectionForeground.handle) {", "-\t\t\t\t\tOS.SetTextColor(hdc, selectionForeground.handle);", "-\t\t\t\t\tint selStart = Math.max(selectionStart, run.start) - run.start;", "-\t\t\t\t\tint selEnd = Math.min(selectionEnd, end) - run.start;", "-\t\t\t\t\tint cChars = run.length;", "-\t\t\t\t\tint gGlyphs = run.glyphCount;", "-\t\t\t\t\tint[] piX = new int[1];", "-\t\t\t\t\tOS.ScriptCPtoX(selStart, false, cChars, gGlyphs, run.clusters, run.visAttrs, run.advances, run.analysis, piX);", "-\t\t\t\t\tint runX = (orientation & SWT.RIGHT_TO_LEFT) != 0 ? run.width - piX[0] : piX[0];", "-\t\t\t\t\trect.left = drawX + runX;", "-\t\t\t\t\trect.top = drawY;", "-\t\t\t\t\tOS.ScriptCPtoX(selEnd, true, cChars, gGlyphs, run.clusters, run.visAttrs, run.advances, run.analysis, piX);", "-\t\t\t\t\trunX = (orientation & SWT.RIGHT_TO_LEFT) != 0 ? run.width - piX[0] : piX[0];", "-\t\t\t\t\trect.right = drawX + runX;", "-\t\t\t\t\trect.bottom = drawY + lineHeight;", "-\t\t\t\t\tOS.ScriptTextOut(hdc, run.psc, drawX, drawRunY, OS.ETO_CLIPPED, rect, run.analysis , 0, 0, run.glyphs, run.glyphCount, run.advances, null, run.goffsets);"]}], "num": 15167}